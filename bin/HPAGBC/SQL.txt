--執行時間--  2017/5/8 上午 11:30:06
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @parAcmYear As SmallInt
Set @parAcmYear = 105
  Update actPayVisa1 Set acvExchPassNo= AM.F_PassCode, acvExchPassDate=NullIF(AM.F_PassDate, '    /  /  ')
      From actPayVisa1 PV1  
          Left Join actPayVisa PV On PV1.acmYear=PV.acmYear and PV1.acmNo=PV.acmNo And PV1.acvNo=PV.acvNo 
              And PV1.acmNo1=PV.acmNo1 And PV1.acvNo1=PV.acvNo1
              And PV1.acmNo2=PV.acmNo2 And PV1.acvNo2=PV.acvNo2
              And PV1.acpPayYear=PV.acpPayYear And PV1.acpPayNo= PV.acpPayNo And PV1.acvSubNo=PV.acvSubNo
      Left Join  
      (   
      Y105_AccMain AM   
      Join Y105_AccExch AE ON AM.F_VouKind = AE.F_VouKind AND AM.PK_MainNo = AE.PFK_MainNo    
      )  On F_AbatedMainNo=PV.FK_VisaNo And F_AbatedDetailNo=PV.FK_DetailNo 
      Where AE.F_VouKind=8  AND AE.F_DC='1' 
      AND F_AbatedVouKind=1  
      AND EXISTS   
      (SELECT * --F_DC='0'另一方沖轉字號原指定的簽證號需與目前的簽證號相同且金額一致 
       FROM Y105_accExch Z JOIN Y105_accExch Z2 
       ON Z.F_AbatedVouKind=Z2.F_VouKind AND Z.F_AbatedMainNo=Z2.PFK_MainNo AND Z.F_AbatedDetailNo=Z2.PK_DetailNo 
       AND Z.F_VouKind=AE.F_VouKind AND Z.PFK_MainNo=AE.PFK_MainNo AND Z.F_DC='0' 
       AND Z2.F_AbatedVouKind=AE.F_AbatedVouKind AND Z2.F_AbatedMainNo=AE.F_AbatedMainNo AND Z2.F_AbatedDetailNo=AE.F_AbatedDetailNo 
       AND Z2.F_Money=AE.F_Money 
       ) 
  And PV1.acmYear=@parAcmYear And IsNull(PV1.acvExchNo,'')=''  And IsNull(PV1.acvMoney,0)>0  
      And IsNull(AM.F_PassCode,'')<>''

------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:30:06
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @parAcmYear As SmallInt
Set @parAcmYear = 105
  Update actPayVisa1 Set acvExchNo1= AM.F_MakeCode, acvExchMakeDate1=NullIF(AM.F_MakeDate, '    /  /  ') 
      From 
      (actPayVisa1 PV1 Join actPay1 P1 On P1.acmYear=PV1.acmYear And P1.acmNo=IsNull(PV1.acmNoPrv, PV1.acmNo)
      And P1.acpPayYear=PV1.acpPayYear And P1.acpPayNo=PV1.acpPayNo And P1.acpPayNo1=PV1.acpPayNo1
      )
      Left Join actPayVisa PV On PV1.acmYear=PV.acmYear and PV1.acmNo=PV.acmNo And PV1.acvNo=PV.acvNo 
      And PV1.acmNo1=PV.acmNo1 And PV1.acvNo1=PV.acvNo1
      And PV1.acmNo2=PV.acmNo2 And PV1.acvNo2=PV.acvNo2
      And PV1.acpPayYear=PV.acpPayYear And PV1.acpPayNo= PV.acpPayNo And PV1.acvSubNo=PV.acvSubNo
      Join 
      	(	 Y105_AccMain AM  
      		Join Y105_AccExch AE ON AM.F_VouKind = AE.F_VouKind AND AM.PK_MainNo = AE.PFK_MainNo
      	) On  AE.F_AbatedMainNo=PV.FK_VisaNo And AE.F_AbatedDetailNo=PV.FK_DetailNo
      		And AE.F_AbatedVouKind='6'
      		And AE.F_DC='1' 
      Where 1=1
      And AM.F_MakeDate >= P1.acpMarkDate
      And PV1.acmYear=@parAcmYear
      And IsNull(PV1.acvExchNo1,'')='' And IsNull(PV1.acvAdjustMoney,0)>0
      And IsNull(AM.F_MakeCode,'')<>''

------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:30:06
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @parAcmYear As SmallInt
Set @parAcmYear = 105
  Update actPayVisa1 Set acvExchPassNo1= AM.F_PassCode, acvExchPassDate1=NullIF(AM.F_PassDate, '    /  /  ')
      From 
      (actPayVisa1 PV1 Join actPay1 P1 On P1.acmYear=PV1.acmYear And P1.acmNo=IsNull(PV1.acmNoPrv, PV1.acmNo)
      And P1.acpPayYear=PV1.acpPayYear And P1.acpPayNo=PV1.acpPayNo And P1.acpPayNo1=PV1.acpPayNo1
      )
      Left Join actPayVisa PV On PV1.acmYear=PV.acmYear and PV1.acmNo=PV.acmNo And PV1.acvNo=PV.acvNo 
      And PV1.acmNo1=PV.acmNo1 And PV1.acvNo1=PV.acvNo1
      And PV1.acmNo2=PV.acmNo2 And PV1.acvNo2=PV.acvNo2
      And PV1.acpPayYear=PV.acpPayYear And PV1.acpPayNo= PV.acpPayNo And PV1.acvSubNo=PV.acvSubNo
      Join 
      	(	 Y105_AccMain AM  
      		Join Y105_AccExch AE ON AM.F_VouKind = AE.F_VouKind AND AM.PK_MainNo = AE.PFK_MainNo
      	) On  AE.F_AbatedMainNo=PV.FK_VisaNo And AE.F_AbatedDetailNo=PV.FK_DetailNo
      		And AE.F_AbatedVouKind='6'
      		And AE.F_DC='1' 
      Where 1=1
      And AM.F_MakeDate >= P1.acpMarkDate
      And PV1.acmYear=@parAcmYear
      And IsNull(PV1.acvExchNo1,'')='' And IsNull(PV1.acvAdjustMoney,0)>0
      And IsNull(AM.F_PassCode,'')<>''

------------------------------------------------------------

--#2017/5/8 上午 11:30:12#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 上午 11:30:12#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B1831' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 上午 11:30:12
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @parUserNo As Int
Set @parUserNo = 1
Declare @parMenuNo As VarChar(10)
Set @parMenuNo = 'B1831'
Select Distinct Top 100 Percent 
      M.PK_mnuNo, M.mnuMode, M.mnuUrl 
From sysBaseUser B
Join sysUserPower P On B.PK_usrNo=P.PK_usrNo
Join sysGroupData G On G.PK_grpNo=P.PK_grpNo
Join sysMenuBase M On M.PK_MnuNo = G.PK_mnuNo
Join sysGroupName GN On GN.PK_grpNo = G.PK_grpNo 
Where 1=1 
   And B.PK_usrNo=@parUserNo 
   And G.PK_mnuNo=@parMenuNo 
 Order By 
 1 

------------------------------------------------------------

--#2017/5/8 上午 11:30:12#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
--[Parameter Count:1]
--@parMenuID='B1831'
 Select * From SysMenuBase Where PK_MnuNo ='B1831' 
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 上午 11:30:12
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @parAtuoParam1 As DateTime
Set @parAtuoParam1 = '2016/01/01 00:00:00'
Declare @parAtuoParam2 As DateTime
Set @parAtuoParam2 = '2016/12/31 00:00:00'
Declare @parAcvExchNo As VarChar(16)
Set @parAcvExchNo = '10500961'
Select 
IDENTITY(int,1,1) As DataNo,   * Into ##MyTempDT_201705081130122700626 From  (

Select Top 100 Percent
      IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As acmWordNum
      , WD.dptName As WorkDepName
      , PN.plnPlanName As PlanName
      , O.oulOutlayName As OulName
      , IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '') As acmWorkUnitNo
      , IsNull(M1.acmWorkUserNo, M.acmWorkUserNo) As acmWorkUserNo
      , IsNull(M1.acmMarkDate, M.acmMarkDate) As acmMarkDate
      , DS.acvAccKind, DS.acvBgtSourceCode, DS.acvBgtDepCode
      , DS.acvOutlayYear, DS.acvPlanCode, DS.acvOutlayCode
      , DS.acvPlanCodePN, DS.acvOutlayCodePN
      , DS.acvPrePayFlag
      , DS.acvMoney, DS.acvOffSetMoney, DS.acvAdjustMoney
      , IsNull(DS.acvMemo, DS.acpMemo) As acvMemo
      , DS.acmYear
      , DS.acmNo, DS.acvNo
      , DS.acmNo1, DS.acvNo1
      , DS.acmNo2, DS.acvNo2
      , DS.acpPayYear, DS.acpPayNo, DS.acvSubNo
      , DS.acpPayYear1, DS.acpPayNo1, DS.acvSubNo1
      , DS.acmNoPrv, DS.acpPayNoPrv
      , DS.acvExchNo, DS.acvExchMakeDate, DS.acvExchPassDate
      , DS.acvExchNo1, DS.acvExchMakeDate1, DS.acvExchPassDate1
      , DS.acpPayName, DS.acpMarkDate, DS.acpGroupNo
      , DS.acmDate 
From (
      Select 
          PV.acmYear
          , PV.acmNo, PV.acvNo
          , PV.acmNo1, PV.acvNo1
          , PV.acmNo2, PV.acvNo2
          , PV.acpPayYear, PV.acpPayNo, PV.acvSubNo
          , 0 As acpPayYear1, 0 As acpPayNo1, 0 As acvSubNo1
          , PV.acmNoPrv, PV.acpPayNoPrv
          , PV.acvAccKind, PV.acvBgtSourceCode, PV.acvBgtDepCode
          , PV.acvOutlayYear, PV.acvPlanCode, PV.acvOutlayCode
          , PV.acvPlanCodePN, PV.acvOutlayCodePN
          , IsNull(PV.acvPrePayFlag, '0') As acvPrePayFlag
          , PV.acvMoney, 0 As acvOffSetMoney, 0 As acvAdjustMoney
          , PV.acvExchNo, PV.acvExchMakeDate, PV.acvExchPassDate
          , Null As acvExchNo1, Null As acvExchMakeDate1, Null As acvExchPassDate1
          , PV.acvMemo, P.acpMemo
          , P.acpMarkDate, P.acpPayName, P.acpGroupNo 
          , P.acmDate 
      From actPay P 
      	Join actPayVisa PV On P.acmYear=PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo)
      		And P.acpPayYear=PV.acpPayYear And P.acpPayNo=PV.acpPayNo
      Where IsNull(PV.acvMoney,0) <>0 
      Union All
      Select 
          PV1.acmYear
          , PV1.acmNo, PV1.acvNo
          , PV1.acmNo1, PV1.acvNo1
          , PV1.acmNo2, PV.acvNo2
          , PV1.acpPayYear, PV1.acpPayNo, PV1.acvSubNo
          , PV1.acpPayYear1, PV1.acpPayNo1, PV1.acvSubNo1
          , PV1.acmNoPrv, PV1.acpPayNoPrv
          , IsNull(PV1.acvAccKind, PV.acvAccKind) As acvAccKind
          , IsNull(PV1.acvBgtSourceCode, PV.acvBgtSourceCode) As acvBgtSourceCode
          , IsNull(PV1.acvBgtDepCode, PV.acvBgtDepCode) As acvBgtDepCode
          , IsNull(PV1.acvOutlayYear, PV.acvOutlayYear) As acvOutlayYear
          , IsNull(PV1.acvPlanCode, PV.acvPlanCode) As acvPlanCode
          , IsNull(PV1.acvOutlayCode, PV.acvOutlayCode) As acvOutlayCode
          , IsNull(PV1.acvPlanCodePN, PV.acvPlanCodePN) As acvPlanCodePN
          , IsNull(PV1.acvOutlayCodePN, PV.acvOutlayCodePN) As acvOutlayCodePN
          , '0' As acvPrePayFlag
          , 0 As acvMoney, PV1.acvMoney As acvOffSetMoney, PV1.acvAdjustMoney
          , PV1.acvExchNo, PV1.acvExchMakeDate, PV1.acvExchPassDate
          , PV1.acvExchNo1, PV1.acvExchMakeDate1, PV1.acvExchPassDate1
          , PV1.acvMemo, P1.acpMemo
          , P1.acpMarkDate, P1.acpPayName, P1.acpGroupNo
          , P1.acmDate 
      From actPay1 P1 
      	Join actPayVisa1 PV1 On P1.acmYear=PV1.acmYear And P1.acmNo=IsNull(PV1.acmNoPrv, PV1.acmNo)
      		And P1.acpPayYear=PV1.acpPayYear And P1.acpPayNo=PV1.acpPayNo
      		And P1.acpPayYear1=PV1.acpPayYear1 And P1.acpPayNo1=PV1.acpPayNo1
      	Left Join actPayVisa PV On PV1.acmYear=PV.acmYear And PV1.acmNo=PV.acmNo And PV1.acvNo=PV.acvNo
      		And PV1.acmNo1=PV.acmNo1 And PV1.acvNo1=PV.acvNo1
      		And PV1.acmNo2=PV.acmNo2 And PV1.acvNo2=PV.acvNo2
      		And PV1.acpPayYear=PV.acpPayYear And PV1.acpPayNo=PV.acpPayNo And PV1.acvSubNo=PV.acvSubNo
      Where (IsNull(PV1.acvMoney,0) <>0 Or IsNull(PV1.acvAdjustMoney,0)<>0)
  ) DS
	    Left Join actMain M On M.acmYear=DS.acmYear And M.acmNo=DS.acmNo
	    Left Join actMain1 M1 On M1.acmYear=DS.acmYear And M1.acmNo=DS.acmNo And M1.acmNo1=DS.acmNo1
	    Left Join actMain2 M2 On M2.acmYear=DS.acmYear And M2.acmNo=DS.acmNo And M2.acmNo1=DS.acmNo1 And M2.acmNo2=DS.acmNo2
	    Left Join codPlanCode PN On PN.codCodeVer = DS.acvOutlayYear And PN.plnPlanCode = DS.acvPlanCode    
	    Left Join codOutlayCode O On O.codCodeVer = DS.acvOutlayYear And O.oulOutlayCode = DS.acvOutlayCode
	    Left Join codDepartName WD On WD.dptCode = IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '')
Where 1=1 
 And DS.acmDate >= @parAtuoParam1 And DS.acmDate <= @parAtuoParam2 And (acvExchNo=@parAcvExchNo Or acvExchNo1=@parAcvExchNo)
 Order By 
 1 

) DS 
 Order By  1 
------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:30:12
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
 Select Count(*) From ##MyTempDT_201705081130122700626
------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:30:12
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @parBDataNo As SmallInt
Set @parBDataNo = 1
Declare @parEDataNo As SmallInt
Set @parEDataNo = 10
 Select * From ##MyTempDT_201705081130122700626 Where DataNo >=@parBDataNo And DataNo <=@parEDataNo  Order By  1 
------------------------------------------------------------

--#2017/5/8 上午 11:30:12#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
--[Parameter Count:1]
--@parMenuID='B1831'
 Select * From SysMenuBase Where PK_MnuNo ='B1831' 
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 上午 11:30:12
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @parAtuoParam1 As DateTime
Set @parAtuoParam1 = '2016/01/01 00:00:00'
Declare @parAtuoParam2 As DateTime
Set @parAtuoParam2 = '2016/12/31 00:00:00'
Declare @parAcvExchNo As VarChar(16)
Set @parAcvExchNo = '10500961'
Select * from ( 
Select Top 100 Percent
      IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As acmWordNum
      , WD.dptName As WorkDepName
      , PN.plnPlanName As PlanName
      , O.oulOutlayName As OulName
      , IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '') As acmWorkUnitNo
      , IsNull(M1.acmWorkUserNo, M.acmWorkUserNo) As acmWorkUserNo
      , IsNull(M1.acmMarkDate, M.acmMarkDate) As acmMarkDate
      , DS.acvAccKind, DS.acvBgtSourceCode, DS.acvBgtDepCode
      , DS.acvOutlayYear, DS.acvPlanCode, DS.acvOutlayCode
      , DS.acvPlanCodePN, DS.acvOutlayCodePN
      , DS.acvPrePayFlag
      , DS.acvMoney, DS.acvOffSetMoney, DS.acvAdjustMoney
      , IsNull(DS.acvMemo, DS.acpMemo) As acvMemo
      , DS.acmYear
      , DS.acmNo, DS.acvNo
      , DS.acmNo1, DS.acvNo1
      , DS.acmNo2, DS.acvNo2
      , DS.acpPayYear, DS.acpPayNo, DS.acvSubNo
      , DS.acpPayYear1, DS.acpPayNo1, DS.acvSubNo1
      , DS.acmNoPrv, DS.acpPayNoPrv
      , DS.acvExchNo, DS.acvExchMakeDate, DS.acvExchPassDate
      , DS.acvExchNo1, DS.acvExchMakeDate1, DS.acvExchPassDate1
      , DS.acpPayName, DS.acpMarkDate, DS.acpGroupNo
      , DS.acmDate 
From (
      Select 
          PV.acmYear
          , PV.acmNo, PV.acvNo
          , PV.acmNo1, PV.acvNo1
          , PV.acmNo2, PV.acvNo2
          , PV.acpPayYear, PV.acpPayNo, PV.acvSubNo
          , 0 As acpPayYear1, 0 As acpPayNo1, 0 As acvSubNo1
          , PV.acmNoPrv, PV.acpPayNoPrv
          , PV.acvAccKind, PV.acvBgtSourceCode, PV.acvBgtDepCode
          , PV.acvOutlayYear, PV.acvPlanCode, PV.acvOutlayCode
          , PV.acvPlanCodePN, PV.acvOutlayCodePN
          , IsNull(PV.acvPrePayFlag, '0') As acvPrePayFlag
          , PV.acvMoney, 0 As acvOffSetMoney, 0 As acvAdjustMoney
          , PV.acvExchNo, PV.acvExchMakeDate, PV.acvExchPassDate
          , Null As acvExchNo1, Null As acvExchMakeDate1, Null As acvExchPassDate1
          , PV.acvMemo, P.acpMemo
          , P.acpMarkDate, P.acpPayName, P.acpGroupNo 
          , P.acmDate 
      From actPay P 
      	Join actPayVisa PV On P.acmYear=PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo)
      		And P.acpPayYear=PV.acpPayYear And P.acpPayNo=PV.acpPayNo
      Where IsNull(PV.acvMoney,0) <>0 
      Union All
      Select 
          PV1.acmYear
          , PV1.acmNo, PV1.acvNo
          , PV1.acmNo1, PV1.acvNo1
          , PV1.acmNo2, PV.acvNo2
          , PV1.acpPayYear, PV1.acpPayNo, PV1.acvSubNo
          , PV1.acpPayYear1, PV1.acpPayNo1, PV1.acvSubNo1
          , PV1.acmNoPrv, PV1.acpPayNoPrv
          , IsNull(PV1.acvAccKind, PV.acvAccKind) As acvAccKind
          , IsNull(PV1.acvBgtSourceCode, PV.acvBgtSourceCode) As acvBgtSourceCode
          , IsNull(PV1.acvBgtDepCode, PV.acvBgtDepCode) As acvBgtDepCode
          , IsNull(PV1.acvOutlayYear, PV.acvOutlayYear) As acvOutlayYear
          , IsNull(PV1.acvPlanCode, PV.acvPlanCode) As acvPlanCode
          , IsNull(PV1.acvOutlayCode, PV.acvOutlayCode) As acvOutlayCode
          , IsNull(PV1.acvPlanCodePN, PV.acvPlanCodePN) As acvPlanCodePN
          , IsNull(PV1.acvOutlayCodePN, PV.acvOutlayCodePN) As acvOutlayCodePN
          , '0' As acvPrePayFlag
          , 0 As acvMoney, PV1.acvMoney As acvOffSetMoney, PV1.acvAdjustMoney
          , PV1.acvExchNo, PV1.acvExchMakeDate, PV1.acvExchPassDate
          , PV1.acvExchNo1, PV1.acvExchMakeDate1, PV1.acvExchPassDate1
          , PV1.acvMemo, P1.acpMemo
          , P1.acpMarkDate, P1.acpPayName, P1.acpGroupNo
          , P1.acmDate 
      From actPay1 P1 
      	Join actPayVisa1 PV1 On P1.acmYear=PV1.acmYear And P1.acmNo=IsNull(PV1.acmNoPrv, PV1.acmNo)
      		And P1.acpPayYear=PV1.acpPayYear And P1.acpPayNo=PV1.acpPayNo
      		And P1.acpPayYear1=PV1.acpPayYear1 And P1.acpPayNo1=PV1.acpPayNo1
      	Left Join actPayVisa PV On PV1.acmYear=PV.acmYear And PV1.acmNo=PV.acmNo And PV1.acvNo=PV.acvNo
      		And PV1.acmNo1=PV.acmNo1 And PV1.acvNo1=PV.acvNo1
      		And PV1.acmNo2=PV.acmNo2 And PV1.acvNo2=PV.acvNo2
      		And PV1.acpPayYear=PV.acpPayYear And PV1.acpPayNo=PV.acpPayNo And PV1.acvSubNo=PV.acvSubNo
      Where (IsNull(PV1.acvMoney,0) <>0 Or IsNull(PV1.acvAdjustMoney,0)<>0)
  ) DS
	    Left Join actMain M On M.acmYear=DS.acmYear And M.acmNo=DS.acmNo
	    Left Join actMain1 M1 On M1.acmYear=DS.acmYear And M1.acmNo=DS.acmNo And M1.acmNo1=DS.acmNo1
	    Left Join actMain2 M2 On M2.acmYear=DS.acmYear And M2.acmNo=DS.acmNo And M2.acmNo1=DS.acmNo1 And M2.acmNo2=DS.acmNo2
	    Left Join codPlanCode PN On PN.codCodeVer = DS.acvOutlayYear And PN.plnPlanCode = DS.acvPlanCode    
	    Left Join codOutlayCode O On O.codCodeVer = DS.acvOutlayYear And O.oulOutlayCode = DS.acvOutlayCode
	    Left Join codDepartName WD On WD.dptCode = IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '')
Where 1=1 
 And DS.acmDate >= @parAtuoParam1 And DS.acmDate <= @parAtuoParam2 And (acvExchNo=@parAcvExchNo Or acvExchNo1=@parAcvExchNo)
 Order By 
 1 
 ) as data
------------------------------------------------------------

--#2017/5/8 上午 11:30:17#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 上午 11:30:17#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B1831' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 上午 11:30:17
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @parUserNo As Int
Set @parUserNo = 1
Declare @parMenuNo As VarChar(10)
Set @parMenuNo = 'B1831'
Select Distinct Top 100 Percent 
      M.PK_mnuNo, M.mnuMode, M.mnuUrl 
From sysBaseUser B
Join sysUserPower P On B.PK_usrNo=P.PK_usrNo
Join sysGroupData G On G.PK_grpNo=P.PK_grpNo
Join sysMenuBase M On M.PK_MnuNo = G.PK_mnuNo
Join sysGroupName GN On GN.PK_grpNo = G.PK_grpNo 
Where 1=1 
   And B.PK_usrNo=@parUserNo 
   And G.PK_mnuNo=@parMenuNo 
 Order By 
 1 

------------------------------------------------------------

--#2017/5/8 上午 11:30:17#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
--[Parameter Count:1]
--@parMenuID='B1831'
 Select * From SysMenuBase Where PK_MnuNo ='B1831' 
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 上午 11:30:17
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @parAtuoParam1 As DateTime
Set @parAtuoParam1 = '2016/01/01 00:00:00'
Declare @parAtuoParam2 As DateTime
Set @parAtuoParam2 = '2016/12/31 00:00:00'
Declare @parAtuoParam3 As VarChar(16)
Set @parAtuoParam3 = '10500961'
Select 
IDENTITY(int,1,1) As DataNo,   * Into ##MyTempDT_201705081130179580722 From  (

Select Top 100 Percent
      IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As acmWordNum
      , WD.dptName As WorkDepName
      , PN.plnPlanName As PlanName
      , O.oulOutlayName As OulName
      , IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '') As acmWorkUnitNo
      , IsNull(M1.acmWorkUserNo, M.acmWorkUserNo) As acmWorkUserNo
      , IsNull(M1.acmMarkDate, M.acmMarkDate) As acmMarkDate
      , DS.acvAccKind, DS.acvBgtSourceCode, DS.acvBgtDepCode
      , DS.acvOutlayYear, DS.acvPlanCode, DS.acvOutlayCode
      , DS.acvPlanCodePN, DS.acvOutlayCodePN
      , DS.acvPrePayFlag
      , DS.acvMoney, DS.acvOffSetMoney, DS.acvAdjustMoney
      , IsNull(DS.acvMemo, DS.acpMemo) As acvMemo
      , DS.acmYear
      , DS.acmNo, DS.acvNo
      , DS.acmNo1, DS.acvNo1
      , DS.acmNo2, DS.acvNo2
      , DS.acpPayYear, DS.acpPayNo, DS.acvSubNo
      , DS.acpPayYear1, DS.acpPayNo1, DS.acvSubNo1
      , DS.acmNoPrv, DS.acpPayNoPrv
      , DS.acvExchNo, DS.acvExchMakeDate, DS.acvExchPassDate
      , DS.acvExchNo1, DS.acvExchMakeDate1, DS.acvExchPassDate1
      , DS.acpPayName, DS.acpMarkDate, DS.acpGroupNo
      , DS.acmDate 
From (
      Select 
          PV.acmYear
          , PV.acmNo, PV.acvNo
          , PV.acmNo1, PV.acvNo1
          , PV.acmNo2, PV.acvNo2
          , PV.acpPayYear, PV.acpPayNo, PV.acvSubNo
          , 0 As acpPayYear1, 0 As acpPayNo1, 0 As acvSubNo1
          , PV.acmNoPrv, PV.acpPayNoPrv
          , PV.acvAccKind, PV.acvBgtSourceCode, PV.acvBgtDepCode
          , PV.acvOutlayYear, PV.acvPlanCode, PV.acvOutlayCode
          , PV.acvPlanCodePN, PV.acvOutlayCodePN
          , IsNull(PV.acvPrePayFlag, '0') As acvPrePayFlag
          , PV.acvMoney, 0 As acvOffSetMoney, 0 As acvAdjustMoney
          , PV.acvExchNo, PV.acvExchMakeDate, PV.acvExchPassDate
          , Null As acvExchNo1, Null As acvExchMakeDate1, Null As acvExchPassDate1
          , PV.acvMemo, P.acpMemo
          , P.acpMarkDate, P.acpPayName, P.acpGroupNo 
          , P.acmDate 
      From actPay P 
      	Join actPayVisa PV On P.acmYear=PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo)
      		And P.acpPayYear=PV.acpPayYear And P.acpPayNo=PV.acpPayNo
      Where IsNull(PV.acvMoney,0) <>0 
      Union All
      Select 
          PV1.acmYear
          , PV1.acmNo, PV1.acvNo
          , PV1.acmNo1, PV1.acvNo1
          , PV1.acmNo2, PV.acvNo2
          , PV1.acpPayYear, PV1.acpPayNo, PV1.acvSubNo
          , PV1.acpPayYear1, PV1.acpPayNo1, PV1.acvSubNo1
          , PV1.acmNoPrv, PV1.acpPayNoPrv
          , IsNull(PV1.acvAccKind, PV.acvAccKind) As acvAccKind
          , IsNull(PV1.acvBgtSourceCode, PV.acvBgtSourceCode) As acvBgtSourceCode
          , IsNull(PV1.acvBgtDepCode, PV.acvBgtDepCode) As acvBgtDepCode
          , IsNull(PV1.acvOutlayYear, PV.acvOutlayYear) As acvOutlayYear
          , IsNull(PV1.acvPlanCode, PV.acvPlanCode) As acvPlanCode
          , IsNull(PV1.acvOutlayCode, PV.acvOutlayCode) As acvOutlayCode
          , IsNull(PV1.acvPlanCodePN, PV.acvPlanCodePN) As acvPlanCodePN
          , IsNull(PV1.acvOutlayCodePN, PV.acvOutlayCodePN) As acvOutlayCodePN
          , '0' As acvPrePayFlag
          , 0 As acvMoney, PV1.acvMoney As acvOffSetMoney, PV1.acvAdjustMoney
          , PV1.acvExchNo, PV1.acvExchMakeDate, PV1.acvExchPassDate
          , PV1.acvExchNo1, PV1.acvExchMakeDate1, PV1.acvExchPassDate1
          , PV1.acvMemo, P1.acpMemo
          , P1.acpMarkDate, P1.acpPayName, P1.acpGroupNo
          , P1.acmDate 
      From actPay1 P1 
      	Join actPayVisa1 PV1 On P1.acmYear=PV1.acmYear And P1.acmNo=IsNull(PV1.acmNoPrv, PV1.acmNo)
      		And P1.acpPayYear=PV1.acpPayYear And P1.acpPayNo=PV1.acpPayNo
      		And P1.acpPayYear1=PV1.acpPayYear1 And P1.acpPayNo1=PV1.acpPayNo1
      	Left Join actPayVisa PV On PV1.acmYear=PV.acmYear And PV1.acmNo=PV.acmNo And PV1.acvNo=PV.acvNo
      		And PV1.acmNo1=PV.acmNo1 And PV1.acvNo1=PV.acvNo1
      		And PV1.acmNo2=PV.acmNo2 And PV1.acvNo2=PV.acvNo2
      		And PV1.acpPayYear=PV.acpPayYear And PV1.acpPayNo=PV.acpPayNo And PV1.acvSubNo=PV.acvSubNo
      Where (IsNull(PV1.acvMoney,0) <>0 Or IsNull(PV1.acvAdjustMoney,0)<>0)
  ) DS
	    Left Join actMain M On M.acmYear=DS.acmYear And M.acmNo=DS.acmNo
	    Left Join actMain1 M1 On M1.acmYear=DS.acmYear And M1.acmNo=DS.acmNo And M1.acmNo1=DS.acmNo1
	    Left Join actMain2 M2 On M2.acmYear=DS.acmYear And M2.acmNo=DS.acmNo And M2.acmNo1=DS.acmNo1 And M2.acmNo2=DS.acmNo2
	    Left Join codPlanCode PN On PN.codCodeVer = DS.acvOutlayYear And PN.plnPlanCode = DS.acvPlanCode    
	    Left Join codOutlayCode O On O.codCodeVer = DS.acvOutlayYear And O.oulOutlayCode = DS.acvOutlayCode
	    Left Join codDepartName WD On WD.dptCode = IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '')
Where 1=1 
 And DS.acmDate >= @parAtuoParam1 And DS.acmDate <= @parAtuoParam2 And IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) = @parAtuoParam3
 Order By 
 1 

) DS 
 Order By  1 
------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:30:18
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
 Select Count(*) From ##MyTempDT_201705081130179580722
------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:30:18
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @parBDataNo As SmallInt
Set @parBDataNo = 1
Declare @parEDataNo As SmallInt
Set @parEDataNo = 10
 Select * From ##MyTempDT_201705081130179580722 Where DataNo >=@parBDataNo And DataNo <=@parEDataNo  Order By  1 
------------------------------------------------------------

--#2017/5/8 上午 11:30:18#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
--[Parameter Count:1]
--@parMenuID='B1831'
 Select * From SysMenuBase Where PK_MnuNo ='B1831' 
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 上午 11:30:18
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @parAtuoParam1 As DateTime
Set @parAtuoParam1 = '2016/01/01 00:00:00'
Declare @parAtuoParam2 As DateTime
Set @parAtuoParam2 = '2016/12/31 00:00:00'
Declare @parAtuoParam3 As VarChar(16)
Set @parAtuoParam3 = '10500961'
Select * from ( 
Select Top 100 Percent
      IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As acmWordNum
      , WD.dptName As WorkDepName
      , PN.plnPlanName As PlanName
      , O.oulOutlayName As OulName
      , IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '') As acmWorkUnitNo
      , IsNull(M1.acmWorkUserNo, M.acmWorkUserNo) As acmWorkUserNo
      , IsNull(M1.acmMarkDate, M.acmMarkDate) As acmMarkDate
      , DS.acvAccKind, DS.acvBgtSourceCode, DS.acvBgtDepCode
      , DS.acvOutlayYear, DS.acvPlanCode, DS.acvOutlayCode
      , DS.acvPlanCodePN, DS.acvOutlayCodePN
      , DS.acvPrePayFlag
      , DS.acvMoney, DS.acvOffSetMoney, DS.acvAdjustMoney
      , IsNull(DS.acvMemo, DS.acpMemo) As acvMemo
      , DS.acmYear
      , DS.acmNo, DS.acvNo
      , DS.acmNo1, DS.acvNo1
      , DS.acmNo2, DS.acvNo2
      , DS.acpPayYear, DS.acpPayNo, DS.acvSubNo
      , DS.acpPayYear1, DS.acpPayNo1, DS.acvSubNo1
      , DS.acmNoPrv, DS.acpPayNoPrv
      , DS.acvExchNo, DS.acvExchMakeDate, DS.acvExchPassDate
      , DS.acvExchNo1, DS.acvExchMakeDate1, DS.acvExchPassDate1
      , DS.acpPayName, DS.acpMarkDate, DS.acpGroupNo
      , DS.acmDate 
From (
      Select 
          PV.acmYear
          , PV.acmNo, PV.acvNo
          , PV.acmNo1, PV.acvNo1
          , PV.acmNo2, PV.acvNo2
          , PV.acpPayYear, PV.acpPayNo, PV.acvSubNo
          , 0 As acpPayYear1, 0 As acpPayNo1, 0 As acvSubNo1
          , PV.acmNoPrv, PV.acpPayNoPrv
          , PV.acvAccKind, PV.acvBgtSourceCode, PV.acvBgtDepCode
          , PV.acvOutlayYear, PV.acvPlanCode, PV.acvOutlayCode
          , PV.acvPlanCodePN, PV.acvOutlayCodePN
          , IsNull(PV.acvPrePayFlag, '0') As acvPrePayFlag
          , PV.acvMoney, 0 As acvOffSetMoney, 0 As acvAdjustMoney
          , PV.acvExchNo, PV.acvExchMakeDate, PV.acvExchPassDate
          , Null As acvExchNo1, Null As acvExchMakeDate1, Null As acvExchPassDate1
          , PV.acvMemo, P.acpMemo
          , P.acpMarkDate, P.acpPayName, P.acpGroupNo 
          , P.acmDate 
      From actPay P 
      	Join actPayVisa PV On P.acmYear=PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo)
      		And P.acpPayYear=PV.acpPayYear And P.acpPayNo=PV.acpPayNo
      Where IsNull(PV.acvMoney,0) <>0 
      Union All
      Select 
          PV1.acmYear
          , PV1.acmNo, PV1.acvNo
          , PV1.acmNo1, PV1.acvNo1
          , PV1.acmNo2, PV.acvNo2
          , PV1.acpPayYear, PV1.acpPayNo, PV1.acvSubNo
          , PV1.acpPayYear1, PV1.acpPayNo1, PV1.acvSubNo1
          , PV1.acmNoPrv, PV1.acpPayNoPrv
          , IsNull(PV1.acvAccKind, PV.acvAccKind) As acvAccKind
          , IsNull(PV1.acvBgtSourceCode, PV.acvBgtSourceCode) As acvBgtSourceCode
          , IsNull(PV1.acvBgtDepCode, PV.acvBgtDepCode) As acvBgtDepCode
          , IsNull(PV1.acvOutlayYear, PV.acvOutlayYear) As acvOutlayYear
          , IsNull(PV1.acvPlanCode, PV.acvPlanCode) As acvPlanCode
          , IsNull(PV1.acvOutlayCode, PV.acvOutlayCode) As acvOutlayCode
          , IsNull(PV1.acvPlanCodePN, PV.acvPlanCodePN) As acvPlanCodePN
          , IsNull(PV1.acvOutlayCodePN, PV.acvOutlayCodePN) As acvOutlayCodePN
          , '0' As acvPrePayFlag
          , 0 As acvMoney, PV1.acvMoney As acvOffSetMoney, PV1.acvAdjustMoney
          , PV1.acvExchNo, PV1.acvExchMakeDate, PV1.acvExchPassDate
          , PV1.acvExchNo1, PV1.acvExchMakeDate1, PV1.acvExchPassDate1
          , PV1.acvMemo, P1.acpMemo
          , P1.acpMarkDate, P1.acpPayName, P1.acpGroupNo
          , P1.acmDate 
      From actPay1 P1 
      	Join actPayVisa1 PV1 On P1.acmYear=PV1.acmYear And P1.acmNo=IsNull(PV1.acmNoPrv, PV1.acmNo)
      		And P1.acpPayYear=PV1.acpPayYear And P1.acpPayNo=PV1.acpPayNo
      		And P1.acpPayYear1=PV1.acpPayYear1 And P1.acpPayNo1=PV1.acpPayNo1
      	Left Join actPayVisa PV On PV1.acmYear=PV.acmYear And PV1.acmNo=PV.acmNo And PV1.acvNo=PV.acvNo
      		And PV1.acmNo1=PV.acmNo1 And PV1.acvNo1=PV.acvNo1
      		And PV1.acmNo2=PV.acmNo2 And PV1.acvNo2=PV.acvNo2
      		And PV1.acpPayYear=PV.acpPayYear And PV1.acpPayNo=PV.acpPayNo And PV1.acvSubNo=PV.acvSubNo
      Where (IsNull(PV1.acvMoney,0) <>0 Or IsNull(PV1.acvAdjustMoney,0)<>0)
  ) DS
	    Left Join actMain M On M.acmYear=DS.acmYear And M.acmNo=DS.acmNo
	    Left Join actMain1 M1 On M1.acmYear=DS.acmYear And M1.acmNo=DS.acmNo And M1.acmNo1=DS.acmNo1
	    Left Join actMain2 M2 On M2.acmYear=DS.acmYear And M2.acmNo=DS.acmNo And M2.acmNo1=DS.acmNo1 And M2.acmNo2=DS.acmNo2
	    Left Join codPlanCode PN On PN.codCodeVer = DS.acvOutlayYear And PN.plnPlanCode = DS.acvPlanCode    
	    Left Join codOutlayCode O On O.codCodeVer = DS.acvOutlayYear And O.oulOutlayCode = DS.acvOutlayCode
	    Left Join codDepartName WD On WD.dptCode = IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '')
Where 1=1 
 And DS.acmDate >= @parAtuoParam1 And DS.acmDate <= @parAtuoParam2 And IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) = @parAtuoParam3
 Order By 
 1 
 ) as data
------------------------------------------------------------

--#2017/5/8 上午 11:30:28#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 上午 11:30:28#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B1831' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 上午 11:30:28
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @parUserNo As Int
Set @parUserNo = 1
Declare @parMenuNo As VarChar(10)
Set @parMenuNo = 'B1831'
Select Distinct Top 100 Percent 
      M.PK_mnuNo, M.mnuMode, M.mnuUrl 
From sysBaseUser B
Join sysUserPower P On B.PK_usrNo=P.PK_usrNo
Join sysGroupData G On G.PK_grpNo=P.PK_grpNo
Join sysMenuBase M On M.PK_MnuNo = G.PK_mnuNo
Join sysGroupName GN On GN.PK_grpNo = G.PK_grpNo 
Where 1=1 
   And B.PK_usrNo=@parUserNo 
   And G.PK_mnuNo=@parMenuNo 
 Order By 
 1 

------------------------------------------------------------

--#2017/5/8 上午 11:30:28#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
--[Parameter Count:1]
--@parMenuID='B1831'
 Select * From SysMenuBase Where PK_MnuNo ='B1831' 
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 上午 11:30:28
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：4
Declare @parAtuoParam1 As DateTime
Set @parAtuoParam1 = '2016/01/01 00:00:00'
Declare @parAtuoParam2 As DateTime
Set @parAtuoParam2 = '2016/12/31 00:00:00'
Declare @parAtuoParam3 As VarChar(16)
Set @parAtuoParam3 = '10500961'
Declare @parAtuoParam4 As VarChar(8)
Set @parAtuoParam4 = '%台東%'
Select 
IDENTITY(int,1,1) As DataNo,   * Into ##MyTempDT_201705081130283590901 From  (

Select Top 100 Percent
      IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As acmWordNum
      , WD.dptName As WorkDepName
      , PN.plnPlanName As PlanName
      , O.oulOutlayName As OulName
      , IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '') As acmWorkUnitNo
      , IsNull(M1.acmWorkUserNo, M.acmWorkUserNo) As acmWorkUserNo
      , IsNull(M1.acmMarkDate, M.acmMarkDate) As acmMarkDate
      , DS.acvAccKind, DS.acvBgtSourceCode, DS.acvBgtDepCode
      , DS.acvOutlayYear, DS.acvPlanCode, DS.acvOutlayCode
      , DS.acvPlanCodePN, DS.acvOutlayCodePN
      , DS.acvPrePayFlag
      , DS.acvMoney, DS.acvOffSetMoney, DS.acvAdjustMoney
      , IsNull(DS.acvMemo, DS.acpMemo) As acvMemo
      , DS.acmYear
      , DS.acmNo, DS.acvNo
      , DS.acmNo1, DS.acvNo1
      , DS.acmNo2, DS.acvNo2
      , DS.acpPayYear, DS.acpPayNo, DS.acvSubNo
      , DS.acpPayYear1, DS.acpPayNo1, DS.acvSubNo1
      , DS.acmNoPrv, DS.acpPayNoPrv
      , DS.acvExchNo, DS.acvExchMakeDate, DS.acvExchPassDate
      , DS.acvExchNo1, DS.acvExchMakeDate1, DS.acvExchPassDate1
      , DS.acpPayName, DS.acpMarkDate, DS.acpGroupNo
      , DS.acmDate 
From (
      Select 
          PV.acmYear
          , PV.acmNo, PV.acvNo
          , PV.acmNo1, PV.acvNo1
          , PV.acmNo2, PV.acvNo2
          , PV.acpPayYear, PV.acpPayNo, PV.acvSubNo
          , 0 As acpPayYear1, 0 As acpPayNo1, 0 As acvSubNo1
          , PV.acmNoPrv, PV.acpPayNoPrv
          , PV.acvAccKind, PV.acvBgtSourceCode, PV.acvBgtDepCode
          , PV.acvOutlayYear, PV.acvPlanCode, PV.acvOutlayCode
          , PV.acvPlanCodePN, PV.acvOutlayCodePN
          , IsNull(PV.acvPrePayFlag, '0') As acvPrePayFlag
          , PV.acvMoney, 0 As acvOffSetMoney, 0 As acvAdjustMoney
          , PV.acvExchNo, PV.acvExchMakeDate, PV.acvExchPassDate
          , Null As acvExchNo1, Null As acvExchMakeDate1, Null As acvExchPassDate1
          , PV.acvMemo, P.acpMemo
          , P.acpMarkDate, P.acpPayName, P.acpGroupNo 
          , P.acmDate 
      From actPay P 
      	Join actPayVisa PV On P.acmYear=PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo)
      		And P.acpPayYear=PV.acpPayYear And P.acpPayNo=PV.acpPayNo
      Where IsNull(PV.acvMoney,0) <>0 
      Union All
      Select 
          PV1.acmYear
          , PV1.acmNo, PV1.acvNo
          , PV1.acmNo1, PV1.acvNo1
          , PV1.acmNo2, PV.acvNo2
          , PV1.acpPayYear, PV1.acpPayNo, PV1.acvSubNo
          , PV1.acpPayYear1, PV1.acpPayNo1, PV1.acvSubNo1
          , PV1.acmNoPrv, PV1.acpPayNoPrv
          , IsNull(PV1.acvAccKind, PV.acvAccKind) As acvAccKind
          , IsNull(PV1.acvBgtSourceCode, PV.acvBgtSourceCode) As acvBgtSourceCode
          , IsNull(PV1.acvBgtDepCode, PV.acvBgtDepCode) As acvBgtDepCode
          , IsNull(PV1.acvOutlayYear, PV.acvOutlayYear) As acvOutlayYear
          , IsNull(PV1.acvPlanCode, PV.acvPlanCode) As acvPlanCode
          , IsNull(PV1.acvOutlayCode, PV.acvOutlayCode) As acvOutlayCode
          , IsNull(PV1.acvPlanCodePN, PV.acvPlanCodePN) As acvPlanCodePN
          , IsNull(PV1.acvOutlayCodePN, PV.acvOutlayCodePN) As acvOutlayCodePN
          , '0' As acvPrePayFlag
          , 0 As acvMoney, PV1.acvMoney As acvOffSetMoney, PV1.acvAdjustMoney
          , PV1.acvExchNo, PV1.acvExchMakeDate, PV1.acvExchPassDate
          , PV1.acvExchNo1, PV1.acvExchMakeDate1, PV1.acvExchPassDate1
          , PV1.acvMemo, P1.acpMemo
          , P1.acpMarkDate, P1.acpPayName, P1.acpGroupNo
          , P1.acmDate 
      From actPay1 P1 
      	Join actPayVisa1 PV1 On P1.acmYear=PV1.acmYear And P1.acmNo=IsNull(PV1.acmNoPrv, PV1.acmNo)
      		And P1.acpPayYear=PV1.acpPayYear And P1.acpPayNo=PV1.acpPayNo
      		And P1.acpPayYear1=PV1.acpPayYear1 And P1.acpPayNo1=PV1.acpPayNo1
      	Left Join actPayVisa PV On PV1.acmYear=PV.acmYear And PV1.acmNo=PV.acmNo And PV1.acvNo=PV.acvNo
      		And PV1.acmNo1=PV.acmNo1 And PV1.acvNo1=PV.acvNo1
      		And PV1.acmNo2=PV.acmNo2 And PV1.acvNo2=PV.acvNo2
      		And PV1.acpPayYear=PV.acpPayYear And PV1.acpPayNo=PV.acpPayNo And PV1.acvSubNo=PV.acvSubNo
      Where (IsNull(PV1.acvMoney,0) <>0 Or IsNull(PV1.acvAdjustMoney,0)<>0)
  ) DS
	    Left Join actMain M On M.acmYear=DS.acmYear And M.acmNo=DS.acmNo
	    Left Join actMain1 M1 On M1.acmYear=DS.acmYear And M1.acmNo=DS.acmNo And M1.acmNo1=DS.acmNo1
	    Left Join actMain2 M2 On M2.acmYear=DS.acmYear And M2.acmNo=DS.acmNo And M2.acmNo1=DS.acmNo1 And M2.acmNo2=DS.acmNo2
	    Left Join codPlanCode PN On PN.codCodeVer = DS.acvOutlayYear And PN.plnPlanCode = DS.acvPlanCode    
	    Left Join codOutlayCode O On O.codCodeVer = DS.acvOutlayYear And O.oulOutlayCode = DS.acvOutlayCode
	    Left Join codDepartName WD On WD.dptCode = IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '')
Where 1=1 
 And DS.acmDate >= @parAtuoParam1 And DS.acmDate <= @parAtuoParam2 And IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) = @parAtuoParam3 And acpPayName Like @parAtuoParam4
 Order By 
 1 

) DS 
 Order By  1 
------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:30:28
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
 Select Count(*) From ##MyTempDT_201705081130283590901
------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:30:28
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @parBDataNo As SmallInt
Set @parBDataNo = 1
Declare @parEDataNo As SmallInt
Set @parEDataNo = 10
 Select * From ##MyTempDT_201705081130283590901 Where DataNo >=@parBDataNo And DataNo <=@parEDataNo  Order By  1 
------------------------------------------------------------

--#2017/5/8 上午 11:30:28#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
--[Parameter Count:1]
--@parMenuID='B1831'
 Select * From SysMenuBase Where PK_MnuNo ='B1831' 
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 上午 11:30:28
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：4
Declare @parAtuoParam1 As DateTime
Set @parAtuoParam1 = '2016/01/01 00:00:00'
Declare @parAtuoParam2 As DateTime
Set @parAtuoParam2 = '2016/12/31 00:00:00'
Declare @parAtuoParam3 As VarChar(16)
Set @parAtuoParam3 = '10500961'
Declare @parAtuoParam4 As VarChar(8)
Set @parAtuoParam4 = '%台東%'
Select * from ( 
Select Top 100 Percent
      IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As acmWordNum
      , WD.dptName As WorkDepName
      , PN.plnPlanName As PlanName
      , O.oulOutlayName As OulName
      , IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '') As acmWorkUnitNo
      , IsNull(M1.acmWorkUserNo, M.acmWorkUserNo) As acmWorkUserNo
      , IsNull(M1.acmMarkDate, M.acmMarkDate) As acmMarkDate
      , DS.acvAccKind, DS.acvBgtSourceCode, DS.acvBgtDepCode
      , DS.acvOutlayYear, DS.acvPlanCode, DS.acvOutlayCode
      , DS.acvPlanCodePN, DS.acvOutlayCodePN
      , DS.acvPrePayFlag
      , DS.acvMoney, DS.acvOffSetMoney, DS.acvAdjustMoney
      , IsNull(DS.acvMemo, DS.acpMemo) As acvMemo
      , DS.acmYear
      , DS.acmNo, DS.acvNo
      , DS.acmNo1, DS.acvNo1
      , DS.acmNo2, DS.acvNo2
      , DS.acpPayYear, DS.acpPayNo, DS.acvSubNo
      , DS.acpPayYear1, DS.acpPayNo1, DS.acvSubNo1
      , DS.acmNoPrv, DS.acpPayNoPrv
      , DS.acvExchNo, DS.acvExchMakeDate, DS.acvExchPassDate
      , DS.acvExchNo1, DS.acvExchMakeDate1, DS.acvExchPassDate1
      , DS.acpPayName, DS.acpMarkDate, DS.acpGroupNo
      , DS.acmDate 
From (
      Select 
          PV.acmYear
          , PV.acmNo, PV.acvNo
          , PV.acmNo1, PV.acvNo1
          , PV.acmNo2, PV.acvNo2
          , PV.acpPayYear, PV.acpPayNo, PV.acvSubNo
          , 0 As acpPayYear1, 0 As acpPayNo1, 0 As acvSubNo1
          , PV.acmNoPrv, PV.acpPayNoPrv
          , PV.acvAccKind, PV.acvBgtSourceCode, PV.acvBgtDepCode
          , PV.acvOutlayYear, PV.acvPlanCode, PV.acvOutlayCode
          , PV.acvPlanCodePN, PV.acvOutlayCodePN
          , IsNull(PV.acvPrePayFlag, '0') As acvPrePayFlag
          , PV.acvMoney, 0 As acvOffSetMoney, 0 As acvAdjustMoney
          , PV.acvExchNo, PV.acvExchMakeDate, PV.acvExchPassDate
          , Null As acvExchNo1, Null As acvExchMakeDate1, Null As acvExchPassDate1
          , PV.acvMemo, P.acpMemo
          , P.acpMarkDate, P.acpPayName, P.acpGroupNo 
          , P.acmDate 
      From actPay P 
      	Join actPayVisa PV On P.acmYear=PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo)
      		And P.acpPayYear=PV.acpPayYear And P.acpPayNo=PV.acpPayNo
      Where IsNull(PV.acvMoney,0) <>0 
      Union All
      Select 
          PV1.acmYear
          , PV1.acmNo, PV1.acvNo
          , PV1.acmNo1, PV1.acvNo1
          , PV1.acmNo2, PV.acvNo2
          , PV1.acpPayYear, PV1.acpPayNo, PV1.acvSubNo
          , PV1.acpPayYear1, PV1.acpPayNo1, PV1.acvSubNo1
          , PV1.acmNoPrv, PV1.acpPayNoPrv
          , IsNull(PV1.acvAccKind, PV.acvAccKind) As acvAccKind
          , IsNull(PV1.acvBgtSourceCode, PV.acvBgtSourceCode) As acvBgtSourceCode
          , IsNull(PV1.acvBgtDepCode, PV.acvBgtDepCode) As acvBgtDepCode
          , IsNull(PV1.acvOutlayYear, PV.acvOutlayYear) As acvOutlayYear
          , IsNull(PV1.acvPlanCode, PV.acvPlanCode) As acvPlanCode
          , IsNull(PV1.acvOutlayCode, PV.acvOutlayCode) As acvOutlayCode
          , IsNull(PV1.acvPlanCodePN, PV.acvPlanCodePN) As acvPlanCodePN
          , IsNull(PV1.acvOutlayCodePN, PV.acvOutlayCodePN) As acvOutlayCodePN
          , '0' As acvPrePayFlag
          , 0 As acvMoney, PV1.acvMoney As acvOffSetMoney, PV1.acvAdjustMoney
          , PV1.acvExchNo, PV1.acvExchMakeDate, PV1.acvExchPassDate
          , PV1.acvExchNo1, PV1.acvExchMakeDate1, PV1.acvExchPassDate1
          , PV1.acvMemo, P1.acpMemo
          , P1.acpMarkDate, P1.acpPayName, P1.acpGroupNo
          , P1.acmDate 
      From actPay1 P1 
      	Join actPayVisa1 PV1 On P1.acmYear=PV1.acmYear And P1.acmNo=IsNull(PV1.acmNoPrv, PV1.acmNo)
      		And P1.acpPayYear=PV1.acpPayYear And P1.acpPayNo=PV1.acpPayNo
      		And P1.acpPayYear1=PV1.acpPayYear1 And P1.acpPayNo1=PV1.acpPayNo1
      	Left Join actPayVisa PV On PV1.acmYear=PV.acmYear And PV1.acmNo=PV.acmNo And PV1.acvNo=PV.acvNo
      		And PV1.acmNo1=PV.acmNo1 And PV1.acvNo1=PV.acvNo1
      		And PV1.acmNo2=PV.acmNo2 And PV1.acvNo2=PV.acvNo2
      		And PV1.acpPayYear=PV.acpPayYear And PV1.acpPayNo=PV.acpPayNo And PV1.acvSubNo=PV.acvSubNo
      Where (IsNull(PV1.acvMoney,0) <>0 Or IsNull(PV1.acvAdjustMoney,0)<>0)
  ) DS
	    Left Join actMain M On M.acmYear=DS.acmYear And M.acmNo=DS.acmNo
	    Left Join actMain1 M1 On M1.acmYear=DS.acmYear And M1.acmNo=DS.acmNo And M1.acmNo1=DS.acmNo1
	    Left Join actMain2 M2 On M2.acmYear=DS.acmYear And M2.acmNo=DS.acmNo And M2.acmNo1=DS.acmNo1 And M2.acmNo2=DS.acmNo2
	    Left Join codPlanCode PN On PN.codCodeVer = DS.acvOutlayYear And PN.plnPlanCode = DS.acvPlanCode    
	    Left Join codOutlayCode O On O.codCodeVer = DS.acvOutlayYear And O.oulOutlayCode = DS.acvOutlayCode
	    Left Join codDepartName WD On WD.dptCode = IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '')
Where 1=1 
 And DS.acmDate >= @parAtuoParam1 And DS.acmDate <= @parAtuoParam2 And IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) = @parAtuoParam3 And acpPayName Like @parAtuoParam4
 Order By 
 1 
 ) as data
------------------------------------------------------------

--#2017/5/8 上午 11:30:50#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 上午 11:30:50#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B1831' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 上午 11:30:50
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @parUserNo As Int
Set @parUserNo = 1
Declare @parMenuNo As VarChar(10)
Set @parMenuNo = 'B1831'
Select Distinct Top 100 Percent 
      M.PK_mnuNo, M.mnuMode, M.mnuUrl 
From sysBaseUser B
Join sysUserPower P On B.PK_usrNo=P.PK_usrNo
Join sysGroupData G On G.PK_grpNo=P.PK_grpNo
Join sysMenuBase M On M.PK_MnuNo = G.PK_mnuNo
Join sysGroupName GN On GN.PK_grpNo = G.PK_grpNo 
Where 1=1 
   And B.PK_usrNo=@parUserNo 
   And G.PK_mnuNo=@parMenuNo 
 Order By 
 1 

------------------------------------------------------------

--#2017/5/8 上午 11:30:50#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
--[Parameter Count:1]
--@parMenuID='B1831'
 Select * From SysMenuBase Where PK_MnuNo ='B1831' 
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 上午 11:30:50
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：4
Declare @parAtuoParam1 As DateTime
Set @parAtuoParam1 = '2016/01/01 00:00:00'
Declare @parAtuoParam2 As DateTime
Set @parAtuoParam2 = '2016/12/31 00:00:00'
Declare @parAtuoParam3 As VarChar(16)
Set @parAtuoParam3 = '10500961'
Declare @parAtuoParam4 As VarChar(16)
Set @parAtuoParam4 = '%台東縣衛生局%'
Select 
IDENTITY(int,1,1) As DataNo,   * Into ##MyTempDT_201705081130508411351 From  (

Select Top 100 Percent
      IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As acmWordNum
      , WD.dptName As WorkDepName
      , PN.plnPlanName As PlanName
      , O.oulOutlayName As OulName
      , IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '') As acmWorkUnitNo
      , IsNull(M1.acmWorkUserNo, M.acmWorkUserNo) As acmWorkUserNo
      , IsNull(M1.acmMarkDate, M.acmMarkDate) As acmMarkDate
      , DS.acvAccKind, DS.acvBgtSourceCode, DS.acvBgtDepCode
      , DS.acvOutlayYear, DS.acvPlanCode, DS.acvOutlayCode
      , DS.acvPlanCodePN, DS.acvOutlayCodePN
      , DS.acvPrePayFlag
      , DS.acvMoney, DS.acvOffSetMoney, DS.acvAdjustMoney
      , IsNull(DS.acvMemo, DS.acpMemo) As acvMemo
      , DS.acmYear
      , DS.acmNo, DS.acvNo
      , DS.acmNo1, DS.acvNo1
      , DS.acmNo2, DS.acvNo2
      , DS.acpPayYear, DS.acpPayNo, DS.acvSubNo
      , DS.acpPayYear1, DS.acpPayNo1, DS.acvSubNo1
      , DS.acmNoPrv, DS.acpPayNoPrv
      , DS.acvExchNo, DS.acvExchMakeDate, DS.acvExchPassDate
      , DS.acvExchNo1, DS.acvExchMakeDate1, DS.acvExchPassDate1
      , DS.acpPayName, DS.acpMarkDate, DS.acpGroupNo
      , DS.acmDate 
From (
      Select 
          PV.acmYear
          , PV.acmNo, PV.acvNo
          , PV.acmNo1, PV.acvNo1
          , PV.acmNo2, PV.acvNo2
          , PV.acpPayYear, PV.acpPayNo, PV.acvSubNo
          , 0 As acpPayYear1, 0 As acpPayNo1, 0 As acvSubNo1
          , PV.acmNoPrv, PV.acpPayNoPrv
          , PV.acvAccKind, PV.acvBgtSourceCode, PV.acvBgtDepCode
          , PV.acvOutlayYear, PV.acvPlanCode, PV.acvOutlayCode
          , PV.acvPlanCodePN, PV.acvOutlayCodePN
          , IsNull(PV.acvPrePayFlag, '0') As acvPrePayFlag
          , PV.acvMoney, 0 As acvOffSetMoney, 0 As acvAdjustMoney
          , PV.acvExchNo, PV.acvExchMakeDate, PV.acvExchPassDate
          , Null As acvExchNo1, Null As acvExchMakeDate1, Null As acvExchPassDate1
          , PV.acvMemo, P.acpMemo
          , P.acpMarkDate, P.acpPayName, P.acpGroupNo 
          , P.acmDate 
      From actPay P 
      	Join actPayVisa PV On P.acmYear=PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo)
      		And P.acpPayYear=PV.acpPayYear And P.acpPayNo=PV.acpPayNo
      Where IsNull(PV.acvMoney,0) <>0 
      Union All
      Select 
          PV1.acmYear
          , PV1.acmNo, PV1.acvNo
          , PV1.acmNo1, PV1.acvNo1
          , PV1.acmNo2, PV.acvNo2
          , PV1.acpPayYear, PV1.acpPayNo, PV1.acvSubNo
          , PV1.acpPayYear1, PV1.acpPayNo1, PV1.acvSubNo1
          , PV1.acmNoPrv, PV1.acpPayNoPrv
          , IsNull(PV1.acvAccKind, PV.acvAccKind) As acvAccKind
          , IsNull(PV1.acvBgtSourceCode, PV.acvBgtSourceCode) As acvBgtSourceCode
          , IsNull(PV1.acvBgtDepCode, PV.acvBgtDepCode) As acvBgtDepCode
          , IsNull(PV1.acvOutlayYear, PV.acvOutlayYear) As acvOutlayYear
          , IsNull(PV1.acvPlanCode, PV.acvPlanCode) As acvPlanCode
          , IsNull(PV1.acvOutlayCode, PV.acvOutlayCode) As acvOutlayCode
          , IsNull(PV1.acvPlanCodePN, PV.acvPlanCodePN) As acvPlanCodePN
          , IsNull(PV1.acvOutlayCodePN, PV.acvOutlayCodePN) As acvOutlayCodePN
          , '0' As acvPrePayFlag
          , 0 As acvMoney, PV1.acvMoney As acvOffSetMoney, PV1.acvAdjustMoney
          , PV1.acvExchNo, PV1.acvExchMakeDate, PV1.acvExchPassDate
          , PV1.acvExchNo1, PV1.acvExchMakeDate1, PV1.acvExchPassDate1
          , PV1.acvMemo, P1.acpMemo
          , P1.acpMarkDate, P1.acpPayName, P1.acpGroupNo
          , P1.acmDate 
      From actPay1 P1 
      	Join actPayVisa1 PV1 On P1.acmYear=PV1.acmYear And P1.acmNo=IsNull(PV1.acmNoPrv, PV1.acmNo)
      		And P1.acpPayYear=PV1.acpPayYear And P1.acpPayNo=PV1.acpPayNo
      		And P1.acpPayYear1=PV1.acpPayYear1 And P1.acpPayNo1=PV1.acpPayNo1
      	Left Join actPayVisa PV On PV1.acmYear=PV.acmYear And PV1.acmNo=PV.acmNo And PV1.acvNo=PV.acvNo
      		And PV1.acmNo1=PV.acmNo1 And PV1.acvNo1=PV.acvNo1
      		And PV1.acmNo2=PV.acmNo2 And PV1.acvNo2=PV.acvNo2
      		And PV1.acpPayYear=PV.acpPayYear And PV1.acpPayNo=PV.acpPayNo And PV1.acvSubNo=PV.acvSubNo
      Where (IsNull(PV1.acvMoney,0) <>0 Or IsNull(PV1.acvAdjustMoney,0)<>0)
  ) DS
	    Left Join actMain M On M.acmYear=DS.acmYear And M.acmNo=DS.acmNo
	    Left Join actMain1 M1 On M1.acmYear=DS.acmYear And M1.acmNo=DS.acmNo And M1.acmNo1=DS.acmNo1
	    Left Join actMain2 M2 On M2.acmYear=DS.acmYear And M2.acmNo=DS.acmNo And M2.acmNo1=DS.acmNo1 And M2.acmNo2=DS.acmNo2
	    Left Join codPlanCode PN On PN.codCodeVer = DS.acvOutlayYear And PN.plnPlanCode = DS.acvPlanCode    
	    Left Join codOutlayCode O On O.codCodeVer = DS.acvOutlayYear And O.oulOutlayCode = DS.acvOutlayCode
	    Left Join codDepartName WD On WD.dptCode = IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '')
Where 1=1 
 And DS.acmDate >= @parAtuoParam1 And DS.acmDate <= @parAtuoParam2 And IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) = @parAtuoParam3 And acpPayName Like @parAtuoParam4
 Order By 
 1 

) DS 
 Order By  1 
------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:30:50
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
 Select Count(*) From ##MyTempDT_201705081130508411351
------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:30:50
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @parBDataNo As SmallInt
Set @parBDataNo = 1
Declare @parEDataNo As SmallInt
Set @parEDataNo = 10
 Select * From ##MyTempDT_201705081130508411351 Where DataNo >=@parBDataNo And DataNo <=@parEDataNo  Order By  1 
------------------------------------------------------------

--#2017/5/8 上午 11:30:50#  http://localhost/HPAGBC/HPAGFC/UI.TMAccSys.Web/FrmVoucher.aspx?MenuID=B1831
--[Parameter Count:1]
--@parMenuID='B1831'
 Select * From SysMenuBase Where PK_MnuNo ='B1831' 
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 上午 11:30:50
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：4
Declare @parAtuoParam1 As DateTime
Set @parAtuoParam1 = '2016/01/01 00:00:00'
Declare @parAtuoParam2 As DateTime
Set @parAtuoParam2 = '2016/12/31 00:00:00'
Declare @parAtuoParam3 As VarChar(16)
Set @parAtuoParam3 = '10500961'
Declare @parAtuoParam4 As VarChar(16)
Set @parAtuoParam4 = '%台東縣衛生局%'
Select * from ( 
Select Top 100 Percent
      IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As acmWordNum
      , WD.dptName As WorkDepName
      , PN.plnPlanName As PlanName
      , O.oulOutlayName As OulName
      , IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '') As acmWorkUnitNo
      , IsNull(M1.acmWorkUserNo, M.acmWorkUserNo) As acmWorkUserNo
      , IsNull(M1.acmMarkDate, M.acmMarkDate) As acmMarkDate
      , DS.acvAccKind, DS.acvBgtSourceCode, DS.acvBgtDepCode
      , DS.acvOutlayYear, DS.acvPlanCode, DS.acvOutlayCode
      , DS.acvPlanCodePN, DS.acvOutlayCodePN
      , DS.acvPrePayFlag
      , DS.acvMoney, DS.acvOffSetMoney, DS.acvAdjustMoney
      , IsNull(DS.acvMemo, DS.acpMemo) As acvMemo
      , DS.acmYear
      , DS.acmNo, DS.acvNo
      , DS.acmNo1, DS.acvNo1
      , DS.acmNo2, DS.acvNo2
      , DS.acpPayYear, DS.acpPayNo, DS.acvSubNo
      , DS.acpPayYear1, DS.acpPayNo1, DS.acvSubNo1
      , DS.acmNoPrv, DS.acpPayNoPrv
      , DS.acvExchNo, DS.acvExchMakeDate, DS.acvExchPassDate
      , DS.acvExchNo1, DS.acvExchMakeDate1, DS.acvExchPassDate1
      , DS.acpPayName, DS.acpMarkDate, DS.acpGroupNo
      , DS.acmDate 
From (
      Select 
          PV.acmYear
          , PV.acmNo, PV.acvNo
          , PV.acmNo1, PV.acvNo1
          , PV.acmNo2, PV.acvNo2
          , PV.acpPayYear, PV.acpPayNo, PV.acvSubNo
          , 0 As acpPayYear1, 0 As acpPayNo1, 0 As acvSubNo1
          , PV.acmNoPrv, PV.acpPayNoPrv
          , PV.acvAccKind, PV.acvBgtSourceCode, PV.acvBgtDepCode
          , PV.acvOutlayYear, PV.acvPlanCode, PV.acvOutlayCode
          , PV.acvPlanCodePN, PV.acvOutlayCodePN
          , IsNull(PV.acvPrePayFlag, '0') As acvPrePayFlag
          , PV.acvMoney, 0 As acvOffSetMoney, 0 As acvAdjustMoney
          , PV.acvExchNo, PV.acvExchMakeDate, PV.acvExchPassDate
          , Null As acvExchNo1, Null As acvExchMakeDate1, Null As acvExchPassDate1
          , PV.acvMemo, P.acpMemo
          , P.acpMarkDate, P.acpPayName, P.acpGroupNo 
          , P.acmDate 
      From actPay P 
      	Join actPayVisa PV On P.acmYear=PV.acmYear And P.acmNo=IsNull(PV.acmNoPrv, PV.acmNo)
      		And P.acpPayYear=PV.acpPayYear And P.acpPayNo=PV.acpPayNo
      Where IsNull(PV.acvMoney,0) <>0 
      Union All
      Select 
          PV1.acmYear
          , PV1.acmNo, PV1.acvNo
          , PV1.acmNo1, PV1.acvNo1
          , PV1.acmNo2, PV.acvNo2
          , PV1.acpPayYear, PV1.acpPayNo, PV1.acvSubNo
          , PV1.acpPayYear1, PV1.acpPayNo1, PV1.acvSubNo1
          , PV1.acmNoPrv, PV1.acpPayNoPrv
          , IsNull(PV1.acvAccKind, PV.acvAccKind) As acvAccKind
          , IsNull(PV1.acvBgtSourceCode, PV.acvBgtSourceCode) As acvBgtSourceCode
          , IsNull(PV1.acvBgtDepCode, PV.acvBgtDepCode) As acvBgtDepCode
          , IsNull(PV1.acvOutlayYear, PV.acvOutlayYear) As acvOutlayYear
          , IsNull(PV1.acvPlanCode, PV.acvPlanCode) As acvPlanCode
          , IsNull(PV1.acvOutlayCode, PV.acvOutlayCode) As acvOutlayCode
          , IsNull(PV1.acvPlanCodePN, PV.acvPlanCodePN) As acvPlanCodePN
          , IsNull(PV1.acvOutlayCodePN, PV.acvOutlayCodePN) As acvOutlayCodePN
          , '0' As acvPrePayFlag
          , 0 As acvMoney, PV1.acvMoney As acvOffSetMoney, PV1.acvAdjustMoney
          , PV1.acvExchNo, PV1.acvExchMakeDate, PV1.acvExchPassDate
          , PV1.acvExchNo1, PV1.acvExchMakeDate1, PV1.acvExchPassDate1
          , PV1.acvMemo, P1.acpMemo
          , P1.acpMarkDate, P1.acpPayName, P1.acpGroupNo
          , P1.acmDate 
      From actPay1 P1 
      	Join actPayVisa1 PV1 On P1.acmYear=PV1.acmYear And P1.acmNo=IsNull(PV1.acmNoPrv, PV1.acmNo)
      		And P1.acpPayYear=PV1.acpPayYear And P1.acpPayNo=PV1.acpPayNo
      		And P1.acpPayYear1=PV1.acpPayYear1 And P1.acpPayNo1=PV1.acpPayNo1
      	Left Join actPayVisa PV On PV1.acmYear=PV.acmYear And PV1.acmNo=PV.acmNo And PV1.acvNo=PV.acvNo
      		And PV1.acmNo1=PV.acmNo1 And PV1.acvNo1=PV.acvNo1
      		And PV1.acmNo2=PV.acmNo2 And PV1.acvNo2=PV.acvNo2
      		And PV1.acpPayYear=PV.acpPayYear And PV1.acpPayNo=PV.acpPayNo And PV1.acvSubNo=PV.acvSubNo
      Where (IsNull(PV1.acvMoney,0) <>0 Or IsNull(PV1.acvAdjustMoney,0)<>0)
  ) DS
	    Left Join actMain M On M.acmYear=DS.acmYear And M.acmNo=DS.acmNo
	    Left Join actMain1 M1 On M1.acmYear=DS.acmYear And M1.acmNo=DS.acmNo And M1.acmNo1=DS.acmNo1
	    Left Join actMain2 M2 On M2.acmYear=DS.acmYear And M2.acmNo=DS.acmNo And M2.acmNo1=DS.acmNo1 And M2.acmNo2=DS.acmNo2
	    Left Join codPlanCode PN On PN.codCodeVer = DS.acvOutlayYear And PN.plnPlanCode = DS.acvPlanCode    
	    Left Join codOutlayCode O On O.codCodeVer = DS.acvOutlayYear And O.oulOutlayCode = DS.acvOutlayCode
	    Left Join codDepartName WD On WD.dptCode = IsNull(IsNull(M1.acmWorkUnitNo, M.acmWorkUnitNo), '')
Where 1=1 
 And DS.acmDate >= @parAtuoParam1 And DS.acmDate <= @parAtuoParam2 And IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) = @parAtuoParam3 And acpPayName Like @parAtuoParam4
 Order By 
 1 
 ) as data
------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:31:10
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(10)
Set @PK_MnuNo = 'B1771'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:31:10
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363

--預撥--------------------------
DECLARE 
@tsbYear_Pre smallint,
@tsbApplyNo_Pre int,
@tsbApplySeq_Pre int,
@tsbDecideNo_Pre int,
@tsbDecideSeq_Pre smallint,
@tsbPrePayYear_Pre smallint,
@tsbPrePayNo_Pre smallint,
@FK_VisaNo_Pre int,
@FK_DetailNo_Pre int,
@F_MakeDate_Pre char(10), 
@F_MakeNo_Pre int, 
@F_PassDate_Pre char(10), 
@F_PassNo_Pre int
-- 取得資料
DECLARE Contain_cursor1 CURSOR FOR

--預撥Start-----------
SELECT  tsbYear, tsbApplyNo, tsbApplySeq, tsbDecideNo, tsbDecideSeq, 
		tsbPrePayYear, tsbPrePayNo, FK_VisaNo,  FK_DetailNo
FROM    tsbPrePayDtl
WHERE   (tsbYear = 105) 
AND (FK_VisaNo IS NOT NULL) 
AND (LEN(FK_VisaNo) > 0) 
AND (tsbExchNo IS NULL)
--預撥End-----------
OPEN Contain_cursor1
FETCH NEXT FROM Contain_cursor1 INTO 
	@tsbYear_Pre ,@tsbApplyNo_Pre ,@tsbApplySeq_Pre ,@tsbDecideNo_Pre ,@tsbDecideSeq_Pre ,
	@tsbDecideSeq_Pre ,@tsbPrePayNo_Pre ,@FK_VisaNo_Pre ,@FK_DetailNo_Pre 
										
WHILE @@FETCH_STATUS = 0
BEGIN
	print '@@FETCH_STATUS='+convert(varchar,@@FETCH_STATUS)

	select top 1 
	@F_MakeDate_Pre=F_MakeDate, @F_MakeNo_Pre=F_MakeNo, @F_PassDate_Pre=F_PassDate, @F_PassNo_Pre=F_PassNo 
	from [Acc_12].dbo.y105_AccExch
	where F_AbatedMainNo=@FK_VisaNo_Pre
	and F_AbatedDetailNo=@FK_DetailNo_Pre
	and F_AbatedVouKind=1
	and F_VouKind=3

	update tsbPrePayDtl
	set tsbExchNo=convert(varchar,@F_PassNo_Pre),
	    tsbExchMakeDate=convert(datetime,@F_MakeDate_Pre),
		tsbExchPassDate=convert(datetime,@F_PassDate_Pre)
	where FK_VisaNo=@FK_VisaNo_Pre and FK_DetailNo=@FK_DetailNo_Pre

	FETCH NEXT FROM Contain_cursor1 INTO 
		@tsbYear_Pre ,@tsbApplyNo_Pre ,@tsbApplySeq_Pre ,@tsbDecideNo_Pre ,@tsbDecideSeq_Pre ,
		@tsbDecideSeq_Pre ,@tsbPrePayNo_Pre ,@FK_VisaNo_Pre ,@FK_DetailNo_Pre

END
CLOSE Contain_cursor1
DEALLOCATE Contain_cursor1
----------------------------------------------


--核銷--------------------------
DECLARE 
@tsbYear_Pay smallint,
@tsbApplyNo_Pay int,
@tsbApplySeq_Pay int,
@tsbDecideNo_Pay int,
@tsbDecideSeq_Pay smallint,
@tsbPrePayYear_Pay smallint,
@tsbPrePayNo_Pay smallint,
@FK_VisaNo_Pay int,
@FK_DetailNo_Pay int,
@F_MakeDate_Pay char(10), 
@F_MakeNo_Pay int, 
@F_PassDate_Pay char(10), 
@F_PassNo_Pay int
-- 取得資料
DECLARE Contain_cursor2 CURSOR FOR

--核銷(實支)Start-----------
SELECT  tsbYear, tsbApplyNo, tsbApplySeq, tsbDecideNo, tsbDecideSeq, 
		tsbPayYear, tsbPayNo, FK_VisaNo, FK_DetailNo
FROM    tsbPayDtl
WHERE   (tsbYear = 105) 
AND (FK_VisaNo IS NOT NULL) 
AND (LEN(FK_VisaNo) > 0) 
AND (tsbCash > 0) 
AND (tsbExchNo IS NULL)
--核銷(實支)End-----------
OPEN Contain_cursor2
FETCH NEXT FROM Contain_cursor2 INTO 
	@tsbYear_Pay ,@tsbApplyNo_Pay ,@tsbApplySeq_Pay ,@tsbDecideNo_Pay ,@tsbDecideSeq_Pay ,
	@tsbDecideSeq_Pay ,@tsbPrePayNo_Pay ,@FK_VisaNo_Pay ,@FK_DetailNo_Pay 
										
WHILE @@FETCH_STATUS = 0
BEGIN
	print '@@FETCH_STATUS='+convert(varchar,@@FETCH_STATUS)

	select top 1 
	@F_MakeDate_Pay=F_MakeDate, @F_MakeNo_Pay=F_MakeNo, @F_PassDate_Pay=F_PassDate, @F_PassNo_Pay=F_PassNo 
	from [Acc_12].dbo.y105_AccExch
	where F_AbatedMainNo=@FK_VisaNo_Pay
	and F_AbatedDetailNo=@FK_DetailNo_Pay
	and F_AbatedVouKind=1
	and F_VouKind=3

	update tsbPayDtl
	set tsbExchNo=convert(varchar,@F_PassNo_Pay),
	    tsbExchMakeDate=convert(datetime,@F_MakeDate_Pay),
		tsbExchPassDate=convert(datetime,@F_PassDate_Pay)
	where FK_VisaNo=@FK_VisaNo_Pay and FK_DetailNo=@FK_DetailNo_Pay

	FETCH NEXT FROM Contain_cursor2 INTO 
		@tsbYear_Pay ,@tsbApplyNo_Pay ,@tsbApplySeq_Pay ,@tsbDecideNo_Pay ,@tsbDecideSeq_Pay ,
		@tsbDecideSeq_Pay ,@tsbPrePayNo_Pay ,@FK_VisaNo_Pay ,@FK_DetailNo_Pay

END
CLOSE Contain_cursor2
DEALLOCATE Contain_cursor2
----------------------------------------------

--估列--------------------------
DECLARE 
@tsbYear_Est smallint,
@tsbApplyNo_Est int,
@tsbApplySeq_Est int,
@tsbDecideNo_Est int,
@tsbDecideSeq_Est smallint,
@tsbPrePayYear_Est smallint,
@tsbPrePayNo_Est smallint,
@FK_VisaNo_Est int,
@FK_DetailNo_Est int,
@F_MakeDate_Est char(10), 
@F_MakeNo_Est int, 
@F_PassDate_Est char(10), 
@F_PassNo_Est int
-- 取得資料
DECLARE Contain_cursor3 CURSOR FOR

--估列Start-----------
SELECT  tsbYear, tsbApplyNo, tsbApplySeq, tsbDecideNo, tsbDecideSeq, 
		0 AS tsbEstimateYear, tsbEstimateNo, FK_VisaNo, FK_DetailNo
FROM    tsbEstimate
WHERE   (tsbYear = 105) 
AND (FK_VisaNo IS NOT NULL) 
AND (LEN(FK_VisaNo) > 0) 
AND (tsbExchNo IS NULL)
--估列End-----------
OPEN Contain_cursor3
FETCH NEXT FROM Contain_cursor3 INTO 
	@tsbYear_Est ,@tsbApplyNo_Est ,@tsbApplySeq_Est ,@tsbDecideNo_Est ,@tsbDecideSeq_Est ,
	@tsbDecideSeq_Est ,@tsbPrePayNo_Est ,@FK_VisaNo_Est ,@FK_DetailNo_Est 
										
WHILE @@FETCH_STATUS = 0
BEGIN
	print '@@FETCH_STATUS='+convert(varchar,@@FETCH_STATUS)

	select top 1 
	@F_MakeDate_Est=F_MakeDate, @F_MakeNo_Est=F_MakeNo, @F_PassDate_Est=F_PassDate, @F_PassNo_Est=F_PassNo 
	from [Acc_12].dbo.y105_AccExch
	where F_AbatedMainNo=@FK_VisaNo_Est
	and F_AbatedDetailNo=@FK_DetailNo_Est
	and F_AbatedVouKind=1
	and F_VouKind=3

	update tsbEstimate
	set tsbExchNo=convert(varchar,@F_PassNo_Est),
	    tsbExchMakeDate=convert(datetime,@F_MakeDate_Est),
		tsbExchPassDate=convert(datetime,@F_PassDate_Est)
	where FK_VisaNo=@FK_VisaNo_Est and FK_DetailNo=@FK_DetailNo_Est

	FETCH NEXT FROM Contain_cursor3 INTO 
		@tsbYear_Est ,@tsbApplyNo_Est ,@tsbApplySeq_Est ,@tsbDecideNo_Est ,@tsbDecideSeq_Est ,
		@tsbDecideSeq_Est ,@tsbPrePayNo_Est ,@FK_VisaNo_Est ,@FK_DetailNo_Est

END
CLOSE Contain_cursor3
DEALLOCATE Contain_cursor3
----------------------------------------------

------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:31:10
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @tsbYear As SmallInt
Set @tsbYear = 105

--Declare @tsbYear As SmallInt
--Set @tsbYear = 105

select B.ExchType,	B.日期,
	A.tsbApplyWordNum,
	A.tsbLastApplyWordNum,
	B.FK_ViewNo,
	B.FK_VisaNo,
	B.FK_DetailNo,
	B.檢視碼,
	B.ViewCode,
	A.plnPlanCode,
	A.tsbPlanName,
	A.tsbTrustSubsidyName,
	A.tsbPayeeName,
	B.tsbMoney,
	B.tsbExchNo,
	B.ExchStatus,
	B.tsbExchMakeDate,
	B.tsbExchPassDate,
	A.tsbYear,
	A.tsbApplyNo,
	A.tsbDecideNo,
	A.tsbApplySeq,
	A.tsbDecideSeq,
	B.ViewYear,
	B.ViewNo,
	B.tsbReceiveSeq
from
(
	SELECT  tsbApply.tsbApplyWordNum, tsbApply.tsbLastApplyWordNum, 
			codPlanCode.plnPlanCode, 
			'[' + codPlanCode.plnPlanCode + '] ' + codPlanCode.plnPlanName AS tsbPlanName, 
			tsbApply.tsbTrustSubsidyName, tsbPayee.tsbPayeeName, 
			tsbDecideDtl.tsbYear, tsbDecideDtl.tsbApplyNo, tsbDecideDtl.tsbDecideNo, 
			tsbDecideDtl.tsbApplySeq, tsbDecideDtl.tsbDecideSeq
	FROM    tsbApplyDtl INNER JOIN
			tsbApply ON tsbApplyDtl.tsbYear = tsbApply.tsbYear AND 
			tsbApplyDtl.tsbApplyNo = tsbApply.tsbApplyNo INNER JOIN
			tsbDecide INNER JOIN
			tsbDecideDtl ON tsbDecide.tsbYear = tsbDecideDtl.tsbYear AND 
			tsbDecide.tsbApplyNo = tsbDecideDtl.tsbApplyNo AND 
			tsbDecide.tsbDecideNo = tsbDecideDtl.tsbDecideNo INNER JOIN
			codOutlayCode ON tsbDecideDtl.tsbOutlayYear = codOutlayCode.codCodeVer AND 
			tsbDecideDtl.tsbOutlayCode = codOutlayCode.oulOutlayCode ON 
			tsbApplyDtl.tsbYear = tsbDecideDtl.tsbYear AND tsbApplyDtl.tsbApplyNo = tsbDecideDtl.tsbApplyNo AND 
			tsbApplyDtl.tsbApplySeq = tsbDecideDtl.tsbApplySeq LEFT OUTER JOIN
			codPlanCode ON codPlanCode.codCodeVer = ISNULL(tsbApplyDtl.tsbOutlayYear, tsbApply.tsbBgtYear) 
			AND codPlanCode.plnPlanCode = ISNULL(tsbApplyDtl.tsbPlanCode, tsbApply.tsbPlanCode) LEFT OUTER JOIN
			tsbPayee ON tsbDecideDtl.tsbPayeeNo = tsbPayee.tsbPayeeNo
	WHERE tsbDecideDtl.tsbYear =@tsbYear
	AND	tsbDecideDtl.tsbOutlayYear = tsbDecideDtl.tsbBgtYear
	AND tsbDecideDtl.tsbBgtYear = tsbDecideDtl.tsbOutlayYear
) A
inner join
(
	SELECT  '預撥' AS ExchType, CONVERT(VARCHAR(10), 
			tsbPrePay.tsbMarkDate, 111) AS '日期', 
			CONVERT(VARCHAR,tsbPrePayDtl.FK_VisaNo) + '-' + CONVERT(VARCHAR, tsbPrePayDtl.FK_DetailNo) AS FK_ViewNo, 
			tsbPrePayDtl.FK_VisaNo, tsbPrePayDtl.FK_DetailNo, 
			'預撥號：' + CONVERT(VARCHAR, tsbPrePayDtl.tsbPrePayNo) AS '檢視碼', 
			CONVERT(VARCHAR, tsbPrePayDtl.tsbPrePayNo) + '-0' AS ViewCode, 
			CONVERT(INT, tsbPrePayDtl.tsbMoney) AS tsbMoney, 
			tsbPrePayDtl.tsbExchNo, 
			CASE WHEN isnull(tsbPrePayDtl.tsbExchNo, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
			tsbPrePayDtl.tsbExchMakeDate, tsbPrePayDtl.tsbExchPassDate, tsbPrePayDtl.tsbYear, 
			tsbPrePayDtl.tsbApplyNo, tsbPrePayDtl.tsbDecideNo, tsbPrePayDtl.tsbApplySeq, 
			tsbPrePayDtl.tsbDecideSeq, tsbPrePayDtl.tsbPrePayYear AS ViewYear, 
			tsbPrePayDtl.tsbPrePayNo AS ViewNo, 0 AS tsbReceiveSeq
	FROM    tsbPrePayDtl INNER JOIN
			tsbPrePay ON tsbPrePayDtl.tsbYear = tsbPrePay.tsbYear AND 
			tsbPrePayDtl.tsbApplyNo = tsbPrePay.tsbApplyNo AND 
			tsbPrePayDtl.tsbDecideNo = tsbPrePay.tsbDecideNo AND 
			tsbPrePayDtl.tsbPrePayYear = tsbPrePay.tsbPrePayYear AND 
			tsbPrePayDtl.tsbPrePayNo = tsbPrePay.tsbPrePayNo
	WHERE tsbPrePayDtl.tsbYear =@tsbYear
	AND tsbPrePay.tsbPassFlag = '1'
	union all
	SELECT  '核銷實支' AS ExchType, CONVERT(VARCHAR(10), 
			tsbPay.tsbMarkDate, 111) AS '日期', 
			CONVERT(VARCHAR,tsbPayDtl.FK_VisaNo) + '-' + CONVERT(VARCHAR, tsbPayDtl.FK_DetailNo) AS FK_ViewNo, 
			tsbPayDtl.FK_VisaNo, tsbPayDtl.FK_DetailNo, 
			'核銷號：' + CONVERT(VARCHAR, tsbPayDtl.tsbPayNo) AS '檢視碼', 
			CONVERT(VARCHAR, tsbPayDtl.tsbPayNo) + '-0' AS ViewCode, 
			CONVERT(INT, tsbPayDtl.tsbCash) AS tsbMoney, tsbPayDtl.tsbExchNo, 
			CASE WHEN isnull(tsbPayDtl.tsbExchNo, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
			tsbPayDtl.tsbExchMakeDate, tsbPayDtl.tsbExchPassDate, tsbPayDtl.tsbYear, 
			tsbPayDtl.tsbApplyNo, tsbPayDtl.tsbDecideNo, tsbPayDtl.tsbApplySeq, 
			tsbPayDtl.tsbDecideSeq, tsbPayDtl.tsbPayYear AS ViewYear, 
			tsbPayDtl.tsbPayNo AS ViewNo, 0 AS tsbReceiveSeq
	FROM    tsbPayDtl INNER JOIN
			tsbPay ON tsbPayDtl.tsbYear = tsbPay.tsbYear AND tsbPayDtl.tsbApplyNo = tsbPay.tsbApplyNo AND 
			tsbPayDtl.tsbDecideNo = tsbPay.tsbDecideNo AND tsbPayDtl.tsbPayYear = tsbPay.tsbPayYear AND 
			tsbPayDtl.tsbPayNo = tsbPay.tsbPayNo
	WHERE tsbPayDtl.tsbYear =@tsbYear
	AND	tsbPay.tsbPassFlag = '1'
	AND tsbPayDtl.tsbCash > 0 
	union all
	SELECT  '估列' AS ExchType, 
			CONVERT(VARCHAR(10), tsbEstimateDate, 111) AS '日期', 
			CONVERT(VARCHAR, FK_VisaNo) + '-' + CONVERT(VARCHAR, FK_DetailNo) AS FK_ViewNo, 
			FK_VisaNo, FK_DetailNo, 
			'估列號：' + CONVERT(VARCHAR,tsbEstimateNo) AS '檢視碼', 
			CONVERT(VARCHAR, tsbEstimateNo) + '-0' AS ViewCode, 
			CONVERT(INT, tsbEstimateMoney) AS tsbMoney, tsbExchNo, 
			CASE WHEN isnull(tsbEstimate.tsbExchNo, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
			tsbExchMakeDate, tsbExchPassDate, tsbYear, tsbApplyNo, tsbDecideNo, tsbApplySeq, 
			tsbDecideSeq, 0 AS ViewYear, 
			tsbEstimateNo AS ViewNo, 0 AS tsbReceiveSeq
	FROM    tsbEstimate
	WHERE tsbEstimate.tsbYear =@tsbYear
	AND	tsbEstimate.tsbPassFlag = '1'
	union all
-- 	SELECT  '核銷轉正' AS ExchType, 
-- 			CONVERT(VARCHAR(10), tsbPay.tsbMarkDate, 111) AS '日期', 
-- 			CONVERT(VARCHAR, tsbPayOffset.FK_VisaNo1) + '-' + CONVERT(VARCHAR, tsbPayOffset.FK_DetailNo1) AS FK_ViewNo, 
-- 			tsbPayOffset.FK_VisaNo1 as FK_VisaNo, tsbPayOffset.FK_DetailNo1 as FK_DetailNo, 
--             --  暫時先把沖抵資料 tsbPrePayYear ＆ tsbPrePayNo 記錄在這。 in 105/04/28
-- 			CONVERT(VARCHAR, tsbPayOffset.tsbPrePayYear) + '-' + CONVERT(VARCHAR, tsbPayOffset.tsbPrePayNo) AS '檢視碼', 
-- 			CONVERT(VARCHAR, tsbPayDtl.tsbPayNo) + '-0' AS ViewCode, 
-- 			CONVERT(INT, tsbPayOffset.tsbPreMoney) AS tsbMoney, 
--             tsbPayOffset.tsbExchNo1 as tsbExchNo, 
-- 			CASE WHEN isnull(tsbPayDtl.tsbExchNo1, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
-- 			tsbPayOffset.tsbExchMakeDate1 as tsbExchMakeDate, 
--             tsbPayOffset.tsbExchPassDate1 as tsbExchPassDate, 
-- 			tsbPayDtl.tsbYear, tsbPayDtl.tsbApplyNo, tsbPayDtl.tsbDecideNo,  
-- 			tsbPayDtl.tsbApplySeq, tsbPayDtl.tsbDecideSeq, 
--             tsbPayOffset.tsbPayYear AS ViewYear, 
-- 			tsbPayOffset.tsbPayNo AS ViewNo, 
--             0 AS tsbReceiveSeq
-- 	FROM    tsbPayDtl
-- 			INNER JOIN tsbPay ON tsbPayDtl.tsbYear = tsbPay.tsbYear AND 
-- 			                     tsbPayDtl.tsbApplyNo = tsbPay.tsbApplyNo AND tsbPayDtl.tsbDecideNo = tsbPay.tsbDecideNo AND  
-- 		                         tsbPayDtl.tsbPayYear = tsbPay.tsbPayYear AND tsbPayDtl.tsbPayNo = tsbPay.tsbPayNo
--             LEFT JOIN tsbPayOffset ON tsbPayDtl.tsbYear = tsbPayOffset.tsbYear AND 
--                                       tsbPayDtl.tsbApplyNo = tsbPayOffset.tsbApplyNo AND  tsbPayDtl.tsbApplySeq = tsbPayOffset.tsbApplySeq AND
--                                       tsbPayDtl.tsbDecideNo = tsbPayOffset.tsbDecideNo AND tsbPayDtl.tsbDecideSeq = tsbPayOffset.tsbDecideSeq AND
--                                       tsbPayDtl.tsbPayYear = tsbPayOffset.tsbPayYear AND tsbPayDtl.tsbPayNo = tsbPayOffset.tsbPayNo
-- 	WHERE tsbPayDtl.tsbYear = @tsbYear
--           AND ISNULL(tsbPayOffset.tsbPreMoney,0) > 0
-- 	      AND tsbPay.tsbPassFlag = '1'
-- 	union all
	SELECT  '預撥繳回' AS ExchType, 
			CONVERT(VARCHAR(10), tsbReceipt.tsbReceiveDate, 111) AS '日期', 
			CONVERT(VARCHAR, tsbReceipt.FK_VisaNo) + '-' + CONVERT(VARCHAR, tsbReceipt.FK_DetailNo) AS FK_ViewNo, 
			tsbReceipt.FK_VisaNo, tsbReceipt.FK_DetailNo, 
			'預撥號：' + CONVERT(VARCHAR, tsbReceipt.tsbPrePayNo)  + '<br/>' + '繳回號：' + CONVERT(VARCHAR, tsbReceipt.tsbReceiveSeq) AS '檢視碼', 
			CONVERT(VARCHAR, tsbReceipt.tsbPrePayNo) + '-' + CONVERT(VARCHAR, tsbReceipt.tsbReceiveSeq) AS ViewCode, 
			CONVERT(INT, tsbReceipt.tsbReceiveMoney) AS tsbMoney, tsbReceipt.tsbExchNo, 
			CASE WHEN isnull(tsbReceipt.tsbExchNo, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
			tsbReceipt.tsbExchMakeDate, tsbReceipt.tsbExchPassDate, 
			tsbReceipt.tsbYear, tsbReceipt.tsbApplyNo, tsbReceipt.tsbDecideNo, tsbReceipt.tsbApplySeq, 
			tsbReceipt.tsbDecideSeq, tsbReceipt.tsbPrePayYear AS ViewYear, 
			tsbReceipt.tsbPrePayNo AS ViewNo, tsbReceipt.tsbReceiveSeq
	FROM    tsbPrePayDtl INNER JOIN
			tsbPrePay ON tsbPrePayDtl.tsbYear = tsbPrePay.tsbYear AND 
			tsbPrePayDtl.tsbApplyNo = tsbPrePay.tsbApplyNo AND 
			tsbPrePayDtl.tsbDecideNo = tsbPrePay.tsbDecideNo AND 
			tsbPrePayDtl.tsbPrePayYear = tsbPrePay.tsbPrePayYear AND 
			tsbPrePayDtl.tsbPrePayNo = tsbPrePay.tsbPrePayNo INNER JOIN
			tsbReceipt ON tsbPrePayDtl.tsbYear = tsbReceipt.tsbYear AND 
			tsbPrePayDtl.tsbApplyNo = tsbReceipt.tsbApplyNo AND 
			tsbPrePayDtl.tsbApplySeq = tsbReceipt.tsbApplySeq AND 
			tsbPrePayDtl.tsbDecideNo = tsbReceipt.tsbDecideNo AND 
			tsbPrePayDtl.tsbDecideSeq = tsbReceipt.tsbDecideSeq AND 
			tsbPrePayDtl.tsbPrePayYear = tsbReceipt.tsbPrePayYear AND 
			tsbPrePayDtl.tsbPrePayNo = tsbReceipt.tsbPrePayNo
	WHERE tsbPrePayDtl.tsbYear =@tsbYear
	AND tsbReceipt.tsbPrePayYear > 0
	AND tsbReceipt.tsbPrePayNo > 0
	union all
	SELECT  '核銷繳回' AS ExchType, 
			CONVERT(VARCHAR(10), tsbReceipt.tsbReceiveDate, 111) AS '日期', 
			CONVERT(VARCHAR, tsbReceipt.FK_VisaNo) + '-' + CONVERT(VARCHAR, tsbReceipt.FK_DetailNo) AS FK_ViewNo, 
			tsbReceipt.FK_VisaNo, tsbReceipt.FK_DetailNo, 
			'核銷號：' + CONVERT(VARCHAR, tsbReceipt.tsbPayNo) + '-' + '繳回號：' + CONVERT(VARCHAR, tsbReceipt.tsbReceiveSeq) AS '檢視碼', 
			CONVERT(VARCHAR, tsbReceipt.tsbPayNo) + '-' + CONVERT(VARCHAR, tsbReceipt.tsbReceiveSeq) AS ViewCode, 
			CONVERT(INT, tsbReceipt.tsbReceiveMoney) AS tsbMoney, tsbReceipt.tsbExchNo, 
			CASE WHEN isnull(tsbReceipt.tsbExchNo, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
			tsbReceipt.tsbExchMakeDate, tsbReceipt.tsbExchPassDate, 
			tsbReceipt.tsbYear, tsbReceipt.tsbApplyNo, tsbReceipt.tsbDecideNo, tsbReceipt.tsbApplySeq, 
			tsbReceipt.tsbDecideSeq, tsbReceipt.tsbPayYear AS ViewYear, 
			tsbReceipt.tsbPayNo AS ViewNo, tsbReceipt.tsbReceiveSeq
	FROM    tsbReceipt INNER JOIN
			tsbPayDtl INNER JOIN
			tsbPay ON tsbPayDtl.tsbYear = tsbPay.tsbYear AND tsbPayDtl.tsbApplyNo = tsbPay.tsbApplyNo AND 
			tsbPayDtl.tsbDecideNo = tsbPay.tsbDecideNo AND tsbPayDtl.tsbPayYear = tsbPay.tsbPayYear AND 
			tsbPayDtl.tsbPayNo = tsbPay.tsbPayNo ON tsbReceipt.tsbYear = tsbPayDtl.tsbYear AND 
			tsbReceipt.tsbApplyNo = tsbPayDtl.tsbApplyNo AND 
			tsbReceipt.tsbApplySeq = tsbPayDtl.tsbApplySeq AND 
			tsbReceipt.tsbDecideNo = tsbPayDtl.tsbDecideNo AND 
			tsbReceipt.tsbDecideSeq = tsbPayDtl.tsbDecideSeq AND 
			tsbReceipt.tsbPayYear = tsbPayDtl.tsbPayYear AND tsbReceipt.tsbPayNo = tsbPayDtl.tsbPayNo
	WHERE tsbReceipt.tsbYear =@tsbYear
	AND tsbReceipt.tsbPayYear > 0
	AND tsbReceipt.tsbPayNo > 0
	union all
	SELECT  '估列繳回' AS ExchType, 
			CONVERT(VARCHAR(10), tsbEstimateOverAgainst.tsbEstiOverAgainstDate, 111) AS '日期', 
			CONVERT(VARCHAR, tsbEstimateOverAgainst.PK_MainNo) + '-' + CONVERT(VARCHAR, tsbEstimateOverAgainst.PK_DetailNo) AS FK_ViewNo, 
			tsbEstimateOverAgainst.PK_MainNo, 
			tsbEstimateOverAgainst.PK_DetailNo, 
			'估列號：' + CONVERT(VARCHAR, tsbEstimateOverAgainst.tsbEstimateNo) + '-' + '繳回號：1' AS '檢視碼', 
			CONVERT(VARCHAR, tsbEstimateOverAgainst.tsbEstimateNo) + '-1' AS ViewCode, 
			CONVERT(INT, tsbEstimateOverAgainst.tsbEstiOverAgainstMoney) AS tsbMoney, 
			tsbEstimateOverAgainst.tran_F_MarkCode, 
			CASE WHEN isnull(tsbEstimateOverAgainst.tran_F_MarkCode, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
			tsbEstimateOverAgainst.tran_F_MarkDate, tsbEstimateOverAgainst.tran_F_PassDate, 
			tsbEstimateOverAgainst.tsbYear, tsbEstimateOverAgainst.tsbApplyNo, 
			tsbEstimateOverAgainst.tsbDecideNo, tsbEstimateOverAgainst.tsbApplySeq, 
			tsbEstimateOverAgainst.tsbDecideSeq, 0 AS ViewYear, 
			tsbEstimateOverAgainst.tsbEstimateNo AS ViewNo, 1 AS tsbReceiveSeq
	FROM    tsbEstimate INNER JOIN
			tsbEstimateOverAgainst ON tsbEstimate.tsbYear = tsbEstimateOverAgainst.tsbYear AND 
			tsbEstimate.tsbEstimateNo = tsbEstimateOverAgainst.tsbEstimateNo AND 
			tsbEstimate.tsbApplyNo = tsbEstimateOverAgainst.tsbApplyNo AND 
			tsbEstimate.tsbApplySeq = tsbEstimateOverAgainst.tsbApplySeq AND 
			tsbEstimate.tsbDecideNo = tsbEstimateOverAgainst.tsbDecideNo AND 
			tsbEstimate.tsbDecideSeq = tsbEstimateOverAgainst.tsbDecideSeq AND 
			tsbEstimate.tsbEstimateType = tsbEstimateOverAgainst.tsbEstimateType
	WHERE tsbEstimateOverAgainst.tsbYear =@tsbYear
) B
on A.tsbYear = B.tsbYear AND 
    A.tsbApplyNo = B.tsbApplyNo AND 
    A.tsbDecideNo = B.tsbDecideNo AND 
    A.tsbApplySeq = B.tsbApplySeq AND 
    A.tsbDecideSeq = B.tsbDecideSeq

------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:31:15
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(10)
Set @PK_MnuNo = 'B1771'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 上午 11:31:15
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @tsbYear As SmallInt
Set @tsbYear = 105

--Declare @tsbYear As SmallInt
--Set @tsbYear = 105

select B.ExchType,	B.日期,
	A.tsbApplyWordNum,
	A.tsbLastApplyWordNum,
	B.FK_ViewNo,
	B.FK_VisaNo,
	B.FK_DetailNo,
	B.檢視碼,
	B.ViewCode,
	A.plnPlanCode,
	A.tsbPlanName,
	A.tsbTrustSubsidyName,
	A.tsbPayeeName,
	B.tsbMoney,
	B.tsbExchNo,
	B.ExchStatus,
	B.tsbExchMakeDate,
	B.tsbExchPassDate,
	A.tsbYear,
	A.tsbApplyNo,
	A.tsbDecideNo,
	A.tsbApplySeq,
	A.tsbDecideSeq,
	B.ViewYear,
	B.ViewNo,
	B.tsbReceiveSeq
from
(
	SELECT  tsbApply.tsbApplyWordNum, tsbApply.tsbLastApplyWordNum, 
			codPlanCode.plnPlanCode, 
			'[' + codPlanCode.plnPlanCode + '] ' + codPlanCode.plnPlanName AS tsbPlanName, 
			tsbApply.tsbTrustSubsidyName, tsbPayee.tsbPayeeName, 
			tsbDecideDtl.tsbYear, tsbDecideDtl.tsbApplyNo, tsbDecideDtl.tsbDecideNo, 
			tsbDecideDtl.tsbApplySeq, tsbDecideDtl.tsbDecideSeq
	FROM    tsbApplyDtl INNER JOIN
			tsbApply ON tsbApplyDtl.tsbYear = tsbApply.tsbYear AND 
			tsbApplyDtl.tsbApplyNo = tsbApply.tsbApplyNo INNER JOIN
			tsbDecide INNER JOIN
			tsbDecideDtl ON tsbDecide.tsbYear = tsbDecideDtl.tsbYear AND 
			tsbDecide.tsbApplyNo = tsbDecideDtl.tsbApplyNo AND 
			tsbDecide.tsbDecideNo = tsbDecideDtl.tsbDecideNo INNER JOIN
			codOutlayCode ON tsbDecideDtl.tsbOutlayYear = codOutlayCode.codCodeVer AND 
			tsbDecideDtl.tsbOutlayCode = codOutlayCode.oulOutlayCode ON 
			tsbApplyDtl.tsbYear = tsbDecideDtl.tsbYear AND tsbApplyDtl.tsbApplyNo = tsbDecideDtl.tsbApplyNo AND 
			tsbApplyDtl.tsbApplySeq = tsbDecideDtl.tsbApplySeq LEFT OUTER JOIN
			codPlanCode ON codPlanCode.codCodeVer = ISNULL(tsbApplyDtl.tsbOutlayYear, tsbApply.tsbBgtYear) 
			AND codPlanCode.plnPlanCode = ISNULL(tsbApplyDtl.tsbPlanCode, tsbApply.tsbPlanCode) LEFT OUTER JOIN
			tsbPayee ON tsbDecideDtl.tsbPayeeNo = tsbPayee.tsbPayeeNo
	WHERE tsbDecideDtl.tsbYear =@tsbYear
	AND	tsbDecideDtl.tsbOutlayYear = tsbDecideDtl.tsbBgtYear
	AND tsbDecideDtl.tsbBgtYear = tsbDecideDtl.tsbOutlayYear
) A
inner join
(
	SELECT  '預撥' AS ExchType, CONVERT(VARCHAR(10), 
			tsbPrePay.tsbMarkDate, 111) AS '日期', 
			CONVERT(VARCHAR,tsbPrePayDtl.FK_VisaNo) + '-' + CONVERT(VARCHAR, tsbPrePayDtl.FK_DetailNo) AS FK_ViewNo, 
			tsbPrePayDtl.FK_VisaNo, tsbPrePayDtl.FK_DetailNo, 
			'預撥號：' + CONVERT(VARCHAR, tsbPrePayDtl.tsbPrePayNo) AS '檢視碼', 
			CONVERT(VARCHAR, tsbPrePayDtl.tsbPrePayNo) + '-0' AS ViewCode, 
			CONVERT(INT, tsbPrePayDtl.tsbMoney) AS tsbMoney, 
			tsbPrePayDtl.tsbExchNo, 
			CASE WHEN isnull(tsbPrePayDtl.tsbExchNo, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
			tsbPrePayDtl.tsbExchMakeDate, tsbPrePayDtl.tsbExchPassDate, tsbPrePayDtl.tsbYear, 
			tsbPrePayDtl.tsbApplyNo, tsbPrePayDtl.tsbDecideNo, tsbPrePayDtl.tsbApplySeq, 
			tsbPrePayDtl.tsbDecideSeq, tsbPrePayDtl.tsbPrePayYear AS ViewYear, 
			tsbPrePayDtl.tsbPrePayNo AS ViewNo, 0 AS tsbReceiveSeq
	FROM    tsbPrePayDtl INNER JOIN
			tsbPrePay ON tsbPrePayDtl.tsbYear = tsbPrePay.tsbYear AND 
			tsbPrePayDtl.tsbApplyNo = tsbPrePay.tsbApplyNo AND 
			tsbPrePayDtl.tsbDecideNo = tsbPrePay.tsbDecideNo AND 
			tsbPrePayDtl.tsbPrePayYear = tsbPrePay.tsbPrePayYear AND 
			tsbPrePayDtl.tsbPrePayNo = tsbPrePay.tsbPrePayNo
	WHERE tsbPrePayDtl.tsbYear =@tsbYear
	AND tsbPrePay.tsbPassFlag = '1'
	union all
	SELECT  '核銷實支' AS ExchType, CONVERT(VARCHAR(10), 
			tsbPay.tsbMarkDate, 111) AS '日期', 
			CONVERT(VARCHAR,tsbPayDtl.FK_VisaNo) + '-' + CONVERT(VARCHAR, tsbPayDtl.FK_DetailNo) AS FK_ViewNo, 
			tsbPayDtl.FK_VisaNo, tsbPayDtl.FK_DetailNo, 
			'核銷號：' + CONVERT(VARCHAR, tsbPayDtl.tsbPayNo) AS '檢視碼', 
			CONVERT(VARCHAR, tsbPayDtl.tsbPayNo) + '-0' AS ViewCode, 
			CONVERT(INT, tsbPayDtl.tsbCash) AS tsbMoney, tsbPayDtl.tsbExchNo, 
			CASE WHEN isnull(tsbPayDtl.tsbExchNo, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
			tsbPayDtl.tsbExchMakeDate, tsbPayDtl.tsbExchPassDate, tsbPayDtl.tsbYear, 
			tsbPayDtl.tsbApplyNo, tsbPayDtl.tsbDecideNo, tsbPayDtl.tsbApplySeq, 
			tsbPayDtl.tsbDecideSeq, tsbPayDtl.tsbPayYear AS ViewYear, 
			tsbPayDtl.tsbPayNo AS ViewNo, 0 AS tsbReceiveSeq
	FROM    tsbPayDtl INNER JOIN
			tsbPay ON tsbPayDtl.tsbYear = tsbPay.tsbYear AND tsbPayDtl.tsbApplyNo = tsbPay.tsbApplyNo AND 
			tsbPayDtl.tsbDecideNo = tsbPay.tsbDecideNo AND tsbPayDtl.tsbPayYear = tsbPay.tsbPayYear AND 
			tsbPayDtl.tsbPayNo = tsbPay.tsbPayNo
	WHERE tsbPayDtl.tsbYear =@tsbYear
	AND	tsbPay.tsbPassFlag = '1'
	AND tsbPayDtl.tsbCash > 0 
	union all
	SELECT  '估列' AS ExchType, 
			CONVERT(VARCHAR(10), tsbEstimateDate, 111) AS '日期', 
			CONVERT(VARCHAR, FK_VisaNo) + '-' + CONVERT(VARCHAR, FK_DetailNo) AS FK_ViewNo, 
			FK_VisaNo, FK_DetailNo, 
			'估列號：' + CONVERT(VARCHAR,tsbEstimateNo) AS '檢視碼', 
			CONVERT(VARCHAR, tsbEstimateNo) + '-0' AS ViewCode, 
			CONVERT(INT, tsbEstimateMoney) AS tsbMoney, tsbExchNo, 
			CASE WHEN isnull(tsbEstimate.tsbExchNo, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
			tsbExchMakeDate, tsbExchPassDate, tsbYear, tsbApplyNo, tsbDecideNo, tsbApplySeq, 
			tsbDecideSeq, 0 AS ViewYear, 
			tsbEstimateNo AS ViewNo, 0 AS tsbReceiveSeq
	FROM    tsbEstimate
	WHERE tsbEstimate.tsbYear =@tsbYear
	AND	tsbEstimate.tsbPassFlag = '1'
	union all
-- 	SELECT  '核銷轉正' AS ExchType, 
-- 			CONVERT(VARCHAR(10), tsbPay.tsbMarkDate, 111) AS '日期', 
-- 			CONVERT(VARCHAR, tsbPayOffset.FK_VisaNo1) + '-' + CONVERT(VARCHAR, tsbPayOffset.FK_DetailNo1) AS FK_ViewNo, 
-- 			tsbPayOffset.FK_VisaNo1 as FK_VisaNo, tsbPayOffset.FK_DetailNo1 as FK_DetailNo, 
--             --  暫時先把沖抵資料 tsbPrePayYear ＆ tsbPrePayNo 記錄在這。 in 105/04/28
-- 			CONVERT(VARCHAR, tsbPayOffset.tsbPrePayYear) + '-' + CONVERT(VARCHAR, tsbPayOffset.tsbPrePayNo) AS '檢視碼', 
-- 			CONVERT(VARCHAR, tsbPayDtl.tsbPayNo) + '-0' AS ViewCode, 
-- 			CONVERT(INT, tsbPayOffset.tsbPreMoney) AS tsbMoney, 
--             tsbPayOffset.tsbExchNo1 as tsbExchNo, 
-- 			CASE WHEN isnull(tsbPayDtl.tsbExchNo1, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
-- 			tsbPayOffset.tsbExchMakeDate1 as tsbExchMakeDate, 
--             tsbPayOffset.tsbExchPassDate1 as tsbExchPassDate, 
-- 			tsbPayDtl.tsbYear, tsbPayDtl.tsbApplyNo, tsbPayDtl.tsbDecideNo,  
-- 			tsbPayDtl.tsbApplySeq, tsbPayDtl.tsbDecideSeq, 
--             tsbPayOffset.tsbPayYear AS ViewYear, 
-- 			tsbPayOffset.tsbPayNo AS ViewNo, 
--             0 AS tsbReceiveSeq
-- 	FROM    tsbPayDtl
-- 			INNER JOIN tsbPay ON tsbPayDtl.tsbYear = tsbPay.tsbYear AND 
-- 			                     tsbPayDtl.tsbApplyNo = tsbPay.tsbApplyNo AND tsbPayDtl.tsbDecideNo = tsbPay.tsbDecideNo AND  
-- 		                         tsbPayDtl.tsbPayYear = tsbPay.tsbPayYear AND tsbPayDtl.tsbPayNo = tsbPay.tsbPayNo
--             LEFT JOIN tsbPayOffset ON tsbPayDtl.tsbYear = tsbPayOffset.tsbYear AND 
--                                       tsbPayDtl.tsbApplyNo = tsbPayOffset.tsbApplyNo AND  tsbPayDtl.tsbApplySeq = tsbPayOffset.tsbApplySeq AND
--                                       tsbPayDtl.tsbDecideNo = tsbPayOffset.tsbDecideNo AND tsbPayDtl.tsbDecideSeq = tsbPayOffset.tsbDecideSeq AND
--                                       tsbPayDtl.tsbPayYear = tsbPayOffset.tsbPayYear AND tsbPayDtl.tsbPayNo = tsbPayOffset.tsbPayNo
-- 	WHERE tsbPayDtl.tsbYear = @tsbYear
--           AND ISNULL(tsbPayOffset.tsbPreMoney,0) > 0
-- 	      AND tsbPay.tsbPassFlag = '1'
-- 	union all
	SELECT  '預撥繳回' AS ExchType, 
			CONVERT(VARCHAR(10), tsbReceipt.tsbReceiveDate, 111) AS '日期', 
			CONVERT(VARCHAR, tsbReceipt.FK_VisaNo) + '-' + CONVERT(VARCHAR, tsbReceipt.FK_DetailNo) AS FK_ViewNo, 
			tsbReceipt.FK_VisaNo, tsbReceipt.FK_DetailNo, 
			'預撥號：' + CONVERT(VARCHAR, tsbReceipt.tsbPrePayNo)  + '<br/>' + '繳回號：' + CONVERT(VARCHAR, tsbReceipt.tsbReceiveSeq) AS '檢視碼', 
			CONVERT(VARCHAR, tsbReceipt.tsbPrePayNo) + '-' + CONVERT(VARCHAR, tsbReceipt.tsbReceiveSeq) AS ViewCode, 
			CONVERT(INT, tsbReceipt.tsbReceiveMoney) AS tsbMoney, tsbReceipt.tsbExchNo, 
			CASE WHEN isnull(tsbReceipt.tsbExchNo, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
			tsbReceipt.tsbExchMakeDate, tsbReceipt.tsbExchPassDate, 
			tsbReceipt.tsbYear, tsbReceipt.tsbApplyNo, tsbReceipt.tsbDecideNo, tsbReceipt.tsbApplySeq, 
			tsbReceipt.tsbDecideSeq, tsbReceipt.tsbPrePayYear AS ViewYear, 
			tsbReceipt.tsbPrePayNo AS ViewNo, tsbReceipt.tsbReceiveSeq
	FROM    tsbPrePayDtl INNER JOIN
			tsbPrePay ON tsbPrePayDtl.tsbYear = tsbPrePay.tsbYear AND 
			tsbPrePayDtl.tsbApplyNo = tsbPrePay.tsbApplyNo AND 
			tsbPrePayDtl.tsbDecideNo = tsbPrePay.tsbDecideNo AND 
			tsbPrePayDtl.tsbPrePayYear = tsbPrePay.tsbPrePayYear AND 
			tsbPrePayDtl.tsbPrePayNo = tsbPrePay.tsbPrePayNo INNER JOIN
			tsbReceipt ON tsbPrePayDtl.tsbYear = tsbReceipt.tsbYear AND 
			tsbPrePayDtl.tsbApplyNo = tsbReceipt.tsbApplyNo AND 
			tsbPrePayDtl.tsbApplySeq = tsbReceipt.tsbApplySeq AND 
			tsbPrePayDtl.tsbDecideNo = tsbReceipt.tsbDecideNo AND 
			tsbPrePayDtl.tsbDecideSeq = tsbReceipt.tsbDecideSeq AND 
			tsbPrePayDtl.tsbPrePayYear = tsbReceipt.tsbPrePayYear AND 
			tsbPrePayDtl.tsbPrePayNo = tsbReceipt.tsbPrePayNo
	WHERE tsbPrePayDtl.tsbYear =@tsbYear
	AND tsbReceipt.tsbPrePayYear > 0
	AND tsbReceipt.tsbPrePayNo > 0
	union all
	SELECT  '核銷繳回' AS ExchType, 
			CONVERT(VARCHAR(10), tsbReceipt.tsbReceiveDate, 111) AS '日期', 
			CONVERT(VARCHAR, tsbReceipt.FK_VisaNo) + '-' + CONVERT(VARCHAR, tsbReceipt.FK_DetailNo) AS FK_ViewNo, 
			tsbReceipt.FK_VisaNo, tsbReceipt.FK_DetailNo, 
			'核銷號：' + CONVERT(VARCHAR, tsbReceipt.tsbPayNo) + '-' + '繳回號：' + CONVERT(VARCHAR, tsbReceipt.tsbReceiveSeq) AS '檢視碼', 
			CONVERT(VARCHAR, tsbReceipt.tsbPayNo) + '-' + CONVERT(VARCHAR, tsbReceipt.tsbReceiveSeq) AS ViewCode, 
			CONVERT(INT, tsbReceipt.tsbReceiveMoney) AS tsbMoney, tsbReceipt.tsbExchNo, 
			CASE WHEN isnull(tsbReceipt.tsbExchNo, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
			tsbReceipt.tsbExchMakeDate, tsbReceipt.tsbExchPassDate, 
			tsbReceipt.tsbYear, tsbReceipt.tsbApplyNo, tsbReceipt.tsbDecideNo, tsbReceipt.tsbApplySeq, 
			tsbReceipt.tsbDecideSeq, tsbReceipt.tsbPayYear AS ViewYear, 
			tsbReceipt.tsbPayNo AS ViewNo, tsbReceipt.tsbReceiveSeq
	FROM    tsbReceipt INNER JOIN
			tsbPayDtl INNER JOIN
			tsbPay ON tsbPayDtl.tsbYear = tsbPay.tsbYear AND tsbPayDtl.tsbApplyNo = tsbPay.tsbApplyNo AND 
			tsbPayDtl.tsbDecideNo = tsbPay.tsbDecideNo AND tsbPayDtl.tsbPayYear = tsbPay.tsbPayYear AND 
			tsbPayDtl.tsbPayNo = tsbPay.tsbPayNo ON tsbReceipt.tsbYear = tsbPayDtl.tsbYear AND 
			tsbReceipt.tsbApplyNo = tsbPayDtl.tsbApplyNo AND 
			tsbReceipt.tsbApplySeq = tsbPayDtl.tsbApplySeq AND 
			tsbReceipt.tsbDecideNo = tsbPayDtl.tsbDecideNo AND 
			tsbReceipt.tsbDecideSeq = tsbPayDtl.tsbDecideSeq AND 
			tsbReceipt.tsbPayYear = tsbPayDtl.tsbPayYear AND tsbReceipt.tsbPayNo = tsbPayDtl.tsbPayNo
	WHERE tsbReceipt.tsbYear =@tsbYear
	AND tsbReceipt.tsbPayYear > 0
	AND tsbReceipt.tsbPayNo > 0
	union all
	SELECT  '估列繳回' AS ExchType, 
			CONVERT(VARCHAR(10), tsbEstimateOverAgainst.tsbEstiOverAgainstDate, 111) AS '日期', 
			CONVERT(VARCHAR, tsbEstimateOverAgainst.PK_MainNo) + '-' + CONVERT(VARCHAR, tsbEstimateOverAgainst.PK_DetailNo) AS FK_ViewNo, 
			tsbEstimateOverAgainst.PK_MainNo, 
			tsbEstimateOverAgainst.PK_DetailNo, 
			'估列號：' + CONVERT(VARCHAR, tsbEstimateOverAgainst.tsbEstimateNo) + '-' + '繳回號：1' AS '檢視碼', 
			CONVERT(VARCHAR, tsbEstimateOverAgainst.tsbEstimateNo) + '-1' AS ViewCode, 
			CONVERT(INT, tsbEstimateOverAgainst.tsbEstiOverAgainstMoney) AS tsbMoney, 
			tsbEstimateOverAgainst.tran_F_MarkCode, 
			CASE WHEN isnull(tsbEstimateOverAgainst.tran_F_MarkCode, 0) > 0 THEN '1' ELSE '0' END AS ExchStatus, 
			tsbEstimateOverAgainst.tran_F_MarkDate, tsbEstimateOverAgainst.tran_F_PassDate, 
			tsbEstimateOverAgainst.tsbYear, tsbEstimateOverAgainst.tsbApplyNo, 
			tsbEstimateOverAgainst.tsbDecideNo, tsbEstimateOverAgainst.tsbApplySeq, 
			tsbEstimateOverAgainst.tsbDecideSeq, 0 AS ViewYear, 
			tsbEstimateOverAgainst.tsbEstimateNo AS ViewNo, 1 AS tsbReceiveSeq
	FROM    tsbEstimate INNER JOIN
			tsbEstimateOverAgainst ON tsbEstimate.tsbYear = tsbEstimateOverAgainst.tsbYear AND 
			tsbEstimate.tsbEstimateNo = tsbEstimateOverAgainst.tsbEstimateNo AND 
			tsbEstimate.tsbApplyNo = tsbEstimateOverAgainst.tsbApplyNo AND 
			tsbEstimate.tsbApplySeq = tsbEstimateOverAgainst.tsbApplySeq AND 
			tsbEstimate.tsbDecideNo = tsbEstimateOverAgainst.tsbDecideNo AND 
			tsbEstimate.tsbDecideSeq = tsbEstimateOverAgainst.tsbDecideSeq AND 
			tsbEstimate.tsbEstimateType = tsbEstimateOverAgainst.tsbEstimateType
	WHERE tsbEstimateOverAgainst.tsbYear =@tsbYear
) B
on A.tsbYear = B.tsbYear AND 
    A.tsbApplyNo = B.tsbApplyNo AND 
    A.tsbDecideNo = B.tsbDecideNo AND 
    A.tsbApplySeq = B.tsbApplySeq AND 
    A.tsbDecideSeq = B.tsbDecideSeq

------------------------------------------------------------

--#2017/5/8 下午 01:33:41#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:33:41#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:33:43
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:33:44.326 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:33:44.989 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:33:45.152 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:33:45.162 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:33:45.252 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:34:00#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:34:00#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:34:00
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:34:00.578 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500033%' 
OR A.tsbLastApplyWordNum LIKE '%10500033%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:34:03#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%2239%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:34:03.434 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:34:04
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:04
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:04
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:34:04.194 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:04.204 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:04.204 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:04.234 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:04.294 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:04.544 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:34:12
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:14
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:34:15#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:34:15#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:34:15
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:34:15.642 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:15.652 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:15.652 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:15.652 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:15.662 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500033%' 
OR A.tsbLastApplyWordNum LIKE '%10500033%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:34:16#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?MenuID=B17621&formStatus=Edit&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%2239%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:34:16.551 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:34:16
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:16
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:16
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:34:16.591 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:16.601 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:16.601 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:16.601 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:16.601 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:34:16.631 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:34:17
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:17
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:20
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:20
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:22
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:22
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:24
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:24
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:25
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:25
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:26
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:26
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:27
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:27
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:28
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:28
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:29
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:29
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:31
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:31
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:32
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:32
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:34:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--#2017/5/8 下午 01:35:59#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:35:59#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:35:59
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:35:59.485 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:35:59.495 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:35:59.495 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:35:59.495 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:35:59.515 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:36:03#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:36:03#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:36:03
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:36:03.405 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500003%' 
OR A.tsbLastApplyWordNum LIKE '%10500003%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:36:06#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%226%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:36:06.819 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:36:06
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:36:06
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:36:06
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:36:06.859 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:06.869 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:06.869 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:06.869 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:06.869 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:06.919 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:36:12#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:36:12#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:36:12
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:36:12.259 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:12.269 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:12.279 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:12.279 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:12.289 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500003%' 
OR A.tsbLastApplyWordNum LIKE '%10500003%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:36:13
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:36:13
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:36:14#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:36:14#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:36:14
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:36:14.906 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:14.906 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:14.916 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:14.916 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:14.926 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500003%' 
OR A.tsbLastApplyWordNum LIKE '%10500003%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:36:15#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?MenuID=B17621&formStatus=Edit&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%226%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:36:15.670 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:36:15
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:36:15
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:36:15
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:36:15.725 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:15.736 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:15.738 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:15.738 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:15.739 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:15.762 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:36:16
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:36:16
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '281'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '06'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:36:17
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:36:17
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '281'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '06'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--#2017/5/8 下午 01:36:37#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:36:37#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:36:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:36:37.516 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500033%' 
OR A.tsbLastApplyWordNum LIKE '%10500033%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:36:39#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?MenuID=B17621&formStatus=Edit&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%2239%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:36:39.503 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:36:39
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:36:39
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:36:39
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:36:39.543 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:39.553 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:39.553 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:39.553 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:39.553 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:36:39.583 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:36:39
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:36:39
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:36:50
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:36:50
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--#2017/5/8 下午 01:37:07#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:37:07#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:37:07
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:37:07.915 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500003%' 
OR A.tsbLastApplyWordNum LIKE '%10500003%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:37:09#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%226%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:37:09.417 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:37:09
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:37:09
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:37:09
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:37:09.457 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:09.467 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:09.467 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:09.467 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:09.467 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:09.547 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:37:17#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?MenuID=B17621&formStatus=Edit&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%226%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:37:17.759 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:37:17
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:37:17
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:37:17
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:37:17.799 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:17.809 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:17.809 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:17.809 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:17.809 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:17.839 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:37:18
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:37:18
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '281'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '06'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:37:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:37:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '281'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '06'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--#2017/5/8 下午 01:37:42#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:37:42#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:37:42
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:37:42.064 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:42.074 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:42.084 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:42.084 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:42.104 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:37:49#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;selectedIndex=8
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:37:49#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;selectedIndex=8
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:37:49
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:37:49.454 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:49.474 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:49.474 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:49.474 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:49.484 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:37:53#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%224514%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:37:53.654 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:37:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 4514

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:37:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:37:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 4514

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:37:53.697 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:53.707 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:53.717 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:53.717 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:53.717 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:37:53.737 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:00#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=1
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:38:00#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=1
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:38:00
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:00.657 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:00.667 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:00.667 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:00.667 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:00.677 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:03#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=2
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:38:03#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=2
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:38:03
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:03.887 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:03.897 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:03.897 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:03.897 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:03.907 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:07#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=3
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:38:07#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=3
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:38:07
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:07.415 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:07.425 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:07.435 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:07.435 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:07.445 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:09#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=4
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:38:09#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=4
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:38:09
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:09.795 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:09.815 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:09.815 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:09.815 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:09.825 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:15#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?MenuID=B17621&formStatus=Edit&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%222957%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:38:15.694 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:38:15
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 2957

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:38:15
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:38:15
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 2957

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:15.744 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:15.754 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:15.754 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:15.754 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:15.754 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:15.784 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:38:16
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 2957
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:38:16
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '721'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '09'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--#2017/5/8 下午 01:38:24#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=4&amp;selectedIndex=1
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:38:24#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=4&amp;selectedIndex=1
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:38:24
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:24.574 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:24.584 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:24.584 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:24.584 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:24.594 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:27#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%222956%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:38:27.356 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:38:27
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 2956

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:38:27
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:38:27
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 2956

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:27.396 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:27.406 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:27.406 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:27.406 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:27.406 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:27.436 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:32#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=4&amp;selectedIndex=2
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:38:32#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=4&amp;selectedIndex=2
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:38:32
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:32.793 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:32.813 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:32.813 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:32.813 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:32.833 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:34#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%222954%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:38:34.071 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:38:34
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 2954

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:38:34
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:38:34
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 2954

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:34.121 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:34.131 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:34.141 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:34.141 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:34.141 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:34.171 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:38#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=10
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:38:38#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=10
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:38:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:38.972 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:38.972 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:38.982 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:38.982 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:38.992 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:41#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=15
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:38:41#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=15
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:38:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:41.923 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:41.933 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:41.933 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:41.933 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:41.953 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:44#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=20
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:38:44#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=20
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:38:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:44.503 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:44.513 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:44.513 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:44.533 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:44.543 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:46#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:38:46#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:38:46
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:46.680 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:46.690 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:46.690 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:46.690 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:46.710 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:49#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=25&amp;selectedIndex=8
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:38:49#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=25&amp;selectedIndex=8
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:38:49
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:49.145 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:49.165 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:49.165 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:49.165 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:49.175 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:38:50#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%2295%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:38:50.768 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:38:50
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 95

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:38:50
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:38:50
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 95

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:38:50.808 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:50.818 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:50.818 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:50.818 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:50.818 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:38:50.848 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:38:57
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 95
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:38:58
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 95
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:39:00#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:39:00#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:39:00
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:39:00.678 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:39:00.688 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:39:00.688 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:39:00.688 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:39:00.698 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:39:03#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?MenuID=B17621&formStatus=Edit&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%2295%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:39:03.534 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:39:03
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 95

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:39:03
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:39:03
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 95

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:39:03.574 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:39:03.584 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:39:03.584 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:39:03.584 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:39:03.584 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:39:03.614 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:39:03
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 95
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:39:03
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '281'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '06'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:39:19
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 95
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:39:19
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 95
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:39:20#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:39:20#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:39:20
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:39:20.832 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:39:20.842 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:39:20.842 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:39:20.852 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:39:20.862 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:41:43#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:41:43#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:41:43
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:41:43.273 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500033%' 
OR A.tsbLastApplyWordNum LIKE '%10500033%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:41:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:41:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:41:46#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:41:46#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:41:46
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:41:46.558 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:41:46.568 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:41:46.568 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:41:46.568 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:41:46.588 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500033%' 
OR A.tsbLastApplyWordNum LIKE '%10500033%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:41:52#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:41:52#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:41:52
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:41:52.754 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500003%' 
OR A.tsbLastApplyWordNum LIKE '%10500003%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:41:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:41:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:41:55#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:41:55#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:41:55
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:41:55.345 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:41:55.358 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:41:55.358 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:41:55.358 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:41:55.368 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500003%' 
OR A.tsbLastApplyWordNum LIKE '%10500003%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:43:10#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:43:10#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:43:10
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:43:10.884 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10504097%' 
OR A.tsbLastApplyWordNum LIKE '%10504097%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:43:18#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%225601%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:43:18.025 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:43:18
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:18
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:18
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:43:18.068 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:18.078 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:18.078 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:18.078 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:18.078 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:18.108 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:43:25
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:25
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:43:26#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:43:26#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:43:26
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:43:26.536 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:26.546 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:26.546 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:26.546 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:26.556 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10504097%' 
OR A.tsbLastApplyWordNum LIKE '%10504097%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:43:28#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:43:28#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:43:28
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:43:28.396 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10504097%' 
OR A.tsbLastApplyWordNum LIKE '%10504097%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:43:29#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?MenuID=B17621&formStatus=Edit&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%225601%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:43:29.758 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:43:29
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:29
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:29
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:43:29.798 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:29.808 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:29.808 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:29.808 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:29.808 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:43:29.838 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:43:30
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:30
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 3

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '721'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 3

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '721'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 3

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '721'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:42
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:42
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:42
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:42
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:42
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:42
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:43
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:43
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:55
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:55
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:55
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:55
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:55
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:55
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:56
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:56
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:56
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:56
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:56
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:43:56
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 3

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '721'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 3

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '721'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 3

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '721'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:46
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:46
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:46
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:46
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:46
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:46
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:47
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:47
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:47
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:47
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:47
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:44:47
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:45:22
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:45:22
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:45:22
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:45:22
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:45:22
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:45:22
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:12
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:12
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:47:13#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:47:13#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:47:13
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:47:13.724 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:47:13.734 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:47:13.734 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:47:13.734 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:47:13.744 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10504097%' 
OR A.tsbLastApplyWordNum LIKE '%10504097%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:47:28#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:47:28#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:47:28
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:47:28.450 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500033%' 
OR A.tsbLastApplyWordNum LIKE '%10500033%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:47:31
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:31
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:47:32#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:47:32#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:47:32
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:47:32.694 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:47:32.714 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:47:32.714 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:47:32.714 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:47:32.724 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500033%' 
OR A.tsbLastApplyWordNum LIKE '%10500033%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:47:35#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:47:35#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:47:35
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:47:35.294 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500033%' 
OR A.tsbLastApplyWordNum LIKE '%10500033%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:47:35#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?MenuID=B17621&formStatus=Edit&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%2239%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:47:35.995 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:47:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:47:36.035 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:47:36.045 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:47:36.045 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:47:36.045 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:47:36.045 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:47:36.127 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:47:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:42
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:42
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:43
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:43
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:46
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:46
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:47
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:47
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:48
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:48
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:50
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:50
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:52
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:47:52
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '02'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:01
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:01
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:48:02#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:48:02#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:48:02
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:02.093 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:02.103 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:02.103 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:02.103 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:02.113 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500033%' 
OR A.tsbLastApplyWordNum LIKE '%10500033%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:05#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:48:05#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=25&selectedIndex=8&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:48:05
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:05.786 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10504097%' 
OR A.tsbLastApplyWordNum LIKE '%10504097%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:07#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%225601%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:48:07.318 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:48:07
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:07
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:07
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:07.358 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:07.368 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:07.368 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:07.368 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:07.368 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:07.398 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:12#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:48:12#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:48:12
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:12.912 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:12.922 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:12.932 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:12.932 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:12.942 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:14#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%225601%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:48:14.882 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:48:14
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:14
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:14
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:14.922 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:14.932 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:14.932 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:14.932 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:14.932 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:14.962 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:21#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;selectedIndex=1
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:48:21#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;selectedIndex=1
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:48:21
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:21.305 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:21.315 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:21.325 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:21.325 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:21.335 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:22#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%225380%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:48:22.758 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:48:22
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5380

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:22
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:22
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5380

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:22.798 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:22.808 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:22.818 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:22.818 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:22.818 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:22.838 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:26#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;selectedIndex=3
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:48:26#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;selectedIndex=3
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:48:26
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:26.056 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:26.066 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:26.066 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:26.066 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:26.076 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:27#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%225108%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:48:27.443 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:48:27
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5108

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:27
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:27
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5108

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:27.493 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:27.503 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:27.503 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:27.503 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:27.503 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:27.533 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:29#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%225108%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:48:29.882 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:48:29
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5108

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:29
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:29
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5108

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:29.922 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:29.932 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:29.932 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:29.932 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:29.932 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:29.962 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:33#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=9
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:48:33#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=9
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:48:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:33.322 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:33.332 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:33.332 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:33.332 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:33.352 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:38#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=14
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:48:38#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=14
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:48:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:38.705 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:38.705 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:38.715 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:38.715 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:38.725 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:41#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=19
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:48:41#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=19
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:48:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:41.299 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:41.309 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:41.309 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:41.309 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:41.319 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:44#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=19&amp;selectedIndex=4
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:48:44#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=19&amp;selectedIndex=4
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:48:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:44.204 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:44.224 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:44.254 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:44.254 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:44.264 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:45#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%22285%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:48:45.576 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:48:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 285

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:48:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 285

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:45.616 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:45.636 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:45.636 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:45.636 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:45.636 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:45.666 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:52#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=24
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:48:52#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=24
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:48:52
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:52.384 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:52.394 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:52.394 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:52.394 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:52.404 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:48:54#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=29
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:48:54#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=29
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:48:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:48:54.497 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:54.507 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:54.507 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:54.507 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:48:54.517 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:04#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=29&amp;selectedIndex=6
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:49:04#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=29&amp;selectedIndex=6
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:49:04
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:04.352 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:04.362 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:04.362 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:04.362 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:04.372 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:05#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%2246%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:49:05.824 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:49:05
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 46

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:05
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:05
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 46

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:05.884 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:05.894 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:05.894 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:05.894 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:05.894 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:05.924 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:08#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=32
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:49:08#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=32
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:49:08
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:08.876 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:08.886 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:08.886 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:08.886 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:08.896 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:11#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=32&amp;selectedIndex=2
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:49:11#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=32&amp;selectedIndex=2
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:49:11
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:11.629 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:11.649 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:11.649 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:11.649 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:11.659 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:13#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%227%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:49:13.237 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:49:13
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 7

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:13
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:13
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 7

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:13.277 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:13.287 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:13.287 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:13.287 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:13.287 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:13.317 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:17#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=32&amp;selectedIndex=3
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:49:17#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=32&amp;selectedIndex=3
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:49:17
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:17.317 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:17.327 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:17.327 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:17.327 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:17.337 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:18#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%226%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:49:18.523 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:49:18
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:18
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:18
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 6

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:18.563 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:18.573 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:18.573 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:18.573 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:18.573 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:18.603 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:22#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=32&amp;selectedIndex=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:49:22#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=32&amp;selectedIndex=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:49:22
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:22.079 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:22.089 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:22.089 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:22.089 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:22.099 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:23#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%229%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:49:23.231 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:49:23
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 9

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:23
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:23
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 9

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:23.266 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:23.276 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:23.286 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:23.286 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:23.286 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:23.306 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:25#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=31
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:49:25#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&pageIndex=31
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:49:25
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:25.670 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:25.680 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:25.680 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:25.680 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:25.690 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:27#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=31&amp;selectedIndex=9
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:49:27#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=31&amp;selectedIndex=9
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:49:27
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:27.651 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:27.661 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:27.661 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:27.661 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:27.671 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:29#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%2210%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:49:29.261 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:49:29
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 10

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:29
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:29
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 10

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:29.303 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:29.313 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:29.313 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:29.313 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:29.313 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:29.343 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:31#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=31&amp;selectedIndex=2
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:49:31#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp;pageIndex=31&amp;selectedIndex=2
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:49:31
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:31.567 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:31.587 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:31.587 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:31.587 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:31.607 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:32#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%2224%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:49:32.903 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:49:32
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 24

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:32
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:32
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 24

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:32.953 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:32.953 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:32.963 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:32.963 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:32.963 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:33.063 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:41#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp%3bpageIndex=31&amp%3bselectedIndex=2
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:49:41#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp%3bpageIndex=31&amp%3bselectedIndex=2
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:49:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:41.474 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500033%' 
OR A.tsbLastApplyWordNum LIKE '%10500033%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:49:43#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%2239%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:49:43.114 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:49:43
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:43
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:49:43
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 39

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:49:43.159 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:43.169 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:43.169 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:43.169 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:43.169 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:49:43.199 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:50:04#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp%3bpageIndex=31&amp%3bselectedIndex=2
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:50:04#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&amp%3bpageIndex=31&amp%3bselectedIndex=2
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:50:04
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:50:04.486 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500961%' 
OR A.tsbLastApplyWordNum LIKE '%10500961%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:50:05#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%221540%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:50:05.706 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:50:05
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 1540

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:05
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:05
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 1540

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:50:05.756 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:05.756 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:05.766 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:05.766 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:05.766 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:05.796 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:50:09
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 1540
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:09
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 1540
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:50:10#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:50:10#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:50:10
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:50:10.295 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:10.305 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:10.305 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:10.305 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:10.315 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500961%' 
OR A.tsbLastApplyWordNum LIKE '%10500961%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:50:11#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?MenuID=B17621&formStatus=Edit&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%221540%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:50:11.755 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:50:11
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 1540

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:11
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:11
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 1540

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:50:11.797 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:11.807 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:11.807 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:11.807 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:11.807 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:11.857 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:50:12
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 1540
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:12
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '723'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '01'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:13
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 1540
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:13
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '723'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '01'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:14
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 1540
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:14
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '723'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '01'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:15
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 1540
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:15
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '723'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '01'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:17
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 1540
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:17
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '723'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '01'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:24
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 1540
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:24
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 1540
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:50:25#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:50:25#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:50:25
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:50:25.225 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:25.235 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:25.245 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:25.245 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:25.255 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500961%' 
OR A.tsbLastApplyWordNum LIKE '%10500961%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:50:30#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:50:30#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:50:30
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:50:30.902 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10504097%' 
OR A.tsbLastApplyWordNum LIKE '%10504097%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:50:32
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:32
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '0'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:50:33#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:50:33#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:50:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:50:33.328 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:33.338 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:33.338 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:33.338 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:33.348 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10504097%' 
OR A.tsbLastApplyWordNum LIKE '%10504097%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 01:50:33#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?MenuID=B17621&formStatus=Edit&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%225601%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 13:50:33.973 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:50:34
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:34
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:34
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 13:50:34.023 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:34.043 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:34.043 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:34.043 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:34.043 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:34.073 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 01:50:34
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:34
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 1

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '286'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 3

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '721'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 3

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '721'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 3

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '721'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:39
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:39
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:39
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:39
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:39
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbApplySeq As Int
Set @tsbApplySeq = 2

SELECT * 
-- A.tsbYear            
--,A.tsbApplyNo         
--,A.tsbApplySeq        
--,A.tsbBgtYear         
--,A.tsbBgtMonth        
--,A.tsbOutlayYear      
--,A.tsbOutlayCode      
--,A.tsbBgtSourceCode   
--,A.tsbAccKind         
--,A.tsbBizCode         
--,A.tsbMoney           
--,A.tsbMemo            
--,A.tsbPlanCode      

FROM tsbApplyDtl A

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo
   AND   A.tsbApplySeq=@tsbApplySeq 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:39
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：3
Declare @OutlayCode As NVarChar(6)
Set @OutlayCode = '722'
Declare @accDepCode As NVarChar(4)
Set @accDepCode = '16'
Declare @codCodeVer As Int
Set @codCodeVer = 105
 
SELECT  DISTINCT  

--LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  

 A.oulOutlayCode as oulOutlayCode
,A.oulOutlayName as oulOutlayName


FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 
And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) 
AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') 

WHERE ( 
--A.codCodeVer=104 
A.codCodeVer=@codCodeVer 
AND (
     --使用者登打用途別日期可能切到隔年去打，但是瀏覽時日期卻是當天造成用途別會撈取不到
    --ISNULL( A.oulCreateDate,'')<=      ( DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))                        --'2015/07/31' 
    --AND 
    ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>     (DATEADD(day, -1, convert(datetime,(convert(char(7),dateadd(month,1,getdate()),111)+'/1'))))  )
 )  

AND (A.oulOutlayCode Like @OutlayCode ) 
                                  --經費單位
AND (W.accDepCode='' OR W.accDepCode = @accDepCode)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1  
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   UPDATE tsbDecide SET 
  tsbPassFlag=@tsbPassFlag

   --第一次為空值，就塞時間，如果有值就略過
, tsbPassDTime =  CASE   WHEN  ISNULL(tsbPassDTime,'') = ''  THEN GETDATE() ELSE  tsbPassDTime  END 
, tsbPassUser= @tsbPassUser

, tsbModifyDTime = GETDATE()  --修改時間
, tsbModifyuser = @tsbPassUser  --修改者


WHERE 
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 01:50:41
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：5
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPassFlag As NVarChar(2)
Set @tsbPassFlag = '1'
Declare @tsbPassUser As NVarChar(10)
Set @tsbPassUser = '系統管理員'

   declare @tsbDecideFlag varchar(1)
set  @tsbDecideFlag = (select  top 1 ISNULL(tsbDecideFlag,'0')
                    from  
					tsbDecide where
tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo=@tsbDecideNo
)

IF ( @tsbDecideFlag='1' ) 
  
declare   @TempTable  table  (
     [tsbYear] [smallint] NOT NULL,
	[tsbApplyNo] [int] NOT NULL,
	[tsbDecideNo] [int] NOT NULL,
	[tsbDecideDate] [datetime] NULL,
	[tsbMarkUnitNo] [varchar](6) NULL,
	[tsbMarkUserNo] [nvarchar](10) NULL,
	[tsbWorkUnitNo] [varchar](6) NULL,
	[tsbWorkUserNo] [nvarchar](10) NULL,
	[tsbMoney] [money] NULL,
	[tsbMemo] [nvarchar](255) NULL,
	[tsbSubMemo] [nvarchar](255) NULL,
	[tsbCreateDTime] [datetime] NULL,
	[tsbCreateUser] [nvarchar](20) NULL,
	[tsbModifyDTime] [datetime] NULL,
	[tsbModifyUser] [nvarchar](20) NULL,
	[tsbPassFlag] [varchar](1) NULL,
	[tsbPassDTime] [datetime] NULL,
	[tsbPassUser] [nvarchar](20) NULL,
	[tsbDecideFlag] [varchar](1) NULL
);

 INSERT  INTO @TempTable 
 SELECT TOP 1 
 
      [tsbYear]
      ,[tsbApplyNo]
      ,[tsbDecideNo]
      ,[tsbDecideDate]
      ,[tsbMarkUnitNo]
      ,[tsbMarkUserNo]
      ,[tsbWorkUnitNo]
      ,[tsbWorkUserNo]
      ,[tsbMoney]
      ,[tsbMemo]
      ,[tsbSubMemo]
      ,[tsbCreateDTime]
      ,[tsbCreateUser]
      ,[tsbModifyDTime]
      ,[tsbModifyUser]
      ,[tsbPassFlag]
      ,[tsbPassDTime]
      ,[tsbPassUser]
      ,[tsbDecideFlag]
 
 
 FROM  tsbDecide  
 where
    tsbYear=@tsbYear
AND tsbApplyNo= @tsbApplyNo
AND tsbDecideNo= @tsbDecideNo     
--------------------------------------actMain2
   Update  dbo.actMain2  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         =T.tsbPassUser
,acmUnitPassFlag     =T.tsbPassFlag
,acmUnitPassDate     =CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )  -- T.tsbPassDTime
,acmUnitPassDTime    =T.tsbPassDTime
,acmUnitPassUser     =T.tsbPassUser
 
	   From   @TempTable   T 
	   where   1 = 1
	        AND  dbo.actMain2.acmYear =T.tsbyear
		    AND  dbo.actMain2.acmNo = T.tsbApplyNo
			--AND  dbo.actMain2.acmNo1 in -
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )
		 --   AND  dbo.actMain2.acmNo2 in 
			--             (
			--				   select D.tsbDecideSeq from tsbDecideDtl  D where
			--				   1=1
			--				   AND D.tsbYear = T.tsbYear
			--				   AND D.tsbApplyNo = T.tsbApplyNo
			--				   AND D.tsbDecideNo =T.tsbDecideNo
			--             )

-------------------------------------------------------------------------------
   Update  dbo.actMain1  set  
 acmPassFlag         =T.tsbPassFlag
,acmPassDate         = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmPassDTime        =T.tsbPassDTime
,acmPassUser         = T.tsbPassUser
,acmUnitPassFlag     = T.tsbPassFlag
,acmUnitPassDate     = CONVERT( DATETIME, CONVERT(VARCHAR (10), T.tsbPassDTime, 111), 111 )
,acmUnitPassDTime    = T.tsbPassDTime
,acmUnitPassUser     = T.tsbPassUser
 
	   From   @TempTable   T 
	   
	   where   1 = 1
	        AND  dbo.actMain1.acmYear =T.tsbyear
		    AND  dbo.actMain1.acmNo = T.tsbApplyNo
			--AND  dbo.actMain1.acmNo1 = 0
			--AND  dbo.actMain2.acpPayYear = T.tsbPrePayYear
		    --AND  dbo.actMain1.acmNo1 in 
			   --          (
						--	   select D.tsbDecideSeq from tsbDecideDtl  D where
						--	   1=1
						--	   AND D.tsbYear = T.tsbYear
						--	   AND D.tsbApplyNo = T.tsbApplyNo
						--	   AND D.tsbDecideNo =T.tsbDecideNo
			   --          )

  Delete  from  @TempTable;

--ELSE
  --delete  from tsbDecide  where 1=0  
------------------------------------------------------------

--#2017/5/8 下午 01:50:42#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 01:50:42#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 01:50:42
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 13:50:42.720 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:42.730 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:42.730 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:42.730 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 13:50:42.740 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10504097%' 
OR A.tsbLastApplyWordNum LIKE '%10504097%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 02:42:43#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:42:43#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 02:42:43
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 14:42:43.714 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500297%' 
OR A.tsbLastApplyWordNum LIKE '%10500297%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 02:42:46#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%22739%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 14:42:46.716 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 02:42:46
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 739

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 02:42:46
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 02:42:46
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 739

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 14:42:46.768 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:42:46.768 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:42:46.779 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:42:46.779 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:42:46.780 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:42:46.814 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 02:42:53#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:42:53#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 02:42:53
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 14:42:53.150 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500223%' 
OR A.tsbLastApplyWordNum LIKE '%10500223%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 02:42:54#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%22271%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 14:42:54.572 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 02:42:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 271

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 02:42:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 02:42:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 271

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 14:42:54.625 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:42:54.635 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:42:54.635 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:42:54.635 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:42:54.635 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:42:54.675 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 02:43:07#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0&WIN=0&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:43:07#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&%3bpageIndex=31&%3bselectedIndex=2&WIN=0&WIN=0&WIN=0&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 02:43:07
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 14:43:07.407 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500297%' 
OR A.tsbLastApplyWordNum LIKE '%10500297%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/8 下午 02:43:09#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%22739%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/08 14:43:09.780 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 02:43:09
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 739

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/8 下午 02:43:09
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 02:43:09
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 739

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/08 14:43:09.820 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:43:09.830 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:43:09.830 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:43:09.830 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:43:09.830 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:43:09.860 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/8 下午 02:44:55#  http://localhost/HPAGBC/HPAGFC/Pay.Web/FrmPay_tsbPay/Default.aspx?MenuID=B17641
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:44:55#  http://localhost/HPAGBC/HPAGFC/Pay.Web/FrmPay_tsbPay/Default.aspx?MenuID=B17641
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17641' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 02:44:55
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17641'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 14:44:55.333 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:44:55.343 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:44:55.343 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:44:55.343 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 14:44:55.373 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
-- 路徑 HPAGBC\Pay.Repository\tsbPayRepository.cs
SELECT
A.tsbApplyWordNum AS AtsbApplyWordNum,
A.tsbPlanCode AS AtsbPlanCode,
A.tsbTrustSubsidyName AS AtsbTrustSubsidyName,
A.tsbLastApplyWordNum as AtsbLastApplyWordNum,
A.tsbBgtYear as AtsbBgtYear,
--A.tsbKindID AS AtsbKindID,
A.tsbKindNum as  AtsbKindNum,

B.tsbYear AS BtsbYear,
B.tsbApplyNo AS BtsbApplyNo,
B.tsbDecideNo AS BtsbDecideNo,
B.tsbDecideDate AS BtsbDecideDate,
--B.tsbPayeeKind AS BtsbPayeeKind,
B.tsbMarkUnitNo AS BtsbMarkUnitNo,
B.tsbMarkUserNo AS BtsbMarkUserNo,
B.tsbWorkUnitNo AS BtsbWorkUnitNo,
B.tsbWorkUserNo AS BtsbWorkUserNo,
B.tsbMoney AS BtsbMoney,
B.tsbMemo AS BtsbMemo,
B.tsbSubMemo AS BtsbSubMemo,
B.tsbCreateDTime AS BtsbCreateDTime,
B.tsbCreateUser AS BtsbCreateUser,
B.tsbModifyDTime AS BtsbModifyDTime,
B.tsbModifyUser AS BtsbModifyUser,
B.tsbPassFlag AS BtsbPassFlag,
B.tsbPassDTime AS BtsbPassDTime,
B.tsbPassUser AS BtsbPassUser,
B.tsbDecideFlag AS BtsbDecideFlag,

C.tsbYear               as       CtsbYear,
C.tsbApplyNo            as       CtsbApplyNo,
C.tsbDecideNo           as       CtsbDecideNo,
C.tsbPayYear            as       CtsbPayYear,
C.tsbPayNo             as       CtsbPayNo,
C.tspPayMonth          as       CtspPayMonth,
C.tspPayDay            as       CtspPayDay,
C.tsbMarkDate          as       CtsbMarkDate,
C.tsbMarkUnitNo        as       CtsbMarkUnitNo,
C.tsbMarkUserNo        as       CtsbMarkUserNo,
C.tsbWorkUnitNo        as       CtsbWorkUnitNo,
C.tsbWorkUserNo        as       CtsbWorkUserNo,
C.tsbMoney             as       CtsbMoney,
C.tsbMemo              as       CtsbMemo,
C.tsbSubMemo           as       CtsbSubMemo,
C.tsbCreateDTime       as       CtsbCreateDTime,
C.tsbCreateUser        as       CtsbCreateUser,
C.tsbModifyDTime       as       CtsbModifyDTime,
C.tsbModifyUser        as       CtsbModifyUser,
C.tsbPassFlag          as       CtsbPassFlag,
C.tsbPassDTime         as       CtsbPassDTime,
C.tsbPassUser           as       CtsbPassUser

FROM
dbo.tsbApply AS A
INNER JOIN dbo.tsbDecide AS B ON A.tsbYear = B.tsbYear AND A.tsbApplyNo = B.tsbApplyNo
Left JOIN dbo.tsbPay AS C ON B.tsbYear = C.tsbYear AND B.tsbApplyNo = C.tsbApplyNo AND B.tsbDecideNo = C.tsbDecideNo
WHERE
A.tsbPassFlag = '1' 
AND A.tsbKindNum='Case' 
AND B.tsbPassFlag = '1' 
    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.BtsbYear = '105' 

 ORDER BY  AtsbApplyWordNum DESC ,CtsbPayNo DESC 

GO
-- ==============================================================================================================================


--執行時間--  2017/5/8 下午 02:45:01
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbIsAudit As NVarChar(2)
Set @tsbIsAudit = '0'

-- --基金_補捐助其他政府機關或團體私人經費報告表(採用共用函數) - 有分層(含保留結轉資料)
-- Declare @tsbYear As Int
-- Set @tsbYear = 105

SELECT
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(組室別) ELSE '' END) as 組室別
        ,(CASE
                WHEN GROUPING(tsbPayeeRoleName_UP)=1 THEN '合計'
                WHEN GROUPING(tsbPayeeRoleName_MY)=1 THEN MAX(tsbPayeeRoleName_UP)
                WHEN GROUPING(tsbPayeeNo)=1 THEN MAX(tsbPayeeRoleName_MY)
                WHEN GROUPING(動支編號)=1 THEN '     小計'
            ELSE MAX(受補捐助單位名稱) END) AS 受補捐助單位名稱
        ,(CASE
                WHEN GROUPING(動支編號)=0 THEN MAX(補捐助計畫名稱) 
                WHEN GROUPING(tsbPayeeRoleName_MY)=1 THEN '總計'
                WHEN GROUPING(tsbPayeeNo)=1 THEN '合計'
            ELSE '' END) as 補捐助計畫名稱
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(oulOutlayCode + 列支科目名稱) ELSE '' END) as 列支科目名稱
		,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(動支編號) ELSE '' END) as 動支編號
        ,SUM(計畫核定金額) as 計畫核定金額
        ,SUM(本年度撥付數) as 本年度撥付數
        ,SUM(累計撥付數) as 累計撥付數
        ,SUM(未撥數) as 未撥數
        ,SUM(合計) as 合計
        ,SUM(實際支用金額) as 實際支用金額
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫執行情形Y) ELSE '' END) as 計畫執行情形Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫執行情形N) ELSE '' END) as 計畫執行情形N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否納入受補助單位預算Y) ELSE '' END) as 是否納入受補助單位預算Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否納入受補助單位預算N) ELSE '' END) as 是否納入受補助單位預算N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定補助之條件標準Y) ELSE '' END) as 是否明定補助之條件標準Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定補助之條件標準N) ELSE '' END) as 是否明定補助之條件標準N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定成果考核方式Y) ELSE '' END) as 是否明定成果考核方式Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定成果考核方式N) ELSE '' END) as 是否明定成果考核方式N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(對補助經費是否施以就地查核Y) ELSE '' END) as 對補助經費是否施以就地查核Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(對補助經費是否施以就地查核N) ELSE '' END) as 對補助經費是否施以就地查核N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫未完成原因) ELSE '' END) as 計畫未完成原因
        ,SUM(計畫完成結餘款) as 計畫完成結餘款
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(收回日期) ELSE '' END) as 收回日期
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(備註) ELSE '' END) as 備註
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票日期) ELSE '' END) as 傳票日期
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票號碼) ELSE '' END) as 傳票號碼
FROM 
(
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------
	SELECT  
		---------------------------- ↓↓ 年報分類 ↓↓ -----------------------------
		(SELECT TOP 1 ZU.SubCatCode FROM codSubsidyCatName ZN JOIN codSubsidyOutlayRole ZO ON ZN.codCodeVer=ZO.codCodeVer and ZN.SubCatCode=ZO.SubCatCode and ISNULL(ZN.SubStopFlag,'0')!='1'
		JOIN codSubsidyCatName ZU ON ZU.codCodeVer=ZN.codCodeVer and ZN.SubCatCode LIKE ZU.SubCatCode+'%' and ZU.SubCatLevel<ZN.SubCatLevel and ISNULL(ZU.SubStopFlag,'0')!='1'
		WHERE ISNULL(NULLIF(ZO.codCodeVer,0),@tsbYear )=@tsbYear 
				AND ISNULL(X.oulOutlayCode,'') LIKE ISNULL(ZO.OutlayCode,'')+'%'
				AND ISNULL(NULLIF(ZO.SubtsbPayeeRoleNo,''),ISNULL(tsbPayeeRoleNo,''))=ISNULL(tsbPayeeRoleNo,'')
		ORDER BY ZU.SubCatLevel DESC,ZU.SubCatCode,ZU.codCodeVer DESC
		) as SubCatCode,
		(SELECT TOP 1 ZU.SubCatName FROM codSubsidyCatName ZN JOIN codSubsidyOutlayRole ZO ON ZN.codCodeVer=ZO.codCodeVer and ZN.SubCatCode=ZO.SubCatCode and ISNULL(ZN.SubStopFlag,'0')!='1'
		JOIN codSubsidyCatName ZU ON ZU.codCodeVer=ZN.codCodeVer and ZN.SubCatCode LIKE ZU.SubCatCode+'%' and ZU.SubCatLevel<ZN.SubCatLevel and ISNULL(ZU.SubStopFlag,'0')!='1'
		WHERE ISNULL(NULLIF(ZO.codCodeVer,0),@tsbYear )=@tsbYear 
				AND ISNULL(X.oulOutlayCode,'') LIKE ISNULL(ZO.OutlayCode,'')+'%'
				AND ISNULL(NULLIF(ZO.SubtsbPayeeRoleNo,''),ISNULL(tsbPayeeRoleNo,''))=ISNULL(tsbPayeeRoleNo,'')
		ORDER BY ZU.SubCatLevel DESC,ZU.SubCatCode,ZU.codCodeVer DESC
		) as tsbPayeeRoleName_UP,
		(SELECT TOP 1 ZN.SubCatName FROM codSubsidyCatName ZN JOIN codSubsidyOutlayRole ZO ON ZN.codCodeVer=ZO.codCodeVer and ZN.SubCatCode=ZO.SubCatCode and ISNULL(ZN.SubStopFlag,'0')!='1'
		WHERE ISNULL(NULLIF(ZO.codCodeVer,0),@tsbYear )=@tsbYear 
				AND ISNULL(X.oulOutlayCode,'') LIKE ISNULL(ZO.OutlayCode,'')+'%'
				AND ISNULL(NULLIF(ZO.SubtsbPayeeRoleNo,''),ISNULL(tsbPayeeRoleNo,''))=ISNULL(tsbPayeeRoleNo,'')
		ORDER BY ZN.SubCatCode,ZN.codCodeVer DESC
		) as tsbPayeeRoleName_MY, 
		---------------------------- ↑↑ 年報分類 ↑↑ -----------------------------
        X.tsbApplyWordNum as 動支編號,
        X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo, X.tsbDecideSeq,
        X.tsbOutlayYear, X.oulOutlayCode, X.oulOutlayName AS 列支科目名稱, 
        X.業務計畫代碼, X.業務計畫名稱, 
        X.工作計畫代碼, X.工作計畫名稱,
        X.分支計畫代碼, X.分支計畫名稱, 
        X.dptCode, X.dptName AS 組室別,
		X.tsbPayeeRoleNo, X.tsbPayeeNo, X.tsbPayeeName AS 受補捐助單位名稱,
		X.tsbTrustSubsidyName AS 補捐助計畫名稱,
        ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) AS 計畫核定金額,
		--取估列及核銷的傳票日期(2015/12/16初驗依蔡專要求修改)，若此欄空白，應僅進行預撥作業所致
        ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo,X.tsbDecideSeq,
			                                                  'tsbExchPassDate','1','PayAndEstimate') , ',' , char(13)+char(10) 
                        ) , '' ) as 傳票日期,
        ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo,X.tsbDecideSeq,
			                                                  'tsbExchNo','1','PayAndEstimate') , ',' , char(13)+char(10) 
                        ) , '' ) as 傳票號碼,
        -----------------------------------------------------------------------------
		X.計畫執行情形Y, 
        X.計畫執行情形N, 
        X.是否納入受補助單位預算Y, 
        X.是否納入受補助單位預算N,
		X.是否明定補助之條件標準Y,
        X.是否明定補助之條件標準N,
		X.是否明定成果考核方式Y, 
        X.是否明定成果考核方式N, 
		X.對補助經費是否施以就地查核Y, 
        X.對補助經費是否施以就地查核N, 
		X.計畫未完成原因,
		X.備註,
        -----------------------------------------------------------------------------
		Y.預撥金額 + Y.付現 - Y.預撥繳回金額 AS 本年度撥付數, 
		Y.預撥金額 + Y.付現 - Y.預撥繳回金額 AS 累計撥付數, 
        -- 未撥數 = 計畫核定金額 - 累計撥付數
        ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) - (Y.預撥金額 + Y.付現 - Y.預撥繳回金額) AS 未撥數,
		-- 合計 = 累計撥付數 + 未撥數 = 計畫核定金額
		ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) AS 合計,
		Y.估列金額 + Y.費用 - Y.估列高估沖銷金額 - Y.核銷繳回金額 AS 實際支用金額,
		--計畫完成結餘款_金額 = 計畫核定金額 - 實際支用金額
		ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) - (Y.估列金額 + Y.費用 - Y.估列高估沖銷金額 - Y.核銷繳回金額) AS 計畫完成結餘款, 
		ISNULL(CONVERT(varchar(10), Y.繳回日期, 111), '') AS 收回日期
	FROM
	(
		------------------　　核定資料Start　　-----------------
        SELECT  GTD.tsbApplyWordNum, GTD.tsbYear, 
                GTD.tsbApplyNo, GTD.tsbApplySeq, 
                GTD.tsbDecideNo, GTD.tsbDecideSeq, 
                GTD.tsbPayeeNo, GTD.tsbPayeeName, 
                GTD.業務計畫代碼, GTD.業務計畫名稱 ,GTD.工作計畫代碼, GTD.工作計畫名稱, GTD.分支計畫代碼,
                GTD.有編號的分支計畫名稱 AS 分支計畫名稱,
                GTD.plnPlanCode, GTD.plnPlanName, 
                GTD.tsbOutlayYear, GTD.oulOutlayCode, GTD.oulOutlayName , 
                GTD.tsbTrustSubsidyName, GTD.dptCode, GTD.dptName,
                GTD.tsbMarkUserNo, GTD.tsbMemo ,
                GTD.tsbWorkUserNo, GTD.tsbPassDTime, 
                GTD.tsbPayeeRoleNo, GTD.tsbPayeeRoleName, GTD.tsbCityName,
                GTD.tsbCityAreaName, GTD.tsbHostName, GTD.tsbMoney, GTD.tsbDecideDate,
                GTD.tsbContractDTime, GTD.tsbContractMoney,
                ----------------------------------------------------------------------------
                CASE WHEN FSP.isFinish = '1' THEN 'V' ELSE '' END AS 計畫執行情形Y,
                CASE WHEN FSP.isFinish = '1' THEN '' ELSE 'V' END AS 計畫執行情形N,
                CASE WHEN GTD.inspect = '2' THEN 'V' ELSE '' END AS 是否納入受補助單位預算Y,
                CASE WHEN GTD.inspect = '2' THEN '' ELSE 'V' END AS 是否納入受補助單位預算N,
		        '' AS 是否明定補助之條件標準Y,
                '' AS 是否明定補助之條件標準N,
		        '' AS 是否明定成果考核方式Y, 
                '' AS 是否明定成果考核方式N, 
		        '' AS 對補助經費是否施以就地查核Y, 
                '' AS 對補助經費是否施以就地查核N, 
		        '' AS 計畫未完成原因,
		        '' AS 備註
                ----------------------------------------------------------------------------
		FROM dbo.fn_GetTsbDecideDT(@tsbYear, '1') GTD
        LEFT JOIN tsbficSubisdyPara FSP
            ON  GTD.tsbYear = FSP.tsbYear 
            AND GTD.tsbApplyNo = FSP.tsbApplyNo AND GTD.tsbApplySeq = FSP.tsbApplySeq 
            AND GTD.tsbDecideNo = FSP.tsbDecideNo AND GTD.tsbDecideSeq = FSP.tsbDecideSeq
		WHERE --20161108  (GTD.oulOutlayCode = N'721' OR GTD.oulOutlayCode = N'722' OR GTD.oulOutlayCode = N'723')
			--721 -> 724，722 -> 722、723，723 -> 721
			( ((GTD.oulOutlayCode LIKE N'721%' OR GTD.oulOutlayCode LIKE N'722%' OR GTD.oulOutlayCode = N'723') AND GTD.tsbOutlayYear <= 105)
				OR ((GTD.oulOutlayCode LIKE N'724%' OR GTD.oulOutlayCode LIKE N'722%' OR GTD.oulOutlayCode LIKE N'723%'
					OR GTD.oulOutlayCode LIKE N'721%') AND GTD.tsbOutlayYear > 105)
			)
		------------------　　核定資料 End 　　-----------------
	) X
	INNER JOIN
	(
        -- 只顯示當年度資料(tsbYear = tsbOutlayYear)，且只抓 72 向下用途別。（核定再更細部去抓。）
        -- 參數：（ 年度 , 計畫年度 , 計畫科目 , 用途別 , 起始日期 , 結束日期 , 案件類別 , 是否有傳票號碼 ）
        SELECT * FROM [dbo].[fn_GetMixDT](@tsbYear, NULL, NULL, '72', NULL, NULL, NULL, '1', @tsbIsAudit)
	) Y
    ON  X.tsbYear = Y.tsbYear 
    AND X.tsbApplyNo = Y.tsbApplyNo AND X.tsbApplySeq = Y.tsbApplySeq 
    AND X.tsbDecideNo = Y.tsbDecideNo AND X.tsbDecideSeq = Y.tsbDecideSeq
    -- ORDER BY X.tsbApplyWordNum, X.tsbDecideSeq
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------
) Z
GROUP BY tsbPayeeRoleName_UP, tsbPayeeRoleName_MY, tsbPayeeNo, 動支編號 WITH ROLLUP  
HAVING GROUPING(tsbPayeeRoleName_UP)=0
ORDER BY tsbPayeeRoleName_UP, tsbPayeeRoleName_MY, tsbPayeeNo,
	(CASE WHEN MAX(列支科目名稱) = '' THEN 'zzzzz' ELSE MAX(列支科目名稱) END), 
	(CASE WHEN MAX(組室別) = '' THEN 'zzzzzz' ELSE MAX(組室別) END),
	(CASE WHEN GROUPING(動支編號)=1 THEN ISNULL(MAX(動支編號),'zzzzzz') ELSE 動支編號 END),
	(CASE WHEN MAX(傳票日期) = '' THEN 'zzzzzz' ELSE MAX(傳票日期) END)

    --列支科目名稱, 組室別, 動支編號,傳票日期

------------------------------------------------------------

--#2017/5/8 下午 02:48:12#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
--[Parameter Count:1]
--@parMenuID='B17611'
 Select * From SysMenuBase Where PK_MnuNo ='B17611' 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:12#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  A.dptCode, A.dptName, A.dptLevel, A.dptBgtFlag, A.dptWorkFlag, A.depCtrlAllFlag, A.dptTeamFlag, A.teaCode, A.dptAliasNo, A.dptAliasName, A.dptCreateDate, A.dptStopFlag, A.dptStopDate  FROM codDepartName A  Where 1=1  AND (ISNULL( A.dptCreateDate,'') <='2016/12/31' AND ( ISNULL(A.dptStopFlag,'') <> '1' OR A.dptStopDate > '2016/12/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:12#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select Distinct *   
 , IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) As TopWordNum  
           From ( 
 SELECT Distinct  Top 100 Percent                  M.acmYear, M.acmNo, M.acmKidNum 
               , M.acmMonth, M.acmDay 
               , IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo) as acmBgtUnitNo  
               , M.acmMarkUnitNo, M.acmWorkUnitNo  
               , M.acmMarkUserNo
               , M.acmProdLevelKind
               , M.acmProdVisaKind 
               , M.acmProdKind 
               , M.acmWordNum, M.acmWordNumSubNo, M.acmTopWordNum, M.acmSourWordNum 
               , IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As FullAcmWordNum 
               , M.acmWorkUserNo, M.acmMoney 
               , M.acmMemo, M.acmModifyUser  
               , M.acmPassUser, M.acmPassDate 
               , WD.dptName as DepName, BD.dptName as BgtDepName  
               , M.acmPassFlag, M.acmMarkDate 
               , M.acmPassMoney, M.acmPassMemo 
               , (Select Count(*) From actPay1 PD1 Where PD1.acmYear= M.acmYear And PD1.acmNo=M.acmNo  ) As P1Counter 
               , (Select Top 1 acpGroupNo From actPay PD  Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpGroupNo 
               , (Select Top 1 acpPayCnt From actPay PD Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpPayCnt 
               , (Select Top 1 acpEtcPayWordNum From actPay PD Where PD.acmYear=M.acmYear And PD.acmNo=M.acmNo) As acpEtcPayWordNum 
               , (Select Count(*) From actMain1 M1D Where M1D.acmYear=M.acmYear and M1D.acmNo=M.acmNo  ) as M1Counter 
               , (Select Count(*) From actMain2 M2D Where M2D.acmYear=M.acmYear and M2D.acmNo=M.acmNo  ) as M2Counter 
               , (Select Count(*) From actPay PD Where PD.acmYear=M.acmYear and PD.acmNo=M.acmNo ) as PCounter 
               , IsNull( M.acmBgtKind ,'0') As acmBgtKind  
               , M.acmSubsidyCode, M.acmEmpNo, M.acmUnitPassFlag, M.acmUnitPassDate, M.acmUnitPassUser, M.acmPayName 
               , M.acmVisaKindCode, VK.vskName, M.acmProdMethodCode,  PM.pcmName, M.acmEtcPayment  
               , M.acmAutoBidFlag, M.acmAutoPrePayFlag, M.acmReadyFlag, M.acmProdDepCode, M.acmBaseItemsKindCode, M.acmSubMemo 
               , BI.baiName, M.acmPayHour As acpPayHour, M.acmReturnDate As acpReturnDate, M.acmPrePayDate As acpPrePayDate 
               , M.acmRequireDepCode, acmRequireUserName, (Select dptName From codDepartName Where dptCode =M.acmRequireDepCode) As acmRequireDepName 
               , M.acmCateGrpFlag, M.acmRequireDate, M.acmSelfProdFlag 
               , M.acmReserveFlag, M.acmReserveWordNum 
               , M.acmActKind ,M.acmPayeeNo, M.acmExt , M.acmFimPK, M.acmFormName, M.acmAddInMisFlag, M.BPMAccount, M.BPMDisplayName 
  FROM (actMain M Join actVisa V ON M.acmYear = V.acmYear AND V.acmNo = M.acmNo)  
 LEFT OUTER JOIN codDepartName WD ON 
 M.acmWorkUnitNo = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON 
  IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)   = BD.dptCode 
 Left Join codAccKindName K On 
 IsNull( V.acvAccKind,'') = K.accKind 
 Left Join codVisaKind VK On 
 M.acmVisaKindCode=VK.vskCode  Left Join codProdMethod PM On 
 M.acmProdMethodCode=PM.pcmCode  Left Join codBaseItems BI On 
 M.acmProdDepCode=BI.baiCode And M.acmBaseItemsKindCode=BI.bakCode    WHERE 1 = 1   And   M.acmYear =105 And ( 1=1 
 And M.acmKidNum='TCase'
 And  M.acmMonth <= 12 And  M.acmWorkUnitNo  = '14'
 And IsNull(M.acmKidNum, '') ='TCase'
 And IsNull(M.acmPassFlag,'0')='0'
 )  Order by  M.acmYear, IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) Desc, M.acmNo 
 Union All 
 SELECT Distinct  Top 100 Percent                  M.acmYear, M.acmNo, M.acmKidNum 
               , M.acmMonth, M.acmDay 
               , IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo) as acmBgtUnitNo  
               , M.acmMarkUnitNo, M.acmWorkUnitNo  
               , M.acmMarkUserNo
               , M.acmProdLevelKind
               , M.acmProdVisaKind 
               , M.acmProdKind 
               , M.acmWordNum, M.acmWordNumSubNo, M.acmTopWordNum, M.acmSourWordNum 
               , IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As FullAcmWordNum 
               , M.acmWorkUserNo, M.acmMoney 
               , M.acmMemo, M.acmModifyUser  
               , M.acmPassUser, M.acmPassDate 
               , WD.dptName as DepName, BD.dptName as BgtDepName  
               , M.acmPassFlag, M.acmMarkDate 
               , M.acmPassMoney, M.acmPassMemo 
               , (Select Count(*) From actPay1 PD1 Where PD1.acmYear= M.acmYear And PD1.acmNo=M.acmNo  ) As P1Counter 
               , (Select Top 1 acpGroupNo From actPay PD  Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpGroupNo 
               , (Select Top 1 acpPayCnt From actPay PD Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpPayCnt 
               , (Select Top 1 acpEtcPayWordNum From actPay PD Where PD.acmYear=M.acmYear And PD.acmNo=M.acmNo) As acpEtcPayWordNum 
               , (Select Count(*) From actMain1 M1D Where M1D.acmYear=M.acmYear and M1D.acmNo=M.acmNo  ) as M1Counter 
               , (Select Count(*) From actMain2 M2D Where M2D.acmYear=M.acmYear and M2D.acmNo=M.acmNo  ) as M2Counter 
               , (Select Count(*) From actPay PD Where PD.acmYear=M.acmYear and PD.acmNo=M.acmNo ) as PCounter 
               , IsNull( M.acmBgtKind ,'0') As acmBgtKind  
               , M.acmSubsidyCode, M.acmEmpNo, M.acmUnitPassFlag, M.acmUnitPassDate, M.acmUnitPassUser, M.acmPayName 
               , M.acmVisaKindCode, VK.vskName, M.acmProdMethodCode,  PM.pcmName, M.acmEtcPayment  
               , M.acmAutoBidFlag, M.acmAutoPrePayFlag, M.acmReadyFlag, M.acmProdDepCode, M.acmBaseItemsKindCode, M.acmSubMemo 
               , BI.baiName, M.acmPayHour As acpPayHour, M.acmReturnDate As acpReturnDate, M.acmPrePayDate As acpPrePayDate 
               , M.acmRequireDepCode, acmRequireUserName, (Select dptName From codDepartName Where dptCode =M.acmRequireDepCode) As acmRequireDepName 
               , M.acmCateGrpFlag, M.acmRequireDate, M.acmSelfProdFlag 
               , M.acmReserveFlag, M.acmReserveWordNum 
               , M.acmActKind ,M.acmPayeeNo, M.acmExt , M.acmFimPK, M.acmFormName, M.acmAddInMisFlag, M.BPMAccount, M.BPMDisplayName 
  FROM (actMain M Join actVisaMore V ON M.acmYear = V.acmYear AND V.acmNo = M.acmNo)  
 LEFT OUTER JOIN codDepartName WD ON 
 M.acmWorkUnitNo = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON 
  IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)   = BD.dptCode 
 Left Join codAccKindName K On 
 IsNull( V.acvAccKind,'') = K.accKind 
 Left Join codVisaKind VK On 
 M.acmVisaKindCode=VK.vskCode  Left Join codProdMethod PM On 
 M.acmProdMethodCode=PM.pcmCode  Left Join codBaseItems BI On 
 M.acmProdDepCode=BI.baiCode And M.acmBaseItemsKindCode=BI.bakCode    WHERE 1 = 1   And   M.acmYear =105 And ( 1=1 
 And M.acmKidNum='TCase'
 And  M.acmMonth <= 12 And  M.acmWorkUnitNo  = '14'
 And IsNull(M.acmKidNum, '') ='TCase'
 And IsNull(M.acmPassFlag,'0')='0'
 )  Order by  M.acmYear, IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) Desc, M.acmNo 
 ) DS 
 Order By  acmYear, IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) Desc, acmNo 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:12#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  * 
       From attKind K  
           Join attInheritModule I ON I.atiCode = K.atkAtiCode  
       Where  '{墊借申請}' like '%' + I.atiName + '%'
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:12#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  * 
       From attKind K  
           Join attInheritModule I ON I.atiCode = K.atkAtiCode  
       Where  '{墊借申請}' like '%' + I.atiName + '%'
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:12#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName                   , BZ.bizName, BD.dptName As BgtDepName 
                  , M.acmBgtUnitNo, M.acmWorkUnitNo 
                  ,  VisaMoneyLeft                   ,  TotalPayThisTime                    , V.acvBgtDepCode, BDV.dptName As acvBgtDepName  
                   , V.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, plnPlanCode) As plnAliasNo  
                   , V.acvCostKind, CK.cskName As CostKindName  
                   , AN.laName As inspectName 
 From ( Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , IsNull( V.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo And V1D.acmNo1=0), 0)   As TotalPayThisTime 
                   , V.acvBgtDepCode  
                   , V.acvPlanCateCode 
                   , V.acvCostKind  
       From actVisa V 
       Where V.acmYear=105 And V.acmNo=0
   Union 
       Select  
                    VM.acmYear, VM.acmNo, VM.acvNo, VM.acvBgtYear, VM.acvBgtMonth, VM.acvPlanCode 
                  , VM.acvOutlayYear, VM.acvOutlayCode, VM.acvBgtSourceCode, VM.acvAccKind 
                  , VM.acvBizCode, VM.acvPrePayFlag, VM.acvMoney, VM.acvMemo, VM.acmNoPrv  
                  , VM.inspect, VM.acvPassAdjustMoney, VM.acvNextYearFlag, VM.acvBgtKindSet  
                  , IsNull( VM.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo And V1MD.acmNo1=0), 0)   As TotalPayThisTime 
                   , VM.acvBgtDepCode 
                   , VM.acvPlanCateCode  
                   , VM.acvCostKind  
  From actVisaMore VM 
       Where VM.acmYear=105 And VM.acmNo=0
 ) V 
          Join actMain M On  M.acmYear = 105 And M.acmYear=V.acmYear And M.acmNo=V.acmNo 
   And V.acmNo=0
 Left Join codAccKindName K On   IsNull(V.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(V.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( V.acvPlanCode,'') = PN.plnPlanCode   And IsNull(V.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  V.acvOutlayCode = O.oulOutlayCode   And V.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(V.acvBizCode,'' ) = BZ.BizCode  And IsNull(V.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo)   
 Left Join codDepartName BDV On  BDV.dptCode  =  IsNull(V.acvBgtDepCode, IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo))   
 Left Join codPlanCategory PC On PC.plnCateCode=IsNull(V.acvPlanCateCode,'')  
 Left Join codCostKind CK On CK.cskCode= V.acvCostKind 
 Left Join codLocalAuditName AN On AN.laCode= V.inspect 
 Where 1=1      Order By  V.acmNo, V.acvNo 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:12#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  Distinct 
                    DP.acmYear, DP.acmNo, DP.acmNo1, DP.acdNo, DP.acdProdCode  
                  , DP.acdProdName, DP.acdProdRule, DP.acdProdSup, DP.acdProdUnit 
                  , DP.acdProdQry, DP.acdMemo, DP.acdProdPrice, DP.acdMoney  
                  , DP.acdProdPriceFac1, DP.acdProdMoneyFac1, DP.acdProdPriceFac2   
                  , DP.acdProdMoneyFac2, DP.acdProdPriceFac3, DP.acdProdMoneyFac3   
                  , MP.acmProdFactory 
                  , MP.acmProdFactory1, MP.acmProdFactory2, MP.acmProdFactory3  
                  , MP.acmProdMoney 
                  , MP.acmProdMoney1, MP.acmProdMoney2, MP.acmProdMoney3  
                  , MP.acmProdChkDate     
               , DP.acdProdCause,  PC.prcName As acdProdCauseName 
          From  actDtlProd DP    
                          Left Join actMainProd MP ON DP.acmYear = MP.acmYear AND DP.acmNo = MP.acmNo AND DP.acmNo1 = MP.acmNo1  
 Left Join codProdCause PC On PC.prcCode=DP.acdProdCause 
 Where 1=1 And DP.acmYear =1 And DP.acmNo =1 And DP.acmNo1=1 Order By  1 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:12#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName                   , BZ.bizName, BD.dptName As BgtDepName 
                  , M.acmBgtUnitNo, M.acmWorkUnitNo 
                  ,  VisaMoneyLeft                   ,  TotalPayThisTime                    , V.acvBgtDepCode, BDV.dptName As acvBgtDepName  
                   , V.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, plnPlanCode) As plnAliasNo  
                   , V.acvCostKind, CK.cskName As CostKindName  
                   , AN.laName As inspectName 
 From ( Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , IsNull( V.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo And V1D.acmNo1=0), 0)   As TotalPayThisTime 
                   , V.acvBgtDepCode  
                   , V.acvPlanCateCode 
                   , V.acvCostKind  
       From actVisa V 
       Where V.acmYear=105 And V.acmNo=0
   Union 
       Select  
                    VM.acmYear, VM.acmNo, VM.acvNo, VM.acvBgtYear, VM.acvBgtMonth, VM.acvPlanCode 
                  , VM.acvOutlayYear, VM.acvOutlayCode, VM.acvBgtSourceCode, VM.acvAccKind 
                  , VM.acvBizCode, VM.acvPrePayFlag, VM.acvMoney, VM.acvMemo, VM.acmNoPrv  
                  , VM.inspect, VM.acvPassAdjustMoney, VM.acvNextYearFlag, VM.acvBgtKindSet  
                  , IsNull( VM.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo And V1MD.acmNo1=0), 0)   As TotalPayThisTime 
                   , VM.acvBgtDepCode 
                   , VM.acvPlanCateCode  
                   , VM.acvCostKind  
  From actVisaMore VM 
       Where VM.acmYear=105 And VM.acmNo=0
 ) V 
          Join actMain M On  M.acmYear = 105 And M.acmYear=V.acmYear And M.acmNo=V.acmNo 
   And V.acmNo=0
 Left Join codAccKindName K On   IsNull(V.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(V.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( V.acvPlanCode,'') = PN.plnPlanCode   And IsNull(V.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  V.acvOutlayCode = O.oulOutlayCode   And V.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(V.acvBizCode,'' ) = BZ.BizCode  And IsNull(V.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo)   
 Left Join codDepartName BDV On  BDV.dptCode  =  IsNull(V.acvBgtDepCode, IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo))   
 Left Join codPlanCategory PC On PC.plnCateCode=IsNull(V.acvPlanCateCode,'')  
 Left Join codCostKind CK On CK.cskCode= V.acvCostKind 
 Left Join codLocalAuditName AN On AN.laCode= V.inspect 
 Where 1=1      Order By  V.acmNo, V.acvNo 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:12#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  Distinct 
                    DP.acmYear, DP.acmNo, DP.acmNo1, DP.acdNo, DP.acdProdCode  
                  , DP.acdProdName, DP.acdProdRule, DP.acdProdSup, DP.acdProdUnit 
                  , DP.acdProdQry, DP.acdMemo, DP.acdProdPrice, DP.acdMoney  
                  , DP.acdProdPriceFac1, DP.acdProdMoneyFac1, DP.acdProdPriceFac2   
                  , DP.acdProdMoneyFac2, DP.acdProdPriceFac3, DP.acdProdMoneyFac3   
                  , MP.acmProdFactory 
                  , MP.acmProdFactory1, MP.acmProdFactory2, MP.acmProdFactory3  
                  , MP.acmProdMoney 
                  , MP.acmProdMoney1, MP.acmProdMoney2, MP.acmProdMoney3  
                  , MP.acmProdChkDate     
               , DP.acdProdCause,  PC.prcName As acdProdCauseName 
          From  actDtlProd DP    
                          Left Join actMainProd MP ON DP.acmYear = MP.acmYear AND DP.acmNo = MP.acmNo AND DP.acmNo1 = MP.acmNo1  
 Left Join codProdCause PC On PC.prcCode=DP.acdProdCause 
 Where 1=1 And DP.acmYear =105 And DP.acmNo =0 And DP.acmNo1=0 Order By  1 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
--[Parameter Count:1]
--@parMenuID='B17611'
 Select * From SysMenuBase Where PK_MnuNo ='B17611' 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  * 
       From attKind K  
           Join attInheritModule I ON I.atiCode = K.atkAtiCode  
       Where  '{墊借申請}' like '%' + I.atiName + '%'
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  * 
       From attKind K  
           Join attInheritModule I ON I.atiCode = K.atkAtiCode  
       Where  '{墊借申請}' like '%' + I.atiName + '%'
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName                   , BZ.bizName, BD.dptName As BgtDepName 
                  , M.acmBgtUnitNo, M.acmWorkUnitNo 
                  ,  VisaMoneyLeft                   ,  TotalPayThisTime                    , V.acvBgtDepCode, BDV.dptName As acvBgtDepName  
                   , V.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, plnPlanCode) As plnAliasNo  
                   , V.acvCostKind, CK.cskName As CostKindName  
                   , AN.laName As inspectName 
 From ( Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , IsNull( V.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo And V1D.acmNo1=0), 0)   As TotalPayThisTime 
                   , V.acvBgtDepCode  
                   , V.acvPlanCateCode 
                   , V.acvCostKind  
       From actVisa V 
       Where V.acmYear=105 And V.acmNo=0
   Union 
       Select  
                    VM.acmYear, VM.acmNo, VM.acvNo, VM.acvBgtYear, VM.acvBgtMonth, VM.acvPlanCode 
                  , VM.acvOutlayYear, VM.acvOutlayCode, VM.acvBgtSourceCode, VM.acvAccKind 
                  , VM.acvBizCode, VM.acvPrePayFlag, VM.acvMoney, VM.acvMemo, VM.acmNoPrv  
                  , VM.inspect, VM.acvPassAdjustMoney, VM.acvNextYearFlag, VM.acvBgtKindSet  
                  , IsNull( VM.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo And V1MD.acmNo1=0), 0)   As TotalPayThisTime 
                   , VM.acvBgtDepCode 
                   , VM.acvPlanCateCode  
                   , VM.acvCostKind  
  From actVisaMore VM 
       Where VM.acmYear=105 And VM.acmNo=0
 ) V 
          Join actMain M On  M.acmYear = 105 And M.acmYear=V.acmYear And M.acmNo=V.acmNo 
   And V.acmNo=0
 Left Join codAccKindName K On   IsNull(V.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(V.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( V.acvPlanCode,'') = PN.plnPlanCode   And IsNull(V.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  V.acvOutlayCode = O.oulOutlayCode   And V.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(V.acvBizCode,'' ) = BZ.BizCode  And IsNull(V.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo)   
 Left Join codDepartName BDV On  BDV.dptCode  =  IsNull(V.acvBgtDepCode, IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo))   
 Left Join codPlanCategory PC On PC.plnCateCode=IsNull(V.acvPlanCateCode,'')  
 Left Join codCostKind CK On CK.cskCode= V.acvCostKind 
 Left Join codLocalAuditName AN On AN.laCode= V.inspect 
 Where 1=1      Order By  V.acmNo, V.acvNo 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  Distinct 
                    DP.acmYear, DP.acmNo, DP.acmNo1, DP.acdNo, DP.acdProdCode  
                  , DP.acdProdName, DP.acdProdRule, DP.acdProdSup, DP.acdProdUnit 
                  , DP.acdProdQry, DP.acdMemo, DP.acdProdPrice, DP.acdMoney  
                  , DP.acdProdPriceFac1, DP.acdProdMoneyFac1, DP.acdProdPriceFac2   
                  , DP.acdProdMoneyFac2, DP.acdProdPriceFac3, DP.acdProdMoneyFac3   
                  , MP.acmProdFactory 
                  , MP.acmProdFactory1, MP.acmProdFactory2, MP.acmProdFactory3  
                  , MP.acmProdMoney 
                  , MP.acmProdMoney1, MP.acmProdMoney2, MP.acmProdMoney3  
                  , MP.acmProdChkDate     
               , DP.acdProdCause,  PC.prcName As acdProdCauseName 
          From  actDtlProd DP    
                          Left Join actMainProd MP ON DP.acmYear = MP.acmYear AND DP.acmNo = MP.acmNo AND DP.acmNo1 = MP.acmNo1  
 Left Join codProdCause PC On PC.prcCode=DP.acdProdCause 
 Where 1=1 And DP.acmYear =1 And DP.acmNo =1 And DP.acmNo1=1 Order By  1 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
SELECT Max(acmNo) as Val,count(*) as Cnt FROM actMain_acmYear_acmNo_Inc WHERE acmYear=105
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
UPDATE actMain_acmYear_acmNo_Inc SET acmNo=5644 WHERE acmYear=105
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  A.dptCode, A.dptName, A.dptLevel, A.dptBgtFlag, A.dptWorkFlag, A.depCtrlAllFlag, A.dptTeamFlag, A.teaCode, A.dptAliasNo, A.dptAliasName, A.dptCreateDate, A.dptStopFlag, A.dptStopDate  FROM codDepartName A  Where 1=1  AND (ISNULL( A.dptCreateDate,'') <='2016/12/31' AND ( ISNULL(A.dptStopFlag,'') <> '1' OR A.dptStopDate > '2016/12/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  Distinct 
                    DP.acmYear, DP.acmNo, DP.acmNo1, DP.acdNo, DP.acdProdCode  
                  , DP.acdProdName, DP.acdProdRule, DP.acdProdSup, DP.acdProdUnit 
                  , DP.acdProdQry, DP.acdMemo, DP.acdProdPrice, DP.acdMoney  
                  , DP.acdProdPriceFac1, DP.acdProdMoneyFac1, DP.acdProdPriceFac2   
                  , DP.acdProdMoneyFac2, DP.acdProdPriceFac3, DP.acdProdMoneyFac3   
                  , MP.acmProdFactory 
                  , MP.acmProdFactory1, MP.acmProdFactory2, MP.acmProdFactory3  
                  , MP.acmProdMoney 
                  , MP.acmProdMoney1, MP.acmProdMoney2, MP.acmProdMoney3  
                  , MP.acmProdChkDate     
               , DP.acdProdCause,  PC.prcName As acdProdCauseName 
          From  actDtlProd DP    
                          Left Join actMainProd MP ON DP.acmYear = MP.acmYear AND DP.acmNo = MP.acmNo AND DP.acmNo1 = MP.acmNo1  
 Left Join codProdCause PC On PC.prcCode=DP.acdProdCause 
 Where 1=1 And DP.acmYear =105 And DP.acmNo =5644 And DP.acmNo1=0 And 1=2  Order By  1 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName                   , BZ.bizName, BD.dptName As BgtDepName 
                  , M.acmBgtUnitNo, M.acmWorkUnitNo 
                  ,  VisaMoneyLeft                   ,  TotalPayThisTime                    , V.acvBgtDepCode, BDV.dptName As acvBgtDepName  
                   , V.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, plnPlanCode) As plnAliasNo  
                   , V.acvCostKind, CK.cskName As CostKindName  
                   , AN.laName As inspectName 
 From ( Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , IsNull( V.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo And V1D.acmNo1=0), 0)   As TotalPayThisTime 
                   , V.acvBgtDepCode  
                   , V.acvPlanCateCode 
                   , V.acvCostKind  
       From actVisa V 
       Where V.acmYear=105 And V.acmNo=5644
   Union 
       Select  
                    VM.acmYear, VM.acmNo, VM.acvNo, VM.acvBgtYear, VM.acvBgtMonth, VM.acvPlanCode 
                  , VM.acvOutlayYear, VM.acvOutlayCode, VM.acvBgtSourceCode, VM.acvAccKind 
                  , VM.acvBizCode, VM.acvPrePayFlag, VM.acvMoney, VM.acvMemo, VM.acmNoPrv  
                  , VM.inspect, VM.acvPassAdjustMoney, VM.acvNextYearFlag, VM.acvBgtKindSet  
                  , IsNull( VM.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo And V1MD.acmNo1=0), 0)   As TotalPayThisTime 
                   , VM.acvBgtDepCode 
                   , VM.acvPlanCateCode  
                   , VM.acvCostKind  
  From actVisaMore VM 
       Where VM.acmYear=105 And VM.acmNo=5644
 ) V 
          Join actMain M On  M.acmYear = 105 And M.acmYear=V.acmYear And M.acmNo=V.acmNo 
   And V.acmNo=5644
 Left Join codAccKindName K On   IsNull(V.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(V.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( V.acvPlanCode,'') = PN.plnPlanCode   And IsNull(V.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  V.acvOutlayCode = O.oulOutlayCode   And V.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(V.acvBizCode,'' ) = BZ.BizCode  And IsNull(V.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo)   
 Left Join codDepartName BDV On  BDV.dptCode  =  IsNull(V.acvBgtDepCode, IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo))   
 Left Join codPlanCategory PC On PC.plnCateCode=IsNull(V.acvPlanCateCode,'')  
 Left Join codCostKind CK On CK.cskCode= V.acvCostKind 
 Left Join codLocalAuditName AN On AN.laCode= V.inspect 
 Where 1=1      And 1=2  Order By  V.acmNo, V.acvNo 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select A.accKind, A.accKindName,  A.ackCreateDate, A.ackStopFlag, A.ackStopDate  FROM codAccKindName A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select A.orgCode, A.orgName, A.orgAliasNo, A.orgAliasName, A.orgCreateDate, A.orgStopFlag, A.orgStopDate  FROM codBgtOrigin A  Where 1=1  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
--[Parameter Count:0]
 Select *    From  codPlanCategory  
                                Where 1=1 
  Order By    1  
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 02:48:18
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
 Select LTrim(laCode) As laCode, laName  From  CodLocalAuditName
  Where 1=1 
  Order By    1  
------------------------------------------------------------

--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  A.dptCode, A.dptName, A.dptLevel, A.dptBgtFlag, A.dptWorkFlag, A.depCtrlAllFlag, A.dptTeamFlag, A.teaCode, A.dptAliasNo, A.dptAliasName, A.dptCreateDate, A.dptStopFlag, A.dptStopDate  FROM codDepartName A  Where 1=1  AND (ISNULL( A.dptCreateDate,'') <='2016/12/31' AND ( ISNULL(A.dptStopFlag,'') <> '1' OR A.dptStopDate > '2016/12/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 SELECT * FROM fn_GetActPowerDepDT(1,1,default,2016/12/31)
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select convert(varchar, A.codCodeVer) + ':' + Convert(varchar, A.dpzBizCode) as BizCode, W.BizName, A.dpzBizCode   From  codDepBiz A  Left Join codBizName W On  W.BizCode= A.dpzBizCode and W.codCodeVer=A.codCodeVer  Where 1=1 And A.codCodeVer = 105  and A.dpzDepCode ='14'  AND (ISNULL( A.dpzCreateDate,'')<='2016/12/31' AND ( ISNULL(A.dpzStopFlag,'')<>'1' OR A.dpzStopDate>'2016/12/1'))  Order By  1,2, 3 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select convert(varchar, A.codCodeVer) + ':' + Convert(varchar, A.BizCode) as BizCode, A.BizName   FROM codBizName  A  Where 1=1  And A.codCodeVer = 105  AND (ISNULL( A.bizCreateDate,'') <='2016/12/31' AND ( ISNULL(A.bizStopFlag,'') <> '1' OR A.bizStopDate > '2016/12/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select Distinct 
       Convert(varchar, P.codCodeVer) +':'+ P.plnPlanCode 
           +  (Case When DS.Code <> Convert(varchar, P.codCodeVer) +':'+ P.plnPlanCode Then '*' Else '' End ) 
            As Code    
       , IsNull(P.plnPlanCode,'') + ' '+ P.plnPlanName 
       From   
           ( 
SELECT DISTINCT LTRIM(STR(A.codCodeVer))+':'+A.plnPlanCode as Code, IsNull(A.plnPlanCode, '') +' '+A.plnPlanName as Name FROM actAccCode W JOIN codPlanCode A ON IsNull(W.accChildCnt,0) <=0 
                                   And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer)  
                                   AND (W.accPlanCode='' or  W.accPlanCode Like A.plnPlanCode+'%' or  A.plnPlanCode Like W.accPlanCode +'%') WHERE ( A.codCodeVer=105 AND (ISNULL( A.plnCreateDate,'')<='2016/12/31' AND ( ISNULL(A.plnStopFlag,'')<>'1' OR A.plnStopDate>'2016/12/31'))  AND (W.accDepCode='' OR W.accDepCode = '14') AND  A.plnCategory Like '%_2')                         And   (A.plnChildCnt<=0  
                                           OR 
                                   (A.plnChildCnt IS NULL AND  
                                       ISNULL((SELECT COUNT(*) FROM codPlanCode  Z 
                                       WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer)) 
                                       AND  ISNULL(Z.plnPlanCode,'') LIKE ISNULL(Ltrim(A.plnPlanCode),'')+'%' 
                                      ),1)<=1) 
                           )  

            ) DS 
         Left Join codPlanCode P  On DS.Code Like Convert(varchar, P.codCodeVer) +':'+ P.plnPlanCode +'%' 
 Order By 1 
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 02:48:18
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：4
Declare @acmKidNum As NVarChar(10)
Set @acmKidNum = 'TCase'
Declare @SubKid As NVarChar(1)
Set @SubKid = Null 
Declare @acvOutlayYear As Int
Set @acvOutlayYear = 105
Declare @acvOutlayCode As NVarChar(1)
Set @acvOutlayCode = Null 

SELECT TOP 100 PERCENT
    COUNT(*) count
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
SELECT TOP 100 PERCENT *
  FROM codActKidOutlayCode A
 WHERE 1 = 1
   AND (A.acmKidNum = @acmKidNum OR @acmKidNum IS NULL)
   AND (A.SubKid = @SubKid OR @SubKid IS NULL)
   AND (A.acvOutlayYear = @acvOutlayYear OR @acvOutlayYear IS NULL)
   AND (A.acvOutlayCode = @acvOutlayCode OR @acvOutlayCode IS NULL)
 ORDER BY A.acmKidNum, A.SubKid, A.acvOutlayYear, A.acvOutlayCode

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   
 ORDER BY 1

------------------------------------------------------------

--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
(SELECT Max(codCodeVer) FROM codOutlayCode WHERE codCodeVer<=105) 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:18#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
SELECT  DISTINCT  LTRIM(STR(A.codCodeVer))+':'+A.oulOutlayCode as Code, A.oulOutlayCode+ '   '+ A.oulOutlayName as Name  FROM actAccCode W JOIN codOutlayCode A ON IsNull(W.accChildCnt,0)<=0 And (W.accCodeVer=0 or W.accCodeVer=A.codCodeVer) AND (W.accOutlayCode='' or W.accOutlayCode Like A.oulOutlayCode+'%' Or A.oulOutlayCode Like W.accOutlayCode +'%') WHERE ( A.codCodeVer=105 AND (ISNULL( A.oulCreateDate,'')<='2016/12/31' AND ( ISNULL(A.oulStopFlag,'')<>'1' OR A.oulStopDate>'2016/12/31'))  AND (W.accDepCode='' OR W.accDepCode = '14')) AND (A.oulOutlayCode IN (SELECT acvOutlayCode FROM codActKidOutlayCode WHERE acmKidNum = 'TCase' AND acvOutlayYear = A.codCodeVer)) AND (A.oulChildCnt<=0  
               OR  
         (A.oulChildCnt IS NULL AND  
           ISNULL((SELECT COUNT(*) FROM codOutlayCode  Z  
           WHERE(ISNULL(Z.codCodeVer, A.codCodeVer) = ISNULL(A.codCodeVer, Z.codCodeVer))  
           AND  ISNULL(Z.oulOutlayCode,'') LIKE ISNULL(A.oulOutlayCode,'')+'%'  
           ),1)<=1)  
       )  
 Order By   1 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:25#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
--[Parameter Count:1]
--@parMenuID='B17611'
 Select * From SysMenuBase Where PK_MnuNo ='B17611' 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:25#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  * 
       From attKind K  
           Join attInheritModule I ON I.atiCode = K.atkAtiCode  
       Where  '{墊借申請}' like '%' + I.atiName + '%'
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:25#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  * 
       From attKind K  
           Join attInheritModule I ON I.atiCode = K.atkAtiCode  
       Where  '{墊借申請}' like '%' + I.atiName + '%'
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:25#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName                   , BZ.bizName, BD.dptName As BgtDepName 
                  , M.acmBgtUnitNo, M.acmWorkUnitNo 
                  ,  VisaMoneyLeft                   ,  TotalPayThisTime                    , V.acvBgtDepCode, BDV.dptName As acvBgtDepName  
                   , V.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, plnPlanCode) As plnAliasNo  
                   , V.acvCostKind, CK.cskName As CostKindName  
                   , AN.laName As inspectName 
 From ( Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , IsNull( V.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo And V1D.acmNo1=0), 0)   As TotalPayThisTime 
                   , V.acvBgtDepCode  
                   , V.acvPlanCateCode 
                   , V.acvCostKind  
       From actVisa V 
       Where V.acmYear=105 And V.acmNo=5644
   Union 
       Select  
                    VM.acmYear, VM.acmNo, VM.acvNo, VM.acvBgtYear, VM.acvBgtMonth, VM.acvPlanCode 
                  , VM.acvOutlayYear, VM.acvOutlayCode, VM.acvBgtSourceCode, VM.acvAccKind 
                  , VM.acvBizCode, VM.acvPrePayFlag, VM.acvMoney, VM.acvMemo, VM.acmNoPrv  
                  , VM.inspect, VM.acvPassAdjustMoney, VM.acvNextYearFlag, VM.acvBgtKindSet  
                  , IsNull( VM.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo And V1MD.acmNo1=0), 0)   As TotalPayThisTime 
                   , VM.acvBgtDepCode 
                   , VM.acvPlanCateCode  
                   , VM.acvCostKind  
  From actVisaMore VM 
       Where VM.acmYear=105 And VM.acmNo=5644
 ) V 
          Join actMain M On  M.acmYear = 105 And M.acmYear=V.acmYear And M.acmNo=V.acmNo 
   And V.acmNo=5644
 Left Join codAccKindName K On   IsNull(V.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(V.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( V.acvPlanCode,'') = PN.plnPlanCode   And IsNull(V.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  V.acvOutlayCode = O.oulOutlayCode   And V.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(V.acvBizCode,'' ) = BZ.BizCode  And IsNull(V.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo)   
 Left Join codDepartName BDV On  BDV.dptCode  =  IsNull(V.acvBgtDepCode, IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo))   
 Left Join codPlanCategory PC On PC.plnCateCode=IsNull(V.acvPlanCateCode,'')  
 Left Join codCostKind CK On CK.cskCode= V.acvCostKind 
 Left Join codLocalAuditName AN On AN.laCode= V.inspect 
 Where 1=1      Order By  V.acmNo, V.acvNo 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:25#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  Distinct 
                    DP.acmYear, DP.acmNo, DP.acmNo1, DP.acdNo, DP.acdProdCode  
                  , DP.acdProdName, DP.acdProdRule, DP.acdProdSup, DP.acdProdUnit 
                  , DP.acdProdQry, DP.acdMemo, DP.acdProdPrice, DP.acdMoney  
                  , DP.acdProdPriceFac1, DP.acdProdMoneyFac1, DP.acdProdPriceFac2   
                  , DP.acdProdMoneyFac2, DP.acdProdPriceFac3, DP.acdProdMoneyFac3   
                  , MP.acmProdFactory 
                  , MP.acmProdFactory1, MP.acmProdFactory2, MP.acmProdFactory3  
                  , MP.acmProdMoney 
                  , MP.acmProdMoney1, MP.acmProdMoney2, MP.acmProdMoney3  
                  , MP.acmProdChkDate     
               , DP.acdProdCause,  PC.prcName As acdProdCauseName 
          From  actDtlProd DP    
                          Left Join actMainProd MP ON DP.acmYear = MP.acmYear AND DP.acmNo = MP.acmNo AND DP.acmNo1 = MP.acmNo1  
 Left Join codProdCause PC On PC.prcCode=DP.acdProdCause 
 Where 1=1 And DP.acmYear =1 And DP.acmNo =1 And DP.acmNo1=1 Order By  1 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:25#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select Distinct *   
 , IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) As TopWordNum  
           From ( 
 SELECT Distinct  Top 100 Percent                  M.acmYear, M.acmNo, M.acmKidNum 
               , M.acmMonth, M.acmDay 
               , IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo) as acmBgtUnitNo  
               , M.acmMarkUnitNo, M.acmWorkUnitNo  
               , M.acmMarkUserNo
               , M.acmProdLevelKind
               , M.acmProdVisaKind 
               , M.acmProdKind 
               , M.acmWordNum, M.acmWordNumSubNo, M.acmTopWordNum, M.acmSourWordNum 
               , IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As FullAcmWordNum 
               , M.acmWorkUserNo, M.acmMoney 
               , M.acmMemo, M.acmModifyUser  
               , M.acmPassUser, M.acmPassDate 
               , WD.dptName as DepName, BD.dptName as BgtDepName  
               , M.acmPassFlag, M.acmMarkDate 
               , M.acmPassMoney, M.acmPassMemo 
               , (Select Count(*) From actPay1 PD1 Where PD1.acmYear= M.acmYear And PD1.acmNo=M.acmNo  ) As P1Counter 
               , (Select Top 1 acpGroupNo From actPay PD  Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpGroupNo 
               , (Select Top 1 acpPayCnt From actPay PD Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpPayCnt 
               , (Select Top 1 acpEtcPayWordNum From actPay PD Where PD.acmYear=M.acmYear And PD.acmNo=M.acmNo) As acpEtcPayWordNum 
               , (Select Count(*) From actMain1 M1D Where M1D.acmYear=M.acmYear and M1D.acmNo=M.acmNo  ) as M1Counter 
               , (Select Count(*) From actMain2 M2D Where M2D.acmYear=M.acmYear and M2D.acmNo=M.acmNo  ) as M2Counter 
               , (Select Count(*) From actPay PD Where PD.acmYear=M.acmYear and PD.acmNo=M.acmNo ) as PCounter 
               , IsNull( M.acmBgtKind ,'0') As acmBgtKind  
               , M.acmSubsidyCode, M.acmEmpNo, M.acmUnitPassFlag, M.acmUnitPassDate, M.acmUnitPassUser, M.acmPayName 
               , M.acmVisaKindCode, VK.vskName, M.acmProdMethodCode,  PM.pcmName, M.acmEtcPayment  
               , M.acmAutoBidFlag, M.acmAutoPrePayFlag, M.acmReadyFlag, M.acmProdDepCode, M.acmBaseItemsKindCode, M.acmSubMemo 
               , BI.baiName, M.acmPayHour As acpPayHour, M.acmReturnDate As acpReturnDate, M.acmPrePayDate As acpPrePayDate 
               , M.acmRequireDepCode, acmRequireUserName, (Select dptName From codDepartName Where dptCode =M.acmRequireDepCode) As acmRequireDepName 
               , M.acmCateGrpFlag, M.acmRequireDate, M.acmSelfProdFlag 
               , M.acmReserveFlag, M.acmReserveWordNum 
               , M.acmActKind ,M.acmPayeeNo, M.acmExt , M.acmFimPK, M.acmFormName, M.acmAddInMisFlag, M.BPMAccount, M.BPMDisplayName 
  FROM (actMain M Join actVisa V ON M.acmYear = V.acmYear AND V.acmNo = M.acmNo)  
 LEFT OUTER JOIN codDepartName WD ON 
 M.acmWorkUnitNo = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON 
  IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)   = BD.dptCode 
 Left Join codAccKindName K On 
 IsNull( V.acvAccKind,'') = K.accKind 
 Left Join codVisaKind VK On 
 M.acmVisaKindCode=VK.vskCode  Left Join codProdMethod PM On 
 M.acmProdMethodCode=PM.pcmCode  Left Join codBaseItems BI On 
 M.acmProdDepCode=BI.baiCode And M.acmBaseItemsKindCode=BI.bakCode    WHERE 1 = 1   And   M.acmYear =105 And ( 1=1 
 And M.acmKidNum='TCase'
 And  M.acmMonth <= 12 And  M.acmWorkUnitNo  = '14'
 And IsNull(M.acmKidNum, '') ='TCase'
 And IsNull(M.acmPassFlag,'0')='0'
 )  Order by  M.acmYear, IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) Desc, M.acmNo 
 Union All 
 SELECT Distinct  Top 100 Percent                  M.acmYear, M.acmNo, M.acmKidNum 
               , M.acmMonth, M.acmDay 
               , IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo) as acmBgtUnitNo  
               , M.acmMarkUnitNo, M.acmWorkUnitNo  
               , M.acmMarkUserNo
               , M.acmProdLevelKind
               , M.acmProdVisaKind 
               , M.acmProdKind 
               , M.acmWordNum, M.acmWordNumSubNo, M.acmTopWordNum, M.acmSourWordNum 
               , IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) As FullAcmWordNum 
               , M.acmWorkUserNo, M.acmMoney 
               , M.acmMemo, M.acmModifyUser  
               , M.acmPassUser, M.acmPassDate 
               , WD.dptName as DepName, BD.dptName as BgtDepName  
               , M.acmPassFlag, M.acmMarkDate 
               , M.acmPassMoney, M.acmPassMemo 
               , (Select Count(*) From actPay1 PD1 Where PD1.acmYear= M.acmYear And PD1.acmNo=M.acmNo  ) As P1Counter 
               , (Select Top 1 acpGroupNo From actPay PD  Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpGroupNo 
               , (Select Top 1 acpPayCnt From actPay PD Where PD.acmYear= M.acmYear And PD.acmNo=M.acmNo  ) As acpPayCnt 
               , (Select Top 1 acpEtcPayWordNum From actPay PD Where PD.acmYear=M.acmYear And PD.acmNo=M.acmNo) As acpEtcPayWordNum 
               , (Select Count(*) From actMain1 M1D Where M1D.acmYear=M.acmYear and M1D.acmNo=M.acmNo  ) as M1Counter 
               , (Select Count(*) From actMain2 M2D Where M2D.acmYear=M.acmYear and M2D.acmNo=M.acmNo  ) as M2Counter 
               , (Select Count(*) From actPay PD Where PD.acmYear=M.acmYear and PD.acmNo=M.acmNo ) as PCounter 
               , IsNull( M.acmBgtKind ,'0') As acmBgtKind  
               , M.acmSubsidyCode, M.acmEmpNo, M.acmUnitPassFlag, M.acmUnitPassDate, M.acmUnitPassUser, M.acmPayName 
               , M.acmVisaKindCode, VK.vskName, M.acmProdMethodCode,  PM.pcmName, M.acmEtcPayment  
               , M.acmAutoBidFlag, M.acmAutoPrePayFlag, M.acmReadyFlag, M.acmProdDepCode, M.acmBaseItemsKindCode, M.acmSubMemo 
               , BI.baiName, M.acmPayHour As acpPayHour, M.acmReturnDate As acpReturnDate, M.acmPrePayDate As acpPrePayDate 
               , M.acmRequireDepCode, acmRequireUserName, (Select dptName From codDepartName Where dptCode =M.acmRequireDepCode) As acmRequireDepName 
               , M.acmCateGrpFlag, M.acmRequireDate, M.acmSelfProdFlag 
               , M.acmReserveFlag, M.acmReserveWordNum 
               , M.acmActKind ,M.acmPayeeNo, M.acmExt , M.acmFimPK, M.acmFormName, M.acmAddInMisFlag, M.BPMAccount, M.BPMDisplayName 
  FROM (actMain M Join actVisaMore V ON M.acmYear = V.acmYear AND V.acmNo = M.acmNo)  
 LEFT OUTER JOIN codDepartName WD ON 
 M.acmWorkUnitNo = WD.dptCode 
 LEFT OUTER JOIN codDepartName BD ON 
  IsNull(M.acmBgtUnitNo, M.acmWorkUnitNo)   = BD.dptCode 
 Left Join codAccKindName K On 
 IsNull( V.acvAccKind,'') = K.accKind 
 Left Join codVisaKind VK On 
 M.acmVisaKindCode=VK.vskCode  Left Join codProdMethod PM On 
 M.acmProdMethodCode=PM.pcmCode  Left Join codBaseItems BI On 
 M.acmProdDepCode=BI.baiCode And M.acmBaseItemsKindCode=BI.bakCode    WHERE 1 = 1   And   M.acmYear =105 And ( 1=1 
 And M.acmKidNum='TCase'
 And  M.acmMonth <= 12 And  M.acmWorkUnitNo  = '14'
 And IsNull(M.acmKidNum, '') ='TCase'
 And IsNull(M.acmPassFlag,'0')='0'
 )  Order by  M.acmYear, IsNull(IsNull(M.acmTopWordNum, M.acmSourWordNum), M.acmWordNum) Desc, M.acmNo 
 ) DS 
 Order By  acmYear, IsNull(IsNull(acmTopWordNum, acmSourWordNum), acmWordNum) Desc, acmNo 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:25#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , K.accKindName, BO.orgName, PN.plnPlanName As PlanName , O.oulOutlayName As OulName                   , BZ.bizName, BD.dptName As BgtDepName 
                  , M.acmBgtUnitNo, M.acmWorkUnitNo 
                  ,  VisaMoneyLeft                   ,  TotalPayThisTime                    , V.acvBgtDepCode, BDV.dptName As acvBgtDepName  
                   , V.acvPlanCateCode, PC.plnCateName, IsNull(PN.plnAliasNo, plnPlanCode) As plnAliasNo  
                   , V.acvCostKind, CK.cskName As CostKindName  
                   , AN.laName As inspectName 
 From ( Select  
                    V.acmYear, V.acmNo, V.acvNo, V.acvBgtYear, V.acvBgtMonth, V.acvPlanCode 
                  , V.acvOutlayYear, V.acvOutlayCode, V.acvBgtSourceCode, V.acvAccKind 
                  , V.acvBizCode, V.acvPrePayFlag, V.acvMoney, V.acvMemo, V.acmNoPrv  
                  , V.inspect, V.acvPassAdjustMoney, V.acvNextYearFlag, V.acvBgtKindSet  
                  , IsNull( V.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1 V1D Where V1D.acmYear=V.acmYear And V1D.acmNo=V.acmNo And V1D.acmNo1=0), 0)   As TotalPayThisTime 
                   , V.acvBgtDepCode  
                   , V.acvPlanCateCode 
                   , V.acvCostKind  
       From actVisa V 
       Where V.acmYear=105 And V.acmNo=0
   Union 
       Select  
                    VM.acmYear, VM.acmNo, VM.acvNo, VM.acvBgtYear, VM.acvBgtMonth, VM.acvPlanCode 
                  , VM.acvOutlayYear, VM.acvOutlayCode, VM.acvBgtSourceCode, VM.acvAccKind 
                  , VM.acvBizCode, VM.acvPrePayFlag, VM.acvMoney, VM.acvMemo, VM.acmNoPrv  
                  , VM.inspect, VM.acvPassAdjustMoney, VM.acvNextYearFlag, VM.acvBgtKindSet  
                  , IsNull( VM.acvMoney,0) - IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo), 0) As VisaMoneyLeft 
                  , IsNull( (Select Sum(IsNull(acvMoney,0) + IsNull(acvAdjustMoney,0)) From actVisa1More V1MD Where V1MD.acmYear=VM.acmYear And V1MD.acmNo=VM.acmNo And V1MD.acmNo1=0), 0)   As TotalPayThisTime 
                   , VM.acvBgtDepCode 
                   , VM.acvPlanCateCode  
                   , VM.acvCostKind  
  From actVisaMore VM 
       Where VM.acmYear=105 And VM.acmNo=0
 ) V 
          Join actMain M On  M.acmYear = 105 And M.acmYear=V.acmYear And M.acmNo=V.acmNo 
   And V.acmNo=0
 Left Join codAccKindName K On   IsNull(V.acvAccKind, '') = K.accKind    
 Left Join codBgtOrigin BO On   IsNull(V.acvBgtSourceCode, '') = BO.orgCode  
 Left Join codPlanCode PN On   IsNull( V.acvPlanCode,'') = PN.plnPlanCode   And IsNull(V.acvOutlayYear,'') = PN.codCodeVer   
 Left Join codOutlayCode O On  V.acvOutlayCode = O.oulOutlayCode   And V.acvOutlayYear = O.codCodeVer   
 Left Join codBizName BZ On  IsNull(V.acvBizCode,'' ) = BZ.BizCode  And IsNull(V.acvOutlayYear, '') = BZ.codCodeVer    
 Left Join codDepartName BD On  BD.dptCode  = IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo)   
 Left Join codDepartName BDV On  BDV.dptCode  =  IsNull(V.acvBgtDepCode, IsNull(M.acmBgtUnitNo, M.acmMarkUnitNo))   
 Left Join codPlanCategory PC On PC.plnCateCode=IsNull(V.acvPlanCateCode,'')  
 Left Join codCostKind CK On CK.cskCode= V.acvCostKind 
 Left Join codLocalAuditName AN On AN.laCode= V.inspect 
 Where 1=1      Order By  V.acmNo, V.acvNo 
-------------------------------------------------------------------------------
--#2017/5/8 下午 02:48:25#  http://localhost/HPAGBC/HPAGFC/UI.ActProdApply.Web/FrmTsbApply.aspx?MenuID=B17611
 Select  Distinct 
                    DP.acmYear, DP.acmNo, DP.acmNo1, DP.acdNo, DP.acdProdCode  
                  , DP.acdProdName, DP.acdProdRule, DP.acdProdSup, DP.acdProdUnit 
                  , DP.acdProdQry, DP.acdMemo, DP.acdProdPrice, DP.acdMoney  
                  , DP.acdProdPriceFac1, DP.acdProdMoneyFac1, DP.acdProdPriceFac2   
                  , DP.acdProdMoneyFac2, DP.acdProdPriceFac3, DP.acdProdMoneyFac3   
                  , MP.acmProdFactory 
                  , MP.acmProdFactory1, MP.acmProdFactory2, MP.acmProdFactory3  
                  , MP.acmProdMoney 
                  , MP.acmProdMoney1, MP.acmProdMoney2, MP.acmProdMoney3  
                  , MP.acmProdChkDate     
               , DP.acdProdCause,  PC.prcName As acdProdCauseName 
          From  actDtlProd DP    
                          Left Join actMainProd MP ON DP.acmYear = MP.acmYear AND DP.acmNo = MP.acmNo AND DP.acmNo1 = MP.acmNo1  
 Left Join codProdCause PC On PC.prcCode=DP.acdProdCause 
 Where 1=1 And DP.acmYear =105 And DP.acmNo =0 And DP.acmNo1=0 Order By  1 
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 03:26:09
--連線字串：Data Source=localhost;Initial Catalog=HPAGBC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(6)
Set @PK_MnuNo = '025'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/8 下午 03:36:52
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbIsAudit As NVarChar(2)
Set @tsbIsAudit = '0'

-- --基金_補捐助其他政府機關或團體私人經費報告表(採用共用函數) - 有分層(含保留結轉資料)
-- Declare @tsbYear As Int
-- Set @tsbYear = 105

SELECT
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(組室別) ELSE '' END) as 組室別
        ,(CASE
                WHEN GROUPING(tsbPayeeRoleName_UP)=1 THEN '合計'
                WHEN GROUPING(tsbPayeeRoleName_MY)=1 THEN MAX(tsbPayeeRoleName_UP)
                WHEN GROUPING(tsbPayeeNo)=1 THEN MAX(tsbPayeeRoleName_MY)
                WHEN GROUPING(動支編號)=1 THEN '     小計'
            ELSE MAX(受補捐助單位名稱) END) AS 受補捐助單位名稱
        ,(CASE
                WHEN GROUPING(動支編號)=0 THEN MAX(補捐助計畫名稱) 
                WHEN GROUPING(tsbPayeeRoleName_MY)=1 THEN '總計'
                WHEN GROUPING(tsbPayeeNo)=1 THEN '合計'
            ELSE '' END) as 補捐助計畫名稱
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(oulOutlayCode + 列支科目名稱) ELSE '' END) as 列支科目名稱
		,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(動支編號) ELSE '' END) as 動支編號
        ,SUM(計畫核定金額) as 計畫核定金額
        ,SUM(本年度撥付數) as 本年度撥付數
        ,SUM(累計撥付數) as 累計撥付數
        ,SUM(未撥數) as 未撥數
        ,SUM(合計) as 合計
        ,SUM(實際支用金額) as 實際支用金額
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫執行情形Y) ELSE '' END) as 計畫執行情形Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫執行情形N) ELSE '' END) as 計畫執行情形N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否納入受補助單位預算Y) ELSE '' END) as 是否納入受補助單位預算Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否納入受補助單位預算N) ELSE '' END) as 是否納入受補助單位預算N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定補助之條件標準Y) ELSE '' END) as 是否明定補助之條件標準Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定補助之條件標準N) ELSE '' END) as 是否明定補助之條件標準N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定成果考核方式Y) ELSE '' END) as 是否明定成果考核方式Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定成果考核方式N) ELSE '' END) as 是否明定成果考核方式N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(對補助經費是否施以就地查核Y) ELSE '' END) as 對補助經費是否施以就地查核Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(對補助經費是否施以就地查核N) ELSE '' END) as 對補助經費是否施以就地查核N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫未完成原因) ELSE '' END) as 計畫未完成原因
        ,SUM(計畫完成結餘款) as 計畫完成結餘款
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(收回日期) ELSE '' END) as 收回日期
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(備註) ELSE '' END) as 備註
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票日期) ELSE '' END) as 傳票日期
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票號碼) ELSE '' END) as 傳票號碼
FROM 
(
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------
	SELECT  
		---------------------------- ↓↓ 年報分類 ↓↓ -----------------------------
		(SELECT TOP 1 ZU.SubCatCode FROM codSubsidyCatName ZN JOIN codSubsidyOutlayRole ZO ON ZN.codCodeVer=ZO.codCodeVer and ZN.SubCatCode=ZO.SubCatCode and ISNULL(ZN.SubStopFlag,'0')!='1'
		JOIN codSubsidyCatName ZU ON ZU.codCodeVer=ZN.codCodeVer and ZN.SubCatCode LIKE ZU.SubCatCode+'%' and ZU.SubCatLevel<ZN.SubCatLevel and ISNULL(ZU.SubStopFlag,'0')!='1'
		WHERE ISNULL(NULLIF(ZO.codCodeVer,0),@tsbYear )=@tsbYear 
				AND ISNULL(X.oulOutlayCode,'') LIKE ISNULL(ZO.OutlayCode,'')+'%'
				AND ISNULL(NULLIF(ZO.SubtsbPayeeRoleNo,''),ISNULL(tsbPayeeRoleNo,''))=ISNULL(tsbPayeeRoleNo,'')
		ORDER BY ZU.SubCatLevel DESC,ZU.SubCatCode,ZU.codCodeVer DESC
		) as SubCatCode,
		(SELECT TOP 1 ZU.SubCatName FROM codSubsidyCatName ZN JOIN codSubsidyOutlayRole ZO ON ZN.codCodeVer=ZO.codCodeVer and ZN.SubCatCode=ZO.SubCatCode and ISNULL(ZN.SubStopFlag,'0')!='1'
		JOIN codSubsidyCatName ZU ON ZU.codCodeVer=ZN.codCodeVer and ZN.SubCatCode LIKE ZU.SubCatCode+'%' and ZU.SubCatLevel<ZN.SubCatLevel and ISNULL(ZU.SubStopFlag,'0')!='1'
		WHERE ISNULL(NULLIF(ZO.codCodeVer,0),@tsbYear )=@tsbYear 
				AND ISNULL(X.oulOutlayCode,'') LIKE ISNULL(ZO.OutlayCode,'')+'%'
				AND ISNULL(NULLIF(ZO.SubtsbPayeeRoleNo,''),ISNULL(tsbPayeeRoleNo,''))=ISNULL(tsbPayeeRoleNo,'')
		ORDER BY ZU.SubCatLevel DESC,ZU.SubCatCode,ZU.codCodeVer DESC
		) as tsbPayeeRoleName_UP,
		(SELECT TOP 1 ZN.SubCatName FROM codSubsidyCatName ZN JOIN codSubsidyOutlayRole ZO ON ZN.codCodeVer=ZO.codCodeVer and ZN.SubCatCode=ZO.SubCatCode and ISNULL(ZN.SubStopFlag,'0')!='1'
		WHERE ISNULL(NULLIF(ZO.codCodeVer,0),@tsbYear )=@tsbYear 
				AND ISNULL(X.oulOutlayCode,'') LIKE ISNULL(ZO.OutlayCode,'')+'%'
				AND ISNULL(NULLIF(ZO.SubtsbPayeeRoleNo,''),ISNULL(tsbPayeeRoleNo,''))=ISNULL(tsbPayeeRoleNo,'')
		ORDER BY ZN.SubCatCode,ZN.codCodeVer DESC
		) as tsbPayeeRoleName_MY, 
		---------------------------- ↑↑ 年報分類 ↑↑ -----------------------------
        X.tsbApplyWordNum as 動支編號,
        X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo, X.tsbDecideSeq,
        X.tsbOutlayYear, X.oulOutlayCode, X.oulOutlayName AS 列支科目名稱, 
        X.業務計畫代碼, X.業務計畫名稱, 
        X.工作計畫代碼, X.工作計畫名稱,
        X.分支計畫代碼, X.分支計畫名稱, 
        X.dptCode, X.dptName AS 組室別,
		X.tsbPayeeRoleNo, X.tsbPayeeNo, X.tsbPayeeName AS 受補捐助單位名稱,
		X.tsbTrustSubsidyName AS 補捐助計畫名稱,
        ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) AS 計畫核定金額,
		--取估列及核銷的傳票日期(2015/12/16初驗依蔡專要求修改)，若此欄空白，應僅進行預撥作業所致
        ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo,X.tsbDecideSeq,
			                                                  'tsbExchPassDate','1','PayAndEstimate') , ',' , char(13)+char(10) 
                        ) , '' ) as 傳票日期,
        ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo,X.tsbDecideSeq,
			                                                  'tsbExchNo','1','PayAndEstimate') , ',' , char(13)+char(10) 
                        ) , '' ) as 傳票號碼,
        -----------------------------------------------------------------------------
		X.計畫執行情形Y, 
        X.計畫執行情形N, 
        X.是否納入受補助單位預算Y, 
        X.是否納入受補助單位預算N,
		X.是否明定補助之條件標準Y,
        X.是否明定補助之條件標準N,
		X.是否明定成果考核方式Y, 
        X.是否明定成果考核方式N, 
		X.對補助經費是否施以就地查核Y, 
        X.對補助經費是否施以就地查核N, 
		X.計畫未完成原因,
		X.備註,
        -----------------------------------------------------------------------------
		Y.預撥金額 + Y.付現 - Y.預撥繳回金額 AS 本年度撥付數, 
		Y.預撥金額 + Y.付現 - Y.預撥繳回金額 AS 累計撥付數, 
        -- 未撥數 = 計畫核定金額 - 累計撥付數
        ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) - (Y.預撥金額 + Y.付現 - Y.預撥繳回金額) AS 未撥數,
		-- 合計 = 累計撥付數 + 未撥數 = 計畫核定金額
		ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) AS 合計,
		Y.估列金額 + Y.費用 - Y.估列高估沖銷金額 - Y.核銷繳回金額 AS 實際支用金額,
		--計畫完成結餘款_金額 = 計畫核定金額 - 實際支用金額
		ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) - (Y.估列金額 + Y.費用 - Y.估列高估沖銷金額 - Y.核銷繳回金額) AS 計畫完成結餘款, 
		ISNULL(CONVERT(varchar(10), Y.繳回日期, 111), '') AS 收回日期
	FROM
	(
		------------------　　核定資料Start　　-----------------
        SELECT  GTD.tsbApplyWordNum, GTD.tsbYear, 
                GTD.tsbApplyNo, GTD.tsbApplySeq, 
                GTD.tsbDecideNo, GTD.tsbDecideSeq, 
                GTD.tsbPayeeNo, GTD.tsbPayeeName, 
                GTD.業務計畫代碼, GTD.業務計畫名稱 ,GTD.工作計畫代碼, GTD.工作計畫名稱, GTD.分支計畫代碼,
                GTD.有編號的分支計畫名稱 AS 分支計畫名稱,
                GTD.plnPlanCode, GTD.plnPlanName, 
                GTD.tsbOutlayYear, GTD.oulOutlayCode, GTD.oulOutlayName , 
                GTD.tsbTrustSubsidyName, GTD.dptCode, GTD.dptName,
                GTD.tsbMarkUserNo, GTD.tsbMemo ,
                GTD.tsbWorkUserNo, GTD.tsbPassDTime, 
                GTD.tsbPayeeRoleNo, GTD.tsbPayeeRoleName, GTD.tsbCityName,
                GTD.tsbCityAreaName, GTD.tsbHostName, GTD.tsbMoney, GTD.tsbDecideDate,
                GTD.tsbContractDTime, GTD.tsbContractMoney,
                ----------------------------------------------------------------------------
                CASE WHEN FSP.isFinish = '1' THEN 'V' ELSE '' END AS 計畫執行情形Y,
                CASE WHEN FSP.isFinish = '1' THEN '' ELSE 'V' END AS 計畫執行情形N,
                CASE WHEN GTD.inspect = '2' THEN 'V' ELSE '' END AS 是否納入受補助單位預算Y,
                CASE WHEN GTD.inspect = '2' THEN '' ELSE 'V' END AS 是否納入受補助單位預算N,
		        '' AS 是否明定補助之條件標準Y,
                '' AS 是否明定補助之條件標準N,
		        '' AS 是否明定成果考核方式Y, 
                '' AS 是否明定成果考核方式N, 
		        '' AS 對補助經費是否施以就地查核Y, 
                '' AS 對補助經費是否施以就地查核N, 
		        '' AS 計畫未完成原因,
		        '' AS 備註
                ----------------------------------------------------------------------------
		FROM dbo.fn_GetTsbDecideDT(@tsbYear, '1') GTD
        LEFT JOIN tsbficSubisdyPara FSP
            ON  GTD.tsbYear = FSP.tsbYear 
            AND GTD.tsbApplyNo = FSP.tsbApplyNo AND GTD.tsbApplySeq = FSP.tsbApplySeq 
            AND GTD.tsbDecideNo = FSP.tsbDecideNo AND GTD.tsbDecideSeq = FSP.tsbDecideSeq
		WHERE --20161108  (GTD.oulOutlayCode = N'721' OR GTD.oulOutlayCode = N'722' OR GTD.oulOutlayCode = N'723')
			--721 -> 724，722 -> 722、723，723 -> 721
			( ((GTD.oulOutlayCode LIKE N'721%' OR GTD.oulOutlayCode LIKE N'722%' OR GTD.oulOutlayCode = N'723') AND GTD.tsbOutlayYear <= 105)
				OR ((GTD.oulOutlayCode LIKE N'724%' OR GTD.oulOutlayCode LIKE N'722%' OR GTD.oulOutlayCode LIKE N'723%'
					OR GTD.oulOutlayCode LIKE N'721%') AND GTD.tsbOutlayYear > 105)
			)
		------------------　　核定資料 End 　　-----------------
	) X
	INNER JOIN
	(
        -- 只顯示當年度資料(tsbYear = tsbOutlayYear)，且只抓 72 向下用途別。（核定再更細部去抓。）
        -- 參數：（ 年度 , 計畫年度 , 計畫科目 , 用途別 , 起始日期 , 結束日期 , 案件類別 , 是否有傳票號碼 ）
        SELECT * FROM [dbo].[fn_GetMixDT](@tsbYear, NULL, NULL, '72', NULL, NULL, NULL, '1', @tsbIsAudit)
	) Y
    ON  X.tsbYear = Y.tsbYear 
    AND X.tsbApplyNo = Y.tsbApplyNo AND X.tsbApplySeq = Y.tsbApplySeq 
    AND X.tsbDecideNo = Y.tsbDecideNo AND X.tsbDecideSeq = Y.tsbDecideSeq
    -- ORDER BY X.tsbApplyWordNum, X.tsbDecideSeq
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------
) Z
GROUP BY tsbPayeeRoleName_UP, tsbPayeeRoleName_MY, tsbPayeeNo, 動支編號 WITH ROLLUP  
HAVING GROUPING(tsbPayeeRoleName_UP)=0
ORDER BY tsbPayeeRoleName_UP, tsbPayeeRoleName_MY, tsbPayeeNo,
	(CASE WHEN MAX(列支科目名稱) = '' THEN 'zzzzz' ELSE MAX(列支科目名稱) END), 
	(CASE WHEN MAX(組室別) = '' THEN 'zzzzzz' ELSE MAX(組室別) END),
	(CASE WHEN GROUPING(動支編號)=1 THEN ISNULL(MAX(動支編號),'zzzzzz') ELSE 動支編號 END),
	(CASE WHEN MAX(傳票日期) = '' THEN 'zzzzzz' ELSE MAX(傳票日期) END)

    --列支科目名稱, 組室別, 動支編號,傳票日期

------------------------------------------------------------

--執行時間--  2017/5/8 下午 03:50:20
--連線字串：Data Source=localhost;Initial Catalog=HPAGBC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(6)
Set @PK_MnuNo = '025'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--#2017/5/8 下午 03:50:35#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/8 下午 03:50:35#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/8 下午 03:50:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/08 15:50:36.881 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 15:50:36.921 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 15:50:36.921 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 15:50:36.921 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/08 15:50:36.931 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--執行時間--  2017/5/9 上午 08:59:52
--連線字串：Data Source=localhost;Initial Catalog=HPAGBC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(6)
Set @PK_MnuNo = '025'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/9 上午 09:07:02
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 0
Declare @tsbIsAudit As NVarChar(2)
Set @tsbIsAudit = '0'

-- --基金_補捐助其他政府機關或團體私人經費報告表(採用共用函數) - 有分層(含保留結轉資料)
-- Declare @tsbYear As Int
-- Set @tsbYear = 105

SELECT
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(組室別) ELSE '' END) as 組室別
        ,(CASE
                WHEN GROUPING(tsbPayeeRoleName_UP)=1 THEN '合計'
                WHEN GROUPING(tsbPayeeRoleName_MY)=1 THEN MAX(tsbPayeeRoleName_UP)
                WHEN GROUPING(tsbPayeeNo)=1 THEN MAX(tsbPayeeRoleName_MY)
                WHEN GROUPING(動支編號)=1 THEN '     小計'
            ELSE MAX(受補捐助單位名稱) END) AS 受補捐助單位名稱
        ,(CASE
                WHEN GROUPING(動支編號)=0 THEN MAX(補捐助計畫名稱) 
                WHEN GROUPING(tsbPayeeRoleName_MY)=1 THEN '總計'
                WHEN GROUPING(tsbPayeeNo)=1 THEN '合計'
            ELSE '' END) as 補捐助計畫名稱
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(oulOutlayCode + 列支科目名稱) ELSE '' END) as 列支科目名稱
		,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(動支編號) ELSE '' END) as 動支編號
        ,SUM(計畫核定金額) as 計畫核定金額
        ,SUM(本年度撥付數) as 本年度撥付數
        ,SUM(累計撥付數) as 累計撥付數
        ,SUM(未撥數) as 未撥數
        ,SUM(合計) as 合計
        ,SUM(實際支用金額) as 實際支用金額
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫執行情形Y) ELSE '' END) as 計畫執行情形Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫執行情形N) ELSE '' END) as 計畫執行情形N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否納入受補助單位預算Y) ELSE '' END) as 是否納入受補助單位預算Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否納入受補助單位預算N) ELSE '' END) as 是否納入受補助單位預算N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定補助之條件標準Y) ELSE '' END) as 是否明定補助之條件標準Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定補助之條件標準N) ELSE '' END) as 是否明定補助之條件標準N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定成果考核方式Y) ELSE '' END) as 是否明定成果考核方式Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定成果考核方式N) ELSE '' END) as 是否明定成果考核方式N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(對補助經費是否施以就地查核Y) ELSE '' END) as 對補助經費是否施以就地查核Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(對補助經費是否施以就地查核N) ELSE '' END) as 對補助經費是否施以就地查核N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫未完成原因) ELSE '' END) as 計畫未完成原因
        ,SUM(計畫完成結餘款) as 計畫完成結餘款
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(收回日期) ELSE '' END) as 收回日期
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(備註) ELSE '' END) as 備註
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票日期) ELSE '' END) as 傳票日期
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票號碼) ELSE '' END) as 傳票號碼
FROM 
(
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------
	SELECT  
		---------------------------- ↓↓ 年報分類 ↓↓ -----------------------------
		(SELECT TOP 1 ZU.SubCatCode FROM codSubsidyCatName ZN JOIN codSubsidyOutlayRole ZO ON ZN.codCodeVer=ZO.codCodeVer and ZN.SubCatCode=ZO.SubCatCode and ISNULL(ZN.SubStopFlag,'0')!='1'
		JOIN codSubsidyCatName ZU ON ZU.codCodeVer=ZN.codCodeVer and ZN.SubCatCode LIKE ZU.SubCatCode+'%' and ZU.SubCatLevel<ZN.SubCatLevel and ISNULL(ZU.SubStopFlag,'0')!='1'
		WHERE ISNULL(NULLIF(ZO.codCodeVer,0),@tsbYear )=@tsbYear 
				AND ISNULL(X.oulOutlayCode,'') LIKE ISNULL(ZO.OutlayCode,'')+'%'
				AND ISNULL(NULLIF(ZO.SubtsbPayeeRoleNo,''),ISNULL(tsbPayeeRoleNo,''))=ISNULL(tsbPayeeRoleNo,'')
		ORDER BY ZU.SubCatLevel DESC,ZU.SubCatCode,ZU.codCodeVer DESC
		) as SubCatCode,
		(SELECT TOP 1 ZU.SubCatName FROM codSubsidyCatName ZN JOIN codSubsidyOutlayRole ZO ON ZN.codCodeVer=ZO.codCodeVer and ZN.SubCatCode=ZO.SubCatCode and ISNULL(ZN.SubStopFlag,'0')!='1'
		JOIN codSubsidyCatName ZU ON ZU.codCodeVer=ZN.codCodeVer and ZN.SubCatCode LIKE ZU.SubCatCode+'%' and ZU.SubCatLevel<ZN.SubCatLevel and ISNULL(ZU.SubStopFlag,'0')!='1'
		WHERE ISNULL(NULLIF(ZO.codCodeVer,0),@tsbYear )=@tsbYear 
				AND ISNULL(X.oulOutlayCode,'') LIKE ISNULL(ZO.OutlayCode,'')+'%'
				AND ISNULL(NULLIF(ZO.SubtsbPayeeRoleNo,''),ISNULL(tsbPayeeRoleNo,''))=ISNULL(tsbPayeeRoleNo,'')
		ORDER BY ZU.SubCatLevel DESC,ZU.SubCatCode,ZU.codCodeVer DESC
		) as tsbPayeeRoleName_UP,
		(SELECT TOP 1 ZN.SubCatName FROM codSubsidyCatName ZN JOIN codSubsidyOutlayRole ZO ON ZN.codCodeVer=ZO.codCodeVer and ZN.SubCatCode=ZO.SubCatCode and ISNULL(ZN.SubStopFlag,'0')!='1'
		WHERE ISNULL(NULLIF(ZO.codCodeVer,0),@tsbYear )=@tsbYear 
				AND ISNULL(X.oulOutlayCode,'') LIKE ISNULL(ZO.OutlayCode,'')+'%'
				AND ISNULL(NULLIF(ZO.SubtsbPayeeRoleNo,''),ISNULL(tsbPayeeRoleNo,''))=ISNULL(tsbPayeeRoleNo,'')
		ORDER BY ZN.SubCatCode,ZN.codCodeVer DESC
		) as tsbPayeeRoleName_MY, 
		---------------------------- ↑↑ 年報分類 ↑↑ -----------------------------
        X.tsbApplyWordNum as 動支編號,
        X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo, X.tsbDecideSeq,
        X.tsbOutlayYear, X.oulOutlayCode, X.oulOutlayName AS 列支科目名稱, 
        X.業務計畫代碼, X.業務計畫名稱, 
        X.工作計畫代碼, X.工作計畫名稱,
        X.分支計畫代碼, X.分支計畫名稱, 
        X.dptCode, X.dptName AS 組室別,
		X.tsbPayeeRoleNo, X.tsbPayeeNo, X.tsbPayeeName AS 受補捐助單位名稱,
		X.tsbTrustSubsidyName AS 補捐助計畫名稱,
        ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) AS 計畫核定金額,
		--取估列及核銷的傳票日期(2015/12/16初驗依蔡專要求修改)，若此欄空白，應僅進行預撥作業所致
        ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo,X.tsbDecideSeq,
			                                                  'tsbExchPassDate','1','PayAndEstimate') , ',' , char(13)+char(10) 
                        ) , '' ) as 傳票日期,
        ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo,X.tsbDecideSeq,
			                                                  'tsbExchNo','1','PayAndEstimate') , ',' , char(13)+char(10) 
                        ) , '' ) as 傳票號碼,
        -----------------------------------------------------------------------------
		X.計畫執行情形Y, 
        X.計畫執行情形N, 
        X.是否納入受補助單位預算Y, 
        X.是否納入受補助單位預算N,
		X.是否明定補助之條件標準Y,
        X.是否明定補助之條件標準N,
		X.是否明定成果考核方式Y, 
        X.是否明定成果考核方式N, 
		X.對補助經費是否施以就地查核Y, 
        X.對補助經費是否施以就地查核N, 
		X.計畫未完成原因,
		X.備註,
        -----------------------------------------------------------------------------
		Y.預撥金額 + Y.付現 - Y.預撥繳回金額 AS 本年度撥付數, 
		Y.預撥金額 + Y.付現 - Y.預撥繳回金額 AS 累計撥付數, 
        -- 未撥數 = 計畫核定金額 - 累計撥付數
        ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) - (Y.預撥金額 + Y.付現 - Y.預撥繳回金額) AS 未撥數,
		-- 合計 = 累計撥付數 + 未撥數 = 計畫核定金額
		ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) AS 合計,
		Y.估列金額 + Y.費用 - Y.估列高估沖銷金額 - Y.核銷繳回金額 AS 實際支用金額,
		--計畫完成結餘款_金額 = 計畫核定金額 - 實際支用金額
		ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) - (Y.估列金額 + Y.費用 - Y.估列高估沖銷金額 - Y.核銷繳回金額) AS 計畫完成結餘款, 
		ISNULL(CONVERT(varchar(10), Y.繳回日期, 111), '') AS 收回日期
	FROM
	(
		------------------　　核定資料Start　　-----------------
        SELECT  GTD.tsbApplyWordNum, GTD.tsbYear, 
                GTD.tsbApplyNo, GTD.tsbApplySeq, 
                GTD.tsbDecideNo, GTD.tsbDecideSeq, 
                GTD.tsbPayeeNo, GTD.tsbPayeeName, 
                GTD.業務計畫代碼, GTD.業務計畫名稱 ,GTD.工作計畫代碼, GTD.工作計畫名稱, GTD.分支計畫代碼,
                GTD.有編號的分支計畫名稱 AS 分支計畫名稱,
                GTD.plnPlanCode, GTD.plnPlanName, 
                GTD.tsbOutlayYear, GTD.oulOutlayCode, GTD.oulOutlayName , 
                GTD.tsbTrustSubsidyName, GTD.dptCode, GTD.dptName,
                GTD.tsbMarkUserNo, GTD.tsbMemo ,
                GTD.tsbWorkUserNo, GTD.tsbPassDTime, 
                GTD.tsbPayeeRoleNo, GTD.tsbPayeeRoleName, GTD.tsbCityName,
                GTD.tsbCityAreaName, GTD.tsbHostName, GTD.tsbMoney, GTD.tsbDecideDate,
                GTD.tsbContractDTime, GTD.tsbContractMoney,
                ----------------------------------------------------------------------------
                CASE WHEN FSP.isFinish = '1' THEN 'V' ELSE '' END AS 計畫執行情形Y,
                CASE WHEN FSP.isFinish = '1' THEN '' ELSE 'V' END AS 計畫執行情形N,
                CASE WHEN GTD.inspect = '2' THEN 'V' ELSE '' END AS 是否納入受補助單位預算Y,
                CASE WHEN GTD.inspect = '2' THEN '' ELSE 'V' END AS 是否納入受補助單位預算N,
		        '' AS 是否明定補助之條件標準Y,
                '' AS 是否明定補助之條件標準N,
		        '' AS 是否明定成果考核方式Y, 
                '' AS 是否明定成果考核方式N, 
		        '' AS 對補助經費是否施以就地查核Y, 
                '' AS 對補助經費是否施以就地查核N, 
		        '' AS 計畫未完成原因,
		        '' AS 備註
                ----------------------------------------------------------------------------
		FROM dbo.fn_GetTsbDecideDT(@tsbYear, '1') GTD
        LEFT JOIN tsbficSubisdyPara FSP
            ON  GTD.tsbYear = FSP.tsbYear 
            AND GTD.tsbApplyNo = FSP.tsbApplyNo AND GTD.tsbApplySeq = FSP.tsbApplySeq 
            AND GTD.tsbDecideNo = FSP.tsbDecideNo AND GTD.tsbDecideSeq = FSP.tsbDecideSeq
		WHERE --20161108  (GTD.oulOutlayCode = N'721' OR GTD.oulOutlayCode = N'722' OR GTD.oulOutlayCode = N'723')
			--721 -> 724，722 -> 722、723，723 -> 721
			( ((GTD.oulOutlayCode LIKE N'721%' OR GTD.oulOutlayCode LIKE N'722%' OR GTD.oulOutlayCode = N'723') AND GTD.tsbOutlayYear <= 105)
				OR ((GTD.oulOutlayCode LIKE N'724%' OR GTD.oulOutlayCode LIKE N'722%' OR GTD.oulOutlayCode LIKE N'723%'
					OR GTD.oulOutlayCode LIKE N'721%') AND GTD.tsbOutlayYear > 105)
			)
		------------------　　核定資料 End 　　-----------------
	) X
	INNER JOIN
	(
        -- 只顯示當年度資料(tsbYear = tsbOutlayYear)，且只抓 72 向下用途別。（核定再更細部去抓。）
        -- 參數：（ 年度 , 計畫年度 , 計畫科目 , 用途別 , 起始日期 , 結束日期 , 案件類別 , 是否有傳票號碼 , 是否包含審定資料 ）
        SELECT * FROM [dbo].[fn_GetMixDT](@tsbYear, NULL, NULL, '72', NULL, NULL, NULL, '1', @tsbIsAudit)
	) Y
    ON  X.tsbYear = Y.tsbYear 
    AND X.tsbApplyNo = Y.tsbApplyNo AND X.tsbApplySeq = Y.tsbApplySeq 
    AND X.tsbDecideNo = Y.tsbDecideNo AND X.tsbDecideSeq = Y.tsbDecideSeq
    -- ORDER BY X.tsbApplyWordNum, X.tsbDecideSeq
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------
) Z
GROUP BY tsbPayeeRoleName_UP, tsbPayeeRoleName_MY, tsbPayeeNo, 動支編號 WITH ROLLUP  
HAVING GROUPING(tsbPayeeRoleName_UP)=0
ORDER BY tsbPayeeRoleName_UP, tsbPayeeRoleName_MY, tsbPayeeNo,
	(CASE WHEN MAX(列支科目名稱) = '' THEN 'zzzzz' ELSE MAX(列支科目名稱) END), 
	(CASE WHEN MAX(組室別) = '' THEN 'zzzzzz' ELSE MAX(組室別) END),
	(CASE WHEN GROUPING(動支編號)=1 THEN ISNULL(MAX(動支編號),'zzzzzz') ELSE 動支編號 END),
	(CASE WHEN MAX(傳票日期) = '' THEN 'zzzzzz' ELSE MAX(傳票日期) END)

    --列支科目名稱, 組室別, 動支編號,傳票日期

------------------------------------------------------------

--#2017/5/9 上午 09:07:24#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%e4%bd%9c%e6%a5%ad%e5%b9%b4%e6%9c%88%e8%a8%ad%e5%ae%9a%7d
 Select Top 1 PK_MnuNo, mnuUrl From sysMenuBase Where mnuAlias Like '%{作業年月設定}%'
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:24#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%e4%bd%9c%e6%a5%ad%e5%b9%b4%e6%9c%88%e8%a8%ad%e5%ae%9a%7d
--[Parameter Count:1]
--@parMenuID='011'
 Select * From SysMenuBase Where PK_MnuNo ='011' 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:24#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%e4%bd%9c%e6%a5%ad%e5%b9%b4%e6%9c%88%e8%a8%ad%e5%ae%9a%7d
 Select Distinct acmYear From actMain Where acmYear >0  Order By acmYear 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:25#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%e4%bd%9c%e6%a5%ad%e5%b9%b4%e6%9c%88%e8%a8%ad%e5%ae%9a%7d
 Select  A.dptCode, A.dptName, A.dptLevel, A.dptBgtFlag, A.dptWorkFlag, A.depCtrlAllFlag, A.dptTeamFlag, A.teaCode, A.dptAliasNo, A.dptAliasName, A.dptCreateDate, A.dptStopFlag, A.dptStopDate  FROM codDepartName A  Where 1=1  AND (ISNULL( A.dptCreateDate,'') <='1911/12/31' AND ( ISNULL(A.dptStopFlag,'') <> '1' OR A.dptStopDate > '1911/12/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:31#  http://localhost/HPAGBC/Login.aspx
--[Parameter Count:2]
--@UserAlias='99999'
--@UserPwd='05072306'
SELECT * FROM sysBaseUser A WHERE usrAlias='99999' AND usrPwd='05072306' AND ISNULL(usrStateKind,'0')<>'1' ORDER BY PK_usrNo
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:31#  http://localhost/HPAGBC/Login.aspx
UPDATE sysBaseUser SET usrLoginDTime='2017/05/09 09:07:31' ,usrLoginIP='::1'  WHERE PK_usrNo=1
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:31#  http://localhost/HPAGBC/Login.aspx
INSERT logWhoRec (LogIP,LogDate,LogUser,LogMod,LogPage,LogWork,LogMemo,LogWorkUser,LogLevel,LogLink,LogSys) VALUES ('::1','2017/05/09 09:07:31','99999','Login','Login.aspx','','成功','系統管理員',35,'','HPAGBC/')
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:32#  http://localhost/HPAGBC/Login.aspx
Select Top 1 * From  ebsAgent 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:32#  http://localhost/HPAGBC/Login.aspx
 Select sysCloseDate From basBaseData 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:32#  http://localhost/HPAGBC/Login.aspx
Select dptName, dptCode  FROM codDepartName A  Where 1=1  and  dptCode = '14' Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:32#  http://localhost/HPAGBC/Menu.aspx
SELECT DISTINCT (SELECT TOP 1 A2.PK_MnuNo  FROM  sysUserPower C2 INNER JOIN  sysGroupData D2 ON C2.PK_grpNo = D2.PK_grpNo INNER JOIN  sysMenuBase A2 ON A2.PK_MnuNo = D2.PK_mnuNo WHERE  (C2.PK_usrNo = 1)  AND ISNULL(mnuLevel,0)> -90 AND A.PK_MnuNo LIKE A2.PK_MnuNo + '_%'  ORDER BY  A2.PK_MnuNo DESC) AS ParentPK_MnuNo, A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -90 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:33#  http://localhost/HPAGBC/intro.aspx
SELECT 'Powered by Microsoft SQL Server ' + CONVERT(nvarchar,SERVERPROPERTY('ProductVersion')) + ' ' + CONVERT(nvarchar,SERVERPROPERTY('ProductLevel'))
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:33#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%e4%bd%9c%e6%a5%ad%e5%b9%b4%e6%9c%88%e8%a8%ad%e5%ae%9a%7d
 Select Top 1 PK_MnuNo, mnuUrl From sysMenuBase Where mnuAlias Like '%{作業年月設定}%'
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:33#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%e4%bd%9c%e6%a5%ad%e5%b9%b4%e6%9c%88%e8%a8%ad%e5%ae%9a%7d
--[Parameter Count:1]
--@parMenuID='011'
 Select * From SysMenuBase Where PK_MnuNo ='011' 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:33#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%e4%bd%9c%e6%a5%ad%e5%b9%b4%e6%9c%88%e8%a8%ad%e5%ae%9a%7d
 Select Distinct acmYear From actMain Where acmYear >0  Order By acmYear 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:33#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%e4%bd%9c%e6%a5%ad%e5%b9%b4%e6%9c%88%e8%a8%ad%e5%ae%9a%7d
 Select  A.dptCode, A.dptName, A.dptLevel, A.dptBgtFlag, A.dptWorkFlag, A.depCtrlAllFlag, A.dptTeamFlag, A.teaCode, A.dptAliasNo, A.dptAliasName, A.dptCreateDate, A.dptStopFlag, A.dptStopDate  FROM codDepartName A  Where 1=1  and  dptCode = '14' AND (ISNULL( A.dptCreateDate,'') <='2017/05/31' AND ( ISNULL(A.dptStopFlag,'') <> '1' OR A.dptStopDate > '2017/05/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:35#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%E4%BD%9C%E6%A5%AD%E5%B9%B4%E6%9C%88%E8%A8%AD%E5%AE%9A%7d
 Select Top 1 PK_MnuNo, mnuUrl From sysMenuBase Where mnuAlias Like '%{作業年月設定}%'
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:35#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%E4%BD%9C%E6%A5%AD%E5%B9%B4%E6%9C%88%E8%A8%AD%E5%AE%9A%7d
--[Parameter Count:1]
--@parMenuID='011'
 Select * From SysMenuBase Where PK_MnuNo ='011' 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:37#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%E4%BD%9C%E6%A5%AD%E5%B9%B4%E6%9C%88%E8%A8%AD%E5%AE%9A%7d
 Select Top 1 PK_MnuNo, mnuUrl From sysMenuBase Where mnuAlias Like '%{作業年月設定}%'
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:07:37#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%E4%BD%9C%E6%A5%AD%E5%B9%B4%E6%9C%88%E8%A8%AD%E5%AE%9A%7d
--[Parameter Count:1]
--@parMenuID='011'
 Select * From SysMenuBase Where PK_MnuNo ='011' 
-------------------------------------------------------------------------------
--執行時間--  2017/5/9 上午 09:08:05
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbIsAudit As NVarChar(2)
Set @tsbIsAudit = '0'

-- --基金_補捐助其他政府機關或團體私人經費報告表(採用共用函數) - 有分層(含保留結轉資料)
-- Declare @tsbYear As Int
-- Set @tsbYear = 105

SELECT
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(組室別) ELSE '' END) as 組室別
        ,(CASE
                WHEN GROUPING(tsbPayeeRoleName_UP)=1 THEN '合計'
                WHEN GROUPING(tsbPayeeRoleName_MY)=1 THEN MAX(tsbPayeeRoleName_UP)
                WHEN GROUPING(tsbPayeeNo)=1 THEN MAX(tsbPayeeRoleName_MY)
                WHEN GROUPING(動支編號)=1 THEN '     小計'
            ELSE MAX(受補捐助單位名稱) END) AS 受補捐助單位名稱
        ,(CASE
                WHEN GROUPING(動支編號)=0 THEN MAX(補捐助計畫名稱) 
                WHEN GROUPING(tsbPayeeRoleName_MY)=1 THEN '總計'
                WHEN GROUPING(tsbPayeeNo)=1 THEN '合計'
            ELSE '' END) as 補捐助計畫名稱
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(oulOutlayCode + 列支科目名稱) ELSE '' END) as 列支科目名稱
		,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(動支編號) ELSE '' END) as 動支編號
        ,SUM(計畫核定金額) as 計畫核定金額
        ,SUM(本年度撥付數) as 本年度撥付數
        ,SUM(累計撥付數) as 累計撥付數
        ,SUM(未撥數) as 未撥數
        ,SUM(合計) as 合計
        ,SUM(實際支用金額) as 實際支用金額
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫執行情形Y) ELSE '' END) as 計畫執行情形Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫執行情形N) ELSE '' END) as 計畫執行情形N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否納入受補助單位預算Y) ELSE '' END) as 是否納入受補助單位預算Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否納入受補助單位預算N) ELSE '' END) as 是否納入受補助單位預算N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定補助之條件標準Y) ELSE '' END) as 是否明定補助之條件標準Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定補助之條件標準N) ELSE '' END) as 是否明定補助之條件標準N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定成果考核方式Y) ELSE '' END) as 是否明定成果考核方式Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(是否明定成果考核方式N) ELSE '' END) as 是否明定成果考核方式N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(對補助經費是否施以就地查核Y) ELSE '' END) as 對補助經費是否施以就地查核Y
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(對補助經費是否施以就地查核N) ELSE '' END) as 對補助經費是否施以就地查核N
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫未完成原因) ELSE '' END) as 計畫未完成原因
        ,SUM(計畫完成結餘款) as 計畫完成結餘款
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(收回日期) ELSE '' END) as 收回日期
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(備註) ELSE '' END) as 備註
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票日期) ELSE '' END) as 傳票日期
        ,(CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票號碼) ELSE '' END) as 傳票號碼
FROM 
(
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------
	SELECT  
		---------------------------- ↓↓ 年報分類 ↓↓ -----------------------------
		(SELECT TOP 1 ZU.SubCatCode FROM codSubsidyCatName ZN JOIN codSubsidyOutlayRole ZO ON ZN.codCodeVer=ZO.codCodeVer and ZN.SubCatCode=ZO.SubCatCode and ISNULL(ZN.SubStopFlag,'0')!='1'
		JOIN codSubsidyCatName ZU ON ZU.codCodeVer=ZN.codCodeVer and ZN.SubCatCode LIKE ZU.SubCatCode+'%' and ZU.SubCatLevel<ZN.SubCatLevel and ISNULL(ZU.SubStopFlag,'0')!='1'
		WHERE ISNULL(NULLIF(ZO.codCodeVer,0),@tsbYear )=@tsbYear 
				AND ISNULL(X.oulOutlayCode,'') LIKE ISNULL(ZO.OutlayCode,'')+'%'
				AND ISNULL(NULLIF(ZO.SubtsbPayeeRoleNo,''),ISNULL(tsbPayeeRoleNo,''))=ISNULL(tsbPayeeRoleNo,'')
		ORDER BY ZU.SubCatLevel DESC,ZU.SubCatCode,ZU.codCodeVer DESC
		) as SubCatCode,
		(SELECT TOP 1 ZU.SubCatName FROM codSubsidyCatName ZN JOIN codSubsidyOutlayRole ZO ON ZN.codCodeVer=ZO.codCodeVer and ZN.SubCatCode=ZO.SubCatCode and ISNULL(ZN.SubStopFlag,'0')!='1'
		JOIN codSubsidyCatName ZU ON ZU.codCodeVer=ZN.codCodeVer and ZN.SubCatCode LIKE ZU.SubCatCode+'%' and ZU.SubCatLevel<ZN.SubCatLevel and ISNULL(ZU.SubStopFlag,'0')!='1'
		WHERE ISNULL(NULLIF(ZO.codCodeVer,0),@tsbYear )=@tsbYear 
				AND ISNULL(X.oulOutlayCode,'') LIKE ISNULL(ZO.OutlayCode,'')+'%'
				AND ISNULL(NULLIF(ZO.SubtsbPayeeRoleNo,''),ISNULL(tsbPayeeRoleNo,''))=ISNULL(tsbPayeeRoleNo,'')
		ORDER BY ZU.SubCatLevel DESC,ZU.SubCatCode,ZU.codCodeVer DESC
		) as tsbPayeeRoleName_UP,
		(SELECT TOP 1 ZN.SubCatName FROM codSubsidyCatName ZN JOIN codSubsidyOutlayRole ZO ON ZN.codCodeVer=ZO.codCodeVer and ZN.SubCatCode=ZO.SubCatCode and ISNULL(ZN.SubStopFlag,'0')!='1'
		WHERE ISNULL(NULLIF(ZO.codCodeVer,0),@tsbYear )=@tsbYear 
				AND ISNULL(X.oulOutlayCode,'') LIKE ISNULL(ZO.OutlayCode,'')+'%'
				AND ISNULL(NULLIF(ZO.SubtsbPayeeRoleNo,''),ISNULL(tsbPayeeRoleNo,''))=ISNULL(tsbPayeeRoleNo,'')
		ORDER BY ZN.SubCatCode,ZN.codCodeVer DESC
		) as tsbPayeeRoleName_MY, 
		---------------------------- ↑↑ 年報分類 ↑↑ -----------------------------
        X.tsbApplyWordNum as 動支編號,
        X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo, X.tsbDecideSeq,
        X.tsbOutlayYear, X.oulOutlayCode, X.oulOutlayName AS 列支科目名稱, 
        X.業務計畫代碼, X.業務計畫名稱, 
        X.工作計畫代碼, X.工作計畫名稱,
        X.分支計畫代碼, X.分支計畫名稱, 
        X.dptCode, X.dptName AS 組室別,
		X.tsbPayeeRoleNo, X.tsbPayeeNo, X.tsbPayeeName AS 受補捐助單位名稱,
		X.tsbTrustSubsidyName AS 補捐助計畫名稱,
        ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) AS 計畫核定金額,
		--取估列及核銷的傳票日期(2015/12/16初驗依蔡專要求修改)，若此欄空白，應僅進行預撥作業所致
        ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo,X.tsbDecideSeq,
			                                                  'tsbExchPassDate','1','PayAndEstimate') , ',' , char(13)+char(10) 
                        ) , '' ) as 傳票日期,
        ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo,X.tsbDecideSeq,
			                                                  'tsbExchNo','1','PayAndEstimate') , ',' , char(13)+char(10) 
                        ) , '' ) as 傳票號碼,
        -----------------------------------------------------------------------------
		X.計畫執行情形Y, 
        X.計畫執行情形N, 
        X.是否納入受補助單位預算Y, 
        X.是否納入受補助單位預算N,
		X.是否明定補助之條件標準Y,
        X.是否明定補助之條件標準N,
		X.是否明定成果考核方式Y, 
        X.是否明定成果考核方式N, 
		X.對補助經費是否施以就地查核Y, 
        X.對補助經費是否施以就地查核N, 
		X.計畫未完成原因,
		X.備註,
        -----------------------------------------------------------------------------
		Y.預撥金額 + Y.付現 - Y.預撥繳回金額 AS 本年度撥付數, 
		Y.預撥金額 + Y.付現 - Y.預撥繳回金額 AS 累計撥付數, 
        -- 未撥數 = 計畫核定金額 - 累計撥付數
        ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) - (Y.預撥金額 + Y.付現 - Y.預撥繳回金額) AS 未撥數,
		-- 合計 = 累計撥付數 + 未撥數 = 計畫核定金額
		ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) AS 合計,
		Y.估列金額 + Y.費用 - Y.估列高估沖銷金額 - Y.核銷繳回金額 AS 實際支用金額,
		--計畫完成結餘款_金額 = 計畫核定金額 - 實際支用金額
		ISNULL(NULLIF(X.tsbContractMoney, 0), X.tsbMoney) - (Y.估列金額 + Y.費用 - Y.估列高估沖銷金額 - Y.核銷繳回金額) AS 計畫完成結餘款, 
		ISNULL(CONVERT(varchar(10), Y.繳回日期, 111), '') AS 收回日期
	FROM
	(
		------------------　　核定資料Start　　-----------------
        SELECT  GTD.tsbApplyWordNum, GTD.tsbYear, 
                GTD.tsbApplyNo, GTD.tsbApplySeq, 
                GTD.tsbDecideNo, GTD.tsbDecideSeq, 
                GTD.tsbPayeeNo, GTD.tsbPayeeName, 
                GTD.業務計畫代碼, GTD.業務計畫名稱 ,GTD.工作計畫代碼, GTD.工作計畫名稱, GTD.分支計畫代碼,
                GTD.有編號的分支計畫名稱 AS 分支計畫名稱,
                GTD.plnPlanCode, GTD.plnPlanName, 
                GTD.tsbOutlayYear, GTD.oulOutlayCode, GTD.oulOutlayName , 
                GTD.tsbTrustSubsidyName, GTD.dptCode, GTD.dptName,
                GTD.tsbMarkUserNo, GTD.tsbMemo ,
                GTD.tsbWorkUserNo, GTD.tsbPassDTime, 
                GTD.tsbPayeeRoleNo, GTD.tsbPayeeRoleName, GTD.tsbCityName,
                GTD.tsbCityAreaName, GTD.tsbHostName, GTD.tsbMoney, GTD.tsbDecideDate,
                GTD.tsbContractDTime, GTD.tsbContractMoney,
                ----------------------------------------------------------------------------
                CASE WHEN FSP.isFinish = '1' THEN 'V' ELSE '' END AS 計畫執行情形Y,
                CASE WHEN FSP.isFinish = '1' THEN '' ELSE 'V' END AS 計畫執行情形N,
                CASE WHEN GTD.inspect = '2' THEN 'V' ELSE '' END AS 是否納入受補助單位預算Y,
                CASE WHEN GTD.inspect = '2' THEN '' ELSE 'V' END AS 是否納入受補助單位預算N,
		        '' AS 是否明定補助之條件標準Y,
                '' AS 是否明定補助之條件標準N,
		        '' AS 是否明定成果考核方式Y, 
                '' AS 是否明定成果考核方式N, 
		        '' AS 對補助經費是否施以就地查核Y, 
                '' AS 對補助經費是否施以就地查核N, 
		        '' AS 計畫未完成原因,
		        '' AS 備註
                ----------------------------------------------------------------------------
		FROM dbo.fn_GetTsbDecideDT(@tsbYear, '1') GTD
        LEFT JOIN tsbficSubisdyPara FSP
            ON  GTD.tsbYear = FSP.tsbYear 
            AND GTD.tsbApplyNo = FSP.tsbApplyNo AND GTD.tsbApplySeq = FSP.tsbApplySeq 
            AND GTD.tsbDecideNo = FSP.tsbDecideNo AND GTD.tsbDecideSeq = FSP.tsbDecideSeq
		WHERE --20161108  (GTD.oulOutlayCode = N'721' OR GTD.oulOutlayCode = N'722' OR GTD.oulOutlayCode = N'723')
			--721 -> 724，722 -> 722、723，723 -> 721
			( ((GTD.oulOutlayCode LIKE N'721%' OR GTD.oulOutlayCode LIKE N'722%' OR GTD.oulOutlayCode = N'723') AND GTD.tsbOutlayYear <= 105)
				OR ((GTD.oulOutlayCode LIKE N'724%' OR GTD.oulOutlayCode LIKE N'722%' OR GTD.oulOutlayCode LIKE N'723%'
					OR GTD.oulOutlayCode LIKE N'721%') AND GTD.tsbOutlayYear > 105)
			)
		------------------　　核定資料 End 　　-----------------
	) X
	INNER JOIN
	(
        -- 只顯示當年度資料(tsbYear = tsbOutlayYear)，且只抓 72 向下用途別。（核定再更細部去抓。）
        -- 參數：（ 年度 , 計畫年度 , 計畫科目 , 用途別 , 起始日期 , 結束日期 , 案件類別 , 是否有傳票號碼 , 是否包含審定資料 ）
        SELECT * FROM [dbo].[fn_GetMixDT](@tsbYear, NULL, NULL, '72', NULL, NULL, NULL, '1', @tsbIsAudit)
	) Y
    ON  X.tsbYear = Y.tsbYear 
    AND X.tsbApplyNo = Y.tsbApplyNo AND X.tsbApplySeq = Y.tsbApplySeq 
    AND X.tsbDecideNo = Y.tsbDecideNo AND X.tsbDecideSeq = Y.tsbDecideSeq
    -- ORDER BY X.tsbApplyWordNum, X.tsbDecideSeq
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------
) Z
GROUP BY tsbPayeeRoleName_UP, tsbPayeeRoleName_MY, tsbPayeeNo, 動支編號 WITH ROLLUP  
HAVING GROUPING(tsbPayeeRoleName_UP)=0
ORDER BY tsbPayeeRoleName_UP, tsbPayeeRoleName_MY, tsbPayeeNo,
	(CASE WHEN MAX(列支科目名稱) = '' THEN 'zzzzz' ELSE MAX(列支科目名稱) END), 
	(CASE WHEN MAX(組室別) = '' THEN 'zzzzzz' ELSE MAX(組室別) END),
	(CASE WHEN GROUPING(動支編號)=1 THEN ISNULL(MAX(動支編號),'zzzzzz') ELSE 動支編號 END),
	(CASE WHEN MAX(傳票日期) = '' THEN 'zzzzzz' ELSE MAX(傳票日期) END)

    --列支科目名稱, 組室別, 動支編號,傳票日期

------------------------------------------------------------

--#2017/5/9 上午 09:15:51#  http://localhost/HPAGBC/SysMenu/codActUserPower.aspx?MenuID=035
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/9 上午 09:16:02
--連線字串：Data Source=localhost;Initial Catalog=HPAGBC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(6)
Set @PK_MnuNo = '025'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--#2017/5/9 上午 09:16:04#  http://localhost/HPAGBC/UI.SystemData.Web/FrmBackUpDB.aspx?MenuID=023
--[Parameter Count:1]
--@parMenuID='023'
 Select * From SysMenuBase Where PK_MnuNo ='023' 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:16:04#  http://localhost/HPAGBC/HPAGFC/UI.SystemData.Web/FrmBackUpDB.aspx?MenuID=024
--[Parameter Count:1]
--@parMenuID='024'
 Select * From SysMenuBase Where PK_MnuNo ='024' 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:16:05#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysCode.aspx?MenuID=021
 SELECT A.sysName as SysName, A.sysOrgName as OrgName , A.sysOrgNo as OrgID, A.sysOrgMaster as OrgChief  , A.sysOrgAddr as OrgAddr, A.sysOrgTel as OrgTel, A.sysOrgID as OrgNO, A.sysDefYear as DefYear  , A.sysDefMonth as DefMonth, A.teaCode as TeamCode, A.sysDefPath as SysPath, B.teaName as TeamName , A.sysInBank as DefBank  , A.sysTaxRate as Tax, A.sysTaxBaseMoney as TaxFree   FROM basBaseData A  Left Outer Join codTeamName B On A.teaCode=B.teaCode  Where 1=1  Order By  1
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:16:05#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysCode.aspx?MenuID=021
 SELECT A.sysName as SysName, A.sysOrgName as OrgName , A.sysOrgNo as OrgID, A.sysOrgMaster as OrgChief  , A.sysOrgAddr as OrgAddr, A.sysOrgTel as OrgTel, A.sysOrgID as OrgNO, A.sysDefYear as DefYear  , A.sysDefMonth as DefMonth, A.teaCode as TeamCode, A.sysDefPath as SysPath, B.teaName as TeamName , A.sysInBank as DefBank  , A.sysTaxRate as Tax, A.sysTaxBaseMoney as TaxFree   FROM basBaseData A  Left Outer Join codTeamName B On A.teaCode=B.teaCode  Where 1=1  And sysName like '預算控制資訊系統%' Order By  1
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:16:06#  http://localhost/HPAGBC/sysMenu/iAdmin.aspx?MenuID=031
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:16:06#  http://localhost/HPAGBC/UI.SystemData.Web/FrmBaseUser.aspx?MenuID=032
 Select  A.* , W.usrName AS AgentName, T.teaName as TeamName, WD.dptName As DepName, S.payName, AG.ageAgentName + '(' + AG.ageSysName + ')' As ageAgentName 
 FROM sysBaseUser A   LEFT OUTER JOIN sysBaseUser W ON A.usrAgentUsrNo = W.PK_usrNo   LEFT OUTER JOIN basPayName S ON A.payCode = S.payCode  LEFT OUTER JOIN codTeamName T ON A.usrTeamCode = T.teaCode  LEFT OUTER JOIN codDepartName WD ON WD.dptCode = A.depCode   LEFT OUTER JOIN ebsAgent AG ON AG.ageAgentNo = A.ageAgentNo  where  1=1  Order By  1, 2 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:16:06#  http://localhost/HPAGBC/UI.SystemData.Web/FrmBaseUser.aspx?MenuID=032
 Select  A.* , W.usrName AS AgentName, T.teaName as TeamName, WD.dptName As DepName, S.payName, AG.ageAgentName + '(' + AG.ageSysName + ')' As ageAgentName 
 FROM sysBaseUser A   LEFT OUTER JOIN sysBaseUser W ON A.usrAgentUsrNo = W.PK_usrNo   LEFT OUTER JOIN basPayName S ON A.payCode = S.payCode  LEFT OUTER JOIN codTeamName T ON A.usrTeamCode = T.teaCode  LEFT OUTER JOIN codDepartName WD ON WD.dptCode = A.depCode   LEFT OUTER JOIN ebsAgent AG ON AG.ageAgentNo = A.ageAgentNo  where  1=1  and A.PK_usrNo ='1'  Order By  1, 2 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:16:07#  http://localhost/HPAGBC/sysMenu/iAdmin.aspx?MenuID=031
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:16:08#  http://localhost/HPAGBC/UI.SystemData.Web/FrmBaseUser.aspx?MenuID=032
 Select  A.* , W.usrName AS AgentName, T.teaName as TeamName, WD.dptName As DepName, S.payName, AG.ageAgentName + '(' + AG.ageSysName + ')' As ageAgentName 
 FROM sysBaseUser A   LEFT OUTER JOIN sysBaseUser W ON A.usrAgentUsrNo = W.PK_usrNo   LEFT OUTER JOIN basPayName S ON A.payCode = S.payCode  LEFT OUTER JOIN codTeamName T ON A.usrTeamCode = T.teaCode  LEFT OUTER JOIN codDepartName WD ON WD.dptCode = A.depCode   LEFT OUTER JOIN ebsAgent AG ON AG.ageAgentNo = A.ageAgentNo  where  1=1  Order By  1, 2 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:16:08#  http://localhost/HPAGBC/UI.SystemData.Web/FrmBaseUser.aspx?MenuID=032
 Select  A.* , W.usrName AS AgentName, T.teaName as TeamName, WD.dptName As DepName, S.payName, AG.ageAgentName + '(' + AG.ageSysName + ')' As ageAgentName 
 FROM sysBaseUser A   LEFT OUTER JOIN sysBaseUser W ON A.usrAgentUsrNo = W.PK_usrNo   LEFT OUTER JOIN basPayName S ON A.payCode = S.payCode  LEFT OUTER JOIN codTeamName T ON A.usrTeamCode = T.teaCode  LEFT OUTER JOIN codDepartName WD ON WD.dptCode = A.depCode   LEFT OUTER JOIN ebsAgent AG ON AG.ageAgentNo = A.ageAgentNo  where  1=1  and A.PK_usrNo ='1'  Order By  1, 2 
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:16:10#  http://localhost/HPAGBC/sysMenu/gAdmin.aspx?MenuID=0331
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:16:10#  http://localhost/HPAGBC/sysMenu/gAdmin.aspx?MenuID=0331
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='0331' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:16:12#  http://localhost/HPAGBC/sysMenu/gAdmin.aspx?MenuID=0331
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/9 上午 09:16:12#  http://localhost/HPAGBC/sysMenu/gAdmin.aspx?MenuID=0331
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='0331' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:43:35#  http://localhost/HPAGBC/sysMenu/gAdmin.aspx?MenuID=0331
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:43:35#  http://localhost/HPAGBC/sysMenu/gAdmin.aspx?MenuID=0331
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='0331' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:43:44#  http://localhost/HPAGBC/sysMenu/gAdmin.aspx?MenuID=0331
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:43:44#  http://localhost/HPAGBC/sysMenu/gAdmin.aspx?MenuID=0331
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='0331' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:43:51#  http://localhost/HPAGBC/sysMenu/gAdmin.aspx?MenuID=0331
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:43:52#  http://localhost/HPAGBC/sysMenu/gAdmin.aspx?MenuID=0331
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='0331' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:43:53#  http://localhost/HPAGBC/sysMenu/gAdmin.aspx?MenuID=0331
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:43:53#  http://localhost/HPAGBC/sysMenu/gAdmin.aspx?MenuID=0331
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='0331' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:43:58#  http://localhost/HPAGBC/Logout.aspx?MenuID=Z
UPDATE sysBaseUser SET usrLogoutDTime='2017/05/10 11:43:58'  WHERE PK_usrNo=1
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:43:59#  http://localhost/HPAGBC/Logout.aspx?MenuID=Z
INSERT logWhoRec (LogIP,LogDate,LogUser,LogMod,LogPage,LogWork,LogMemo,LogWorkUser,LogLevel,LogLink,LogSys) VALUES ('::1','2017/05/10 11:43:58','系統管理員','Logout','Logout.aspx','?MenuID=Z','','系統管理員',35,'','HPAGBC/')
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:44:03#  http://localhost/HPAGBC/Login.aspx
--[Parameter Count:2]
--@UserAlias='99999'
--@UserPwd='05072306'
SELECT * FROM sysBaseUser A WHERE usrAlias='99999' AND usrPwd='05072306' AND ISNULL(usrStateKind,'0')<>'1' ORDER BY PK_usrNo
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:44:03#  http://localhost/HPAGBC/Login.aspx
UPDATE sysBaseUser SET usrLoginDTime='2017/05/10 11:44:03' ,usrLoginIP='::1'  WHERE PK_usrNo=1
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:44:03#  http://localhost/HPAGBC/Login.aspx
INSERT logWhoRec (LogIP,LogDate,LogUser,LogMod,LogPage,LogWork,LogMemo,LogWorkUser,LogLevel,LogLink,LogSys) VALUES ('::1','2017/05/10 11:44:03','99999','Login','Login.aspx','','成功','系統管理員',35,'','HPAGBC/')
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:44:04#  http://localhost/HPAGBC/Login.aspx
Select Top 1 * From  ebsAgent 
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:44:04#  http://localhost/HPAGBC/Login.aspx
 Select sysCloseDate From basBaseData 
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:44:04#  http://localhost/HPAGBC/Login.aspx
Select dptName, dptCode  FROM codDepartName A  Where 1=1  and  dptCode = '14' Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:44:04#  http://localhost/HPAGBC/Menu.aspx
SELECT DISTINCT (SELECT TOP 1 A2.PK_MnuNo  FROM  sysUserPower C2 INNER JOIN  sysGroupData D2 ON C2.PK_grpNo = D2.PK_grpNo INNER JOIN  sysMenuBase A2 ON A2.PK_MnuNo = D2.PK_mnuNo WHERE  (C2.PK_usrNo = 1)  AND ISNULL(mnuLevel,0)> -90 AND A.PK_MnuNo LIKE A2.PK_MnuNo + '_%'  ORDER BY  A2.PK_MnuNo DESC) AS ParentPK_MnuNo, A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -90 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 上午 11:44:05#  http://localhost/HPAGBC/intro.aspx
SELECT 'Powered by Microsoft SQL Server ' + CONVERT(nvarchar,SERVERPROPERTY('ProductVersion')) + ' ' + CONVERT(nvarchar,SERVERPROPERTY('ProductLevel'))
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 上午 11:45:12
--連線字串：Data Source=localhost;Initial Catalog=HPAGBC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：7
Declare @acmYear As SmallInt
Set @acmYear = 106
Declare @acmWordNum As NVarChar(1)
Set @acmWordNum = ''
Declare @acmWorkUserNo As NVarChar(1)
Set @acmWorkUserNo = ''
Declare @actBuyKind As NVarChar(1)
Set @actBuyKind = ''
Declare @tsbSDate As NVarChar(20)
Set @tsbSDate = '2017/05/01'
Declare @tsbEDate As NVarChar(20)
Set @tsbEDate = '2017/05/31'
Declare @tsbCityName As NVarChar(1)
Set @tsbCityName = ''

--DECLARE
--	@acmYear as smallint
--	, @acmWordNum AS varchar(30) --動支編號
--	, @acmWorkUserNo AS nvarchar(30) --承辦人
--	, @tsbSDate AS datetime --起始日期
--	, @tsbEDate AS datetime --結束日期
--	, @actBuyKind AS varchar(1)
--	, @tsbCityName AS nvarchar(20)

--SET @acmYear = 0
--SET @acmWordNum = ''
--SET @acmWorkUserNo = ''
--SET @tsbEDate = '2016/1/1'
--SET @tsbEDate = '2016/5/21'
--SET @actBuyKind = ''
--SET @tsbCityName = N'台北'

--20170504 17.99 查詢條件增加 區域而因為區域在BPMDB所以加一層
SELECT * 
FROM
(
SELECT M.acmWordNum+'-'+LTRIM(ISNULL(M1.acmNo1,0))  as 動支編號 --1.查詢條件
 ,ISNULL(M1.acmFormName,M.acmFormName) as 單據種類
 ,ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) as 承辦人 --2.查詢條件
 ,ISNULL(M1.acmMarkDate,M.acmMarkDate) as 請示日期 --3.查詢條件(區間)
 ,ISNULL(R.acdNo,1) as 明細序號
 ,ISNULL(R.acdProdName,ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo))) as 品名
 ,ISNULL(R.acdMemo,'') as 用途說明
 ,ISNULL(R.acdProdQry,1) as 數量
 ,ISNULL(R.acdMoney,ISNULL(M1.acmMoney,M.acmMoney)) as 總價  
 ,REPLACE(ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo)),CHAR(13)+CHAR(10),';') as 請示事由 
 ,(CASE WHEN P.acpPayNo>0 THEN '已核銷' WHEN (CASE WHEN M1.acmNo>0 THEN ISNULL(NULLIF(M1.acmReadyFlag,'0'),M1.acmPassFlag) ELSE ISNULL(NULLIF(M.acmReadyFlag,'0'),M.acmPassFlag) END)='1' THEN '已決行' ELSE '審核中' END) 表單狀態 
 ,ISNULL(P.acpPayNo,0) as 報支次號
 ,P.acmDate as 報支日期
 ,REPLACE(ISNULL(ISNULL(NULLIF(P.acpSubMemo,''),P.acpMemo),''),CHAR(13)+CHAR(10),';') as 核銷事由
 ,ISNULL(P.acpMoney,0) as 核銷總金額
 ,ISNULL(P.acpPayName,ISNULL(M2.acmPayName,'')) as 廠商名稱 
 , CASE ISNULL(P.actBuyKind, '0')
	WHEN '0' THEN '無'
	WHEN '1' THEN '優先採購'
	WHEN '2' THEN '綠色採購'
	ELSE '' END AS 採購種類
 ,(CASE WHEN ISNULL(P.acpEtcPayment,ISNULL(M1.acmEtcPayment,M.acmEtcPayment))='1' THEN '電子支付'
   WHEN ISNULL(P.acpProdVisaKind,ISNULL(M1.acmProdVisaKind,M.acmProdVisaKind))='1' THEN '零用金'
   ELSE '一般' END) as 支付方式 --支付方式:一般、電子支付、零用金
 ,ISNULL((SELECT TOP 1 B.Office FROM BPMDB.dbo.BPMSysUsers B WHERE ISNULL(M1.acmEmpNo,M.acmEmpNo) LIKE B.Account),'台北') as 地區--取出地區Office --5.查詢條件:全部、台北、台中
FROM actMain M 
 LEFT OUTER JOIN actMain1 M1 ON M.acmYear=M1.acmYear and M.acmNo=M1.acmNo
 LEFT OUTER JOIN actMain2 M2 ON M.acmYear=M2.acmYear and M.acmNo=M2.acmNo and ISNULL(M1.acmNo1,0)=M2.acmNo1
 LEFT OUTER JOIN actDtlProd R ON M.acmYear=R.acmYear and M.acmNo=R.acmNo and R.acmNo1=ISNULL(M1.acmNo1,0) 
 LEFT OUTER JOIN actPay P ON P.acmYear=M.acmYear and P.acmNo=M.acmNo
WHERE ISNULL(M1.acmFormName,M.acmFormName) IN ('請購單','請修單')
	AND (ISNULL(@acmYear, 0) = 0 OR M.acmYear = @acmYear)
	--動支編號
	AND (ISNULL(@acmWordNum, '') = '' OR M.acmWordNum LIKE @acmWordNum + '%')
	--承辦人
	AND (ISNULL(@acmWorkUserNo, '') = '' OR ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) LIKE @acmWorkUserNo + '%')
	--日期區間
	AND	(ISNULL(@tsbSDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) >= @tsbSDate)
	AND (ISNULL(@tsbEDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) < DATEADD(day, 1, @tsbEDate)) --必須加1天
	--採購種類
	AND (ISNULL(@actBuyKind, '') = '' OR ISNULL(P.actBuyKind, '0') = @actBuyKind)
) AA
WHERE 
	(ISNULL(@tsbCityName, '') = '' OR ISNULL(AA.地區, '') = @tsbCityName)
ORDER BY 動支編號,請示日期

------------------------------------------------------------

--執行時間--  2017/5/10 上午 11:45:25
--連線字串：Data Source=localhost;Initial Catalog=HPAGBC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：7
Declare @acmYear As SmallInt
Set @acmYear = 106
Declare @acmWordNum As NVarChar(1)
Set @acmWordNum = ''
Declare @acmWorkUserNo As NVarChar(1)
Set @acmWorkUserNo = ''
Declare @actBuyKind As NVarChar(1)
Set @actBuyKind = ''
Declare @tsbSDate As NVarChar(20)
Set @tsbSDate = '2017/05/01'
Declare @tsbEDate As NVarChar(20)
Set @tsbEDate = '2017/05/31'
Declare @tsbCityName As NVarChar(4)
Set @tsbCityName = '台北'

--DECLARE
--	@acmYear as smallint
--	, @acmWordNum AS varchar(30) --動支編號
--	, @acmWorkUserNo AS nvarchar(30) --承辦人
--	, @tsbSDate AS datetime --起始日期
--	, @tsbEDate AS datetime --結束日期
--	, @actBuyKind AS varchar(1)
--	, @tsbCityName AS nvarchar(20)

--SET @acmYear = 0
--SET @acmWordNum = ''
--SET @acmWorkUserNo = ''
--SET @tsbEDate = '2016/1/1'
--SET @tsbEDate = '2016/5/21'
--SET @actBuyKind = ''
--SET @tsbCityName = N'台北'

--20170504 17.99 查詢條件增加 區域而因為區域在BPMDB所以加一層
SELECT * 
FROM
(
SELECT M.acmWordNum+'-'+LTRIM(ISNULL(M1.acmNo1,0))  as 動支編號 --1.查詢條件
 ,ISNULL(M1.acmFormName,M.acmFormName) as 單據種類
 ,ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) as 承辦人 --2.查詢條件
 ,ISNULL(M1.acmMarkDate,M.acmMarkDate) as 請示日期 --3.查詢條件(區間)
 ,ISNULL(R.acdNo,1) as 明細序號
 ,ISNULL(R.acdProdName,ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo))) as 品名
 ,ISNULL(R.acdMemo,'') as 用途說明
 ,ISNULL(R.acdProdQry,1) as 數量
 ,ISNULL(R.acdMoney,ISNULL(M1.acmMoney,M.acmMoney)) as 總價  
 ,REPLACE(ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo)),CHAR(13)+CHAR(10),';') as 請示事由 
 ,(CASE WHEN P.acpPayNo>0 THEN '已核銷' WHEN (CASE WHEN M1.acmNo>0 THEN ISNULL(NULLIF(M1.acmReadyFlag,'0'),M1.acmPassFlag) ELSE ISNULL(NULLIF(M.acmReadyFlag,'0'),M.acmPassFlag) END)='1' THEN '已決行' ELSE '審核中' END) 表單狀態 
 ,ISNULL(P.acpPayNo,0) as 報支次號
 ,P.acmDate as 報支日期
 ,REPLACE(ISNULL(ISNULL(NULLIF(P.acpSubMemo,''),P.acpMemo),''),CHAR(13)+CHAR(10),';') as 核銷事由
 ,ISNULL(P.acpMoney,0) as 核銷總金額
 ,ISNULL(P.acpPayName,ISNULL(M2.acmPayName,'')) as 廠商名稱 
 , CASE ISNULL(P.actBuyKind, '0')
	WHEN '0' THEN '無'
	WHEN '1' THEN '優先採購'
	WHEN '2' THEN '綠色採購'
	ELSE '' END AS 採購種類
 ,(CASE WHEN ISNULL(P.acpEtcPayment,ISNULL(M1.acmEtcPayment,M.acmEtcPayment))='1' THEN '電子支付'
   WHEN ISNULL(P.acpProdVisaKind,ISNULL(M1.acmProdVisaKind,M.acmProdVisaKind))='1' THEN '零用金'
   ELSE '一般' END) as 支付方式 --支付方式:一般、電子支付、零用金
 ,ISNULL((SELECT TOP 1 B.Office FROM BPMDB.dbo.BPMSysUsers B WHERE ISNULL(M1.acmEmpNo,M.acmEmpNo) LIKE B.Account),'台北') as 地區--取出地區Office --5.查詢條件:全部、台北、台中
FROM actMain M 
 LEFT OUTER JOIN actMain1 M1 ON M.acmYear=M1.acmYear and M.acmNo=M1.acmNo
 LEFT OUTER JOIN actMain2 M2 ON M.acmYear=M2.acmYear and M.acmNo=M2.acmNo and ISNULL(M1.acmNo1,0)=M2.acmNo1
 LEFT OUTER JOIN actDtlProd R ON M.acmYear=R.acmYear and M.acmNo=R.acmNo and R.acmNo1=ISNULL(M1.acmNo1,0) 
 LEFT OUTER JOIN actPay P ON P.acmYear=M.acmYear and P.acmNo=M.acmNo
WHERE ISNULL(M1.acmFormName,M.acmFormName) IN ('請購單','請修單')
	AND (ISNULL(@acmYear, 0) = 0 OR M.acmYear = @acmYear)
	--動支編號
	AND (ISNULL(@acmWordNum, '') = '' OR M.acmWordNum LIKE @acmWordNum + '%')
	--承辦人
	AND (ISNULL(@acmWorkUserNo, '') = '' OR ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) LIKE @acmWorkUserNo + '%')
	--日期區間
	AND	(ISNULL(@tsbSDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) >= @tsbSDate)
	AND (ISNULL(@tsbEDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) < DATEADD(day, 1, @tsbEDate)) --必須加1天
	--採購種類
	AND (ISNULL(@actBuyKind, '') = '' OR ISNULL(P.actBuyKind, '0') = @actBuyKind)
) AA
WHERE 
	(ISNULL(@tsbCityName, '') = '' OR ISNULL(AA.地區, '') = @tsbCityName)
ORDER BY 動支編號,請示日期

------------------------------------------------------------

--執行時間--  2017/5/10 上午 11:45:29
--連線字串：Data Source=localhost;Initial Catalog=HPAGBC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：7
Declare @acmYear As SmallInt
Set @acmYear = 106
Declare @acmWordNum As NVarChar(1)
Set @acmWordNum = ''
Declare @acmWorkUserNo As NVarChar(1)
Set @acmWorkUserNo = ''
Declare @actBuyKind As NVarChar(1)
Set @actBuyKind = ''
Declare @tsbSDate As NVarChar(20)
Set @tsbSDate = '2017/05/01'
Declare @tsbEDate As NVarChar(20)
Set @tsbEDate = '2017/05/31'
Declare @tsbCityName As NVarChar(4)
Set @tsbCityName = '台中'

--DECLARE
--	@acmYear as smallint
--	, @acmWordNum AS varchar(30) --動支編號
--	, @acmWorkUserNo AS nvarchar(30) --承辦人
--	, @tsbSDate AS datetime --起始日期
--	, @tsbEDate AS datetime --結束日期
--	, @actBuyKind AS varchar(1)
--	, @tsbCityName AS nvarchar(20)

--SET @acmYear = 0
--SET @acmWordNum = ''
--SET @acmWorkUserNo = ''
--SET @tsbEDate = '2016/1/1'
--SET @tsbEDate = '2016/5/21'
--SET @actBuyKind = ''
--SET @tsbCityName = N'台北'

--20170504 17.99 查詢條件增加 區域而因為區域在BPMDB所以加一層
SELECT * 
FROM
(
SELECT M.acmWordNum+'-'+LTRIM(ISNULL(M1.acmNo1,0))  as 動支編號 --1.查詢條件
 ,ISNULL(M1.acmFormName,M.acmFormName) as 單據種類
 ,ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) as 承辦人 --2.查詢條件
 ,ISNULL(M1.acmMarkDate,M.acmMarkDate) as 請示日期 --3.查詢條件(區間)
 ,ISNULL(R.acdNo,1) as 明細序號
 ,ISNULL(R.acdProdName,ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo))) as 品名
 ,ISNULL(R.acdMemo,'') as 用途說明
 ,ISNULL(R.acdProdQry,1) as 數量
 ,ISNULL(R.acdMoney,ISNULL(M1.acmMoney,M.acmMoney)) as 總價  
 ,REPLACE(ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo)),CHAR(13)+CHAR(10),';') as 請示事由 
 ,(CASE WHEN P.acpPayNo>0 THEN '已核銷' WHEN (CASE WHEN M1.acmNo>0 THEN ISNULL(NULLIF(M1.acmReadyFlag,'0'),M1.acmPassFlag) ELSE ISNULL(NULLIF(M.acmReadyFlag,'0'),M.acmPassFlag) END)='1' THEN '已決行' ELSE '審核中' END) 表單狀態 
 ,ISNULL(P.acpPayNo,0) as 報支次號
 ,P.acmDate as 報支日期
 ,REPLACE(ISNULL(ISNULL(NULLIF(P.acpSubMemo,''),P.acpMemo),''),CHAR(13)+CHAR(10),';') as 核銷事由
 ,ISNULL(P.acpMoney,0) as 核銷總金額
 ,ISNULL(P.acpPayName,ISNULL(M2.acmPayName,'')) as 廠商名稱 
 , CASE ISNULL(P.actBuyKind, '0')
	WHEN '0' THEN '無'
	WHEN '1' THEN '優先採購'
	WHEN '2' THEN '綠色採購'
	ELSE '' END AS 採購種類
 ,(CASE WHEN ISNULL(P.acpEtcPayment,ISNULL(M1.acmEtcPayment,M.acmEtcPayment))='1' THEN '電子支付'
   WHEN ISNULL(P.acpProdVisaKind,ISNULL(M1.acmProdVisaKind,M.acmProdVisaKind))='1' THEN '零用金'
   ELSE '一般' END) as 支付方式 --支付方式:一般、電子支付、零用金
 ,ISNULL((SELECT TOP 1 B.Office FROM BPMDB.dbo.BPMSysUsers B WHERE ISNULL(M1.acmEmpNo,M.acmEmpNo) LIKE B.Account),'台北') as 地區--取出地區Office --5.查詢條件:全部、台北、台中
FROM actMain M 
 LEFT OUTER JOIN actMain1 M1 ON M.acmYear=M1.acmYear and M.acmNo=M1.acmNo
 LEFT OUTER JOIN actMain2 M2 ON M.acmYear=M2.acmYear and M.acmNo=M2.acmNo and ISNULL(M1.acmNo1,0)=M2.acmNo1
 LEFT OUTER JOIN actDtlProd R ON M.acmYear=R.acmYear and M.acmNo=R.acmNo and R.acmNo1=ISNULL(M1.acmNo1,0) 
 LEFT OUTER JOIN actPay P ON P.acmYear=M.acmYear and P.acmNo=M.acmNo
WHERE ISNULL(M1.acmFormName,M.acmFormName) IN ('請購單','請修單')
	AND (ISNULL(@acmYear, 0) = 0 OR M.acmYear = @acmYear)
	--動支編號
	AND (ISNULL(@acmWordNum, '') = '' OR M.acmWordNum LIKE @acmWordNum + '%')
	--承辦人
	AND (ISNULL(@acmWorkUserNo, '') = '' OR ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) LIKE @acmWorkUserNo + '%')
	--日期區間
	AND	(ISNULL(@tsbSDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) >= @tsbSDate)
	AND (ISNULL(@tsbEDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) < DATEADD(day, 1, @tsbEDate)) --必須加1天
	--採購種類
	AND (ISNULL(@actBuyKind, '') = '' OR ISNULL(P.actBuyKind, '0') = @actBuyKind)
) AA
WHERE 
	(ISNULL(@tsbCityName, '') = '' OR ISNULL(AA.地區, '') = @tsbCityName)
ORDER BY 動支編號,請示日期

------------------------------------------------------------

--執行時間--  2017/5/10 上午 11:45:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：7
Declare @acmYear As SmallInt
Set @acmYear = 106
Declare @acmWordNum As NVarChar(1)
Set @acmWordNum = ''
Declare @acmWorkUserNo As NVarChar(1)
Set @acmWorkUserNo = ''
Declare @actBuyKind As NVarChar(1)
Set @actBuyKind = ''
Declare @tsbSDate As NVarChar(20)
Set @tsbSDate = '2017/05/01'
Declare @tsbEDate As NVarChar(20)
Set @tsbEDate = '2017/05/31'
Declare @tsbCityName As NVarChar(1)
Set @tsbCityName = ''

--DECLARE
--	@acmYear as smallint
--	, @acmWordNum AS varchar(30) --動支編號
--	, @acmWorkUserNo AS nvarchar(30) --承辦人
--	, @tsbSDate AS datetime --起始日期
--	, @tsbEDate AS datetime --結束日期
--	, @actBuyKind AS varchar(1)
--	, @tsbCityName AS nvarchar(20)

--SET @acmYear = 0
--SET @acmWordNum = ''
--SET @acmWorkUserNo = ''
--SET @tsbEDate = '2016/1/1'
--SET @tsbEDate = '2016/5/21'
--SET @actBuyKind = ''
--SET @tsbCityName = N'台北'

--20170504 17.99 查詢條件增加 區域而因為區域在BPMDB所以加一層
SELECT * 
FROM
(
SELECT M.acmWordNum+'-'+LTRIM(ISNULL(M1.acmNo1,0))  as 動支編號 --1.查詢條件
 ,ISNULL(M1.acmFormName,M.acmFormName) as 單據種類
 ,ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) as 承辦人 --2.查詢條件
 ,ISNULL(M1.acmMarkDate,M.acmMarkDate) as 請示日期 --3.查詢條件(區間)
 ,ISNULL(R.acdNo,1) as 明細序號
 ,ISNULL(R.acdProdName,ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo))) as 品名
 ,ISNULL(R.acdMemo,'') as 用途說明
 ,ISNULL(R.acdProdQry,1) as 數量
 ,ISNULL(R.acdMoney,ISNULL(M1.acmMoney,M.acmMoney)) as 總價  
 ,REPLACE(ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo)),CHAR(13)+CHAR(10),';') as 請示事由 
 ,(CASE WHEN P.acpPayNo>0 THEN '已核銷' WHEN (CASE WHEN M1.acmNo>0 THEN ISNULL(NULLIF(M1.acmReadyFlag,'0'),M1.acmPassFlag) ELSE ISNULL(NULLIF(M.acmReadyFlag,'0'),M.acmPassFlag) END)='1' THEN '已決行' ELSE '審核中' END) 表單狀態 
 ,ISNULL(P.acpPayNo,0) as 報支次號
 ,P.acmDate as 報支日期
 ,REPLACE(ISNULL(ISNULL(NULLIF(P.acpSubMemo,''),P.acpMemo),''),CHAR(13)+CHAR(10),';') as 核銷事由
 ,ISNULL(P.acpMoney,0) as 核銷總金額
 ,ISNULL(P.acpPayName,ISNULL(M2.acmPayName,'')) as 廠商名稱 
 , CASE ISNULL(P.actBuyKind, '0')
	WHEN '0' THEN '無'
	WHEN '1' THEN '優先採購'
	WHEN '2' THEN '綠色採購'
	ELSE '' END AS 採購種類
 ,(CASE WHEN ISNULL(P.acpEtcPayment,ISNULL(M1.acmEtcPayment,M.acmEtcPayment))='1' THEN '電子支付'
   WHEN ISNULL(P.acpProdVisaKind,ISNULL(M1.acmProdVisaKind,M.acmProdVisaKind))='1' THEN '零用金'
   ELSE '一般' END) as 支付方式 --支付方式:一般、電子支付、零用金
 ,ISNULL((SELECT TOP 1 B.Office FROM BPMDB.dbo.BPMSysUsers B WHERE ISNULL(M1.acmEmpNo,M.acmEmpNo) LIKE B.Account),'台北') as 地區--取出地區Office --5.查詢條件:全部、台北、台中
FROM actMain M 
 LEFT OUTER JOIN actMain1 M1 ON M.acmYear=M1.acmYear and M.acmNo=M1.acmNo
 LEFT OUTER JOIN actMain2 M2 ON M.acmYear=M2.acmYear and M.acmNo=M2.acmNo and ISNULL(M1.acmNo1,0)=M2.acmNo1
 LEFT OUTER JOIN actDtlProd R ON M.acmYear=R.acmYear and M.acmNo=R.acmNo and R.acmNo1=ISNULL(M1.acmNo1,0) 
 LEFT OUTER JOIN actPay P ON P.acmYear=M.acmYear and P.acmNo=M.acmNo
WHERE ISNULL(M1.acmFormName,M.acmFormName) IN ('請購單','請修單')
	AND (ISNULL(@acmYear, 0) = 0 OR M.acmYear = @acmYear)
	--動支編號
	AND (ISNULL(@acmWordNum, '') = '' OR M.acmWordNum LIKE @acmWordNum + '%')
	--承辦人
	AND (ISNULL(@acmWorkUserNo, '') = '' OR ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) LIKE @acmWorkUserNo + '%')
	--日期區間
	AND	(ISNULL(@tsbSDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) >= @tsbSDate)
	AND (ISNULL(@tsbEDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) < DATEADD(day, 1, @tsbEDate)) --必須加1天
	--採購種類
	AND (ISNULL(@actBuyKind, '') = '' OR ISNULL(P.actBuyKind, '0') = @actBuyKind)
) AA
WHERE 
	(ISNULL(@tsbCityName, '') = '' OR ISNULL(AA.地區, '') = @tsbCityName)
ORDER BY 動支編號,請示日期

------------------------------------------------------------

--執行時間--  2017/5/10 上午 11:45:47
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：7
Declare @acmYear As SmallInt
Set @acmYear = 106
Declare @acmWordNum As NVarChar(1)
Set @acmWordNum = ''
Declare @acmWorkUserNo As NVarChar(1)
Set @acmWorkUserNo = ''
Declare @actBuyKind As NVarChar(1)
Set @actBuyKind = ''
Declare @tsbSDate As NVarChar(20)
Set @tsbSDate = '2017/05/01'
Declare @tsbEDate As NVarChar(20)
Set @tsbEDate = '2017/05/31'
Declare @tsbCityName As NVarChar(4)
Set @tsbCityName = '台北'

--DECLARE
--	@acmYear as smallint
--	, @acmWordNum AS varchar(30) --動支編號
--	, @acmWorkUserNo AS nvarchar(30) --承辦人
--	, @tsbSDate AS datetime --起始日期
--	, @tsbEDate AS datetime --結束日期
--	, @actBuyKind AS varchar(1)
--	, @tsbCityName AS nvarchar(20)

--SET @acmYear = 0
--SET @acmWordNum = ''
--SET @acmWorkUserNo = ''
--SET @tsbEDate = '2016/1/1'
--SET @tsbEDate = '2016/5/21'
--SET @actBuyKind = ''
--SET @tsbCityName = N'台北'

--20170504 17.99 查詢條件增加 區域而因為區域在BPMDB所以加一層
SELECT * 
FROM
(
SELECT M.acmWordNum+'-'+LTRIM(ISNULL(M1.acmNo1,0))  as 動支編號 --1.查詢條件
 ,ISNULL(M1.acmFormName,M.acmFormName) as 單據種類
 ,ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) as 承辦人 --2.查詢條件
 ,ISNULL(M1.acmMarkDate,M.acmMarkDate) as 請示日期 --3.查詢條件(區間)
 ,ISNULL(R.acdNo,1) as 明細序號
 ,ISNULL(R.acdProdName,ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo))) as 品名
 ,ISNULL(R.acdMemo,'') as 用途說明
 ,ISNULL(R.acdProdQry,1) as 數量
 ,ISNULL(R.acdMoney,ISNULL(M1.acmMoney,M.acmMoney)) as 總價  
 ,REPLACE(ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo)),CHAR(13)+CHAR(10),';') as 請示事由 
 ,(CASE WHEN P.acpPayNo>0 THEN '已核銷' WHEN (CASE WHEN M1.acmNo>0 THEN ISNULL(NULLIF(M1.acmReadyFlag,'0'),M1.acmPassFlag) ELSE ISNULL(NULLIF(M.acmReadyFlag,'0'),M.acmPassFlag) END)='1' THEN '已決行' ELSE '審核中' END) 表單狀態 
 ,ISNULL(P.acpPayNo,0) as 報支次號
 ,P.acmDate as 報支日期
 ,REPLACE(ISNULL(ISNULL(NULLIF(P.acpSubMemo,''),P.acpMemo),''),CHAR(13)+CHAR(10),';') as 核銷事由
 ,ISNULL(P.acpMoney,0) as 核銷總金額
 ,ISNULL(P.acpPayName,ISNULL(M2.acmPayName,'')) as 廠商名稱 
 , CASE ISNULL(P.actBuyKind, '0')
	WHEN '0' THEN '無'
	WHEN '1' THEN '優先採購'
	WHEN '2' THEN '綠色採購'
	ELSE '' END AS 採購種類
 ,(CASE WHEN ISNULL(P.acpEtcPayment,ISNULL(M1.acmEtcPayment,M.acmEtcPayment))='1' THEN '電子支付'
   WHEN ISNULL(P.acpProdVisaKind,ISNULL(M1.acmProdVisaKind,M.acmProdVisaKind))='1' THEN '零用金'
   ELSE '一般' END) as 支付方式 --支付方式:一般、電子支付、零用金
 ,ISNULL((SELECT TOP 1 B.Office FROM BPMDB.dbo.BPMSysUsers B WHERE ISNULL(M1.acmEmpNo,M.acmEmpNo) LIKE B.Account),'台北') as 地區--取出地區Office --5.查詢條件:全部、台北、台中
FROM actMain M 
 LEFT OUTER JOIN actMain1 M1 ON M.acmYear=M1.acmYear and M.acmNo=M1.acmNo
 LEFT OUTER JOIN actMain2 M2 ON M.acmYear=M2.acmYear and M.acmNo=M2.acmNo and ISNULL(M1.acmNo1,0)=M2.acmNo1
 LEFT OUTER JOIN actDtlProd R ON M.acmYear=R.acmYear and M.acmNo=R.acmNo and R.acmNo1=ISNULL(M1.acmNo1,0) 
 LEFT OUTER JOIN actPay P ON P.acmYear=M.acmYear and P.acmNo=M.acmNo
WHERE ISNULL(M1.acmFormName,M.acmFormName) IN ('請購單','請修單')
	AND (ISNULL(@acmYear, 0) = 0 OR M.acmYear = @acmYear)
	--動支編號
	AND (ISNULL(@acmWordNum, '') = '' OR M.acmWordNum LIKE @acmWordNum + '%')
	--承辦人
	AND (ISNULL(@acmWorkUserNo, '') = '' OR ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) LIKE @acmWorkUserNo + '%')
	--日期區間
	AND	(ISNULL(@tsbSDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) >= @tsbSDate)
	AND (ISNULL(@tsbEDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) < DATEADD(day, 1, @tsbEDate)) --必須加1天
	--採購種類
	AND (ISNULL(@actBuyKind, '') = '' OR ISNULL(P.actBuyKind, '0') = @actBuyKind)
) AA
WHERE 
	(ISNULL(@tsbCityName, '') = '' OR ISNULL(AA.地區, '') = @tsbCityName)
ORDER BY 動支編號,請示日期

------------------------------------------------------------

--執行時間--  2017/5/10 上午 11:45:52
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：7
Declare @acmYear As SmallInt
Set @acmYear = 106
Declare @acmWordNum As NVarChar(1)
Set @acmWordNum = ''
Declare @acmWorkUserNo As NVarChar(1)
Set @acmWorkUserNo = ''
Declare @actBuyKind As NVarChar(1)
Set @actBuyKind = ''
Declare @tsbSDate As NVarChar(20)
Set @tsbSDate = '2017/05/01'
Declare @tsbEDate As NVarChar(20)
Set @tsbEDate = '2017/05/31'
Declare @tsbCityName As NVarChar(4)
Set @tsbCityName = '台中'

--DECLARE
--	@acmYear as smallint
--	, @acmWordNum AS varchar(30) --動支編號
--	, @acmWorkUserNo AS nvarchar(30) --承辦人
--	, @tsbSDate AS datetime --起始日期
--	, @tsbEDate AS datetime --結束日期
--	, @actBuyKind AS varchar(1)
--	, @tsbCityName AS nvarchar(20)

--SET @acmYear = 0
--SET @acmWordNum = ''
--SET @acmWorkUserNo = ''
--SET @tsbEDate = '2016/1/1'
--SET @tsbEDate = '2016/5/21'
--SET @actBuyKind = ''
--SET @tsbCityName = N'台北'

--20170504 17.99 查詢條件增加 區域而因為區域在BPMDB所以加一層
SELECT * 
FROM
(
SELECT M.acmWordNum+'-'+LTRIM(ISNULL(M1.acmNo1,0))  as 動支編號 --1.查詢條件
 ,ISNULL(M1.acmFormName,M.acmFormName) as 單據種類
 ,ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) as 承辦人 --2.查詢條件
 ,ISNULL(M1.acmMarkDate,M.acmMarkDate) as 請示日期 --3.查詢條件(區間)
 ,ISNULL(R.acdNo,1) as 明細序號
 ,ISNULL(R.acdProdName,ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo))) as 品名
 ,ISNULL(R.acdMemo,'') as 用途說明
 ,ISNULL(R.acdProdQry,1) as 數量
 ,ISNULL(R.acdMoney,ISNULL(M1.acmMoney,M.acmMoney)) as 總價  
 ,REPLACE(ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo)),CHAR(13)+CHAR(10),';') as 請示事由 
 ,(CASE WHEN P.acpPayNo>0 THEN '已核銷' WHEN (CASE WHEN M1.acmNo>0 THEN ISNULL(NULLIF(M1.acmReadyFlag,'0'),M1.acmPassFlag) ELSE ISNULL(NULLIF(M.acmReadyFlag,'0'),M.acmPassFlag) END)='1' THEN '已決行' ELSE '審核中' END) 表單狀態 
 ,ISNULL(P.acpPayNo,0) as 報支次號
 ,P.acmDate as 報支日期
 ,REPLACE(ISNULL(ISNULL(NULLIF(P.acpSubMemo,''),P.acpMemo),''),CHAR(13)+CHAR(10),';') as 核銷事由
 ,ISNULL(P.acpMoney,0) as 核銷總金額
 ,ISNULL(P.acpPayName,ISNULL(M2.acmPayName,'')) as 廠商名稱 
 , CASE ISNULL(P.actBuyKind, '0')
	WHEN '0' THEN '無'
	WHEN '1' THEN '優先採購'
	WHEN '2' THEN '綠色採購'
	ELSE '' END AS 採購種類
 ,(CASE WHEN ISNULL(P.acpEtcPayment,ISNULL(M1.acmEtcPayment,M.acmEtcPayment))='1' THEN '電子支付'
   WHEN ISNULL(P.acpProdVisaKind,ISNULL(M1.acmProdVisaKind,M.acmProdVisaKind))='1' THEN '零用金'
   ELSE '一般' END) as 支付方式 --支付方式:一般、電子支付、零用金
 ,ISNULL((SELECT TOP 1 B.Office FROM BPMDB.dbo.BPMSysUsers B WHERE ISNULL(M1.acmEmpNo,M.acmEmpNo) LIKE B.Account),'台北') as 地區--取出地區Office --5.查詢條件:全部、台北、台中
FROM actMain M 
 LEFT OUTER JOIN actMain1 M1 ON M.acmYear=M1.acmYear and M.acmNo=M1.acmNo
 LEFT OUTER JOIN actMain2 M2 ON M.acmYear=M2.acmYear and M.acmNo=M2.acmNo and ISNULL(M1.acmNo1,0)=M2.acmNo1
 LEFT OUTER JOIN actDtlProd R ON M.acmYear=R.acmYear and M.acmNo=R.acmNo and R.acmNo1=ISNULL(M1.acmNo1,0) 
 LEFT OUTER JOIN actPay P ON P.acmYear=M.acmYear and P.acmNo=M.acmNo
WHERE ISNULL(M1.acmFormName,M.acmFormName) IN ('請購單','請修單')
	AND (ISNULL(@acmYear, 0) = 0 OR M.acmYear = @acmYear)
	--動支編號
	AND (ISNULL(@acmWordNum, '') = '' OR M.acmWordNum LIKE @acmWordNum + '%')
	--承辦人
	AND (ISNULL(@acmWorkUserNo, '') = '' OR ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) LIKE @acmWorkUserNo + '%')
	--日期區間
	AND	(ISNULL(@tsbSDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) >= @tsbSDate)
	AND (ISNULL(@tsbEDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) < DATEADD(day, 1, @tsbEDate)) --必須加1天
	--採購種類
	AND (ISNULL(@actBuyKind, '') = '' OR ISNULL(P.actBuyKind, '0') = @actBuyKind)
) AA
WHERE 
	(ISNULL(@tsbCityName, '') = '' OR ISNULL(AA.地區, '') = @tsbCityName)
ORDER BY 動支編號,請示日期

------------------------------------------------------------

--執行時間--  2017/5/10 上午 11:45:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：7
Declare @acmYear As SmallInt
Set @acmYear = 106
Declare @acmWordNum As NVarChar(1)
Set @acmWordNum = ''
Declare @acmWorkUserNo As NVarChar(1)
Set @acmWorkUserNo = ''
Declare @actBuyKind As NVarChar(1)
Set @actBuyKind = ''
Declare @tsbSDate As NVarChar(20)
Set @tsbSDate = '2017/05/01'
Declare @tsbEDate As NVarChar(20)
Set @tsbEDate = '2017/05/31'
Declare @tsbCityName As NVarChar(1)
Set @tsbCityName = ''

--DECLARE
--	@acmYear as smallint
--	, @acmWordNum AS varchar(30) --動支編號
--	, @acmWorkUserNo AS nvarchar(30) --承辦人
--	, @tsbSDate AS datetime --起始日期
--	, @tsbEDate AS datetime --結束日期
--	, @actBuyKind AS varchar(1)
--	, @tsbCityName AS nvarchar(20)

--SET @acmYear = 0
--SET @acmWordNum = ''
--SET @acmWorkUserNo = ''
--SET @tsbEDate = '2016/1/1'
--SET @tsbEDate = '2016/5/21'
--SET @actBuyKind = ''
--SET @tsbCityName = N'台北'

--20170504 17.99 查詢條件增加 區域而因為區域在BPMDB所以加一層
SELECT * 
FROM
(
SELECT M.acmWordNum+'-'+LTRIM(ISNULL(M1.acmNo1,0))  as 動支編號 --1.查詢條件
 ,ISNULL(M1.acmFormName,M.acmFormName) as 單據種類
 ,ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) as 承辦人 --2.查詢條件
 ,ISNULL(M1.acmMarkDate,M.acmMarkDate) as 請示日期 --3.查詢條件(區間)
 ,ISNULL(R.acdNo,1) as 明細序號
 ,ISNULL(R.acdProdName,ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo))) as 品名
 ,ISNULL(R.acdMemo,'') as 用途說明
 ,ISNULL(R.acdProdQry,1) as 數量
 ,ISNULL(R.acdMoney,ISNULL(M1.acmMoney,M.acmMoney)) as 總價  
 ,REPLACE(ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo)),CHAR(13)+CHAR(10),';') as 請示事由 
 ,(CASE WHEN P.acpPayNo>0 THEN '已核銷' WHEN (CASE WHEN M1.acmNo>0 THEN ISNULL(NULLIF(M1.acmReadyFlag,'0'),M1.acmPassFlag) ELSE ISNULL(NULLIF(M.acmReadyFlag,'0'),M.acmPassFlag) END)='1' THEN '已決行' ELSE '審核中' END) 表單狀態 
 ,ISNULL(P.acpPayNo,0) as 報支次號
 ,P.acmDate as 報支日期
 ,REPLACE(ISNULL(ISNULL(NULLIF(P.acpSubMemo,''),P.acpMemo),''),CHAR(13)+CHAR(10),';') as 核銷事由
 ,ISNULL(P.acpMoney,0) as 核銷總金額
 ,ISNULL(P.acpPayName,ISNULL(M2.acmPayName,'')) as 廠商名稱 
 , CASE ISNULL(P.actBuyKind, '0')
	WHEN '0' THEN '無'
	WHEN '1' THEN '優先採購'
	WHEN '2' THEN '綠色採購'
	ELSE '' END AS 採購種類
 ,(CASE WHEN ISNULL(P.acpEtcPayment,ISNULL(M1.acmEtcPayment,M.acmEtcPayment))='1' THEN '電子支付'
   WHEN ISNULL(P.acpProdVisaKind,ISNULL(M1.acmProdVisaKind,M.acmProdVisaKind))='1' THEN '零用金'
   ELSE '一般' END) as 支付方式 --支付方式:一般、電子支付、零用金
 ,ISNULL((SELECT TOP 1 B.Office FROM BPMDB.dbo.BPMSysUsers B WHERE ISNULL(M1.acmEmpNo,M.acmEmpNo) LIKE B.Account),'台北') as 地區--取出地區Office --5.查詢條件:全部、台北、台中
FROM actMain M 
 LEFT OUTER JOIN actMain1 M1 ON M.acmYear=M1.acmYear and M.acmNo=M1.acmNo
 LEFT OUTER JOIN actMain2 M2 ON M.acmYear=M2.acmYear and M.acmNo=M2.acmNo and ISNULL(M1.acmNo1,0)=M2.acmNo1
 LEFT OUTER JOIN actDtlProd R ON M.acmYear=R.acmYear and M.acmNo=R.acmNo and R.acmNo1=ISNULL(M1.acmNo1,0) 
 LEFT OUTER JOIN actPay P ON P.acmYear=M.acmYear and P.acmNo=M.acmNo
WHERE ISNULL(M1.acmFormName,M.acmFormName) IN ('請購單','請修單')
	AND (ISNULL(@acmYear, 0) = 0 OR M.acmYear = @acmYear)
	--動支編號
	AND (ISNULL(@acmWordNum, '') = '' OR M.acmWordNum LIKE @acmWordNum + '%')
	--承辦人
	AND (ISNULL(@acmWorkUserNo, '') = '' OR ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) LIKE @acmWorkUserNo + '%')
	--日期區間
	AND	(ISNULL(@tsbSDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) >= @tsbSDate)
	AND (ISNULL(@tsbEDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) < DATEADD(day, 1, @tsbEDate)) --必須加1天
	--採購種類
	AND (ISNULL(@actBuyKind, '') = '' OR ISNULL(P.actBuyKind, '0') = @actBuyKind)
) AA
WHERE 
	(ISNULL(@tsbCityName, '') = '' OR ISNULL(AA.地區, '') = @tsbCityName)
ORDER BY 動支編號,請示日期

------------------------------------------------------------

--執行時間--  2017/5/10 上午 11:45:59
--連線字串：Data Source=localhost;Initial Catalog=HPAGBC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：7
Declare @acmYear As SmallInt
Set @acmYear = 106
Declare @acmWordNum As NVarChar(1)
Set @acmWordNum = ''
Declare @acmWorkUserNo As NVarChar(1)
Set @acmWorkUserNo = ''
Declare @actBuyKind As NVarChar(1)
Set @actBuyKind = ''
Declare @tsbSDate As NVarChar(20)
Set @tsbSDate = '2017/05/01'
Declare @tsbEDate As NVarChar(20)
Set @tsbEDate = '2017/05/31'
Declare @tsbCityName As NVarChar(1)
Set @tsbCityName = ''

--DECLARE
--	@acmYear as smallint
--	, @acmWordNum AS varchar(30) --動支編號
--	, @acmWorkUserNo AS nvarchar(30) --承辦人
--	, @tsbSDate AS datetime --起始日期
--	, @tsbEDate AS datetime --結束日期
--	, @actBuyKind AS varchar(1)
--	, @tsbCityName AS nvarchar(20)

--SET @acmYear = 0
--SET @acmWordNum = ''
--SET @acmWorkUserNo = ''
--SET @tsbEDate = '2016/1/1'
--SET @tsbEDate = '2016/5/21'
--SET @actBuyKind = ''
--SET @tsbCityName = N'台北'

--20170504 17.99 查詢條件增加 區域而因為區域在BPMDB所以加一層
SELECT * 
FROM
(
SELECT M.acmWordNum+'-'+LTRIM(ISNULL(M1.acmNo1,0))  as 動支編號 --1.查詢條件
 ,ISNULL(M1.acmFormName,M.acmFormName) as 單據種類
 ,ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) as 承辦人 --2.查詢條件
 ,ISNULL(M1.acmMarkDate,M.acmMarkDate) as 請示日期 --3.查詢條件(區間)
 ,ISNULL(R.acdNo,1) as 明細序號
 ,ISNULL(R.acdProdName,ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo))) as 品名
 ,ISNULL(R.acdMemo,'') as 用途說明
 ,ISNULL(R.acdProdQry,1) as 數量
 ,ISNULL(R.acdMoney,ISNULL(M1.acmMoney,M.acmMoney)) as 總價  
 ,REPLACE(ISNULL(ISNULL(NULLIF(M1.acmSubMemo,''),M1.acmMemo),ISNULL(NULLIF(M.acmSubMemo,''),M.acmMemo)),CHAR(13)+CHAR(10),';') as 請示事由 
 ,(CASE WHEN P.acpPayNo>0 THEN '已核銷' WHEN (CASE WHEN M1.acmNo>0 THEN ISNULL(NULLIF(M1.acmReadyFlag,'0'),M1.acmPassFlag) ELSE ISNULL(NULLIF(M.acmReadyFlag,'0'),M.acmPassFlag) END)='1' THEN '已決行' ELSE '審核中' END) 表單狀態 
 ,ISNULL(P.acpPayNo,0) as 報支次號
 ,P.acmDate as 報支日期
 ,REPLACE(ISNULL(ISNULL(NULLIF(P.acpSubMemo,''),P.acpMemo),''),CHAR(13)+CHAR(10),';') as 核銷事由
 ,ISNULL(P.acpMoney,0) as 核銷總金額
 ,ISNULL(P.acpPayName,ISNULL(M2.acmPayName,'')) as 廠商名稱 
 , CASE ISNULL(P.actBuyKind, '0')
	WHEN '0' THEN '無'
	WHEN '1' THEN '優先採購'
	WHEN '2' THEN '綠色採購'
	ELSE '' END AS 採購種類
 ,(CASE WHEN ISNULL(P.acpEtcPayment,ISNULL(M1.acmEtcPayment,M.acmEtcPayment))='1' THEN '電子支付'
   WHEN ISNULL(P.acpProdVisaKind,ISNULL(M1.acmProdVisaKind,M.acmProdVisaKind))='1' THEN '零用金'
   ELSE '一般' END) as 支付方式 --支付方式:一般、電子支付、零用金
 ,ISNULL((SELECT TOP 1 B.Office FROM BPMDB.dbo.BPMSysUsers B WHERE ISNULL(M1.acmEmpNo,M.acmEmpNo) LIKE B.Account),'台北') as 地區--取出地區Office --5.查詢條件:全部、台北、台中
FROM actMain M 
 LEFT OUTER JOIN actMain1 M1 ON M.acmYear=M1.acmYear and M.acmNo=M1.acmNo
 LEFT OUTER JOIN actMain2 M2 ON M.acmYear=M2.acmYear and M.acmNo=M2.acmNo and ISNULL(M1.acmNo1,0)=M2.acmNo1
 LEFT OUTER JOIN actDtlProd R ON M.acmYear=R.acmYear and M.acmNo=R.acmNo and R.acmNo1=ISNULL(M1.acmNo1,0) 
 LEFT OUTER JOIN actPay P ON P.acmYear=M.acmYear and P.acmNo=M.acmNo
WHERE ISNULL(M1.acmFormName,M.acmFormName) IN ('請購單','請修單')
	AND (ISNULL(@acmYear, 0) = 0 OR M.acmYear = @acmYear)
	--動支編號
	AND (ISNULL(@acmWordNum, '') = '' OR M.acmWordNum LIKE @acmWordNum + '%')
	--承辦人
	AND (ISNULL(@acmWorkUserNo, '') = '' OR ISNULL(M1.acmWorkUserNo,M.acmWorkUserNo) LIKE @acmWorkUserNo + '%')
	--日期區間
	AND	(ISNULL(@tsbSDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) >= @tsbSDate)
	AND (ISNULL(@tsbEDate, '') = '' OR ISNULL(M1.acmMarkDate,M.acmMarkDate) < DATEADD(day, 1, @tsbEDate)) --必須加1天
	--採購種類
	AND (ISNULL(@actBuyKind, '') = '' OR ISNULL(P.actBuyKind, '0') = @actBuyKind)
) AA
WHERE 
	(ISNULL(@tsbCityName, '') = '' OR ISNULL(AA.地區, '') = @tsbCityName)
ORDER BY 動支編號,請示日期

------------------------------------------------------------

--#2017/5/10 下午 02:05:31#  http://localhost/HPAGBC/Menu.aspx
SELECT DISTINCT (SELECT TOP 1 A2.PK_MnuNo  FROM  sysUserPower C2 INNER JOIN  sysGroupData D2 ON C2.PK_grpNo = D2.PK_grpNo INNER JOIN  sysMenuBase A2 ON A2.PK_MnuNo = D2.PK_mnuNo WHERE  (C2.PK_usrNo = 1)  AND ISNULL(mnuLevel,0)> -90 AND A.PK_MnuNo LIKE A2.PK_MnuNo + '_%'  ORDER BY  A2.PK_MnuNo DESC) AS ParentPK_MnuNo, A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -90 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 02:05:32#  http://localhost/HPAGBC/intro.aspx
SELECT 'Powered by Microsoft SQL Server ' + CONVERT(nvarchar,SERVERPROPERTY('ProductVersion')) + ' ' + CONVERT(nvarchar,SERVERPROPERTY('ProductLevel'))
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:06:05#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:06:05#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:06:15
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/10 15:06:16.618 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:06:17.249 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:06:17.273 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:06:17.276 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:06:17.400 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%106%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:06:26#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:06:26#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:06:26
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/10 15:06:26.405 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%106%' 
AND ( A.tsbApplyWordNum LIKE '%10500464%' 
OR A.tsbLastApplyWordNum LIKE '%10500464%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:06:29#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%e4%bd%9c%e6%a5%ad%e5%b9%b4%e6%9c%88%e8%a8%ad%e5%ae%9a%7d
 Select Top 1 PK_MnuNo, mnuUrl From sysMenuBase Where mnuAlias Like '%{作業年月設定}%'
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:06:29#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%e4%bd%9c%e6%a5%ad%e5%b9%b4%e6%9c%88%e8%a8%ad%e5%ae%9a%7d
--[Parameter Count:1]
--@parMenuID='011'
 Select * From SysMenuBase Where PK_MnuNo ='011' 
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:06:29#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%e4%bd%9c%e6%a5%ad%e5%b9%b4%e6%9c%88%e8%a8%ad%e5%ae%9a%7d
 Select Distinct acmYear From actMain Where acmYear >0  Order By acmYear 
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:06:29#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%e4%bd%9c%e6%a5%ad%e5%b9%b4%e6%9c%88%e8%a8%ad%e5%ae%9a%7d
 Select  A.dptCode, A.dptName, A.dptLevel, A.dptBgtFlag, A.dptWorkFlag, A.depCtrlAllFlag, A.dptTeamFlag, A.teaCode, A.dptAliasNo, A.dptAliasName, A.dptCreateDate, A.dptStopFlag, A.dptStopDate  FROM codDepartName A  Where 1=1  and  dptCode = '14' AND (ISNULL( A.dptCreateDate,'') <='2017/05/31' AND ( ISNULL(A.dptStopFlag,'') <> '1' OR A.dptStopDate > '2017/05/31'))  Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:06:30#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%E4%BD%9C%E6%A5%AD%E5%B9%B4%E6%9C%88%E8%A8%AD%E5%AE%9A%7d
 Select Top 1 PK_MnuNo, mnuUrl From sysMenuBase Where mnuAlias Like '%{作業年月設定}%'
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:06:30#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%E4%BD%9C%E6%A5%AD%E5%B9%B4%E6%9C%88%E8%A8%AD%E5%AE%9A%7d
--[Parameter Count:1]
--@parMenuID='011'
 Select * From SysMenuBase Where PK_MnuNo ='011' 
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:06:32#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%E4%BD%9C%E6%A5%AD%E5%B9%B4%E6%9C%88%E8%A8%AD%E5%AE%9A%7d
 Select Top 1 PK_MnuNo, mnuUrl From sysMenuBase Where mnuAlias Like '%{作業年月設定}%'
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:06:32#  http://localhost/HPAGBC/UI.SystemData.Web/FrmSysEnv.aspx?MenuAlias=%7b%E4%BD%9C%E6%A5%AD%E5%B9%B4%E6%9C%88%E8%A8%AD%E5%AE%9A%7d
--[Parameter Count:1]
--@parMenuID='011'
 Select * From SysMenuBase Where PK_MnuNo ='011' 
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:06:33#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:06:33#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:06:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/10 15:06:33.728 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:06:33.763 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:06:33.766 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:06:33.768 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:06:33.791 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:07:16#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:07:16#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:07:16
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/10 15:07:16.327 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10500464%' 
OR A.tsbLastApplyWordNum LIKE '%10500464%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:07:19#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%22976%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/10 15:07:19.568 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/10 下午 03:07:20
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 976

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/10 下午 03:07:20
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/10 下午 03:07:20
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 976

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/10 15:07:20.683 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:07:20.694 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:07:20.697 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:07:20.747 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:07:20.756 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:07:20.912 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:07:40#  http://localhost/HPAGBC/HPAGFC/PrePay.Web/FrmPrePay_tsbPrePay/Default.aspx?MenuID=B17631
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:07:40#  http://localhost/HPAGBC/HPAGFC/PrePay.Web/FrmPrePay_tsbPrePay/Default.aspx?MenuID=B17631
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17631' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:07:40
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17631'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--#2017/5/10 下午 03:07:40#  http://localhost/HPAGBC/HPAGFC/PrePay.Web/FrmPrePay_tsbPrePay/Default.aspx?MenuID=B17631
--[Parameter Count:1]
--@parMenuID='B17631'
 Select * From SysMenuBase Where PK_MnuNo ='B17631' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/10 15:07:40.479 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:07:40.488 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:07:40.490 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:07:40.491 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:07:40.519 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在 PrePay.Repository 的 SelectAnySQL() 內 使用DTO 為 PrePay.Domain 內  tsbPrePayDTO.cs
SELECT

A.tsbApplyWordNum     as      AtsbApplyWordNum,
A.tsbPlanCode         as      AtsbPlanCode,
A.tsbTrustSubsidyName   as    AtsbTrustSubsidyName,
A.tsbLastApplyWordNum as AtsbLastApplyWordNum,
A.tsbBgtYear  as  AtsbBgtYear,
--A.tsbKindID    as    AtsbKindID ,
A.tsbKindNum as AtsbKindNum,

---
B.tsbYear            as      BtsbYear      ,
B.tsbApplyNo         as      BtsbApplyNo      ,
B.tsbDecideNo        as      BtsbDecideNo  ,
B.tsbDecideDate      as      BtsbDecideDate   ,
--B.tsbPayeeKind       as      BtsbPayeeKind    ,
B.tsbMarkUnitNo      as      BtsbMarkUnitNo    ,
B.tsbMarkUserNo      as      BtsbMarkUserNo    ,
B.tsbWorkUnitNo      as      BtsbWorkUnitNo   ,
B.tsbWorkUserNo      as      BtsbWorkUserNo   ,
B.tsbMoney           as      BtsbMoney ,
B.tsbMemo            as      BtsbMemo ,
B.tsbSubMemo         as      BtsbSubMemo   ,
B.tsbCreateDTime     as      BtsbCreateDTime   ,
B.tsbCreateUser      as      BtsbCreateUser   ,
B.tsbModifyDTime     as      BtsbModifyDTime   ,
B.tsbModifyUser      as      BtsbModifyUser   ,
B.tsbPassFlag        as      BtsbPassFlag ,
B.tsbPassDTime       as      BtsbPassDTime   ,
B.tsbPassUser        as      BtsbPassUser  ,
B.tsbDecideFlag      as      BtsbDecideFlag , 

----
----
C.tsbYear            as      CtsbYear,
C.tsbApplyNo         as      CtsbApplyNo ,
C.tsbDecideNo        as      CtsbDecideNo ,
C.tsbPrePayYear      as      CtsbPrePayYear   ,
C.tsbPrePayNo        as      CtsbPrePayNo ,
C.tsbMarkDate        as      CtsbMarkDate ,
C.tsbMarkUnitNo      as      CtsbMarkUnitNo ,
C.tsbMarkUserNo      as      CtsbMarkUserNo ,
C.tsbWorkUnitNo      as      CtsbWorkUnitNo ,
C.tsbWorkUserNo      as      CtsbWorkUserNo,
C.tsbMoney           as      CtsbMoney,
C.tsbMemo            as      CtsbMemo,
C.tsbSubMemo         as      CtsbSubMemo,
C.tsbCreateDTime     as      CtsbCreateDTime   ,
C.tsbCreateUser      as      CtsbCreateUser  ,
C.tsbModifyDTime     as      CtsbModifyDTime ,
C.tsbModifyUser      as      CtsbModifyUser ,
C.tsbPassFlag        as      CtsbPassFlag  ,
C.tsbPassDTime       as      CtsbPassDTime  ,
C.tsbPassUser        as      CtsbPassUser,  

C.tsbProdVisaKind    as      CtsbProdVisaKind,
C.isEtcPayment       as      CisEtcPayment,
C.tsbGroupNo         as      CtsbGroupNo,
C.tsbEtcPayWordNum   as      CtsbEtcPayWordNum



FROM  tsbApply  AS A           
Inner  JOIN  dbo.tsbDecide as B
                    ON A.tsbYear = B.tsbYear 
                   AND A.tsbApplyNo = B.tsbApplyNo 

LEFT JOIN   tsbPrePay as C
                
             
                   ON B.tsbYear = C.tsbYear 
                  AND B.tsbApplyNo = C.tsbApplyNo 
                AND B.tsbDecideNo = C.tsbDecideNo
      
WHERE
A.tsbPassFlag = '1'  
AND A.tsbKindNum='Case' 
AND   B.tsbPassFlag='1'



    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.BtsbYear = '105' 

 ORDER BY AtsbApplyWordNum DESC , CtsbPrePayNo DESC  

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:07:54#  http://localhost/HPAGBC/HPAGFC/PrePay.Web/FrmPrePay_tsbPrePay/Default.aspx?MenuID=B17631
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:07:54#  http://localhost/HPAGBC/HPAGFC/PrePay.Web/FrmPrePay_tsbPrePay/Default.aspx?MenuID=B17631
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17631' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:07:54
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17631'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/10 15:07:54.726 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在 PrePay.Repository 的 SelectAnySQL() 內 使用DTO 為 PrePay.Domain 內  tsbPrePayDTO.cs
SELECT

A.tsbApplyWordNum     as      AtsbApplyWordNum,
A.tsbPlanCode         as      AtsbPlanCode,
A.tsbTrustSubsidyName   as    AtsbTrustSubsidyName,
A.tsbLastApplyWordNum as AtsbLastApplyWordNum,
A.tsbBgtYear  as  AtsbBgtYear,
--A.tsbKindID    as    AtsbKindID ,
A.tsbKindNum as AtsbKindNum,

---
B.tsbYear            as      BtsbYear      ,
B.tsbApplyNo         as      BtsbApplyNo      ,
B.tsbDecideNo        as      BtsbDecideNo  ,
B.tsbDecideDate      as      BtsbDecideDate   ,
--B.tsbPayeeKind       as      BtsbPayeeKind    ,
B.tsbMarkUnitNo      as      BtsbMarkUnitNo    ,
B.tsbMarkUserNo      as      BtsbMarkUserNo    ,
B.tsbWorkUnitNo      as      BtsbWorkUnitNo   ,
B.tsbWorkUserNo      as      BtsbWorkUserNo   ,
B.tsbMoney           as      BtsbMoney ,
B.tsbMemo            as      BtsbMemo ,
B.tsbSubMemo         as      BtsbSubMemo   ,
B.tsbCreateDTime     as      BtsbCreateDTime   ,
B.tsbCreateUser      as      BtsbCreateUser   ,
B.tsbModifyDTime     as      BtsbModifyDTime   ,
B.tsbModifyUser      as      BtsbModifyUser   ,
B.tsbPassFlag        as      BtsbPassFlag ,
B.tsbPassDTime       as      BtsbPassDTime   ,
B.tsbPassUser        as      BtsbPassUser  ,
B.tsbDecideFlag      as      BtsbDecideFlag , 

----
----
C.tsbYear            as      CtsbYear,
C.tsbApplyNo         as      CtsbApplyNo ,
C.tsbDecideNo        as      CtsbDecideNo ,
C.tsbPrePayYear      as      CtsbPrePayYear   ,
C.tsbPrePayNo        as      CtsbPrePayNo ,
C.tsbMarkDate        as      CtsbMarkDate ,
C.tsbMarkUnitNo      as      CtsbMarkUnitNo ,
C.tsbMarkUserNo      as      CtsbMarkUserNo ,
C.tsbWorkUnitNo      as      CtsbWorkUnitNo ,
C.tsbWorkUserNo      as      CtsbWorkUserNo,
C.tsbMoney           as      CtsbMoney,
C.tsbMemo            as      CtsbMemo,
C.tsbSubMemo         as      CtsbSubMemo,
C.tsbCreateDTime     as      CtsbCreateDTime   ,
C.tsbCreateUser      as      CtsbCreateUser  ,
C.tsbModifyDTime     as      CtsbModifyDTime ,
C.tsbModifyUser      as      CtsbModifyUser ,
C.tsbPassFlag        as      CtsbPassFlag  ,
C.tsbPassDTime       as      CtsbPassDTime  ,
C.tsbPassUser        as      CtsbPassUser,  

C.tsbProdVisaKind    as      CtsbProdVisaKind,
C.isEtcPayment       as      CisEtcPayment,
C.tsbGroupNo         as      CtsbGroupNo,
C.tsbEtcPayWordNum   as      CtsbEtcPayWordNum



FROM  tsbApply  AS A           
Inner  JOIN  dbo.tsbDecide as B
                    ON A.tsbYear = B.tsbYear 
                   AND A.tsbApplyNo = B.tsbApplyNo 

LEFT JOIN   tsbPrePay as C
                
             
                   ON B.tsbYear = C.tsbYear 
                  AND B.tsbApplyNo = C.tsbApplyNo 
                AND B.tsbDecideNo = C.tsbDecideNo
      
WHERE
A.tsbPassFlag = '1'  
AND A.tsbKindNum='Case' 
AND   B.tsbPassFlag='1'



    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.BtsbYear = '105' 
AND ( A.AtsbApplyWordNum LIKE '%10500464%' 
OR A.AtsbLastApplyWordNum LIKE '%10500464%' )

 ORDER BY AtsbApplyWordNum DESC , CtsbPrePayNo DESC  

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:25:36#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:25:36#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:25:36
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/10 15:25:36.590 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:25:36.600 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:25:36.600 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:25:36.600 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:25:36.614 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:25:39#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:25:39#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:25:39
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/10 15:25:39.326 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10504097%' 
OR A.tsbLastApplyWordNum LIKE '%10504097%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:26:33#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%225601%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/10 15:26:33.268 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/10 下午 03:26:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/10 下午 03:26:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/10 下午 03:26:33
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/10 15:26:33.342 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:33.352 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:33.352 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:33.352 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:33.352 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:33.382 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:26:37#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&WIN=0
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:26:38#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621&WIN=0
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:26:38
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/10 15:26:38.014 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:38.034 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:38.034 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:38.044 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:38.054 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 
AND ( A.tsbApplyWordNum LIKE '%10504097%' 
OR A.tsbLastApplyWordNum LIKE '%10504097%' )

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:26:44#  http://localhost/HPAGBC/HPAGFC/PrePay.Web/FrmPrePay_tsbPrePay/Default.aspx?MenuID=B17631
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:26:44#  http://localhost/HPAGBC/HPAGFC/PrePay.Web/FrmPrePay_tsbPrePay/Default.aspx?MenuID=B17631
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17631' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:26:44
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17631'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--#2017/5/10 下午 03:26:44#  http://localhost/HPAGBC/HPAGFC/PrePay.Web/FrmPrePay_tsbPrePay/Default.aspx?MenuID=B17631
--[Parameter Count:1]
--@parMenuID='B17631'
 Select * From SysMenuBase Where PK_MnuNo ='B17631' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/10 15:26:44.554 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:44.564 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:44.564 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:44.574 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:44.587 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在 PrePay.Repository 的 SelectAnySQL() 內 使用DTO 為 PrePay.Domain 內  tsbPrePayDTO.cs
SELECT

A.tsbApplyWordNum     as      AtsbApplyWordNum,
A.tsbPlanCode         as      AtsbPlanCode,
A.tsbTrustSubsidyName   as    AtsbTrustSubsidyName,
A.tsbLastApplyWordNum as AtsbLastApplyWordNum,
A.tsbBgtYear  as  AtsbBgtYear,
--A.tsbKindID    as    AtsbKindID ,
A.tsbKindNum as AtsbKindNum,

---
B.tsbYear            as      BtsbYear      ,
B.tsbApplyNo         as      BtsbApplyNo      ,
B.tsbDecideNo        as      BtsbDecideNo  ,
B.tsbDecideDate      as      BtsbDecideDate   ,
--B.tsbPayeeKind       as      BtsbPayeeKind    ,
B.tsbMarkUnitNo      as      BtsbMarkUnitNo    ,
B.tsbMarkUserNo      as      BtsbMarkUserNo    ,
B.tsbWorkUnitNo      as      BtsbWorkUnitNo   ,
B.tsbWorkUserNo      as      BtsbWorkUserNo   ,
B.tsbMoney           as      BtsbMoney ,
B.tsbMemo            as      BtsbMemo ,
B.tsbSubMemo         as      BtsbSubMemo   ,
B.tsbCreateDTime     as      BtsbCreateDTime   ,
B.tsbCreateUser      as      BtsbCreateUser   ,
B.tsbModifyDTime     as      BtsbModifyDTime   ,
B.tsbModifyUser      as      BtsbModifyUser   ,
B.tsbPassFlag        as      BtsbPassFlag ,
B.tsbPassDTime       as      BtsbPassDTime   ,
B.tsbPassUser        as      BtsbPassUser  ,
B.tsbDecideFlag      as      BtsbDecideFlag , 

----
----
C.tsbYear            as      CtsbYear,
C.tsbApplyNo         as      CtsbApplyNo ,
C.tsbDecideNo        as      CtsbDecideNo ,
C.tsbPrePayYear      as      CtsbPrePayYear   ,
C.tsbPrePayNo        as      CtsbPrePayNo ,
C.tsbMarkDate        as      CtsbMarkDate ,
C.tsbMarkUnitNo      as      CtsbMarkUnitNo ,
C.tsbMarkUserNo      as      CtsbMarkUserNo ,
C.tsbWorkUnitNo      as      CtsbWorkUnitNo ,
C.tsbWorkUserNo      as      CtsbWorkUserNo,
C.tsbMoney           as      CtsbMoney,
C.tsbMemo            as      CtsbMemo,
C.tsbSubMemo         as      CtsbSubMemo,
C.tsbCreateDTime     as      CtsbCreateDTime   ,
C.tsbCreateUser      as      CtsbCreateUser  ,
C.tsbModifyDTime     as      CtsbModifyDTime ,
C.tsbModifyUser      as      CtsbModifyUser ,
C.tsbPassFlag        as      CtsbPassFlag  ,
C.tsbPassDTime       as      CtsbPassDTime  ,
C.tsbPassUser        as      CtsbPassUser,  

C.tsbProdVisaKind    as      CtsbProdVisaKind,
C.isEtcPayment       as      CisEtcPayment,
C.tsbGroupNo         as      CtsbGroupNo,
C.tsbEtcPayWordNum   as      CtsbEtcPayWordNum



FROM  tsbApply  AS A           
Inner  JOIN  dbo.tsbDecide as B
                    ON A.tsbYear = B.tsbYear 
                   AND A.tsbApplyNo = B.tsbApplyNo 

LEFT JOIN   tsbPrePay as C
                
             
                   ON B.tsbYear = C.tsbYear 
                  AND B.tsbApplyNo = C.tsbApplyNo 
                AND B.tsbDecideNo = C.tsbDecideNo
      
WHERE
A.tsbPassFlag = '1'  
AND A.tsbKindNum='Case' 
AND   B.tsbPassFlag='1'



    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.BtsbYear = '105' 

 ORDER BY AtsbApplyWordNum DESC , CtsbPrePayNo DESC  

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:26:47#  http://localhost/HPAGBC/HPAGFC/PrePay.Web/FrmPrePay_tsbPrePay/Default.aspx?MenuID=B17631
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:26:47#  http://localhost/HPAGBC/HPAGFC/PrePay.Web/FrmPrePay_tsbPrePay/Default.aspx?MenuID=B17631
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17631' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:26:47
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17631'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/10 15:26:47.966 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在 PrePay.Repository 的 SelectAnySQL() 內 使用DTO 為 PrePay.Domain 內  tsbPrePayDTO.cs
SELECT

A.tsbApplyWordNum     as      AtsbApplyWordNum,
A.tsbPlanCode         as      AtsbPlanCode,
A.tsbTrustSubsidyName   as    AtsbTrustSubsidyName,
A.tsbLastApplyWordNum as AtsbLastApplyWordNum,
A.tsbBgtYear  as  AtsbBgtYear,
--A.tsbKindID    as    AtsbKindID ,
A.tsbKindNum as AtsbKindNum,

---
B.tsbYear            as      BtsbYear      ,
B.tsbApplyNo         as      BtsbApplyNo      ,
B.tsbDecideNo        as      BtsbDecideNo  ,
B.tsbDecideDate      as      BtsbDecideDate   ,
--B.tsbPayeeKind       as      BtsbPayeeKind    ,
B.tsbMarkUnitNo      as      BtsbMarkUnitNo    ,
B.tsbMarkUserNo      as      BtsbMarkUserNo    ,
B.tsbWorkUnitNo      as      BtsbWorkUnitNo   ,
B.tsbWorkUserNo      as      BtsbWorkUserNo   ,
B.tsbMoney           as      BtsbMoney ,
B.tsbMemo            as      BtsbMemo ,
B.tsbSubMemo         as      BtsbSubMemo   ,
B.tsbCreateDTime     as      BtsbCreateDTime   ,
B.tsbCreateUser      as      BtsbCreateUser   ,
B.tsbModifyDTime     as      BtsbModifyDTime   ,
B.tsbModifyUser      as      BtsbModifyUser   ,
B.tsbPassFlag        as      BtsbPassFlag ,
B.tsbPassDTime       as      BtsbPassDTime   ,
B.tsbPassUser        as      BtsbPassUser  ,
B.tsbDecideFlag      as      BtsbDecideFlag , 

----
----
C.tsbYear            as      CtsbYear,
C.tsbApplyNo         as      CtsbApplyNo ,
C.tsbDecideNo        as      CtsbDecideNo ,
C.tsbPrePayYear      as      CtsbPrePayYear   ,
C.tsbPrePayNo        as      CtsbPrePayNo ,
C.tsbMarkDate        as      CtsbMarkDate ,
C.tsbMarkUnitNo      as      CtsbMarkUnitNo ,
C.tsbMarkUserNo      as      CtsbMarkUserNo ,
C.tsbWorkUnitNo      as      CtsbWorkUnitNo ,
C.tsbWorkUserNo      as      CtsbWorkUserNo,
C.tsbMoney           as      CtsbMoney,
C.tsbMemo            as      CtsbMemo,
C.tsbSubMemo         as      CtsbSubMemo,
C.tsbCreateDTime     as      CtsbCreateDTime   ,
C.tsbCreateUser      as      CtsbCreateUser  ,
C.tsbModifyDTime     as      CtsbModifyDTime ,
C.tsbModifyUser      as      CtsbModifyUser ,
C.tsbPassFlag        as      CtsbPassFlag  ,
C.tsbPassDTime       as      CtsbPassDTime  ,
C.tsbPassUser        as      CtsbPassUser,  

C.tsbProdVisaKind    as      CtsbProdVisaKind,
C.isEtcPayment       as      CisEtcPayment,
C.tsbGroupNo         as      CtsbGroupNo,
C.tsbEtcPayWordNum   as      CtsbEtcPayWordNum



FROM  tsbApply  AS A           
Inner  JOIN  dbo.tsbDecide as B
                    ON A.tsbYear = B.tsbYear 
                   AND A.tsbApplyNo = B.tsbApplyNo 

LEFT JOIN   tsbPrePay as C
                
             
                   ON B.tsbYear = C.tsbYear 
                  AND B.tsbApplyNo = C.tsbApplyNo 
                AND B.tsbDecideNo = C.tsbDecideNo
      
WHERE
A.tsbPassFlag = '1'  
AND A.tsbKindNum='Case' 
AND   B.tsbPassFlag='1'



    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.BtsbYear = '105' 
AND ( A.AtsbApplyWordNum LIKE '%10504097%' 
OR A.AtsbLastApplyWordNum LIKE '%10504097%' )

 ORDER BY AtsbApplyWordNum DESC , CtsbPrePayNo DESC  

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:26:51#  http://localhost/HPAGBC/HPAGFC/PrePay.Web/FrmPrePay_tsbPrePay/Modify.aspx?menuID=B17631&formStatus=View&Keys=%7B%22BtsbYear%22%3A%22105%22%2C%22BtsbApplyNo%22%3A%225601%22%2C%22BtsbDecideNo%22%3A%221%22%2C%22CtsbPrePayNo%22%3A%221%22%2C%22CtsbPrePayYear%22%3A%22105%22%7D
--[Parameter Count:1]
--@parMenuID='B17631'
 Select * From SysMenuBase Where PK_MnuNo ='B17631' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/10 15:26:51.790 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/10 下午 03:26:51
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：4
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPrePayNo As Int
Set @tsbPrePayNo = 1

--//取預撥明細表(modify頁)
--寫在PrePay.DAT 內 PrePay01.cs getData_PrePayModify02DTO() 內 
-- DTO 為 PrePay.Domain 內 PrePayModify02DTO.cs

SELECT 
A.tsbYear            as      AtsbYear,
A.tsbApplyNo         as      AtsbApplyNo ,
A.tsbDecideNo        as      AtsbDecideNo ,
A.tsbPrePayYear      as      AtsbPrePayYear   ,
A.tsbPrePayNo        as      AtsbPrePayNo ,
A.tsbMarkDate        as      AtsbMarkDate ,
A.tsbMarkUnitNo      as      AtsbMarkUnitNo ,
A.tsbMarkUserNo      as      AtsbMarkUserNo ,
A.tsbWorkUnitNo      as      AtsbWorkUnitNo ,
A.tsbWorkUserNo      as      AtsbWorkUserNo,
A.tsbMoney           as      AtsbMoney,
A.tsbMemo            as      AtsbMemo,
A.tsbSubMemo         as      AtsbSubMemo,
A.tsbCreateDTime     as      AtsbCreateDTime   ,
A.tsbCreateUser      as      AtsbCreateUser  ,
A.tsbModifyDTime     as      AtsbModifyDTime ,
A.tsbModifyUser      as      AtsbModifyUser ,
A.tsbPassFlag        as      AtsbPassFlag  ,
A.tsbPassDTime       as      AtsbPassDTime  ,
A.tsbPassUser        as      AtsbPassUser,  

A.tsbProdVisaKind    as      AtsbProdVisaKind,
A.isEtcPayment       as      AisEtcPayment,
A.tsbGroupNo         as      AtsbGroupNo,
A.tsbEtcPayWordNum   as      AtsbEtcPayWordNum




,B.tsbYear  as               BtsbYear      
,B.tsbApplyNo as             BtsbApplyNo   
,B.tsbDecideNo   as          BtsbDecideNo  
,B.tsbPrePayYear  as         BtsbPrePayYear
,B.tsbPrePayNo  as           BtsbPrePayNo
,B.tsbApplySeq  as           BtsbApplySeq
,B.tsbDecideSeq   as         BtsbDecideSeq
,B.tsbPayeeNo  as            BtsbPayeeNo
,B.tsbPayeeName as           BtsbPayeeName
,B.tsbOutlayYear as          BtsbOutlayYear
,B.tsbOutlayCode as          BtsbOutlayCode
,B.tsbBgtSourceCode as       BtsbBgtSourceCode
,B.tsbAccKind as             BtsbAccKind
,B.tsbBizCode as             BtsbBizCode
,B.tsbMoney as               BtsbMoney
,B.tsbMemo as                BtsbMemo
,B.tsbPlanCode as            BtsbPlanCode
,B.tsbExchNo as              BtsbExchNo
,B.tsbExchMakeDate as        BtsbExchMakeDate
,B.tsbExchPassDate as        BtsbExchPassDate
,B.tsbBgtDepCode   as        BtsbBgtDepCode
,B.tsbtemp      as        Btsbtemp
,B.tsbPayNoMapping      as        BtsbPayNoMapping
,B.tsbGroupNo      as        BtsbGroupNo
,B.FK_VisaNo      as        BFK_VisaNo
,B.FK_DetailNo      as        BFK_DetailNo

,C.tsbMoney as CtsbMoney
,C.tsbMoney1 as  CtsbMoney1
,C.tsbMoneyTotal as  CtsbMoneyTotal
,C.tsbCaseKind as CtsbCaseKind
,C.tsbOutlayCode as CtsbOutlayCode
,C.tsbOutlayYear as CtsbOutlayYear

--國建疾管新增
,C.tsbAccKind as CtsbAccKind
,C.tsbBgtSourceCode as  CtsbBgtSourceCode
,C.tsbBgtDepCode as CtsbBgtDepCode
,C.tsbPlanCode as  CtsbPlanCode
,C.acmNo1 as CacmNo1



FROM tsbPrePay A
LEFT JOIN tsbPrePayDtl  B

on  A.tsbYear = B.tsbYear  --核定年度
AND  A.tsbApplyNo =B.tsbApplyNo --會簽系統號
AND A.tsbDecideNo =B.tsbDecideNo   --核定號
AND A.tsbPrePayYear =B.tsbPrePayYear --預撥年度
AND A.tsbPrePayNo=B.tsbPrePayNo  --預撥號


INNER  JOIN  tsbDecideDtl as C
on    B.tsbYear = C.tsbYear  --核定年度
AND   B.tsbApplyNo =C.tsbApplyNo --會簽系統號
AND   B.tsbApplySeq = C.tsbApplySeq --會簽明細號
AND   B.tsbDecideNo =C.tsbDecideNo   --核定號
AND   B.tsbDecideSeq =C.tsbDecideSeq




WHERE  
         A.tsbYear=@tsbYear  --會簽年度
   AND   A.tsbApplyNo =@tsbApplyNo  --會簽系統號
   AND   A.tsbDecideNo=@tsbDecideNo   --核定號
   AND   A.tsbPrePayNo=@tsbPrePayNo   --預撥號 
------------------------------------------------------------

--執行時間--  2017/5/10 下午 03:26:51
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17631'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/10 下午 03:26:51
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：4
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601
Declare @tsbDecideNo As Int
Set @tsbDecideNo = 1
Declare @tsbPrePayNo As Int
Set @tsbPrePayNo = 1

--//撈取修改或新增畫面所需檔案(modify頁)
--寫在PrePay.DAT 內 PrePay01.cs getData_PrePayModify01DTO() 內
-- DTO 為 PrePay.Domain 內 PrePayModify01DTO.cs
SELECT 

           ---applay
  A.tsbYear    as  AtsbYear
, A.tsbApplyNo   as     AtsbApplyNo
, A.tsbTSBYear   as       AtsbTSBYear
, A.tsbTrustSubsidyName  as   AtsbTrustSubsidyName
--, A.tsbKindID  as   AtsbKindID
, A.tsbPlanCode  as  AtsbPlanCode
, A.tsbBgtYear  as   AtsbBgtYear
, A.tsbBgtMonth  as   AtsbBgtMonth
, A.tsbBgtUnitNo  as   AtsbBgtUnitNo
, A.tsbApplyWordNum  as  AtsbApplyWordNum
, A.tsbMarkDate  as   AtsbMarkDate
, A.tsbMarkUnitNo  as   AtsbMarkUnitNo
, A.tsbMarkUserNo  as   AtsbMarkUserNo
, A.tsbWorkUnitNo  as    AtsbWorkUnitNo
, A.tsbWorkUserNo   as    AtsbWorkUserNo
, A.tsbMoney   as     AtsbMoney
, A.tsbMemo   as    AtsbMemo
, A.tsbSubMemo   as    AtsbSubMemo
, A.tsbCreateDTime   as  AtsbCreateDTime
, A.tsbCreateUser     as  AtsbCreateUser
, A.tsbModifyDTime   as  AtsbModifyDTime
, A.tsbModifyUser   as    AtsbModifyUser
, A.tsbPassFlag  as    AtsbPassFlag
, A.tsbPassDTime  as   AtsbPassDTime
, A.tsbPassUser   as   AtsbPassUser
, A.IsTransfer  as   AIsTransfer
, A.IsInterest  as   AIsInterest
          ---tsbdecide
,B.tsbDecideNo  as    BtsbDecideNo
,B.tsbPassFlag AS BtsbPassFlag
,B.tsbMoney as  BtsbMoney
,B.tsbDecideDate  as  BtsbDecideDate
,B.tsbMemo as BtsbMemo ,
--,B.tsbPayeeKind  as  BtsbPayeeKind,
 
           ---tsbprepay
C.tsbYear            as      CtsbYear,
C.tsbApplyNo         as      CtsbApplyNo ,
C.tsbDecideNo        as      CtsbDecideNo ,
C.tsbPrePayYear      as      CtsbPrePayYear   ,
C.tsbPrePayNo        as      CtsbPrePayNo ,
C.tsbMarkDate        as      CtsbMarkDate ,
C.tsbMarkUnitNo      as      CtsbMarkUnitNo ,
C.tsbMarkUserNo      as      CtsbMarkUserNo ,
C.tsbWorkUnitNo      as      CtsbWorkUnitNo ,
C.tsbWorkUserNo      as      CtsbWorkUserNo,
C.tsbMoney           as      CtsbMoney,
C.tsbMemo            as      CtsbMemo,
C.tsbSubMemo         as      CtsbSubMemo,
C.tsbCreateDTime     as      CtsbCreateDTime   ,
C.tsbCreateUser      as      CtsbCreateUser  ,
C.tsbModifyDTime     as      CtsbModifyDTime ,
C.tsbModifyUser      as      CtsbModifyUser ,
C.tsbPassFlag        as      CtsbPassFlag  ,
C.tsbPassDTime       as      CtsbPassDTime  ,
C.tsbPassUser        as      CtsbPassUser  ,

C.tsbProdVisaKind    as      CtsbProdVisaKind,
C.isEtcPayment       as      CisEtcPayment,
C.tsbGroupNo         as      CtsbGroupNo,
C.tsbEtcPayWordNum   as      CtsbEtcPayWordNum,



    --
D.tsbApplySeq as DtsbApplySeq,
D.tsbOutlayYear  as  DtsbOutlayYear,
D.tsbOutlayCode  as  DtsbOutlayCode,
D.tsbPayeeNo  as  DtsbPayeeNo,
D.tsbPayeeName  as  DtsbPayeeName,
D.tsbDecideSeq  as  DtsbDecideSeq,
D.tsbMoney  as  DtsbMoney,
D.tsbMoney1  as   DtsbMoney1,
D.tsbMoneyTotal as DtsbMoneyTotal,
D.tsbPlanCode    as DtsbPlanCode,     
D.tsbCaseKind  as    DtsbCaseKind,     
--新增
D.tsbAccKind  as  DtsbAccKind,
D.tsbBgtSourceCode  as  DtsbBgtSourceCode,
D.tsbBgtDepCode as DtsbBgtDepCode

      

from  dbo.tsbApply as A
INNER  join  dbo.tsbDecide as B 
                 on A.tsbYear =B.tsbYear 
                AND  A.tsbApplyNo =B.tsbApplyNo 

LEFT JOIN    tsbPrePay  as C
              on   C.tsbYear =B.tsbYear
             AND    C.tsbApplyNo = B.tsbApplyNo
             AND   C.tsbDecideNo = B.tsbDecideNo

INNER JOIN  tsbDecideDtl D
     on  B.tsbYear = D.tsbYear  --核定年度
    AND  B.tsbApplyNo =D.tsbApplyNo --會簽系統號
    AND B.tsbDecideNo =D.tsbDecideNo   --核定號


WHERE   A.tsbPassFlag='1'      
   AND  B.tsbPassFlag='1'
   AND  B.tsbYear=@tsbYear  --會簽年度
   AND  B.tsbApplyNo =@tsbApplyNo  --會簽系統號
   AND  B.tsbDecideNo=@tsbDecideNo   --核定號
   AND  C.tsbPrePayNo=@tsbPrePayNo   --預撥號 
------------------------------------------------------------

-- 執行時間：2017/05/10 15:26:52.064 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:52.084 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:52.094 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:52.094 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:52.094 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:26:52.124 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:27:32#  http://localhost/HPAGBC/HPAGFC/Pay.Web/FrmPay_tsbPay/Default.aspx?MenuID=B17641
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:27:32#  http://localhost/HPAGBC/HPAGFC/Pay.Web/FrmPay_tsbPay/Default.aspx?MenuID=B17641
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17641' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:27:32
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17641'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/10 15:27:32.974 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:27:32.984 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:27:32.994 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:27:32.994 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:27:33.014 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
-- 路徑 HPAGBC\Pay.Repository\tsbPayRepository.cs
SELECT
A.tsbApplyWordNum AS AtsbApplyWordNum,
A.tsbPlanCode AS AtsbPlanCode,
A.tsbTrustSubsidyName AS AtsbTrustSubsidyName,
A.tsbLastApplyWordNum as AtsbLastApplyWordNum,
A.tsbBgtYear as AtsbBgtYear,
--A.tsbKindID AS AtsbKindID,
A.tsbKindNum as  AtsbKindNum,

B.tsbYear AS BtsbYear,
B.tsbApplyNo AS BtsbApplyNo,
B.tsbDecideNo AS BtsbDecideNo,
B.tsbDecideDate AS BtsbDecideDate,
--B.tsbPayeeKind AS BtsbPayeeKind,
B.tsbMarkUnitNo AS BtsbMarkUnitNo,
B.tsbMarkUserNo AS BtsbMarkUserNo,
B.tsbWorkUnitNo AS BtsbWorkUnitNo,
B.tsbWorkUserNo AS BtsbWorkUserNo,
B.tsbMoney AS BtsbMoney,
B.tsbMemo AS BtsbMemo,
B.tsbSubMemo AS BtsbSubMemo,
B.tsbCreateDTime AS BtsbCreateDTime,
B.tsbCreateUser AS BtsbCreateUser,
B.tsbModifyDTime AS BtsbModifyDTime,
B.tsbModifyUser AS BtsbModifyUser,
B.tsbPassFlag AS BtsbPassFlag,
B.tsbPassDTime AS BtsbPassDTime,
B.tsbPassUser AS BtsbPassUser,
B.tsbDecideFlag AS BtsbDecideFlag,

C.tsbYear               as       CtsbYear,
C.tsbApplyNo            as       CtsbApplyNo,
C.tsbDecideNo           as       CtsbDecideNo,
C.tsbPayYear            as       CtsbPayYear,
C.tsbPayNo             as       CtsbPayNo,
C.tspPayMonth          as       CtspPayMonth,
C.tspPayDay            as       CtspPayDay,
C.tsbMarkDate          as       CtsbMarkDate,
C.tsbMarkUnitNo        as       CtsbMarkUnitNo,
C.tsbMarkUserNo        as       CtsbMarkUserNo,
C.tsbWorkUnitNo        as       CtsbWorkUnitNo,
C.tsbWorkUserNo        as       CtsbWorkUserNo,
C.tsbMoney             as       CtsbMoney,
C.tsbMemo              as       CtsbMemo,
C.tsbSubMemo           as       CtsbSubMemo,
C.tsbCreateDTime       as       CtsbCreateDTime,
C.tsbCreateUser        as       CtsbCreateUser,
C.tsbModifyDTime       as       CtsbModifyDTime,
C.tsbModifyUser        as       CtsbModifyUser,
C.tsbPassFlag          as       CtsbPassFlag,
C.tsbPassDTime         as       CtsbPassDTime,
C.tsbPassUser           as       CtsbPassUser

FROM
dbo.tsbApply AS A
INNER JOIN dbo.tsbDecide AS B ON A.tsbYear = B.tsbYear AND A.tsbApplyNo = B.tsbApplyNo
Left JOIN dbo.tsbPay AS C ON B.tsbYear = C.tsbYear AND B.tsbApplyNo = C.tsbApplyNo AND B.tsbDecideNo = C.tsbDecideNo
WHERE
A.tsbPassFlag = '1' 
AND A.tsbKindNum='Case' 
AND B.tsbPassFlag = '1' 
    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.BtsbYear = '105' 

 ORDER BY  AtsbApplyWordNum DESC ,CtsbPayNo DESC 

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:27:37#  http://localhost/HPAGBC/HPAGFC/Pay.Web/FrmPay_tsbPay/Default.aspx?MenuID=B17641
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:27:37#  http://localhost/HPAGBC/HPAGFC/Pay.Web/FrmPay_tsbPay/Default.aspx?MenuID=B17641
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17641' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:27:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17641'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/10 15:27:37.245 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
-- 路徑 HPAGBC\Pay.Repository\tsbPayRepository.cs
SELECT
A.tsbApplyWordNum AS AtsbApplyWordNum,
A.tsbPlanCode AS AtsbPlanCode,
A.tsbTrustSubsidyName AS AtsbTrustSubsidyName,
A.tsbLastApplyWordNum as AtsbLastApplyWordNum,
A.tsbBgtYear as AtsbBgtYear,
--A.tsbKindID AS AtsbKindID,
A.tsbKindNum as  AtsbKindNum,

B.tsbYear AS BtsbYear,
B.tsbApplyNo AS BtsbApplyNo,
B.tsbDecideNo AS BtsbDecideNo,
B.tsbDecideDate AS BtsbDecideDate,
--B.tsbPayeeKind AS BtsbPayeeKind,
B.tsbMarkUnitNo AS BtsbMarkUnitNo,
B.tsbMarkUserNo AS BtsbMarkUserNo,
B.tsbWorkUnitNo AS BtsbWorkUnitNo,
B.tsbWorkUserNo AS BtsbWorkUserNo,
B.tsbMoney AS BtsbMoney,
B.tsbMemo AS BtsbMemo,
B.tsbSubMemo AS BtsbSubMemo,
B.tsbCreateDTime AS BtsbCreateDTime,
B.tsbCreateUser AS BtsbCreateUser,
B.tsbModifyDTime AS BtsbModifyDTime,
B.tsbModifyUser AS BtsbModifyUser,
B.tsbPassFlag AS BtsbPassFlag,
B.tsbPassDTime AS BtsbPassDTime,
B.tsbPassUser AS BtsbPassUser,
B.tsbDecideFlag AS BtsbDecideFlag,

C.tsbYear               as       CtsbYear,
C.tsbApplyNo            as       CtsbApplyNo,
C.tsbDecideNo           as       CtsbDecideNo,
C.tsbPayYear            as       CtsbPayYear,
C.tsbPayNo             as       CtsbPayNo,
C.tspPayMonth          as       CtspPayMonth,
C.tspPayDay            as       CtspPayDay,
C.tsbMarkDate          as       CtsbMarkDate,
C.tsbMarkUnitNo        as       CtsbMarkUnitNo,
C.tsbMarkUserNo        as       CtsbMarkUserNo,
C.tsbWorkUnitNo        as       CtsbWorkUnitNo,
C.tsbWorkUserNo        as       CtsbWorkUserNo,
C.tsbMoney             as       CtsbMoney,
C.tsbMemo              as       CtsbMemo,
C.tsbSubMemo           as       CtsbSubMemo,
C.tsbCreateDTime       as       CtsbCreateDTime,
C.tsbCreateUser        as       CtsbCreateUser,
C.tsbModifyDTime       as       CtsbModifyDTime,
C.tsbModifyUser        as       CtsbModifyUser,
C.tsbPassFlag          as       CtsbPassFlag,
C.tsbPassDTime         as       CtsbPassDTime,
C.tsbPassUser           as       CtsbPassUser

FROM
dbo.tsbApply AS A
INNER JOIN dbo.tsbDecide AS B ON A.tsbYear = B.tsbYear AND A.tsbApplyNo = B.tsbApplyNo
Left JOIN dbo.tsbPay AS C ON B.tsbYear = C.tsbYear AND B.tsbApplyNo = C.tsbApplyNo AND B.tsbDecideNo = C.tsbDecideNo
WHERE
A.tsbPassFlag = '1' 
AND A.tsbKindNum='Case' 
AND B.tsbPassFlag = '1' 
    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.BtsbYear = '105' 
AND ( A.AtsbApplyWordNum LIKE '%10504097%' 
OR A.AtsbLastApplyWordNum LIKE '%10504097%' )

 ORDER BY  AtsbApplyWordNum DESC ,CtsbPayNo DESC 

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:27:45#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/10 下午 03:27:45#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/10 下午 03:27:45
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/10 15:27:45.855 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:27:45.875 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:27:45.876 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:27:45.876 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:27:45.886 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%105%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/10 下午 03:28:23#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Modify.aspx?menuID=B17621&formStatus=View&Keys=%7B%22tsbYear%22%3A%22105%22%2C%22tsbApplyNo%22%3A%225601%22%2C%22tsbDecideNo%22%3A%221%22%7D
--[Parameter Count:1]
--@parMenuID='B17621'
 Select * From SysMenuBase Where PK_MnuNo ='B17621' 
-------------------------------------------------------------------------------
-- 執行時間：2017/05/10 15:28:23.393 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--執行時間--  2017/5/10 下午 03:28:23
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//取核定明細表(modify頁)
--寫在approved.DAT 的  approved01.cs  getJoinDecideDtlData()，使用DTO為 approved.Domain 內 approvedModify01DTO.cs
SELECT 
 A.tsbYear           as      AtsbYear            
,A.tsbApplyNo        as      AtsbApplyNo         
,A.tsbApplySeq       as      AtsbApplySeq        
,A.tsbBgtYear        as      AtsbBgtYear         
,A.tsbBgtMonth       as      AtsbBgtMonth        
,A.tsbOutlayYear     as      AtsbOutlayYear      
,A.tsbOutlayCode     as      AtsbOutlayCode      
,A.tsbBgtSourceCode  as      AtsbBgtSourceCode   
,A.tsbAccKind        as      AtsbAccKind         
,A.tsbBizCode        as      AtsbBizCode         
,A.tsbMoney          as      AtsbMoney           
,A.tsbMemo           as      AtsbMemo            
,A.tsbPlanCode       as      AtsbPlanCode      
,A.tsbBgtDepCode     as      AtsbBgtDepCode  --新增

, B.tsbYear            as          BtsbYear          
, B.tsbApplyNo         as          BtsbApplyNo       
, B.tsbApplySeq        as          BtsbApplySeq      
, B.tsbDecideNo        as          BtsbDecideNo      
, B.tsbDecideSeq       as          BtsbDecideSeq     
, B.tsbBgtKind         as          BtsbBgtKind       
, B.tsbBgtYear         as          BtsbBgtYear       
, B.tsbBgtMonth        as          BtsbBgtMonth    
, B.tsbPayeeKind         as        BtsbPayeeKind   --新增
, B.tsbPayeeNo         as          BtsbPayeeNo       
, B.tsbPayeeName       as          BtsbPayeeName     
, B.tsbOutlayYear      as          BtsbOutlayYear    
, B.tsbOutlayCode      as          BtsbOutlayCode    
, B.tsbBgtSourceCode   as          BtsbBgtSourceCode 
, B.tsbAccKind         as          BtsbAccKind       
, B.tsbBizCode         as          BtsbBizCode       
, B.tsbMoney           as          BtsbMoney         
, B.tsbMoney1          as          BtsbMoney1    
, B.tsbMoneyTotal          as          BtsbMoneyTotal    
, B.tsbMemo            as          BtsbMemo        
, B.tsbContractDTime   as          BtsbContractDTime  
, B.tsbPlanCode        as          BtsbPlanCode      
, B.tsbBgtDepCode      as          BtsbBgtDepCode
, B.tsbHostName        as          BtsbHostName
, B.tsbCaseKind        as          BtsbCaseKind
, B.tsbContractMoney   as          BtsbContractMoney
, B.inspect            as          Binspect
, B.acmNo1             as          BacmNo1

FROM tsbApplyDtl A

left JOIN tsbDecideDtl  B

 
on  A.tsbYear = B.tsbYear  
AND  A.tsbApplyNo =B.tsbApplyNo
AND A.tsbApplySeq =B.tsbApplySeq

WHERE  
         A.tsbYear=@tsbYear
   AND   A.tsbApplyNo =@tsbApplyNo 
------------------------------------------------------------

--執行時間--  2017/5/10 下午 03:28:23
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

--執行時間--  2017/5/10 下午 03:28:23
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：2
Declare @tsbYear As Int
Set @tsbYear = 105
Declare @tsbApplyNo As Int
Set @tsbApplyNo = 5601

--//撈取修改或新增畫面所需檔案(modify頁)
--- 寫在 approved.DAT  getJoinData 方法  使用DTO 為  approved.Domain 的  tsbApplyDTO.cs
SELECT 
  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
--,B.tsbPayeeKind
,B.tsbDecideFlag
,B.tsbWorkUnitNo as  BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo
--,B.tsbInterestMoney as BtsbInterestMoney


from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'      

   AND  A.tsbYear= @tsbYear
   AND  A.tsbApplyNo=@tsbApplyNo
 --  AND  B.tsbDecideNo=@tsbDecideNo
------------------------------------------------------------

-- 執行時間：2017/05/10 15:28:23.433 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:28:23.463 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:28:23.473 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBgtOrigin A
    WHERE 1 = 1
    ORDER BY   A.orgCode       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:28:23.473 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codAccKindName A
    WHERE 1 = 1
    ORDER BY   A.accKind       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:28:23.473 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codBizName A
    WHERE 1 = 1
    ORDER BY   A.BizCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/10 15:28:23.493 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codOutlayCode A
    WHERE 1 = 1
    ORDER BY   A.oulOutlayCode ,A.codCodeVer       

GO
-- ==============================================================================================================================


--#2017/5/11 上午 08:41:22#  http://localhost/HPAGBC/Login.aspx
--[Parameter Count:2]
--@UserAlias='99999'
--@UserPwd='05072306'
SELECT * FROM sysBaseUser A WHERE usrAlias='99999' AND usrPwd='05072306' AND ISNULL(usrStateKind,'0')<>'1' ORDER BY PK_usrNo
-------------------------------------------------------------------------------
--#2017/5/11 上午 08:41:23#  http://localhost/HPAGBC/Login.aspx
UPDATE sysBaseUser SET usrLoginDTime='2017/05/11 08:41:23' ,usrLoginIP='::1'  WHERE PK_usrNo=1
-------------------------------------------------------------------------------
--#2017/5/11 上午 08:41:25#  http://localhost/HPAGBC/Login.aspx
INSERT logWhoRec (LogIP,LogDate,LogUser,LogMod,LogPage,LogWork,LogMemo,LogWorkUser,LogLevel,LogLink,LogSys) VALUES ('::1','2017/05/11 08:41:23','99999','Login','Login.aspx','','成功','系統管理員',35,'','HPAGBC/')
-------------------------------------------------------------------------------
--#2017/5/11 上午 08:41:26#  http://localhost/HPAGBC/Login.aspx
Select Top 1 * From  ebsAgent 
-------------------------------------------------------------------------------
--#2017/5/11 上午 08:41:26#  http://localhost/HPAGBC/Login.aspx
 Select sysCloseDate From basBaseData 
-------------------------------------------------------------------------------
--#2017/5/11 上午 08:41:26#  http://localhost/HPAGBC/Login.aspx
Select dptName, dptCode  FROM codDepartName A  Where 1=1  and  dptCode = '14' Order By  1 ,2 
-------------------------------------------------------------------------------
--#2017/5/11 上午 08:41:27#  http://localhost/HPAGBC/intro.aspx
SELECT 'Powered by Microsoft SQL Server ' + CONVERT(nvarchar,SERVERPROPERTY('ProductVersion')) + ' ' + CONVERT(nvarchar,SERVERPROPERTY('ProductLevel'))
-------------------------------------------------------------------------------
--#2017/5/11 上午 08:41:27#  http://localhost/HPAGBC/Menu.aspx
SELECT DISTINCT (SELECT TOP 1 A2.PK_MnuNo  FROM  sysUserPower C2 INNER JOIN  sysGroupData D2 ON C2.PK_grpNo = D2.PK_grpNo INNER JOIN  sysMenuBase A2 ON A2.PK_MnuNo = D2.PK_mnuNo WHERE  (C2.PK_usrNo = 1)  AND ISNULL(mnuLevel,0)> -90 AND A.PK_MnuNo LIKE A2.PK_MnuNo + '_%'  ORDER BY  A2.PK_MnuNo DESC) AS ParentPK_MnuNo, A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -90 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/11 上午 08:42:03
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B176A1'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/11 08:42:03.846 
-- 連線資料庫：HPAGBCEntities 
--==============================================================================================================================--
DECLARE p__linq__0 AS INT
SET p__linq__0 = 106


SELECT 
[Project1].[C1] AS [C1], 
[Project1].[plnPlanCode] AS [plnPlanCode], 
[Project1].[C2] AS [C2], 
[Project1].[plnLevelEnd] AS [plnLevelEnd], 
[Project1].[plnLevel] AS [plnLevel]
FROM ( SELECT 
	[Extent1].[plnPlanCode] AS [plnPlanCode], 
	[Extent1].[plnLevel] AS [plnLevel], 
	[Extent1].[plnLevelEnd] AS [plnLevelEnd], 
	1 AS [C1], 
	N'[' + [Extent1].[plnPlanCode] + N'] ' + [Extent1].[plnPlanName] AS [C2]
	FROM [dbo].[codPlanCode] AS [Extent1]
	WHERE ( CAST( [Extent1].[codCodeVer] AS int) = @p__linq__0) AND ((CASE WHEN ([Extent1].[plnStopFlag] IS NOT NULL) THEN CASE WHEN ('0' = [Extent1].[plnStopFlag]) THEN cast(1 as bit) WHEN (N'0' <> [Extent1].[plnStopFlag]) THEN cast(0 as bit) END ELSE cast(1 as bit) END) = 1)
)  AS [Project1]
ORDER BY [Project1].[plnPlanCode] ASC
--==============================================================================================================================--


-- 執行時間：2017/05/11 08:42:05.045 
-- 連線資料庫：HPAGBCEntities 
--==============================================================================================================================--
DECLARE p__linq__0 AS INT
SET p__linq__0 = 106
DECLARE p__linq__1 AS NVARCHAR(1000)
SET p__linq__1 = '2017/05/12 00:00:00.000'
DECLARE p__linq__2 AS NVARCHAR(1000)
SET p__linq__2 = N'0'


SELECT 
[Project1].[tsbApplyNo] AS [tsbApplyNo], 
[Project1].[tsbYear] AS [tsbYear], 
[Project1].[tsbApplySeq] AS [tsbApplySeq], 
[Project1].[tsbDecideNo] AS [tsbDecideNo], 
[Project1].[tsbDecideSeq] AS [tsbDecideSeq], 
[Project1].[tsbContractDTime] AS [tsbContractDTime], 
[Project1].[tsbApplyWordNum] AS [tsbApplyWordNum], 
[Project1].[C1] AS [C1], 
[Project1].[dptName] AS [dptName], 
[Project1].[dptCode] AS [dptCode], 
[Project1].[tsbWorkUserNo] AS [tsbWorkUserNo], 
[Project1].[tsbPlanCode] AS [tsbPlanCode], 
[Project1].[C2] AS [C2], 
[Project1].[tsbPayeeNo] AS [tsbPayeeNo], 
[Project1].[tsbPayeeName] AS [tsbPayeeName], 
[Project1].[tsbPayeeKind] AS [tsbPayeeKind], 
[Project1].[tsbOutlayYear] AS [tsbOutlayYear], 
[Project1].[tsbOutlayCode] AS [tsbOutlayCode], 
[Project1].[C3] AS [C3], 
[Project1].[tsbTrustSubsidyName] AS [tsbTrustSubsidyName], 
[Project1].[tsbMoney] AS [tsbMoney], 
[Project1].[C4] AS [C4], 
[Project1].[C5] AS [C5]
FROM ( SELECT 
	[Filter1].[tsbYear1] AS [tsbYear], 
	[Filter1].[tsbApplyNo1] AS [tsbApplyNo], 
	[Filter1].[tsbApplySeq] AS [tsbApplySeq], 
	[Filter1].[tsbDecideNo1] AS [tsbDecideNo], 
	[Filter1].[tsbDecideSeq] AS [tsbDecideSeq], 
	[Filter1].[tsbPayeeNo] AS [tsbPayeeNo], 
	[Filter1].[tsbPayeeKind] AS [tsbPayeeKind], 
	[Filter1].[tsbPayeeName] AS [tsbPayeeName], 
	[Filter1].[tsbOutlayYear] AS [tsbOutlayYear], 
	[Filter1].[tsbOutlayCode] AS [tsbOutlayCode], 
	[Filter1].[tsbMoney2] AS [tsbMoney], 
	[Filter1].[tsbContractDTime] AS [tsbContractDTime], 
	[Filter1].[tsbPlanCode1] AS [tsbPlanCode], 
	[Filter1].[tsbWorkUserNo1] AS [tsbWorkUserNo], 
	[Filter1].[tsbTrustSubsidyName] AS [tsbTrustSubsidyName], 
	[Filter1].[tsbApplyWordNum] AS [tsbApplyWordNum], 
	[Filter1].[dptCode] AS [dptCode], 
	[Filter1].[dptName] AS [dptName], 
	CASE WHEN ([Filter1].[tsbLastApplyWordNum] IS NULL) THEN N'' ELSE N'(' + [Filter1].[tsbLastApplyWordNum] + N')' END AS [C1], 
	N'[' + [Filter1].[plnPlanCode] + N'] ' + [Filter1].[plnPlanName] AS [C2], 
	N'[' + [Filter1].[oulOutlayCode] + N'] ' + [Filter1].[oulOutlayName] AS [C3], 
	CASE WHEN (N'0' = (CASE WHEN ([Extent7].[tsbPassFlag] IS NULL) THEN N'0' ELSE [Extent7].[tsbPassFlag] END)) THEN N'Ｘ' ELSE N'Ｏ' END AS [C4], 
	CASE WHEN ([Extent7].[tsbPassFlag] IS NULL) THEN N'Ｘ' ELSE N'Ｏ' END AS [C5]
	FROM   (SELECT [Extent1].[tsbYear] AS [tsbYear1], [Extent1].[tsbApplyNo] AS [tsbApplyNo1], [Extent1].[tsbApplySeq] AS [tsbApplySeq], [Extent1].[tsbDecideNo] AS [tsbDecideNo1], [Extent1].[tsbDecideSeq] AS [tsbDecideSeq], [Extent1].[tsbPayeeNo] AS [tsbPayeeNo], [Extent1].[tsbPayeeKind] AS [tsbPayeeKind], [Extent1].[tsbPayeeName] AS [tsbPayeeName], [Extent1].[tsbOutlayYear] AS [tsbOutlayYear], [Extent1].[tsbOutlayCode] AS [tsbOutlayCode], [Extent1].[tsbMoney] AS [tsbMoney2], [Extent1].[tsbContractDTime] AS [tsbContractDTime], [Extent1].[tsbPlanCode] AS [tsbPlanCode1], [Extent2].[tsbWorkUserNo] AS [tsbWorkUserNo1], [Extent3].[tsbTrustSubsidyName] AS [tsbTrustSubsidyName], [Extent3].[tsbApplyWordNum] AS [tsbApplyWordNum], [Extent3].[tsbLastApplyWordNum] AS [tsbLastApplyWordNum], [Extent4].[plnPlanCode] AS [plnPlanCode], [Extent4].[plnPlanName] AS [plnPlanName], [Extent5].[oulOutlayCode] AS [oulOutlayCode], [Extent5].[oulOutlayName] AS [oulOutlayName], [Extent6].[dptCode] AS [dptCode], [Extent6].[dptName] AS [dptName]
		FROM      [dbo].[tsbDecideDtl] AS [Extent1]
		INNER JOIN [dbo].[tsbDecide] AS [Extent2] ON ([Extent1].[tsbApplyNo] = [Extent2].[tsbApplyNo]) AND ([Extent1].[tsbYear] = [Extent2].[tsbYear]) AND ([Extent1].[tsbDecideNo] = [Extent2].[tsbDecideNo])
		INNER JOIN (SELECT 
[tsbApply].[tsbYear] AS [tsbYear], 
[tsbApply].[tsbApplyNo] AS [tsbApplyNo], 
[tsbApply].[tsbKindNum] AS [tsbKindNum], 
[tsbApply].[tsbTSBYear] AS [tsbTSBYear], 
[tsbApply].[tsbTrustSubsidyName] AS [tsbTrustSubsidyName], 
[tsbApply].[tsbPlanCode] AS [tsbPlanCode], 
[tsbApply].[tsbBgtYear] AS [tsbBgtYear], 
[tsbApply].[tsbBgtMonth] AS [tsbBgtMonth], 
[tsbApply].[tsbBgtUnitNo] AS [tsbBgtUnitNo], 
[tsbApply].[tsbApplyWordNum] AS [tsbApplyWordNum], 
[tsbApply].[tsbLastApplyWordNum] AS [tsbLastApplyWordNum], 
[tsbApply].[tsbMarkDate] AS [tsbMarkDate], 
[tsbApply].[tsbMarkUnitNo] AS [tsbMarkUnitNo], 
[tsbApply].[tsbMarkUserNo] AS [tsbMarkUserNo], 
[tsbApply].[tsbWorkUnitNo] AS [tsbWorkUnitNo], 
[tsbApply].[tsbWorkUserNo] AS [tsbWorkUserNo], 
[tsbApply].[tsbMoney] AS [tsbMoney], 
[tsbApply].[tsbMemo] AS [tsbMemo], 
[tsbApply].[tsbSubMemo] AS [tsbSubMemo], 
[tsbApply].[tsbCreateDTime] AS [tsbCreateDTime], 
[tsbApply].[tsbCreateUser] AS [tsbCreateUser], 
[tsbApply].[tsbModifyDTime] AS [tsbModifyDTime], 
[tsbApply].[tsbModifyUser] AS [tsbModifyUser], 
[tsbApply].[tsbPassFlag] AS [tsbPassFlag], 
[tsbApply].[tsbPassDTime] AS [tsbPassDTime], 
[tsbApply].[tsbPassUser] AS [tsbPassUser], 
[tsbApply].[IsTransfer] AS [IsTransfer], 
[tsbApply].[IsInterest] AS [IsInterest], 
[tsbApply].[tsbSubEntKind] AS [tsbSubEntKind]
FROM [dbo].[tsbApply] AS [tsbApply]) AS [Extent3] ON ([Extent1].[tsbApplyNo] = [Extent3].[tsbApplyNo]) AND ([Extent1].[tsbYear] = [Extent3].[tsbYear])
		INNER JOIN [dbo].[codPlanCode] AS [Extent4] ON ([Extent1].[tsbBgtYear] = [Extent4].[codCodeVer]) AND ([Extent1].[tsbPlanCode] = [Extent4].[plnPlanCode])
		INNER JOIN [dbo].[codOutlayCode] AS [Extent5] ON ([Extent1].[tsbOutlayYear] = [Extent5].[codCodeVer]) AND ([Extent1].[tsbOutlayCode] = [Extent5].[oulOutlayCode])
		INNER JOIN [dbo].[codDepartName] AS [Extent6] ON [Extent3].[tsbWorkUnitNo] = [Extent6].[dptCode]
		WHERE ('1' = [Extent2].[tsbPassFlag]) AND ('Case' = [Extent3].[tsbKindNum]) AND (([Extent5].[oulOutlayCode] LIKE N'0251%') OR (N'281' = [Extent5].[oulOutlayCode]) OR (N'286' = [Extent5].[oulOutlayCode]) OR (N'287' = [Extent5].[oulOutlayCode]) OR (N'288' = [Extent5].[oulOutlayCode]) OR (N'28A' = [Extent5].[oulOutlayCode])) ) AS [Filter1]
	LEFT OUTER JOIN [dbo].[tsbficEntrustPara] AS [Extent7] ON ([Filter1].[tsbYear1] = [Extent7].[tsbYear]) AND ([Filter1].[tsbApplyNo1] = [Extent7].[tsbApplyNo]) AND ([Filter1].[tsbApplySeq] = [Extent7].[tsbApplySeq]) AND ([Filter1].[tsbDecideNo1] = [Extent7].[tsbDecideNo]) AND ([Filter1].[tsbDecideSeq] = [Extent7].[tsbDecideSeq])
	WHERE ( CAST( [Filter1].[tsbYear1] AS int) = @p__linq__0) AND ([Filter1].[tsbContractDTime] < @p__linq__1) AND ((CASE WHEN (N'0' = (CASE WHEN ([Extent7].[tsbPassFlag] IS NULL) THEN N'0' ELSE [Extent7].[tsbPassFlag] END)) THEN N'Ｘ' ELSE N'Ｏ' END) = (CASE WHEN (N'0' = @p__linq__2) THEN N'Ｘ' ELSE N'Ｏ' END))
)  AS [Project1]
ORDER BY [Project1].[tsbApplyWordNum] DESC, [Project1].[tsbDecideNo] DESC
--==============================================================================================================================--


--執行時間--  2017/5/11 上午 08:42:17
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B176A2'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/11 08:42:17.583 
-- 連線資料庫：HPAGBCEntities 
--==============================================================================================================================--
DECLARE p__linq__0 AS INT
SET p__linq__0 = 106


SELECT 
[Project1].[C1] AS [C1], 
[Project1].[plnPlanCode] AS [plnPlanCode], 
[Project1].[C2] AS [C2], 
[Project1].[plnLevelEnd] AS [plnLevelEnd], 
[Project1].[plnLevel] AS [plnLevel]
FROM ( SELECT 
	[Extent1].[plnPlanCode] AS [plnPlanCode], 
	[Extent1].[plnLevel] AS [plnLevel], 
	[Extent1].[plnLevelEnd] AS [plnLevelEnd], 
	1 AS [C1], 
	N'[' + [Extent1].[plnPlanCode] + N'] ' + [Extent1].[plnPlanName] AS [C2]
	FROM [dbo].[codPlanCode] AS [Extent1]
	WHERE ( CAST( [Extent1].[codCodeVer] AS int) = @p__linq__0) AND ((CASE WHEN ([Extent1].[plnStopFlag] IS NOT NULL) THEN CASE WHEN ('0' = [Extent1].[plnStopFlag]) THEN cast(1 as bit) WHEN (N'0' <> [Extent1].[plnStopFlag]) THEN cast(0 as bit) END ELSE cast(1 as bit) END) = 1)
)  AS [Project1]
ORDER BY [Project1].[plnPlanCode] ASC
--==============================================================================================================================--


-- 執行時間：2017/05/11 08:42:17.753 
-- 連線資料庫：HPAGBCEntities 
--==============================================================================================================================--
DECLARE p__linq__0 AS INT
SET p__linq__0 = 106
DECLARE p__linq__1 AS NVARCHAR(1000)
SET p__linq__1 = '2017/05/12 00:00:00.000'
DECLARE p__linq__2 AS NVARCHAR(1000)
SET p__linq__2 = N'0'


SELECT 
[Project2].[tsbApplyNo] AS [tsbApplyNo], 
[Project2].[tsbYear] AS [tsbYear], 
[Project2].[tsbApplySeq] AS [tsbApplySeq], 
[Project2].[tsbDecideNo] AS [tsbDecideNo], 
[Project2].[tsbDecideSeq] AS [tsbDecideSeq], 
[Project2].[tsbContractDTime] AS [tsbContractDTime], 
[Project2].[tsbApplyWordNum] AS [tsbApplyWordNum], 
[Project2].[C1] AS [C1], 
[Project2].[dptName] AS [dptName], 
[Project2].[dptCode] AS [dptCode], 
[Project2].[tsbWorkUserNo] AS [tsbWorkUserNo], 
[Project2].[tsbPlanCode] AS [tsbPlanCode], 
[Project2].[C2] AS [C2], 
[Project2].[tsbPayeeNo] AS [tsbPayeeNo], 
[Project2].[tsbPayeeName] AS [tsbPayeeName], 
[Project2].[tsbPayeeKind] AS [tsbPayeeKind], 
[Project2].[tsbOutlayYear] AS [tsbOutlayYear], 
[Project2].[tsbOutlayCode] AS [tsbOutlayCode], 
[Project2].[C3] AS [C3], 
[Project2].[tsbTrustSubsidyName] AS [tsbTrustSubsidyName], 
[Project2].[tsbMoney] AS [tsbMoney], 
[Project2].[C4] AS [C4], 
[Project2].[C5] AS [C5]
FROM ( SELECT 
	[Filter1].[tsbYear1] AS [tsbYear], 
	[Filter1].[tsbApplyNo1] AS [tsbApplyNo], 
	[Filter1].[tsbApplySeq] AS [tsbApplySeq], 
	[Filter1].[tsbDecideNo1] AS [tsbDecideNo], 
	[Filter1].[tsbDecideSeq] AS [tsbDecideSeq], 
	[Filter1].[tsbPayeeNo] AS [tsbPayeeNo], 
	[Filter1].[tsbPayeeKind] AS [tsbPayeeKind], 
	[Filter1].[tsbPayeeName] AS [tsbPayeeName], 
	[Filter1].[tsbOutlayYear] AS [tsbOutlayYear], 
	[Filter1].[tsbOutlayCode] AS [tsbOutlayCode], 
	[Filter1].[tsbMoney2] AS [tsbMoney], 
	[Filter1].[tsbContractDTime] AS [tsbContractDTime], 
	[Filter1].[tsbPlanCode1] AS [tsbPlanCode], 
	[Filter1].[tsbWorkUserNo1] AS [tsbWorkUserNo], 
	[Filter1].[tsbTrustSubsidyName] AS [tsbTrustSubsidyName], 
	[Filter1].[tsbApplyWordNum] AS [tsbApplyWordNum], 
	[Filter1].[dptCode] AS [dptCode], 
	[Filter1].[dptName] AS [dptName], 
	CASE WHEN ([Filter1].[tsbLastApplyWordNum] IS NULL) THEN N'' ELSE N'(' + [Filter1].[tsbLastApplyWordNum] + N')' END AS [C1], 
	N'[' + [Filter1].[plnPlanCode] + N'] ' + [Filter1].[plnPlanName] AS [C2], 
	N'[' + [Filter1].[oulOutlayCode] + N'] ' + [Filter1].[oulOutlayName] AS [C3], 
	CASE WHEN (N'0' = (CASE WHEN ([Extent8].[tsbPassFlag] IS NULL) THEN N'0' ELSE [Extent8].[tsbPassFlag] END)) THEN N'Ｘ' ELSE N'Ｏ' END AS [C4], 
	CASE WHEN ([Extent8].[tsbPassFlag] IS NULL) THEN N'Ｘ' ELSE N'Ｏ' END AS [C5]
	FROM   (SELECT [Extent1].[tsbYear] AS [tsbYear1], [Extent1].[tsbApplyNo] AS [tsbApplyNo1], [Extent1].[tsbApplySeq] AS [tsbApplySeq], [Extent1].[tsbDecideNo] AS [tsbDecideNo1], [Extent1].[tsbDecideSeq] AS [tsbDecideSeq], [Extent1].[tsbPayeeNo] AS [tsbPayeeNo], [Extent1].[tsbPayeeKind] AS [tsbPayeeKind], [Extent1].[tsbPayeeName] AS [tsbPayeeName], [Extent1].[tsbOutlayYear] AS [tsbOutlayYear], [Extent1].[tsbOutlayCode] AS [tsbOutlayCode], [Extent1].[tsbMoney] AS [tsbMoney2], [Extent1].[tsbContractDTime] AS [tsbContractDTime], [Extent1].[tsbPlanCode] AS [tsbPlanCode1], [Extent2].[tsbWorkUserNo] AS [tsbWorkUserNo1], [Extent3].[tsbTrustSubsidyName] AS [tsbTrustSubsidyName], [Extent3].[tsbApplyWordNum] AS [tsbApplyWordNum], [Extent3].[tsbLastApplyWordNum] AS [tsbLastApplyWordNum], [Extent4].[plnPlanCode] AS [plnPlanCode], [Extent4].[plnPlanName] AS [plnPlanName], [Extent5].[oulOutlayCode] AS [oulOutlayCode], [Extent5].[oulOutlayName] AS [oulOutlayName], [Extent7].[dptCode] AS [dptCode], [Extent7].[dptName] AS [dptName]
		FROM       [dbo].[tsbDecideDtl] AS [Extent1]
		INNER JOIN [dbo].[tsbDecide] AS [Extent2] ON ([Extent1].[tsbYear] = [Extent2].[tsbYear]) AND ([Extent1].[tsbApplyNo] = [Extent2].[tsbApplyNo]) AND ([Extent1].[tsbDecideNo] = [Extent2].[tsbDecideNo])
		INNER JOIN (SELECT 
[tsbApply].[tsbYear] AS [tsbYear], 
[tsbApply].[tsbApplyNo] AS [tsbApplyNo], 
[tsbApply].[tsbKindNum] AS [tsbKindNum], 
[tsbApply].[tsbTSBYear] AS [tsbTSBYear], 
[tsbApply].[tsbTrustSubsidyName] AS [tsbTrustSubsidyName], 
[tsbApply].[tsbPlanCode] AS [tsbPlanCode], 
[tsbApply].[tsbBgtYear] AS [tsbBgtYear], 
[tsbApply].[tsbBgtMonth] AS [tsbBgtMonth], 
[tsbApply].[tsbBgtUnitNo] AS [tsbBgtUnitNo], 
[tsbApply].[tsbApplyWordNum] AS [tsbApplyWordNum], 
[tsbApply].[tsbLastApplyWordNum] AS [tsbLastApplyWordNum], 
[tsbApply].[tsbMarkDate] AS [tsbMarkDate], 
[tsbApply].[tsbMarkUnitNo] AS [tsbMarkUnitNo], 
[tsbApply].[tsbMarkUserNo] AS [tsbMarkUserNo], 
[tsbApply].[tsbWorkUnitNo] AS [tsbWorkUnitNo], 
[tsbApply].[tsbWorkUserNo] AS [tsbWorkUserNo], 
[tsbApply].[tsbMoney] AS [tsbMoney], 
[tsbApply].[tsbMemo] AS [tsbMemo], 
[tsbApply].[tsbSubMemo] AS [tsbSubMemo], 
[tsbApply].[tsbCreateDTime] AS [tsbCreateDTime], 
[tsbApply].[tsbCreateUser] AS [tsbCreateUser], 
[tsbApply].[tsbModifyDTime] AS [tsbModifyDTime], 
[tsbApply].[tsbModifyUser] AS [tsbModifyUser], 
[tsbApply].[tsbPassFlag] AS [tsbPassFlag], 
[tsbApply].[tsbPassDTime] AS [tsbPassDTime], 
[tsbApply].[tsbPassUser] AS [tsbPassUser], 
[tsbApply].[IsTransfer] AS [IsTransfer], 
[tsbApply].[IsInterest] AS [IsInterest], 
[tsbApply].[tsbSubEntKind] AS [tsbSubEntKind]
FROM [dbo].[tsbApply] AS [tsbApply]) AS [Extent3] ON ([Extent1].[tsbYear] = [Extent3].[tsbYear]) AND ([Extent1].[tsbApplyNo] = [Extent3].[tsbApplyNo])
		INNER JOIN [dbo].[codPlanCode] AS [Extent4] ON ([Extent1].[tsbBgtYear] = [Extent4].[codCodeVer]) AND ([Extent1].[tsbPlanCode] = [Extent4].[plnPlanCode])
		INNER JOIN [dbo].[codOutlayCode] AS [Extent5] ON ([Extent1].[tsbOutlayYear] = [Extent5].[codCodeVer]) AND ([Extent1].[tsbOutlayCode] = [Extent5].[oulOutlayCode])
		INNER JOIN  (SELECT DISTINCT 
			[Extent6].[codCodeVer] AS [codCodeVer], 
			[Extent6].[OutlayCode] AS [OutlayCode]
			FROM [dbo].[codSubsidyOutlay] AS [Extent6] ) AS [Distinct1] ON ([Extent5].[codCodeVer] = [Distinct1].[codCodeVer]) AND ([Extent5].[oulOutlayCode] = [Distinct1].[OutlayCode])
		INNER JOIN [dbo].[codDepartName] AS [Extent7] ON [Extent3].[tsbWorkUnitNo] = [Extent7].[dptCode]
		WHERE ('1' = [Extent2].[tsbPassFlag]) AND ('Case' = [Extent3].[tsbKindNum]) AND (([Extent5].[oulOutlayCode] LIKE N'04%') OR (N'721' = [Extent5].[oulOutlayCode]) OR (N'722' = [Extent5].[oulOutlayCode]) OR (N'723' = [Extent5].[oulOutlayCode])) ) AS [Filter1]
	LEFT OUTER JOIN [dbo].[tsbficSubisdyPara] AS [Extent8] ON ([Filter1].[tsbYear1] = [Extent8].[tsbYear]) AND ([Filter1].[tsbApplyNo1] = [Extent8].[tsbApplyNo]) AND ([Filter1].[tsbApplySeq] = [Extent8].[tsbApplySeq]) AND ([Filter1].[tsbDecideNo1] = [Extent8].[tsbDecideNo]) AND ([Filter1].[tsbDecideSeq] = [Extent8].[tsbDecideSeq])
	WHERE ( CAST( [Filter1].[tsbYear1] AS int) = @p__linq__0) AND ([Filter1].[tsbContractDTime] < @p__linq__1) AND ((CASE WHEN (N'0' = (CASE WHEN ([Extent8].[tsbPassFlag] IS NULL) THEN N'0' ELSE [Extent8].[tsbPassFlag] END)) THEN N'Ｘ' ELSE N'Ｏ' END) = (CASE WHEN (N'0' = @p__linq__2) THEN N'Ｘ' ELSE N'Ｏ' END))
)  AS [Project2]
ORDER BY [Project2].[tsbApplyWordNum] DESC, [Project2].[tsbDecideNo] DESC
--==============================================================================================================================--


-- 執行時間：2017/05/11 08:42:54.783 
-- 連線字串：name=HPAGBCEntities 
--==============================================================================================================================--
DECLARE @codCodeVer AS INT
SET @codCodeVer = 106
DECLARE @isAll AS NVARCHAR(1000)
SET @isAll = N'0'



-- DECLARE @codCodeVer AS INT
-- SET @codCodeVer = 105
-- DECLARE @isAll AS VARCHAR(1)
-- SET @isAll = '1'
----------------------------------以前年度----------------------------------
SELECT DISTINCT
	    PC.codCodeVer, 
	    CONVERT(VARCHAR, PC.codCodeVer) + '_' + PC.plnPlanCode AS plnPlanCode, 
	    '（' + CONVERT(VARCHAR, PC.codCodeVer) + '年度）' + '[' + PC.plnPlanCode + '] ' + plnPlanName AS plnPlanName, 
	    PC.plnLevelEnd ,PC.plnLevel 
FROM tsbDecideDtl DD 
	JOIN codPlanCode PC 
		ON DD.tsbOutlayYear = PC.codCodeVer AND DD.tsbPlanCode = PC.plnPlanCode
WHERE  DD.tsbOutlayYear <> DD.tsbYear AND DD.tsbYear = @codCodeVer AND @isAll = '1'
----------------------------------------------------------------------------
UNION ALL
----------------------------------現在年度----------------------------------
SELECT  PC.codCodeVer, 
        CONVERT(VARCHAR, PC.codCodeVer) + '_' + PC.plnPlanCode AS plnPlanCode, 
        CASE WHEN @isAll = '1' 
             THEN '（' + CONVERT(VARCHAR, PC.codCodeVer) + '年度）'
             ELSE '' END
            + '[' + PC.plnPlanCode + '] ' + plnPlanName AS plnPlanName, 
        PC.plnLevelEnd ,PC.plnLevel 
FROM codPlanCode PC
WHERE codCodeVer = @codCodeVer 
----------------------------------------------------------------------------
ORDER BY codCodeVer DESC, plnPlanCode

--==============================================================================================================================--


-- 執行時間：2017/05/11 08:42:55.260 
-- 連線字串：name=HPAGBCEntities 
--==============================================================================================================================--
DECLARE @codCodeVer AS INT
SET @codCodeVer = 106
DECLARE @isAll AS NVARCHAR(1000)
SET @isAll = N'0'



-- DECLARE @codCodeVer AS INT
-- SET @codCodeVer = 105
-- DECLARE @isAll AS VARCHAR(1)
-- SET @isAll = '1'
----------------------------------以前年度----------------------------------
SELECT DISTINCT
	    PC.codCodeVer, 
	    CONVERT(VARCHAR, PC.codCodeVer) + '_' + PC.plnPlanCode AS plnPlanCode, 
	    '（' + CONVERT(VARCHAR, PC.codCodeVer) + '年度）' + '[' + PC.plnPlanCode + '] ' + plnPlanName AS plnPlanName, 
	    PC.plnLevelEnd ,PC.plnLevel 
FROM tsbDecideDtl DD 
	JOIN codPlanCode PC 
		ON DD.tsbOutlayYear = PC.codCodeVer AND DD.tsbPlanCode = PC.plnPlanCode
WHERE  DD.tsbOutlayYear <> DD.tsbYear AND DD.tsbYear = @codCodeVer AND @isAll = '1'
----------------------------------------------------------------------------
UNION ALL
----------------------------------現在年度----------------------------------
SELECT  PC.codCodeVer, 
        CONVERT(VARCHAR, PC.codCodeVer) + '_' + PC.plnPlanCode AS plnPlanCode, 
        CASE WHEN @isAll = '1' 
             THEN '（' + CONVERT(VARCHAR, PC.codCodeVer) + '年度）'
             ELSE '' END
            + '[' + PC.plnPlanCode + '] ' + plnPlanName AS plnPlanName, 
        PC.plnLevelEnd ,PC.plnLevel 
FROM codPlanCode PC
WHERE codCodeVer = @codCodeVer 
----------------------------------------------------------------------------
ORDER BY codCodeVer DESC, plnPlanCode

--==============================================================================================================================--


-- 執行時間：2017/05/11 08:42:58.824 
-- 連線字串：name=HPAGBCEntities 
--==============================================================================================================================--
DECLARE @codCodeVer AS INT
SET @codCodeVer = 106
DECLARE @isAll AS NVARCHAR(1000)
SET @isAll = N'0'



-- DECLARE @codCodeVer AS INT
-- SET @codCodeVer = 105
-- DECLARE @isAll AS VARCHAR(1)
-- SET @isAll = '1'
----------------------------------以前年度----------------------------------
SELECT DISTINCT
	    PC.codCodeVer, 
	    CONVERT(VARCHAR, PC.codCodeVer) + '_' + PC.plnPlanCode AS plnPlanCode, 
	    '（' + CONVERT(VARCHAR, PC.codCodeVer) + '年度）' + '[' + PC.plnPlanCode + '] ' + plnPlanName AS plnPlanName, 
	    PC.plnLevelEnd ,PC.plnLevel 
FROM tsbDecideDtl DD 
	JOIN codPlanCode PC 
		ON DD.tsbOutlayYear = PC.codCodeVer AND DD.tsbPlanCode = PC.plnPlanCode
WHERE  DD.tsbOutlayYear <> DD.tsbYear AND DD.tsbYear = @codCodeVer AND @isAll = '1'
----------------------------------------------------------------------------
UNION ALL
----------------------------------現在年度----------------------------------
SELECT  PC.codCodeVer, 
        CONVERT(VARCHAR, PC.codCodeVer) + '_' + PC.plnPlanCode AS plnPlanCode, 
        CASE WHEN @isAll = '1' 
             THEN '（' + CONVERT(VARCHAR, PC.codCodeVer) + '年度）'
             ELSE '' END
            + '[' + PC.plnPlanCode + '] ' + plnPlanName AS plnPlanName, 
        PC.plnLevelEnd ,PC.plnLevel 
FROM codPlanCode PC
WHERE codCodeVer = @codCodeVer 
----------------------------------------------------------------------------
ORDER BY codCodeVer DESC, plnPlanCode

--==============================================================================================================================--


-- 執行時間：2017/05/11 08:42:58.833 
-- 連線字串：name=HPAGBCEntities 
--==============================================================================================================================--
DECLARE @codCodeVer AS INT
SET @codCodeVer = 106
DECLARE @isAll AS NVARCHAR(1000)
SET @isAll = N'0'



-- DECLARE @codCodeVer AS INT
-- SET @codCodeVer = 105
-- DECLARE @isAll AS VARCHAR(1)
-- SET @isAll = '1'
----------------------------------以前年度----------------------------------
SELECT DISTINCT
	    PC.codCodeVer, 
	    CONVERT(VARCHAR, PC.codCodeVer) + '_' + PC.plnPlanCode AS plnPlanCode, 
	    '（' + CONVERT(VARCHAR, PC.codCodeVer) + '年度）' + '[' + PC.plnPlanCode + '] ' + plnPlanName AS plnPlanName, 
	    PC.plnLevelEnd ,PC.plnLevel 
FROM tsbDecideDtl DD 
	JOIN codPlanCode PC 
		ON DD.tsbOutlayYear = PC.codCodeVer AND DD.tsbPlanCode = PC.plnPlanCode
WHERE  DD.tsbOutlayYear <> DD.tsbYear AND DD.tsbYear = @codCodeVer AND @isAll = '1'
----------------------------------------------------------------------------
UNION ALL
----------------------------------現在年度----------------------------------
SELECT  PC.codCodeVer, 
        CONVERT(VARCHAR, PC.codCodeVer) + '_' + PC.plnPlanCode AS plnPlanCode, 
        CASE WHEN @isAll = '1' 
             THEN '（' + CONVERT(VARCHAR, PC.codCodeVer) + '年度）'
             ELSE '' END
            + '[' + PC.plnPlanCode + '] ' + plnPlanName AS plnPlanName, 
        PC.plnLevelEnd ,PC.plnLevel 
FROM codPlanCode PC
WHERE codCodeVer = @codCodeVer 
----------------------------------------------------------------------------
ORDER BY codCodeVer DESC, plnPlanCode

--==============================================================================================================================--


--執行時間--  2017/5/11 上午 08:43:24
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：4
Declare @tsbYear As Int
Set @tsbYear = 106
Declare @SDate As DateTime
Set @SDate = '2017/01/01 00:00:00'
Declare @EDate As DateTime
Set @EDate = '2017/05/31 00:00:00'
Declare @tsbIsAudit As NVarChar(2)
Set @tsbIsAudit = '0'

SELECT  (CASE WHEN GROUPING(動支編號)=0 THEN MAX(組室) ELSE '' END) as 組室別,
        (CASE WHEN GROUPING(業務計畫代碼)=1 THEN '合計'
              WHEN GROUPING(工作計畫代碼)=1 THEN MAX(業務計畫名稱)
              WHEN  GROUPING(分支計畫代碼)=1 THEN MAX(工作計畫名稱)
              WHEN  GROUPING(動支編號)=1 THEN MAX(分支計畫名稱)
              ELSE '' END) as 計畫名稱,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(動支編號) ELSE '' END) as 動支編號,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票日期) ELSE '' END) as 傳票日期,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票號碼) ELSE '' END) as 傳票號碼,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(接受委託單位或個人名稱) ELSE '' END) as 接受委託單位或個人名稱,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(委託辦理事項) ELSE '' END) as 委託辦理事項,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(用途別) ELSE '' END) as 用途別,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(主持人) ELSE '' END) as 主持人,
        SUM(合約金額) as 合約金額,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(訂約日期) ELSE '' END) as 訂約日期,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(完成時間_預訂) ELSE '' END) as 完成時間_預訂,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(完成時間_實際) ELSE '' END) as 完成時間_實際,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫執行期間) ELSE '' END) as 計畫執行期間,
        SUM(金額) as 金額,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(縣市別) ELSE '' END) as 縣市別
FROM 
(

SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
    -- --基金_委託辦理計畫(事項)經費明細表
    -- Declare @tsbYear As Int
    -- Set @tsbYear = 105
    -- Declare @DateStart As datetime
    -- Set @DateStart = '2016/01/01'
    -- Declare @DateEnd As datetime
    -- Set @DateEnd = '2016/09/30'
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------
	SELECT  X.tsbApplyWordNum as 動支編號,
            X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo, X.tsbDecideSeq,
            X.oulOutlayCode, X.oulOutlayName,
            X.業務計畫代碼, X.業務計畫名稱, 
            X.工作計畫代碼,X.工作計畫名稱,
            X.分支計畫代碼, X.分支計畫名稱, 
            X.dptCode, X.dptName as 組室,
            ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, 
                                                                    X.tsbDecideNo,X.tsbDecideSeq,
			                                                        'tsbExchPassDate','1','PayAndEstimate') , ',' , char(13)+char(10) 
                            ) , '' ) as 傳票日期,
            ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, 
                                                                    X.tsbDecideNo,X.tsbDecideSeq,
			                                                        'tsbExchNo','1','PayAndEstimate') , ',' , char(13)+char(10) 
                            ) , '' ) as 傳票號碼,
            X.tsbPayeeName AS 接受委託單位或個人名稱, X.tsbTrustSubsidyName AS 委託辦理事項,   
            X.oulOutlayCode + X.oulOutlayName AS 用途別,
            X.tsbHostName AS 主持人, X.tsbPayeeRoleNo, X.tsbCityName as 縣市別,
            ISNULL(X.tsbContractMoney, X.tsbMoney) AS 合約金額,
            ISNULL(X.PlanDate, '') AS 計畫執行期間,
            CONVERT(varchar, ISNULL(X.tsbContractDTime,X.tsbDecideDate), 111) AS 訂約日期,
            X.ContractBDate AS 完成時間_預訂,
            X.ContractEDate AS 完成時間_實際,
		    Y.估列金額 + Y.費用 - Y.估列高估沖銷金額 - Y.核銷繳回金額 as 金額 -- 累計實際支用金額
	FROM
	(
		------------------　　核定資料Start　　-----------------
        SELECT  GTD.tsbApplyWordNum, GTD.tsbYear, 
                GTD.tsbApplyNo, GTD.tsbApplySeq, 
                GTD.tsbDecideNo, GTD.tsbDecideSeq, 
                GTD.tsbPayeeNo, GTD.tsbPayeeName, 
                GTD.業務計畫代碼, GTD.業務計畫名稱 ,GTD.工作計畫代碼, GTD.工作計畫名稱, GTD.分支計畫代碼,
                GTD.有編號的分支計畫名稱 AS 分支計畫名稱,
                GTD.plnPlanCode, GTD.plnPlanName, 
                GTD.oulOutlayCode, GTD.oulOutlayName , 
                GTD.tsbTrustSubsidyName, GTD.dptCode, GTD.dptName,
                GTD.tsbMarkUserNo, GTD.tsbMemo ,
                GTD.tsbWorkUserNo, GTD.tsbPassDTime, 
                GTD.tsbPayeeRoleNo, GTD.tsbPayeeRoleName, GTD.tsbCityName,
                GTD.tsbCityAreaName, GTD.tsbHostName, GTD.tsbMoney, GTD.tsbDecideDate,
                CAST( DATEPART(YY, FEP.PlanBDate) -1911 AS VARCHAR) +  
                RIGHT(CAST(100 + DATEPART(MM, FEP.PlanBDate) AS VARCHAR), 2) +   
                RIGHT(CAST(100 + DATEPART(DD, FEP.PlanBDate) AS VARCHAR), 2) + '-' +
                CAST( DATEPART(YY, FEP.PlanBDate)-1911 AS VARCHAR) +  
                RIGHT(CAST(100 + DATEPART(MM, FEP.PlanBDate) AS VARCHAR), 2) +   
                RIGHT(CAST(100 + DATEPART(DD, FEP.PlanBDate) AS VARCHAR), 2) AS PlanDate,
                ISNULL( CONVERT(varchar, FEP.ContractBDate, 111), '') AS ContractBDate,
                ISNULL( CONVERT(varchar, FEP.ContractEDate, 111), '') AS ContractEDate,
                ISNULL(FEP.ContractDate, GTD.tsbContractDTime) AS tsbContractDTime,
                ISNULL(FEP.ContractMoney, GTD.tsbContractMoney) AS tsbContractMoney
		FROM dbo.fn_GetTsbDecideDT(@tsbYear, '1') GTD
        LEFT JOIN tsbficEntrustPara FEP
            ON  GTD.tsbYear = FEP.tsbYear 
            AND GTD.tsbApplyNo = FEP.tsbApplyNo AND GTD.tsbApplySeq = FEP.tsbApplySeq 
            AND GTD.tsbDecideNo = FEP.tsbDecideNo AND GTD.tsbDecideSeq = FEP.tsbDecideSeq
		WHERE GTD.tsbYear = GTD.tsbOutlayYear -- 只顯示當年度資料
		AND (GTD.oulOutlayCode = N'281' OR GTD.oulOutlayCode = N'286' OR GTD.oulOutlayCode = N'287' OR
             GTD.oulOutlayCode = N'288' OR GTD.oulOutlayCode = N'28A')
		------------------　　核定資料 End 　　-----------------
	) X
	INNER JOIN
    (
        -- 只顯示當年度資料(tsbYear = tsbOutlayYear)，且只抓 ２８ 向下用途別。（核定再更細部去抓。）
        -- 參數：（ 年度 , 計畫年度 , 計畫科目 , 用途別 , 起始日期 , 結束日期 , 案件類別 , 是否有傳票號碼 ）
        SELECT * FROM [dbo].[fn_GetMixDT](@tsbYear, @tsbYear, NULL, '28', @DateStart, @DateEnd, NULL, '1', @tsbIsAudit)
	) Y
    ON  X.tsbYear = Y.tsbYear 
    AND X.tsbApplyNo = Y.tsbApplyNo AND X.tsbApplySeq = Y.tsbApplySeq 
    AND X.tsbDecideNo = Y.tsbDecideNo AND X.tsbDecideSeq = Y.tsbDecideSeq
    -- ORDER BY X.tsbApplyWordNum, X.tsbDecideSeq
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND 用途別 LIKE '%286%' 

 ORDER BY 用途別, 業務計畫代碼,工作計畫代碼,分支計畫代碼,dptCode

) D
GROUP BY 業務計畫代碼, 工作計畫代碼, 分支計畫代碼, 動支編號, 用途別, 接受委託單位或個人名稱 WITH ROLLUP 
HAVING GROUPING(業務計畫代碼)=0 and (GROUPING(動支編號) = GROUPING(接受委託單位或個人名稱))
ORDER BY 業務計畫代碼, 工作計畫代碼, 分支計畫代碼, 用途別, 組室別, 動支編號 ,傳票日期


------------------------------------------------------------

--執行時間--  2017/5/11 上午 08:43:31
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：4
Declare @tsbYear As Int
Set @tsbYear = 106
Declare @SDate As DateTime
Set @SDate = '2017/01/01 00:00:00'
Declare @EDate As DateTime
Set @EDate = '2017/05/31 00:00:00'
Declare @tsbIsAudit As NVarChar(2)
Set @tsbIsAudit = '0'

SELECT  (CASE WHEN GROUPING(動支編號)=0 THEN MAX(組室) ELSE '' END) as 組室別,
        (CASE WHEN GROUPING(業務計畫代碼)=1 THEN '合計'
              WHEN GROUPING(工作計畫代碼)=1 THEN MAX(業務計畫名稱)
              WHEN  GROUPING(分支計畫代碼)=1 THEN MAX(工作計畫名稱)
              WHEN  GROUPING(動支編號)=1 THEN MAX(分支計畫名稱)
              ELSE '' END) as 計畫名稱,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(動支編號) ELSE '' END) as 動支編號,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票日期) ELSE '' END) as 傳票日期,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票號碼) ELSE '' END) as 傳票號碼,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(接受委託單位或個人名稱) ELSE '' END) as 接受委託單位或個人名稱,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(委託辦理事項) ELSE '' END) as 委託辦理事項,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(用途別) ELSE '' END) as 用途別,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(主持人) ELSE '' END) as 主持人,
        SUM(合約金額) as 合約金額,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(訂約日期) ELSE '' END) as 訂約日期,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(完成時間_預訂) ELSE '' END) as 完成時間_預訂,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(完成時間_實際) ELSE '' END) as 完成時間_實際,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫執行期間) ELSE '' END) as 計畫執行期間,
        SUM(金額) as 金額,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(縣市別) ELSE '' END) as 縣市別
FROM 
(

SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
    -- --基金_委託辦理計畫(事項)經費明細表
    -- Declare @tsbYear As Int
    -- Set @tsbYear = 105
    -- Declare @DateStart As datetime
    -- Set @DateStart = '2016/01/01'
    -- Declare @DateEnd As datetime
    -- Set @DateEnd = '2016/09/30'
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------
	SELECT  X.tsbApplyWordNum as 動支編號,
            X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo, X.tsbDecideSeq,
            X.oulOutlayCode, X.oulOutlayName,
            X.業務計畫代碼, X.業務計畫名稱, 
            X.工作計畫代碼,X.工作計畫名稱,
            X.分支計畫代碼, X.分支計畫名稱, 
            X.dptCode, X.dptName as 組室,
            ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, 
                                                                    X.tsbDecideNo,X.tsbDecideSeq,
			                                                        'tsbExchPassDate','1','PayAndEstimate') , ',' , char(13)+char(10) 
                            ) , '' ) as 傳票日期,
            ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, 
                                                                    X.tsbDecideNo,X.tsbDecideSeq,
			                                                        'tsbExchNo','1','PayAndEstimate') , ',' , char(13)+char(10) 
                            ) , '' ) as 傳票號碼,
            X.tsbPayeeName AS 接受委託單位或個人名稱, X.tsbTrustSubsidyName AS 委託辦理事項,   
            X.oulOutlayCode + X.oulOutlayName AS 用途別,
            X.tsbHostName AS 主持人, X.tsbPayeeRoleNo, X.tsbCityName as 縣市別,
            ISNULL(X.tsbContractMoney, X.tsbMoney) AS 合約金額,
            ISNULL(X.PlanDate, '') AS 計畫執行期間,
            CONVERT(varchar, ISNULL(X.tsbContractDTime,X.tsbDecideDate), 111) AS 訂約日期,
            X.ContractBDate AS 完成時間_預訂,
            X.ContractEDate AS 完成時間_實際,
		    Y.估列金額 + Y.費用 - Y.估列高估沖銷金額 - Y.核銷繳回金額 as 金額 -- 累計實際支用金額
	FROM
	(
		------------------　　核定資料Start　　-----------------
        SELECT  GTD.tsbApplyWordNum, GTD.tsbYear, 
                GTD.tsbApplyNo, GTD.tsbApplySeq, 
                GTD.tsbDecideNo, GTD.tsbDecideSeq, 
                GTD.tsbPayeeNo, GTD.tsbPayeeName, 
                GTD.業務計畫代碼, GTD.業務計畫名稱 ,GTD.工作計畫代碼, GTD.工作計畫名稱, GTD.分支計畫代碼,
                GTD.有編號的分支計畫名稱 AS 分支計畫名稱,
                GTD.plnPlanCode, GTD.plnPlanName, 
                GTD.oulOutlayCode, GTD.oulOutlayName , 
                GTD.tsbTrustSubsidyName, GTD.dptCode, GTD.dptName,
                GTD.tsbMarkUserNo, GTD.tsbMemo ,
                GTD.tsbWorkUserNo, GTD.tsbPassDTime, 
                GTD.tsbPayeeRoleNo, GTD.tsbPayeeRoleName, GTD.tsbCityName,
                GTD.tsbCityAreaName, GTD.tsbHostName, GTD.tsbMoney, GTD.tsbDecideDate,
                CAST( DATEPART(YY, FEP.PlanBDate) -1911 AS VARCHAR) +  
                RIGHT(CAST(100 + DATEPART(MM, FEP.PlanBDate) AS VARCHAR), 2) +   
                RIGHT(CAST(100 + DATEPART(DD, FEP.PlanBDate) AS VARCHAR), 2) + '-' +
                CAST( DATEPART(YY, FEP.PlanBDate)-1911 AS VARCHAR) +  
                RIGHT(CAST(100 + DATEPART(MM, FEP.PlanBDate) AS VARCHAR), 2) +   
                RIGHT(CAST(100 + DATEPART(DD, FEP.PlanBDate) AS VARCHAR), 2) AS PlanDate,
                ISNULL( CONVERT(varchar, FEP.ContractBDate, 111), '') AS ContractBDate,
                ISNULL( CONVERT(varchar, FEP.ContractEDate, 111), '') AS ContractEDate,
                ISNULL(FEP.ContractDate, GTD.tsbContractDTime) AS tsbContractDTime,
                ISNULL(FEP.ContractMoney, GTD.tsbContractMoney) AS tsbContractMoney
		FROM dbo.fn_GetTsbDecideDT(@tsbYear, '1') GTD
        LEFT JOIN tsbficEntrustPara FEP
            ON  GTD.tsbYear = FEP.tsbYear 
            AND GTD.tsbApplyNo = FEP.tsbApplyNo AND GTD.tsbApplySeq = FEP.tsbApplySeq 
            AND GTD.tsbDecideNo = FEP.tsbDecideNo AND GTD.tsbDecideSeq = FEP.tsbDecideSeq
		WHERE GTD.tsbYear = GTD.tsbOutlayYear -- 只顯示當年度資料
		AND (GTD.oulOutlayCode = N'281' OR GTD.oulOutlayCode = N'286' OR GTD.oulOutlayCode = N'287' OR
             GTD.oulOutlayCode = N'288' OR GTD.oulOutlayCode = N'28A')
		------------------　　核定資料 End 　　-----------------
	) X
	INNER JOIN
    (
        -- 只顯示當年度資料(tsbYear = tsbOutlayYear)，且只抓 ２８ 向下用途別。（核定再更細部去抓。）
        -- 參數：（ 年度 , 計畫年度 , 計畫科目 , 用途別 , 起始日期 , 結束日期 , 案件類別 , 是否有傳票號碼 ）
        SELECT * FROM [dbo].[fn_GetMixDT](@tsbYear, @tsbYear, NULL, '28', @DateStart, @DateEnd, NULL, '1', @tsbIsAudit)
	) Y
    ON  X.tsbYear = Y.tsbYear 
    AND X.tsbApplyNo = Y.tsbApplyNo AND X.tsbApplySeq = Y.tsbApplySeq 
    AND X.tsbDecideNo = Y.tsbDecideNo AND X.tsbDecideSeq = Y.tsbDecideSeq
    -- ORDER BY X.tsbApplyWordNum, X.tsbDecideSeq
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND 用途別 LIKE '%285%' 

 ORDER BY 用途別, 業務計畫代碼,工作計畫代碼,分支計畫代碼,dptCode

) D
GROUP BY 業務計畫代碼, 工作計畫代碼, 分支計畫代碼, 動支編號, 用途別, 接受委託單位或個人名稱 WITH ROLLUP 
HAVING GROUPING(業務計畫代碼)=0 and (GROUPING(動支編號) = GROUPING(接受委託單位或個人名稱))
ORDER BY 業務計畫代碼, 工作計畫代碼, 分支計畫代碼, 用途別, 組室別, 動支編號 ,傳票日期


------------------------------------------------------------

--執行時間--  2017/5/11 上午 08:43:37
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：4
Declare @tsbYear As Int
Set @tsbYear = 106
Declare @SDate As DateTime
Set @SDate = '2017/01/01 00:00:00'
Declare @EDate As DateTime
Set @EDate = '2017/05/31 00:00:00'
Declare @tsbIsAudit As NVarChar(2)
Set @tsbIsAudit = '0'

SELECT  (CASE WHEN GROUPING(動支編號)=0 THEN MAX(組室) ELSE '' END) as 組室別,
        (CASE WHEN GROUPING(業務計畫代碼)=1 THEN '合計'
              WHEN GROUPING(工作計畫代碼)=1 THEN MAX(業務計畫名稱)
              WHEN  GROUPING(分支計畫代碼)=1 THEN MAX(工作計畫名稱)
              WHEN  GROUPING(動支編號)=1 THEN MAX(分支計畫名稱)
              ELSE '' END) as 計畫名稱,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(動支編號) ELSE '' END) as 動支編號,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票日期) ELSE '' END) as 傳票日期,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票號碼) ELSE '' END) as 傳票號碼,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(接受委託單位或個人名稱) ELSE '' END) as 接受委託單位或個人名稱,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(委託辦理事項) ELSE '' END) as 委託辦理事項,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(用途別) ELSE '' END) as 用途別,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(主持人) ELSE '' END) as 主持人,
        SUM(合約金額) as 合約金額,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(訂約日期) ELSE '' END) as 訂約日期,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(完成時間_預訂) ELSE '' END) as 完成時間_預訂,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(完成時間_實際) ELSE '' END) as 完成時間_實際,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫執行期間) ELSE '' END) as 計畫執行期間,
        SUM(金額) as 金額,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(縣市別) ELSE '' END) as 縣市別
FROM 
(

SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
    -- --基金_委託辦理計畫(事項)經費明細表
    -- Declare @tsbYear As Int
    -- Set @tsbYear = 105
    -- Declare @DateStart As datetime
    -- Set @DateStart = '2016/01/01'
    -- Declare @DateEnd As datetime
    -- Set @DateEnd = '2016/09/30'
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------
	SELECT  X.tsbApplyWordNum as 動支編號,
            X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo, X.tsbDecideSeq,
            X.oulOutlayCode, X.oulOutlayName,
            X.業務計畫代碼, X.業務計畫名稱, 
            X.工作計畫代碼,X.工作計畫名稱,
            X.分支計畫代碼, X.分支計畫名稱, 
            X.dptCode, X.dptName as 組室,
            ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, 
                                                                    X.tsbDecideNo,X.tsbDecideSeq,
			                                                        'tsbExchPassDate','1','PayAndEstimate') , ',' , char(13)+char(10) 
                            ) , '' ) as 傳票日期,
            ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, 
                                                                    X.tsbDecideNo,X.tsbDecideSeq,
			                                                        'tsbExchNo','1','PayAndEstimate') , ',' , char(13)+char(10) 
                            ) , '' ) as 傳票號碼,
            X.tsbPayeeName AS 接受委託單位或個人名稱, X.tsbTrustSubsidyName AS 委託辦理事項,   
            X.oulOutlayCode + X.oulOutlayName AS 用途別,
            X.tsbHostName AS 主持人, X.tsbPayeeRoleNo, X.tsbCityName as 縣市別,
            ISNULL(X.tsbContractMoney, X.tsbMoney) AS 合約金額,
            ISNULL(X.PlanDate, '') AS 計畫執行期間,
            CONVERT(varchar, ISNULL(X.tsbContractDTime,X.tsbDecideDate), 111) AS 訂約日期,
            X.ContractBDate AS 完成時間_預訂,
            X.ContractEDate AS 完成時間_實際,
		    Y.估列金額 + Y.費用 - Y.估列高估沖銷金額 - Y.核銷繳回金額 as 金額 -- 累計實際支用金額
	FROM
	(
		------------------　　核定資料Start　　-----------------
        SELECT  GTD.tsbApplyWordNum, GTD.tsbYear, 
                GTD.tsbApplyNo, GTD.tsbApplySeq, 
                GTD.tsbDecideNo, GTD.tsbDecideSeq, 
                GTD.tsbPayeeNo, GTD.tsbPayeeName, 
                GTD.業務計畫代碼, GTD.業務計畫名稱 ,GTD.工作計畫代碼, GTD.工作計畫名稱, GTD.分支計畫代碼,
                GTD.有編號的分支計畫名稱 AS 分支計畫名稱,
                GTD.plnPlanCode, GTD.plnPlanName, 
                GTD.oulOutlayCode, GTD.oulOutlayName , 
                GTD.tsbTrustSubsidyName, GTD.dptCode, GTD.dptName,
                GTD.tsbMarkUserNo, GTD.tsbMemo ,
                GTD.tsbWorkUserNo, GTD.tsbPassDTime, 
                GTD.tsbPayeeRoleNo, GTD.tsbPayeeRoleName, GTD.tsbCityName,
                GTD.tsbCityAreaName, GTD.tsbHostName, GTD.tsbMoney, GTD.tsbDecideDate,
                CAST( DATEPART(YY, FEP.PlanBDate) -1911 AS VARCHAR) +  
                RIGHT(CAST(100 + DATEPART(MM, FEP.PlanBDate) AS VARCHAR), 2) +   
                RIGHT(CAST(100 + DATEPART(DD, FEP.PlanBDate) AS VARCHAR), 2) + '-' +
                CAST( DATEPART(YY, FEP.PlanBDate)-1911 AS VARCHAR) +  
                RIGHT(CAST(100 + DATEPART(MM, FEP.PlanBDate) AS VARCHAR), 2) +   
                RIGHT(CAST(100 + DATEPART(DD, FEP.PlanBDate) AS VARCHAR), 2) AS PlanDate,
                ISNULL( CONVERT(varchar, FEP.ContractBDate, 111), '') AS ContractBDate,
                ISNULL( CONVERT(varchar, FEP.ContractEDate, 111), '') AS ContractEDate,
                ISNULL(FEP.ContractDate, GTD.tsbContractDTime) AS tsbContractDTime,
                ISNULL(FEP.ContractMoney, GTD.tsbContractMoney) AS tsbContractMoney
		FROM dbo.fn_GetTsbDecideDT(@tsbYear, '1') GTD
        LEFT JOIN tsbficEntrustPara FEP
            ON  GTD.tsbYear = FEP.tsbYear 
            AND GTD.tsbApplyNo = FEP.tsbApplyNo AND GTD.tsbApplySeq = FEP.tsbApplySeq 
            AND GTD.tsbDecideNo = FEP.tsbDecideNo AND GTD.tsbDecideSeq = FEP.tsbDecideSeq
		WHERE GTD.tsbYear = GTD.tsbOutlayYear -- 只顯示當年度資料
		AND (GTD.oulOutlayCode = N'281' OR GTD.oulOutlayCode = N'286' OR GTD.oulOutlayCode = N'287' OR
             GTD.oulOutlayCode = N'288' OR GTD.oulOutlayCode = N'28A')
		------------------　　核定資料 End 　　-----------------
	) X
	INNER JOIN
    (
        -- 只顯示當年度資料(tsbYear = tsbOutlayYear)，且只抓 ２８ 向下用途別。（核定再更細部去抓。）
        -- 參數：（ 年度 , 計畫年度 , 計畫科目 , 用途別 , 起始日期 , 結束日期 , 案件類別 , 是否有傳票號碼 ）
        SELECT * FROM [dbo].[fn_GetMixDT](@tsbYear, @tsbYear, NULL, '28', @DateStart, @DateEnd, NULL, '1', @tsbIsAudit)
	) Y
    ON  X.tsbYear = Y.tsbYear 
    AND X.tsbApplyNo = Y.tsbApplyNo AND X.tsbApplySeq = Y.tsbApplySeq 
    AND X.tsbDecideNo = Y.tsbDecideNo AND X.tsbDecideSeq = Y.tsbDecideSeq
    -- ORDER BY X.tsbApplyWordNum, X.tsbDecideSeq
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   
 ORDER BY 用途別, 業務計畫代碼,工作計畫代碼,分支計畫代碼,dptCode

) D
GROUP BY 業務計畫代碼, 工作計畫代碼, 分支計畫代碼, 動支編號, 用途別, 接受委託單位或個人名稱 WITH ROLLUP 
HAVING GROUPING(業務計畫代碼)=0 and (GROUPING(動支編號) = GROUPING(接受委託單位或個人名稱))
ORDER BY 業務計畫代碼, 工作計畫代碼, 分支計畫代碼, 用途別, 組室別, 動支編號 ,傳票日期


------------------------------------------------------------

--執行時間--  2017/5/11 上午 08:44:15
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：4
Declare @tsbYear As Int
Set @tsbYear = 106
Declare @SDate As DateTime
Set @SDate = '2017/01/01 00:00:00'
Declare @EDate As DateTime
Set @EDate = '2017/05/31 00:00:00'
Declare @tsbIsAudit As NVarChar(2)
Set @tsbIsAudit = '0'

SELECT  (CASE WHEN GROUPING(動支編號)=0 THEN MAX(組室) ELSE '' END) as 組室別,
        (CASE WHEN GROUPING(業務計畫代碼)=1 THEN '合計'
              WHEN GROUPING(工作計畫代碼)=1 THEN MAX(業務計畫名稱)
              WHEN  GROUPING(分支計畫代碼)=1 THEN MAX(工作計畫名稱)
              WHEN  GROUPING(動支編號)=1 THEN MAX(分支計畫名稱)
              ELSE '' END) as 計畫名稱,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(動支編號) ELSE '' END) as 動支編號,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票日期) ELSE '' END) as 傳票日期,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(傳票號碼) ELSE '' END) as 傳票號碼,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(接受委託單位或個人名稱) ELSE '' END) as 接受委託單位或個人名稱,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(委託辦理事項) ELSE '' END) as 委託辦理事項,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(用途別) ELSE '' END) as 用途別,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(主持人) ELSE '' END) as 主持人,
        SUM(合約金額) as 合約金額,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(訂約日期) ELSE '' END) as 訂約日期,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(完成時間_預訂) ELSE '' END) as 完成時間_預訂,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(完成時間_實際) ELSE '' END) as 完成時間_實際,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(計畫執行期間) ELSE '' END) as 計畫執行期間,
        SUM(金額) as 金額,
        (CASE WHEN GROUPING(動支編號)=0 THEN MAX(縣市別) ELSE '' END) as 縣市別
FROM 
(

SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
    -- --基金_委託辦理計畫(事項)經費明細表
    -- Declare @tsbYear As Int
    -- Set @tsbYear = 105
    -- Declare @DateStart As datetime
    -- Set @DateStart = '2016/01/01'
    -- Declare @DateEnd As datetime
    -- Set @DateEnd = '2016/09/30'
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------
	SELECT  X.tsbApplyWordNum as 動支編號,
            X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, X.tsbDecideNo, X.tsbDecideSeq,
            X.oulOutlayCode, X.oulOutlayName,
            X.業務計畫代碼, X.業務計畫名稱, 
            X.工作計畫代碼,X.工作計畫名稱,
            X.分支計畫代碼, X.分支計畫名稱, 
            X.dptCode, X.dptName as 組室,
            ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, 
                                                                    X.tsbDecideNo,X.tsbDecideSeq,
			                                                        'tsbExchPassDate','1','PayAndEstimate') , ',' , char(13)+char(10) 
                            ) , '' ) as 傳票日期,
            ISNULL( REPLACE( dbo.fn_GettsbPayExchNoOrExchPassDate(X.tsbYear, X.tsbApplyNo, X.tsbApplySeq, 
                                                                    X.tsbDecideNo,X.tsbDecideSeq,
			                                                        'tsbExchNo','1','PayAndEstimate') , ',' , char(13)+char(10) 
                            ) , '' ) as 傳票號碼,
            X.tsbPayeeName AS 接受委託單位或個人名稱, X.tsbTrustSubsidyName AS 委託辦理事項,   
            X.oulOutlayCode + X.oulOutlayName AS 用途別,
            X.tsbHostName AS 主持人, X.tsbPayeeRoleNo, X.tsbCityName as 縣市別,
            ISNULL(X.tsbContractMoney, X.tsbMoney) AS 合約金額,
            ISNULL(X.PlanDate, '') AS 計畫執行期間,
            CONVERT(varchar, ISNULL(X.tsbContractDTime,X.tsbDecideDate), 111) AS 訂約日期,
            X.ContractBDate AS 完成時間_預訂,
            X.ContractEDate AS 完成時間_實際,
		    Y.估列金額 + Y.費用 - Y.估列高估沖銷金額 - Y.核銷繳回金額 as 金額 -- 累計實際支用金額
	FROM
	(
		------------------　　核定資料Start　　-----------------
        SELECT  GTD.tsbApplyWordNum, GTD.tsbYear, 
                GTD.tsbApplyNo, GTD.tsbApplySeq, 
                GTD.tsbDecideNo, GTD.tsbDecideSeq, 
                GTD.tsbPayeeNo, GTD.tsbPayeeName, 
                GTD.業務計畫代碼, GTD.業務計畫名稱 ,GTD.工作計畫代碼, GTD.工作計畫名稱, GTD.分支計畫代碼,
                GTD.有編號的分支計畫名稱 AS 分支計畫名稱,
                GTD.plnPlanCode, GTD.plnPlanName, 
                GTD.oulOutlayCode, GTD.oulOutlayName , 
                GTD.tsbTrustSubsidyName, GTD.dptCode, GTD.dptName,
                GTD.tsbMarkUserNo, GTD.tsbMemo ,
                GTD.tsbWorkUserNo, GTD.tsbPassDTime, 
                GTD.tsbPayeeRoleNo, GTD.tsbPayeeRoleName, GTD.tsbCityName,
                GTD.tsbCityAreaName, GTD.tsbHostName, GTD.tsbMoney, GTD.tsbDecideDate,
                CAST( DATEPART(YY, FEP.PlanBDate) -1911 AS VARCHAR) +  
                RIGHT(CAST(100 + DATEPART(MM, FEP.PlanBDate) AS VARCHAR), 2) +   
                RIGHT(CAST(100 + DATEPART(DD, FEP.PlanBDate) AS VARCHAR), 2) + '-' +
                CAST( DATEPART(YY, FEP.PlanBDate)-1911 AS VARCHAR) +  
                RIGHT(CAST(100 + DATEPART(MM, FEP.PlanBDate) AS VARCHAR), 2) +   
                RIGHT(CAST(100 + DATEPART(DD, FEP.PlanBDate) AS VARCHAR), 2) AS PlanDate,
                ISNULL( CONVERT(varchar, FEP.ContractBDate, 111), '') AS ContractBDate,
                ISNULL( CONVERT(varchar, FEP.ContractEDate, 111), '') AS ContractEDate,
                ISNULL(FEP.ContractDate, GTD.tsbContractDTime) AS tsbContractDTime,
                ISNULL(FEP.ContractMoney, GTD.tsbContractMoney) AS tsbContractMoney
		FROM dbo.fn_GetTsbDecideDT(@tsbYear, '1') GTD
        LEFT JOIN tsbficEntrustPara FEP
            ON  GTD.tsbYear = FEP.tsbYear 
            AND GTD.tsbApplyNo = FEP.tsbApplyNo AND GTD.tsbApplySeq = FEP.tsbApplySeq 
            AND GTD.tsbDecideNo = FEP.tsbDecideNo AND GTD.tsbDecideSeq = FEP.tsbDecideSeq
		WHERE GTD.tsbYear = GTD.tsbOutlayYear -- 只顯示當年度資料
		AND (GTD.oulOutlayCode = N'281' OR GTD.oulOutlayCode = N'286' OR GTD.oulOutlayCode = N'287' OR
             GTD.oulOutlayCode = N'288' OR GTD.oulOutlayCode = N'28A')
		------------------　　核定資料 End 　　-----------------
	) X
	INNER JOIN
    (
        -- 只顯示當年度資料(tsbYear = tsbOutlayYear)，且只抓 ２８ 向下用途別。（核定再更細部去抓。）
        -- 參數：（ 年度 , 計畫年度 , 計畫科目 , 用途別 , 起始日期 , 結束日期 , 案件類別 , 是否有傳票號碼 ）
        SELECT * FROM [dbo].[fn_GetMixDT](@tsbYear, @tsbYear, NULL, '28', @DateStart, @DateEnd, NULL, '1', @tsbIsAudit)
	) Y
    ON  X.tsbYear = Y.tsbYear 
    AND X.tsbApplyNo = Y.tsbApplyNo AND X.tsbApplySeq = Y.tsbApplySeq 
    AND X.tsbDecideNo = Y.tsbDecideNo AND X.tsbDecideSeq = Y.tsbDecideSeq
    -- ORDER BY X.tsbApplyWordNum, X.tsbDecideSeq
	--------  ★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★★  --------

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   
 ORDER BY 用途別, 業務計畫代碼,工作計畫代碼,分支計畫代碼,dptCode

) D
GROUP BY 業務計畫代碼, 工作計畫代碼, 分支計畫代碼, 動支編號, 用途別, 接受委託單位或個人名稱 WITH ROLLUP 
HAVING GROUPING(業務計畫代碼)=0 and (GROUPING(動支編號) = GROUPING(接受委託單位或個人名稱))
ORDER BY 業務計畫代碼, 工作計畫代碼, 分支計畫代碼, 用途別, 組室別, 動支編號 ,傳票日期


------------------------------------------------------------

--#2017/5/11 上午 10:09:56#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT DISTINCT A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -100 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
--#2017/5/11 上午 10:09:57#  http://localhost/HPAGBC/HPAGFC/approved.Web/Frmapproved_approved/Default.aspx?MenuID=B17621
SELECT TOP 1 N.*,D.* FROM sysGroupName N Join sysUserPower U ON N.PK_grpNo=U.PK_grpNo Join sysGroupData D ON N.PK_grpNo=D.PK_grpNo where U.PK_usrNo=1 AND D.PK_mnuNo='B17621' ORDER BY ISNULL(grpLevel,99),N.PK_grpNo
-------------------------------------------------------------------------------
--執行時間--  2017/5/11 上午 10:09:58
--連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363
--參數個數：1
Declare @PK_MnuNo As NVarChar(12)
Set @PK_MnuNo = 'B17621'

SELECT TOP 100 PERCENT *
  FROM sysMenuBase A
 WHERE 1 = 1
   AND (A.PK_MnuNo = @PK_MnuNo OR @PK_MnuNo IS NULL)
 ORDER BY A.PK_MnuNo

------------------------------------------------------------

-- 執行時間：2017/05/11 10:09:58.555 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/11 10:09:59.101 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/11 10:09:59.191 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codDepartName A
    WHERE 1 = 1
    ORDER BY  A.dptCode    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/11 10:09:59.211 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT *
    FROM codPlanCode A
    WHERE 1 = 1
    ORDER BY  A.plnPlanCode ,A.codCodeVer    ---A.bnkBankNo, A.bnksBankSubNo

GO
-- ==============================================================================================================================


-- 執行時間：2017/05/11 10:09:59.622 
-- 連線字串：Data Source=localhost;Initial Catalog=HPAGFC;Persist Security Info=True;User ID=sa;Password=3363 



SELECT TOP 100 PERCENT
    *
  FROM
(
    --#region ↓↓ 原始 SQL ↓↓ ------------------------------------------------------------------------------------------------
    
--寫在tsbApplyRepository.cs (核定專案檔)
SELECT 

(SELECT  TOP 1 C.tsbApplyWordNum   from tsbApply as C  
                     WHERE C.tsbYear =A.tsbYear 
                     AND   c.tsbApplyNo =A.tsbApplyNo 
                    
                                                    )  as AtsbApplyWordNum,  ---會籤編號

  A.tsbYear
, A.tsbApplyNo
, A.tsbTSBYear
, A.tsbTrustSubsidyName
--, A.tsbKindID
, A.tsbKindNum
, A.tsbPlanCode
, A.tsbBgtYear
, A.tsbBgtMonth
, A.tsbBgtUnitNo
, A.tsbApplyWordNum
, A.tsbLastApplyWordNum
, A.tsbMarkDate
, A.tsbMarkUnitNo
, A.tsbMarkUserNo
, A.tsbWorkUnitNo
, A.tsbWorkUserNo
, A.tsbMoney
, A.tsbMemo
, A.tsbSubMemo
, A.tsbCreateDTime
, A.tsbCreateUser
, A.tsbModifyDTime
, A.tsbModifyUser
, A.tsbPassFlag
, A.tsbPassDTime
, A.tsbPassUser
, A.IsTransfer
, A.IsInterest

,B.tsbDecideNo
,B.tsbPassFlag AS DtsbPassFlag
,B.tsbMoney as  DtsbMoney
,B.tsbDecideDate 
,B.tsbMemo as DtsbMemo
,B.tsbPassDTime as DtsbPassDTime
,B.tsbWorkUnitNo as BtsbWorkUnitNo
,B.tsbWorkUserNo as  BtsbWorkUserNo



--,B.tsbPayeeKind

from  dbo.tsbApply as A
LEFT join  dbo.tsbDecide as B 
                     on A.tsbYear =B.tsbYear 
                     AND  A.tsbApplyNo =B.tsbApplyNo 
WHERE A.tsbPassFlag='1'   
  AND A.tsbKindNum='Case'    

    --#endregion ↑↑ ---------------------------------------------------------------------------------------------------------
) A
 WHERE 1 = 1
   AND A.tsbYear LIKE '%106%' 

 ORDER BY tsbApplyWordNum DESC,tsbDecideNo DESC

GO
-- ==============================================================================================================================


--#2017/5/11 下午 05:01:02#  http://localhost/HPAGBC/intro.aspx
SELECT 'Powered by Microsoft SQL Server ' + CONVERT(nvarchar,SERVERPROPERTY('ProductVersion')) + ' ' + CONVERT(nvarchar,SERVERPROPERTY('ProductLevel'))
-------------------------------------------------------------------------------
--#2017/5/11 下午 05:01:02#  http://localhost/HPAGBC/Menu.aspx
SELECT DISTINCT (SELECT TOP 1 A2.PK_MnuNo  FROM  sysUserPower C2 INNER JOIN  sysGroupData D2 ON C2.PK_grpNo = D2.PK_grpNo INNER JOIN  sysMenuBase A2 ON A2.PK_MnuNo = D2.PK_mnuNo WHERE  (C2.PK_usrNo = 1)  AND ISNULL(mnuLevel,0)> -90 AND A.PK_MnuNo LIKE A2.PK_MnuNo + '_%'  ORDER BY  A2.PK_MnuNo DESC) AS ParentPK_MnuNo, A.* FROM sysUserPower C INNER JOIN  sysGroupData D ON C.PK_grpNo = D.PK_grpNo INNER JOIN  sysMenuBase A ON A.PK_MnuNo = D.PK_mnuNo WHERE  (C.PK_usrNo = 1) AND ISNULL(mnuLevel,0)> -90 ORDER BY A.PK_MnuNo
-------------------------------------------------------------------------------
